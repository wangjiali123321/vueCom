!function(d,Y){"use strict";var V=ht.AlarmSeverity=function(v,e,W,L,w){this.value=v,this.name=e,this.nickName=W,this.color=L,this.displayName=w};ht.Default.def("ht.AlarmSeverity",Y,{toString:function(){return this.displayName||this.name}}),function(){V.severities=new ht.List,V._vm={},V._nm={},V._cp=function(Q,T){if(Q&&T){var S=Q.value-T.value;return S>0?1:0>S?-1:0}return Q&&!T?1:!Q&&T?-1:0},V.each=function(K,U){V.severities.each(K,U)},V.getSortFunction=function(){return V._cp},V.setSortFunction=function(k){V._cp=k,V.severities.sort(k)},V.add=function(D,d,F,Z,f){var w=new V(D,d,F,Z,f);return V._vm[D]=w,V._nm[d]=w,V.severities.add(w),V.severities.sort(V._cp),w},V.remove=function(_){var B=V._nm[_];return B&&(delete V._nm[_],delete V._vm[B.value],V.severities.remove(B)),B},V.CRITICAL=V.add(500,"Critical","C","#FF0000"),V.MAJOR=V.add(400,"Major","M","#FFA000"),V.MINOR=V.add(300,"Minor","m","#FFFF00"),V.WARNING=V.add(200,"Warning","W","#00FFFF"),V.INDETERMINATE=V.add(100,"Indeterminate","N","#C800FF"),V.CLEARED=V.add(0,"Cleared","R","#00FF00"),V.isClearedAlarmSeverity=function(W){return W?0===W.value:!1},V.getByName=function(L){return V._nm[L]},V.getByValue=function(U){return V._vm[U]},V.clear=function(){V.severities.clear(),V._vm={},V._nm={}},V.compare=function(y,w){return V._cp(y,w)}}();var v=ht.AlarmState=function(D){this._d=D,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",Y,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var R=null;for(var Q in this._am)Q=V.getByName(Q),V.isClearedAlarmSeverity(Q)||0!==this.getAcknowledgedAlarmCount(Q)&&(R=R?V.compare(R,Q)>0?R:Q:Q);this._haa=R},_c2:function(){var N=null;for(var $ in this._nm)$=V.getByName($),V.isClearedAlarmSeverity($)||0!==this.getNewAlarmCount($)&&(N=N?V.compare(N,$)>0?N:$:$);this._hna=N},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var b in this._nm)if(b=V.getByName(b),!V.isClearedAlarmSeverity(b)&&0!==this.getNewAlarmCount(b)&&V.compare(this._hna,b)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var i=this._haa,a=this._hna,q=this._ps;this._hoa=i,V.compare(a,this._hoa)>0&&(this._hoa=a),V.compare(q,this._hoa)>0&&(this._hoa=q)},_c5:function(){var U=this._haa,O=this._hna;this._hta=U,V.compare(O,this._hta)>0&&(this._hta=O)},increaseAcknowledgedAlarm:function(s,_){if(0!==_){_=_||1;var j=this._am[s.name]||0;j+=_,this._am[s.name]=j,this._f()}},increaseNewAlarm:function(C,M){if(0!==M){M=M||1;var $=this._nm[C.name]||0;$+=M,this._nm[C.name]=$,this._f()}},decreaseAcknowledgedAlarm:function(p,V){if(0!==V){V||(V=1);var D=this._am[p.name]||0;if(D-=V,0>D)throw"Alarm count can not be negative";this._am[p.name]=D,this._f()}},decreaseNewAlarm:function(Y,C){if(0!==C){C||(C=1);var D=this._nm[Y.name]||0;if(D-=C,0>D)throw"Alarm count can not be negative";this._nm[Y.name]=D,this._f()}},acknowledgeAlarm:function(y){this.decreaseNewAlarm(y,1),this.increaseAcknowledgedAlarm(y,1)},acknowledgeAllAlarms:function(S){if(S){var T=this.getNewAlarmCount(S);this.decreaseNewAlarm(S,T),this.increaseAcknowledgedAlarm(S,T)}else for(var x in this._nm)this.acknowledgeAllAlarms(V.getByName(x))},_c6:function(){this._aac=0;for(var x in this._am)x=V.getByName(x),this._aac+=this.getAcknowledgedAlarmCount(x)},getAcknowledgedAlarmCount:function(g){return g?this._am[g.name]||0:this._aac},getAlarmCount:function(x){return this.getAcknowledgedAlarmCount(x)+this.getNewAlarmCount(x)},_c7:function(){this._nac=0;for(var Y in this._nm)this._nac+=this.getNewAlarmCount(V.getByName(Y))},getNewAlarmCount:function(L){return L?this._nm[L.name]||0:this._nac},setNewAlarmCount:function(N,P){this._nm[N.name]=P,this._f()},removeAllNewAlarms:function(Y){Y?delete this._nm[Y]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(f,u){this._am[f.name]=u,this._f()},removeAllAcknowledgedAlarms:function(s){s?delete this._am[s.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(Q){if(this._ep||(Q=null),this._ps!==Q){var w=this._ps;this._ps=Q,this._f(),this._d.fp("propagateSeverity",w,Q)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(X){var x=this._ep;this._ep=X,this._d.fp("enablePropagation",x,X)&&(X||this.setPropagateSeverity(null))}});var Q=ht.AlarmStatePropagator=function(c){this._dataModel=c,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",Y,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(Y){this._enable!==Y&&(this._enable=Y,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(l){this.propagate(l)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(E){E.data&&this.propagate(E.data)},handleDataPropertyChange:function(f){if("alarmState"===f.property||"enablePropagation"===f.property)this.propagate(f.data);else if("parent"===f.property){var j=f.oldValue;j&&this.propagate(j),this.propagate(f.data)}},propagate:function(T){T&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(T),this._isPropagating=!1)},propagateToTop:function(B){for(this.propagateToParent(null,B);B&&B.getParent();)this.propagateToParent(B,B.getParent()),B=B.getParent()},propagateToParent:function(I,U){var S=null;U.getChildren().each(function(l){var m=l.getAlarmState().getHighestOverallAlarmSeverity();V.compare(m,S)>0&&(S=m)}),U.getAlarmState().setPropagateSeverity(S)}}),ht.AlarmStateStatistics=function(e){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(e)},ht.Default.def("ht.AlarmStateStatistics",Y,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function($){var V=this._dataModel;V!==$&&(V&&(V.umd(this.handleDataPropertyChange,this),V.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=$,this.reset(),$.md(this.handleDataPropertyChange,this),$.mm(this.handleDataModelChange,this),this.fp("dataModel",V,$))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(x){"alarmState"===x.property&&(this.increase(x.data),this.fireAlarmStateChange())},handleDataModelChange:function(q){"add"===q.kind?(this.increase(q.data),this.fireAlarmStateChange()):"remove"===q.kind?(this.decrease(q.data),this.fireAlarmStateChange()):"clear"===q.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,V.each(function(D){var j=this.getSumInfo(D);this.sumAcked+=j.ackedCount,this.sumNew+=j.newCount,this.sumTotal+=j.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(I){if(!I)return this.sumNew;var P=this.getSumInfo(I);return P.newCount},getAcknowledgedAlarmCount:function(x){if(!x)return this.sumAcked;var t=this.getSumInfo(x);return t.ackedCount},getTotalAlarmCount:function(w){if(!w)return this.sumTotal;var r=this.getSumInfo(w);return r.totalCount},getSumInfo:function(w){var k=this.severtiyMap[w.name];return k||(k={},k.newCount=0,k.ackedCount=0,k.totalCount=0,this.severtiyMap[w.name]=k),k},decrease:function(K){var Q=this.dataMap[K.getId()];Q&&(delete this.dataMap[K.getId()],V.each(function(t){var T=Q[t.name],N=this.getSumInfo(t);N.newCount=N.newCount-T.newCount,N.ackedCount=N.ackedCount-T.ackedCount,N.totalCount=N.totalCount-T.totalCount},this))},increase:function(J){if(this.decrease(J),!this._filterFunc||this._filterFunc(J)){var z={},T=J.getAlarmState();this.dataMap[J.getId()]=z,V.each(function(m){var V={};V.newCount=T.getNewAlarmCount(m),V.ackedCount=T.getAcknowledgedAlarmCount(m),V.totalCount=T.getAlarmCount(m),z[m.name]=V;var g=this.getSumInfo(m);g.newCount=g.newCount+V.newCount,g.ackedCount=g.ackedCount+V.ackedCount,g.totalCount=g.totalCount+V.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(j){var _=this._filterFunc;this._filterFunc=j,this.reset(),this.fp("filterFunc",_,j)},getFilterFunc:function(){return this._filterFunc}});var p=ht.Data.prototype;p.getAlarmState=function(){return this._alarmState||(this._alarmState=new v(this))},p=ht.DataModel.prototype,p.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},p.setEnableAlarmStatePropagator=function(c){c!=this.isEnableAlarmStatePropagator()&&(c?(this._alarmStatePropagator=new Q(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},p=ht.graph.GraphView.prototype,p.getNote2=function(k){var Y=k.getAlarmState().getHighestNewAlarmSeverity();if(Y){var R=k.getAlarmState().getNewAlarmCount(Y)+Y.nickName;return k.getAlarmState().hasLessSevereNewAlarms()&&(R+="+"),R}return k.s("note2")},p.getNote2Background=function(W){var R=W.getAlarmState().getHighestNewAlarmSeverity();return R?R.color:W.s("note2.background")},p.getBodyColor=function(X){var d=X.getAlarmState().getHighestNativeAlarmSeverity();return d?d.color:X.s("body.color")},p.getBorderColor=function(x){var n=x.getAlarmState().getPropagateSeverity();return n?n.color:x.s("border.color")},p=ht.widget.TreeView.prototype,p.getBorderColor=function(n){var V=n.getAlarmState().getPropagateSeverity();return V?V.color:n.s("border.color")},p.getIcon=function(T){return T.getIcon()?"__alarmIcon__":null},p=ht.widget.TreeTableView.prototype,p.getBorderColor=function(s){var T=s.getAlarmState().getPropagateSeverity();return T?T.color:s.s("border.color")},p.getIcon=function(Y){return Y.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(i){return i.getIcon()}},color:{func:function(r){var l=r.getAlarmState().getHighestNativeAlarmSeverity();return l?l.color:r.s("body.color")}},rect:[0,0,16,16]}]});var M=ht.Style;M["note2.expanded"]=!0,M["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);
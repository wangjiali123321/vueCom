!function(A,W){"use strict";var N="ht",P=N+".layout.",i=A[N]||module.parent.exports.ht,M=i.List,G=i.DataModel,H=i.Node,l=i.Edge,j=i.Group,T=Math,D=T.sqrt,d=T.random,c=T.max,R=T.min,Z=function(P){return P*P};i.Default.getInternal().addMSMap({ms_force:function(x){x._interval=50,x._stepCount=10,x._motionLimit=.01,x._edgeRepulsion=.65,x._nodeRepulsion=.65,x._damper=1,x._maxMotion=0,x._motionRatio=0,x.init=function(I){var x=this;I instanceof G?x.dm=I:x.gv=I,x._nodeMap={},x._nodes=new M,x._edges=new M},x.start=function(){var c=this,O=c.gv;if(!c._timer){var n=c.cdm=O?O.dm():c.dm;n.mm(c.handleDataModelChange,c),n.md(c.handleDataPropertyChange,c),O&&O.mp(c.handleGV,c),n.each(function(f){if(c.isVisible(f)&&c.isLayoutable(f)&&f instanceof H)if(c instanceof F){var B=f.p3();f.p3([B[0]+d(),B[1]+d(),B[2]+d()])}else B=f.p(),f.p(B.x+d(),B.y+d())}),c._timer=setInterval(function(){c.relax()},c._interval),c._damper=1}},x.stop=function(){var I=this;I._timer&&(I.cdm.umm(I.handleDataModelChange,I),I.cdm.umd(I.handleDataPropertyChange,I),I.gv&&I.gv.ump(I.handleGV,I),clearInterval(I._timer),delete I._timer,delete I.cdm)},x.handleGV=function(H){var b=this;if("dataModel"===H.property){var w=H.oldValue,g=H.newValue;w&&(w.umm(b.handleDataModelChange,b),w.umd(b.handleDataPropertyChange,b)),this.cdm=g,g.mm(b.handleDataModelChange,b),g.md(b.handleDataPropertyChange,b)}},x.relax=function(){var D=this;if(!(D._damper<.1&&D._maxMotion<D._motionLimit)){this.cdm.each(function(k){D.isVisible(k)&&(k instanceof l?D.addEdge(k):k instanceof H&&D.addNode(k))});for(var S,i,N=0,L=D._edges,z=D._nodes,M=z.size();N<D._stepCount;N++){for(L.each(D.relaxEdge,D),S=0;M>S;S++)for(i=0;M>i;i++)D.relaxNode(z.get(S),z.get(i));D.moveNode()}D._isAdjusting=1,z.each(function(E){E.fix||(E.p?E.v.p3(E.p):E.v.p(E.x,E.y))}),delete D._isAdjusting,D._nodeMap={},z.clear(),L.clear(),D.onRelaxed()}},x.onRelaxed=function(){},x.isRunning=function(){return!!this._timer},x.isVisible=function(L){return L.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(L):!0},x.isLayoutable=function(A){if(A.s("layoutable")===!1)return!1;if(A instanceof j)return!1;var m=this;return m.gv?m.gv.isMovable(A)&&!m.gv.isSelected(A):!(m.cdm||m.dm).sm().co(A)},x.getNodeRepulsion=function(){return this._nodeRepulsion},x.setNodeRepulsion=function(w){this._nodeRepulsion=w,this._damper=1},x.getEdgeRepulsion=function(){return this._edgeRepulsion},x.setEdgeRepulsion=function(C){this._edgeRepulsion=C,this._damper=1},x.getStepCount=function(){return this._stepCount},x.setStepCount=function(I){this._stepCount=I,this._damper=1},x.getInterval=function(){return this._interval},x.setInterval=function(j){var N=this;N._interval!==j&&(N._interval=j,N._timer&&(clearInterval(N._timer),N._timer=setInterval(function(){N.relax()},j)))},x.handleDataPropertyChange=function(B){!this._isAdjusting&&this.isVisible(B.data)&&(this._damper=1)},x.handleDataModelChange=function(){this._damper=1},x.damp=function(){var O=this._maxMotion,L=this._damper;this._motionRatio<=.001&&((.2>O||O>1&&.9>L)&&L>.01?this._damper-=.01:.4>O&&L>.003?this._damper-=.003:L>1e-4&&(this._damper-=1e-4)),O<this._motionLimit&&(this._damper=0)}}}),i.layout.ForceLayout=function(q){this.init(q)},i.Default.def(P+"ForceLayout",W,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function($){this._limitBounds=$,this._damper=1},getNodeSize:function(G){var P=this.gv;return P&&P.getDataUIBounds?P.getDataUIBounds(G):G.getRect()},addNode:function(m){var W=this,M=W._nodeMap[m._id];if(M)return M;var T=m.p();M={v:m,x:T.x,y:T.y,dx:0,dy:0,fix:!W.isLayoutable(m),s:W.getNodeSize(m)};var o=M.s,g=D(Z(o.width)+Z(o.height))*W._nodeRepulsion;return M.r=1>g?100:g,W._nodeMap[m._id]=M,W._nodes.add(M),M},addEdge:function(P){if(P._40I&&P._41I){var I=this,w=I.addNode(P._40I),b=I.addNode(P._41I),k={s:w,t:b};b=b.s,w=w.s;var Y=b.width+w.width,p=b.height+w.height;k.length=D(Y*Y+p*p)*I._edgeRepulsion,k.length<=0&&(k.length=100),I._edges.add(k)}},relaxEdge:function(s){var $=s.t,f=s.s,k=$.x-f.x,R=$.y-f.y,O=D(k*k+R*R),S=100*s.length,b=.25*k/S*O,t=.25*R/S*O;$.dx=$.dx-b,$.dy=$.dy-t,f.dx=f.dx+b,f.dy=f.dy+t},relaxNode:function(Q,J){if(Q!==J){var o=0,s=0,i=Q.x-J.x,B=Q.y-J.y,q=i*i+B*B;0===q?(o=d(),s=d()):36e4>q&&(o=i/q,s=B/q);var v=Q.r*J.r/400;o*=v,s*=v,Q.dx+=o,Q.dy+=s,J.dx-=o,J.dy-=s}},moveNode:function(){var i=this,x=i._limitBounds,s=i._maxMotion,k=0,d=i._damper;i._nodes.each(function(B){if(!B.fix){var J=B.dx*d,w=B.dy*d;if(B.dx=J/2,B.dy=w/2,k=c(D(J*J+w*w),k),B.x+=c(-40,R(40,J)),B.y+=c(-40,R(40,w)),x){B.x<x.x&&(B.x=x.x,i.adjust(1,0)),B.y<x.y&&(B.y=x.y,i.adjust(0,1));var U=B.s;B.x+U.width>x.x+x.width&&(B.x=x.x+x.width-U.width,i.adjust(-1,0)),B.y+U.height>x.y+x.height&&(B.y=x.y+x.height-U.height,i.adjust(0,-1))}}}),i._maxMotion=k,i._motionRatio=k>0?s/k-1:0,i.damp()},adjust:function(S,m){var c=this._limitBounds;this._nodes.each(function($){S>0?(!c||$.x+$.s.width+S<c.x+c.width)&&($.x+=S):(!c||$.x+S>c.x)&&($.x+=S),m>0?(!c||$.y+$.s.height+m<c.y+c.height)&&($.y+=m):(!c||$.y+m>c.y)&&($.y+=m)})}});var F=i.layout.Force3dLayout=function(B){this.init(B)};i.Default.def(P+"Force3dLayout",W,{ms_force:1,getNodeSize3d:function(v){return v.s3()},addNode:function(o){var Z=this,f=Z._nodeMap[o._id];if(f)return f;f={v:o,p:o.p3(),d:[0,0,0],fix:!Z.isLayoutable(o),s:Z.getNodeSize3d(o)};var p=f.s,b=i.Default.getDistance(p)*Z._nodeRepulsion;return f.r=1>b?100:b,Z._nodeMap[o._id]=f,Z._nodes.add(f),f},addEdge:function(Y){if(Y._40I&&Y._41I){var r=this,_=r.addNode(Y._40I),q=r.addNode(Y._41I),v={s:_,t:q};q=q.s,_=_.s,v.length=D(Z(q[0]+_[0])+Z(q[1]+_[1])+Z(q[2]+_[2]))*r._edgeRepulsion,v.length<=0&&(v.length=100),r._edges.add(v)}},relaxEdge:function(b){var R=b.t.p,g=b.s.p,q=b.t.d,n=b.s.d,U=R[0]-g[0],J=R[1]-g[1],v=R[2]-g[2],V=D(U*U+J*J+v*v),u=100*b.length,c=.25*U/u*V,G=.25*J/u*V,p=.25*v/u*V;q[0]-=c,q[1]-=G,q[2]-=p,n[0]+=c,n[1]+=G,n[2]+=p},relaxNode:function(P,w){if(P!==w){var Z=P.p,q=w.p,X=0,v=0,H=0,T=Z[0]-q[0],u=Z[1]-q[1],k=Z[2]-q[2],r=T*T+u*u+k*k;0===r?(X=d(),v=d(),H=d()):216e6>r&&(X=T/r,v=u/r,H=k/r);var Y=P.r*w.r/400,F=P.d,j=w.d;X*=Y,v*=Y,H*=Y,F[0]+=X,F[1]+=v,F[2]+=H,j[0]-=X,j[1]-=v,j[2]-=H}},moveNode:function(){var x=this,F=x._maxMotion,$=0,L=x._damper;x._nodes.each(function(h){if(!h.fix){var W=h.p,m=h.d,K=m[0]*L,Q=m[1]*L,z=m[2]*L;m[0]=K/2,m[1]=Q/2,m[2]=z/2,$=c(D(K*K+Q*Q+z*z),$),W[0]+=c(-40,R(40,K)),W[1]+=c(-40,R(40,Q)),W[2]+=c(-40,R(40,z))}}),x._maxMotion=$,x._motionRatio=$>0?F/$-1:0,x.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);
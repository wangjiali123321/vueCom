!function(y,n,m){"use strict";var l=y.ht;l.Astar={},function(z){var R=z();y.AStar=R.astar,y.AStar.Graph=R.Graph}(function(){function w(e){for(var H=e,K=[];H.parent;)K.unshift(H),H=H.parent;return K}function q(){return new x(function(n){return n.f})}function N(M,j){j=j||{},this.nodes=[],this.diagonal=!!j.diagonal,this.grid=[];for(var W=0;W<M.length;W++){this.grid[W]=[];for(var w=0,L=M[W];w<L.length;w++){var b=new D(W,w,L[w]);this.grid[W][w]=b,this.nodes.push(b)}}this.$13x()}function D(A,v,E){this.x=A,this.y=v,this.weight=E}function x(n){this.content=[],this.scoreFunction=n}var B={search:function(P,Q,F,S){P.$6x(),S=S||{};var z=S.heuristic;z||(z=P.diagonal?B.$4x.diagonal:B.$4x.manhattan);var L=S.closest||!1,j=S.punish,N=q(),d=Q;for(Q.h=z(Q,F),P.$7x(Q),N.push(Q);N.size()>0;){var f=N.pop();if(f===F)return w(f);f.closed=!0;for(var T=P.neighbors(f),H=0,A=T.length;A>H;++H){var t=T[H];if(!t.closed&&!t.$9x()){var O=f.g+t.getCost(f,j),g=t.visited;(!g||O<t.g)&&(t.visited=!0,t.parent=f,t.h=t.h||z(t,F),t.g=O,t.f=t.g+t.h,P.$7x(t),L&&(t.h<d.h||t.h===d.h&&t.g<d.g)&&(d=t),g?N.$10x(t):N.push(t))}}}return L?w(d):[]},$4x:{manhattan:function(G,E){var S=Math.abs(E.x-G.x),s=Math.abs(E.y-G.y);return S+s},diagonal:function(Q,j){var i=1,y=Math.sqrt(2),G=Math.abs(j.x-Q.x),F=Math.abs(j.y-Q.y);return i*(G+F)+(y-2*i)*Math.min(G,F)}},$5x:function(l){l.f=0,l.g=0,l.h=0,l.visited=!1,l.closed=!1,l.parent=null}};return N.prototype.$13x=function(){this.dirtyNodes=[];for(var g=0;g<this.nodes.length;g++)B.$5x(this.nodes[g])},N.prototype.$6x=function(){for(var h=0;h<this.dirtyNodes.length;h++)B.$5x(this.dirtyNodes[h]);this.dirtyNodes=[]},N.prototype.$7x=function(q){this.dirtyNodes.push(q)},N.prototype.neighbors=function(v){var z=[],j=v.x,H=v.y,l=this.grid;return l[j-1]&&l[j-1][H]&&z.push(l[j-1][H]),l[j+1]&&l[j+1][H]&&z.push(l[j+1][H]),l[j]&&l[j][H-1]&&z.push(l[j][H-1]),l[j]&&l[j][H+1]&&z.push(l[j][H+1]),this.diagonal&&(l[j-1]&&l[j-1][H-1]&&z.push(l[j-1][H-1]),l[j+1]&&l[j+1][H-1]&&z.push(l[j+1][H-1]),l[j-1]&&l[j-1][H+1]&&z.push(l[j-1][H+1]),l[j+1]&&l[j+1][H+1]&&z.push(l[j+1][H+1])),z},N.prototype.toString=function(){for(var p=[],M=this.grid,g=0;g<M.length;g++){for(var a=[],W=M[g],C=0;C<W.length;C++)a.push(W[C].weight);p.push(a.join(" "))}return p.join("\n")},D.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},D.prototype.getCost=function(X,h){var q;if(q=X&&X.x!=this.x&&X.y!=this.y?1.41421*this.weight:this.weight,h){var $=X;if(!$)return q;var v=$.parent;return v?Math.abs(v.x+this.x-2*$.x)>1e-5?q+h:Math.abs(v.y+this.y-2*$.y)>1e-5?q+h:q:q}},D.prototype.$9x=function(){return 0===this.weight},x.prototype={push:function(E){this.content.push(E),this.$11x(this.content.length-1)},pop:function(){var j=this.content[0],L=this.content.pop();return this.content.length>0&&(this.content[0]=L,this.$12x(0)),j},remove:function(f){var Y=this.content.indexOf(f),v=this.content.pop();Y!==this.content.length-1&&(this.content[Y]=v,this.scoreFunction(v)<this.scoreFunction(f)?this.$11x(Y):this.$12x(Y))},size:function(){return this.content.length},$10x:function(c){this.$11x(this.content.indexOf(c))},$11x:function(x){for(var o=this.content[x];x>0;){var Z=(x+1>>1)-1,b=this.content[Z];if(!(this.scoreFunction(o)<this.scoreFunction(b)))break;this.content[Z]=o,this.content[x]=b,x=Z}},$12x:function(F){for(var A=this.content.length,h=this.content[F],_=this.scoreFunction(h);;){var D,w=F+1<<1,x=w-1,H=null;if(A>x){var b=this.content[x];D=this.scoreFunction(b),_>D&&(H=x)}if(A>w){var Y=this.content[w],r=this.scoreFunction(Y);(null===H?_:D)>r&&(H=w)}if(null===H)break;this.content[F]=this.content[H],this.content[H]=h,F=H}}},{astar:B,Graph:N}});var w=l.Astar.Finder=function(k,v){var T=this;T.gv=k,T.$13x(v),T.refreshMap()};w.prototype={},w.prototype.constructor=w,n.defineProperties(w.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(j){this.gv._astarDebugInfo=j}}}),w.prototype.$13x=function(N){var J=this,y=J.$14x={};N=N||{};var O=N.gridSize||10;y.gridSizeX=N.gridSizeX||O,y.gridSizeY=N.gridSizeY||O,y.rect=N.rect,y.filter=N.filter,y.extendBlocks=N.extendBlocks||3,y.fastOverlap=N.fastOverlap===m?!0:N.fastOverlap,y.nodeRectExtend=N.nodeRectExtend||0,y.diagonal=N.diagonal===m?!0:N.diagonal,y.turnPunish=N.turnPunish===m?.1:N.turnPunish,y.simplify=N.simplify===m?!0:N.simplify,y.toGridCenter=N.toGridCenter===m?!1:N.toGridCenter,y.closest=N.closest===m?!0:N.closest},w.prototype.refreshMap=function(){var V,y=this,I=y.$14x,G=I.gridSizeX,N=I.gridSizeY,Y=I.extendBlocks;I.rect?V=I.rect:(V=y.$15x(),l.Default.grow(V,G*Y,N*Y)),l.Default.grow(V,G,N);var F=Math.floor(V.x/G)*G,E=Math.floor(V.y/N)*N,n=Math.ceil(V.width/G),f=Math.ceil(V.height/N),T=n*G,O=f*N;y.$16x={x:F,y:E,w:T,h:O,gridX:G,gridY:N,xLen:n,yLen:f},y.$17x(),y.$21x()},w.prototype.$15x=function(){var d=this.gv;if(d instanceof l.graph.GraphView)return d.getContentRect();var R,B=l.Default.unionRect;return d.dm().each(function(l){d.isVisible(l)&&l.getRect&&(R=B(R,l.getRect()))}),R},w.prototype.$17x=function(){var _,O,q,j,s=this,t=s.$16x,J=t.xLen,I=t.yLen;for(_=new Array(J),q=0;J>q;q++)for(_[q]=O=new Array(I),j=I;j--;)O[j]=1;var Y=s.$14x.filter;for(s.gv.dm().each(function(F){Y&&Y(F)===!1||(!s._debugInfo||F!==s._debugInfo.grid&&F!=s._debugInfo.path)&&s.$1cw(_,F)}),q=0;J>q;q++)_[q][0]=1,_[q][I-1]=1;for(j=0;I>j;j++)_[0][j]=1,_[J-1][j]=1;s.grid=_;var D=new AStar.Graph(_,{diagonal:s.$14x.diagonal});s.graph=D},w.prototype.$18x=function(Q,O,l,T,a,x,c,j){var q=this.$19x,U=q(l-Q,a-c,T-O,x-j);if(1e-6>=U&&U>=-1e-6)return!1;var N=q(a-Q,a-c,x-O,x-j)/U;if(0>N||N>1)return!1;var P=q(l-Q,a-Q,T-O,x-O)/U;return 0>P||P>1?!1:!0},w.prototype.$19x=function(P,w,Y,r){return P*r-w*Y},w.prototype.$1aw=function(O,v,o,z){for(var H=[-(v[1]-O[1]),v[0]-O[0]],l=H[0]*(o[0]-O[0])+H[1]*(o[1]-O[1])>=0,m=0,_=z.length;_>m;m+=2)if(H[0]*(z[m]-O[0])+H[1]*(z[m+1]-O[1])>=0===l)return!1;return!0},w.prototype.$1bw=function(K,o){for(var $,L,v=this,r=0,J=K.length;J>r;r+=2)if($=r===J-2?0:r+2,L=$===J-2?0:$+2,v.$1aw([K[r],K[r+1]],[K[$],K[$+1]],[K[L],K[L+1]],o))return!1;for(var r=0,J=o.length;J>r;r+=2)if($=r===J-2?0:r+2,L=$===J-2?0:$+2,v.$1aw([o[r],o[r+1]],[o[$],o[$+1]],[o[L],o[L+1]],K))return!1;return!0},w.prototype.$1cw=function(K,h){if(h.getRect){var b=this,_=h.getRect();l.Default.grow(_,b.$14x.nodeRectExtend);var p,e,Y,V,Q,T,U,S,k,E,v,G=b.$1dw({x:_.x,y:_.y}),Z=b.$1dw({x:_.x+_.width,y:_.y+_.height}),w=b.$14x.fastOverlap;if(!w){var F=h.getCorners();U=[],F.forEach(function(L){U.push(L.x,L.y)}),E=b.$14x.gridSizeX/2,v=b.$14x.gridSizeY/2}for(e=Math.max(0,G.x),Y=Math.min(Z.x,K.length-1),Q=Math.max(0,G.y),T=Math.min(Z.y,K.length?K[0].length-1:-1),p=e;Y>=p;p++)for(V=Q;T>=V;V++)if(w)K[p][V]=0;else{k=b.$1ew({x:p,y:V});var y=k.x-E,i=k.x+E,B=k.y-v,X=k.y+v;S=[y,B,y,X,i,X,i,B],b.$1bw(U,S)&&(K[p][V]=0)}}},w.prototype.$1dw=function(N,i){var x=this,l=x.$16x,o=(N.x-l.x)/l.gridX,z=(N.y-l.y)/l.gridY;return i!==!1&&(o=Math.round(o),z=Math.round(z)),{x:o,y:z}},w.prototype.$1ew=function(o){var L=this,G=L.$16x;return{x:o.x*G.gridX+G.x,y:o.y*G.gridY+G.y}},w.prototype.$1fw=function(d){var l=this,P=l.$16x,I=P.xLen,q=P.yLen;if(d.x>=0&&d.x<I&&d.y>=0&&d.y<q)return d;var R={x:d.x,y:d.y};return R.x<0?R.x=0:R.x>=I&&(R.x=I-1),R.y<0?R.y=0:R.y>=q&&(R.y=q-1),R},w.prototype.findPath=function(u,l){var J,z,V,y,_=this,U=_.$1dw(u),g=_.$1dw(l);if(V=_.$1fw(U),y=_.$1fw(g),V!==U&&y!==g){var h=_.$16x,e=h.x-h.gridX/2,Y=h.y-h.gridY/2,p=e+h.gridX*h.xLen,t=Y+h.gridY*h.yLen;if(!(_.$18x(u.x,u.y,l.x,l.y,e,Y,p,Y)||_.$18x(u.x,u.y,l.x,l.y,p,Y,p,t)||_.$18x(u.x,u.y,l.x,l.y,p,t,e,t)||_.$18x(u.x,u.y,l.x,l.y,e,t,e,Y)))return[u,l]}V!==U&&(J=!0,U=V),y!==g&&(z=!0,g=y);var R=_.graph.grid[U.x][U.y],N=_.graph.grid[g.x][g.y],k=AStar.search(_.graph,R,N,{closest:_.$14x.closest,punish:_.$14x.turnPunish});if(!k||!k.length)return null;var K=[];K.push(u),J&&K.push(_.$1ew(k[0]));for(var P=1,f=k.length;f-1>P;P++)K.push(_.$1ew(k[P]));if(z)K.push(_.$1ew(k[f-1])),K.push(l);else{var O=k[f-1];g.x!==O.x||g.y!==O.y||_.$14x.toGridCenter?K.push(_.$1ew(O)):K.push(l)}return _.$14x.simplify&&(K=_.simplifyPath(K)),_.$20x=K,_.$21x(),K},w.prototype.debugOn=function(Z){this.debugFlag=!0,this.debugSettings=Z||{},this.$21x()},w.prototype.simplifyPath=function(T){var V=T.length;if(2>=V)return T;var e,O,z=[T[0],T[1]],Q=z[0],o=z[1],d=1e-5;for(e=2;V>e;e++)O=T[e],Math.abs((o.x-Q.x)*(O.y-Q.y)-(o.y-Q.y)*(O.x-Q.x))<d?o=z[z.length-1]=O:(Q=o,o=O,z.push(O));return z},w.prototype.$21x=function(){var w=this;if(w.$22x(),this.debugFlag){var D=w.grid;if(D){var d,W=w.gv;if(w.debugSettings.$16x!==!1){d=[];for(var E,r,Z,K,J,V=[],H=w.$14x.gridSizeX/2,f=w.$14x.gridSizeY/2,Y=D.length,T=Y?D[0].length:0,a=1;Y-1>a;a++)for(var N=1;T-1>N;N++)D[a][N]||(E=w.$1ew({x:a,y:N}),r=E.x-H,Z=E.x+H,K=E.y-f,J=E.y+f,d.push({x:r,y:K},{x:r,y:J},{x:Z,y:J},{x:Z,y:K}),V.push(1,2,2,2,5));var M=new l.Shape;M.s("shape.border.color","rgba(50, 50, 50, 0.2)"),M.s("shape.border.width",1),M.s("shape.background","rgba(200, 50, 100, 0.2)"),M.s("2d.editable",!1),M.s("2d.selectable",!1),M.setPoints(d),M.setSegments(V),w._debugInfo={grid:M},W.dm().add(M)}w.debugSettings.path!==!1&&(d=new l.Shape,w.$20x&&(d.setPoints(w.$20x),d.s("shape.border.color","red"),d.s("shape.border.width",1),d.s("2d.editable",!1),d.s("2d.selectable",!1),d.s("shape.background",null),w._debugInfo||(w._debugInfo={}),w._debugInfo.path=d,W.dm().add(d)))}}},w.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},w.prototype.$22x=function(){var t=this;if(t._debugInfo){var y=t._debugInfo.grid,$=t._debugInfo.path,q=t.gv;y&&q.dm().remove(y),$&&q.dm().remove($),t._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);
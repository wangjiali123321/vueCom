!function(K){"use strict";var s=K.ht,V=s.Default,w=V.getInternal(),Z=w.ui(),x=null,v="__segmentLengths",f="__lineTotalLength",T="__linePoints",y="__distance0",R="flow.count",H="flow.step",b="flow.element.max",t="flow.element.count",M="flow.element.min",u="flow.element.space",X="flow.element.autorotate",q="flow.element.background",k="flow.element.shadow.max",e="flow.element.shadow.min",N="flow.element.shadow.begincolor",o="flow.element.shadow.endcolor",E="flow.element.shadow.visible",G="flow.element.image",h="flow",C=s.Math.Vector2,I=new C;new C,new C,s.List;var d=s.Default._edgeProtectMethod,W=d.getStraightLinePoints,i=function(C,f){for(var I=[],$=C.length,Q=0;$>Q;Q++){var e=C[Q];e._as&&(e=e._as);for(var k=e[0],F=1;F<e.length;F++)I.push([k,e[F]]),k=e[F]}for(var J=[],Q=0;Q<I.length;Q++){var p=n(I[Q][0],I[Q][1],f);J.push(p)}return{distance:J,segments:I}},B=function($,K,M){if($){for(var x,B=i($,K),P=B.distance,u=B.segments,R=1/0,N=null,m=0,G=P.length;G>m;m++){var Z=P[m];Z.z<R&&(x=m,R=Z.z,N=Z)}if(null==M&&(M=.1),N.z<M){for(var j=0,C=0;x>=C;C++)j+=V.getDistance(u[C][0],x>C?u[C][1]:N);return j}}},n=function(t,q,I){var U=t.x,m=t.y,i=q.x,K=q.y,W=I.x,v=I.y,f=i-U,X=K-m,B=Math.sqrt(f*f+X*X),a=f/B,j=X/B,S=(-U+W)*a+(-m+v)*j,J={x:U+S*a,y:m+S*j};return J.x>=Math.min(t.x,q.x)&&J.x<=Math.max(t.x,q.x)&&J.y>=Math.min(t.y,q.y)&&J.y<=Math.max(t.y,q.y)||(J.x=Math.abs(J.x-t.x)<Math.abs(J.x-q.x)?t.x:q.x,J.y=Math.abs(J.y-t.y)<Math.abs(J.y-q.y)?t.y:q.y),f=W-J.x,X=v-J.y,J.z=Math.sqrt(f*f+X*X),J},z=function(g,Q){if(g){var e=i(g,Q).distance,y=1/0,J=null;return e.forEach(function(I){I.z<y&&(y=I.z,J=I)}),J}},O=d.calculateLineLength,D=d.calcSegmentIndexByDistance,Y=d.calculatePointAlongLine,$=function(y,V,G){if(!y)return G;if(0===V){var n=y[0][0],P=y[0][1];return G+Math.atan2(P.y-n.y,P.x-n.x)}if(100===V){y=y[y.length-1];var n=y[y.length-2],P=y[y.length-1];return G+Math.atan2(P.y-n.y,P.x-n.x)}for(var g=0,j=[],u=y.length,W=0;u>W;W++){var Z=y[W],e=O(Z);g+=e,j.push(e)}for(var s=g*V/100,H=D(s,j),m=0,f=0;H>f;f++)m+=j[f];s-=m;for(var L=Y(y[H],s),r=y[H],$=0,R=0,z=0;z<r.length-1;z++){var v=r[z],l=r[z+1],I=l.x-v.x,K=l.y-v.y,d=Math.sqrt(I*I+K*K);if($+=d,$>s){R=z;break}}var q=r[R];return G+Math.atan2(L.y-q.y,L.x-q.x)},L=function(q){var P=0;if(q)if(Array.isArray(q[0]))for(var s=q.length,w=0;s>w;w++){var k=q[w],$=O(k);P+=$}else P=O(q);return P},j=function(e,v,J,W){return I.set(v,J).rotateAround(null,W),e?{x:e.x+I.x,y:e.y+I.y}:{x:I.x,y:I.y}},P=function(q){var $=q._data,M=W(q);if(M){$.s("flow.reverse")&&(M.reverse(),M.forEach(function(J){J.reverse()}));for(var E=0,b=[],n=M.length,z=0;n>z;z++){var o=M[z],P=O(o);E+=P,b.push(P)}if($[v]=b,$[f]=E,$[T]=M,$ instanceof s.Edge){var i=V.unionPoint(M),l=i.x+i.width/2,Y=i.y+i.height/2;$.$10e={x:l,y:Y}}c(q,!0)}},p=d.getPercentPosition,c=function(g,V){var N=g._data,L=N[f],n=N.s(R),W=N.s(H),Q=0,J=N[v],D=N.s(b),o=N.s(M),$=N.s(t),G=(D-o)/($-1),T=[];if(J){if(1===$)T.push(D);else if(2===$)T.push(D),T.push(o);else{if(!($>2))return;T.push(D);for(var O=$-2;O>0;O--)T.push(o+G*O);T.push(o)}var z=0,p=0;T.forEach(function(x){$-1>z&&(p+=N.getFlowElementSpace(x)),z++}),p+=(D+o)/2,Q=(L-n*p+p)/n;var a=g[y];for(null==a&&(a=0),V||(a+=W);a>L+p;){var i=g._overCount;i?i++:i=1,i>=n&&(i=null),g._overCount=i,N.s("flow.autoreverse")?i?a-=Q+p:(a=0,N.s("flow.reverse",!N.s("flow.reverse"))):a-=Q+p}g[y]=a}},U="prototype",_=s.graph.GraphView[U],S=s.Data[U],r=Z.DataUI[U],g=Z.ShapeUI[U],J=Z.EdgeUI[U],F=s.DataModel[U],A=s.Style;A[b]==x&&(A[b]=7),A[M]==x&&(A[M]=0),A[R]==x&&(A[R]=1),A[H]==x&&(A[H]=3),A[t]==x&&(A[t]=10),A[u]==x&&(A[u]=3.5),A[X]==x&&(A[X]=!1),A[q]==x&&(A[q]="rgba(255, 255, 114, 0.4)"),A[N]==x&&(A[N]="rgba(255, 255, 0, 0.3)"),A[o]==x&&(A[o]="rgba(255, 255, 0, 0)"),A[E]==x&&(A[E]=1),A[k]==x&&(A[k]=22),A[e]==x&&(A[e]=4),_.calculatePointLength=function(h,t,p){var V=this.getDataUI(h),H=W(V);return B(H,t,p)},V.calculatePointLength=function(g,d,v,t){var p=W(x,g,d);return B(p,v,t)},V.calculateClosestPointOnLine=n,_.calculateClosestPoint=function(t,P){var b=this.getDataUI(t),f=W(b);return z(f,P)},V.calculateClosestPoint=function(G,d,O){var t=W(x,G,d);return z(t,O)},_.getPercentAngle=function(M,I){var x=this.getDataUI(M),E=W(x);return M.getRotation?M.getRotation():0,$(E,I,M.getRotation?M.getRotation():0)},V.getPercentAngle=function(A,C,s){var E=W(x,A,C);return $(E,s,0)},_.calculateLength=function(y){var R=this.getDataUI(y),T=W(R);return L(T)},V.calculateLength=function(v,o){var u=W(x,v,o);return L(u)},_.getPercentPosition=function(s,D){var j=this.getDataUI(s),G=W(j);return p(G,D)},V.getPercentPositionOnPoints=function(E,n,R){var g=W(x,E,n);return p(g,R)};var m=function(K){var Z=K.data,H=this.dm();if(Z&&"add"===K.kind){var A=H.$3e;A&&Z.s(h)&&A.indexOf(Z)<0&&A.push(Z)}"clear"===K.kind&&(H.$3e=[])},Q=function(f){var n=f.property,L=f.data,_=f.newValue,i=this.dm().$3e;if(i&&"s:flow"===n)if(_)i.indexOf(L)<0&&i.push(L);else for(var b=i.length,T=0;b>T;T++)if(i[T]===L){i.splice(T,1);break}},a=_.setDataModel;_.setDataModel=function(v){var u=this,P=u._dataModel;if(P!==v){P&&(P.umm(m,u),P.umd(Q,u),P.$3e=[]),v.mm(m,u),v.md(Q,u);var f=v.$3e=[];v.each(function(_){_.s(h)&&f.indexOf(_)<0&&f.push(_)}),a.call(u,v)}},S.getFlowElementSpace=function(){return this.s(u)};var l=function(F){var _=this,d=_._data,H=d[f],S=d[v],q=d[T],w=d.s(R),L=0,J=_[y],G=d.s(b),E=d.s(M),s=d.s(t),Q=d.s(e),A=d.s(k),r=d.s(X),K=(A-Q)/(s-1),g=(G-E)/(s-1),O=d.getRotation?d.getRotation():0,I=d.getPosition?d.p():d.$10e,z=[],n=[];if(J!=x){if(1===s)z.push(G);else if(2===s)z.push(G),z.push(E);else{if(!(s>2))return;z.push(G);for(var i=s-2;i>0;i--)z.push(E+g*i);z.push(E)}if(1===s)n.push(A);else if(2===s)n.push(A),n.push(Q);else{if(!(s>2))return;n.push(A);for(var i=s-2;i>0;i--)n.push(Q+K*i);n.push(Q)}var m=0,$=0;z.forEach(function(g){s-1>m&&($+=d.getFlowElementSpace(g)),m++}),$+=(G+E)/2,L=(H-w*$+$)/w,F.save();for(var i=0;w>i;i++){var p=J,o=0,V=_._overCount,l=0;d.s("flow.autoreverse")&&V&&V>w-(i+1)||(p-=i*(L+$),m=0,z.forEach(function(E){var x=p-o;if(x>=0&&H>x){var V=!0,u=D(x,S);l=0;for(var X=0;u>X;X++)l+=S[X];if(x-=l,V){var v=Y(q[u],x),C=O;if(r){for(var t=q[u],f=0,B=0,s=0;s<t.length-1;s++){var M=t[s],y=t[s+1],c=y.x-M.x,w=y.y-M.y,k=Math.sqrt(c*c+w*w);if(f+=k,f>x){B=s;break}}var W=t[B];C+=Math.atan2(v.y-W.y,v.x-W.x)}O&&(v=j(I,v.x-I.x,v.y-I.y,O)),_.$5e(F,v,E,n[m],C)}}o+=d.getFlowElementSpace(z[m]),m++}))}F.restore()}},Wg=J._80o;J._80o=function(c){Wg.call(this,c);var Y=this,n=Y._data,T=Y.gv;n.s(h)&&T.$7e!=x&&l.call(Y,c)};var Xf=g._80o;g._80o=function(w){Xf.call(this,w);var M=this,r=M._data,n=M.gv;r.s(h)&&n.$7e!=x&&l.call(M,w)};var Hr=J._79o,Fd=g._79o,Ap=function(){var Q=this,j=Q._data,w=j.s(b),S=!1,l=x;if(Q._6I||(S=!0),l=j instanceof s.Edge?Hr.call(Q):Fd.call(Q),j.s(h)&&S){var i=j.s(k),W=j.s(E);W&&i>w&&(w=i),w>0&&V.grow(l,Math.ceil(w/2)),P(Q)}return!j.s(h)&&S&&(j[v]=j[f]=j[T]=Q[y]=x),l};g._79o=Ap,J._79o=Ap,r.$5e=function(H,f,Q,S,t){var M=this,c=M._data,R=M.gv,D=c.s(q),Y=c.s(N),g=c.s(o),$=c.s(E),d=R.$8e,n=c.s(G);if(d==x&&(d=R.$8e={}),H.beginPath(),n!=x){var _=V.getImage(n),X=Q/2;H.translate(f.x,f.y),H.rotate(t),H.translate(-f.x,-f.y),V.drawImage(H,_,f.x-X,f.y-X,Q,Q,c),H.translate(f.x,f.y),H.rotate(-t),H.translate(-f.x,-f.y)}else if(R.__flowBatch){var m=R.__flowBatchGroup;m||(m=R.__flowBatchGroup={});var v=[f.x,f.y,Q/2];m[D]?m[D].push(v):m[D]=[v]}else H.fillStyle=D,H.arc(f.x,f.y,Q/2,0,2*Math.PI,!0),H.fill();if($){var z=22,T=z+"_"+Y+"_"+g,e=d[T];if(e==x){var p=document.createElement("canvas");w.setCanvas(p,z,z);var U=p.getContext("2d"),u=z/2,L=u,j=u;w.translateAndScale(U,0,0,1),U.beginPath();var F=U.createRadialGradient(L,j,0,L,L,u);F.addColorStop(0,Y),F.addColorStop(1,g),U.fillStyle=F,U.arc(L,j,u,0,2*Math.PI,!0),U.fill(),e=d[T]=p}var X=S/2;V.drawImage(H,e,f.x-X,f.y-X,S,S,c)}},_.$9e=function(){var q=this,i=q.dm().$3e;q._24I,i.forEach(function(V){q._24I[V._id]=V}),q.iv()};var Lb=F.prepareRemove;F.prepareRemove=function(p){Lb.call(this,p);var N=p._dataModel,y=N.$3e;if(y)for(var R=y.length,t=0;R>t;t++)if(y[t]===p){y.splice(t,1);break}},_.setFlowInterval=function(l){var s=this,e=s.$11e;s.$11e=l,s.fp("flowInterval",e,l),s.$7e!=x&&(clearInterval(s.$7e),delete s.$7e,s.enableFlow(l))},_.getFlowInterval=function(){return this.$11e},_.enableFlow=function(A){var W=this,j=W.dm(),L=j.$3e;W.$7e==x&&(L.forEach(function(O){var B=W.getDataUI(O);P(B)}),W.$7e=setInterval(function(){j.$3e.forEach(function(q){c(W.getDataUI(q))}),W.$9e()},A||W.$11e||50))},_.disableFlow=function(){var x=this;clearInterval(x.$7e),delete x.$7e;var B=x.dm().$3e;B&&x.$9e()};var Jl=function(){this.__flowBatchGroup={}},rq=function($){var u=this.__flowBatchGroup;if(u){$.save();for(var k in u){$.fillStyle=k,$.beginPath();var H=u[k];H.forEach(function(i){$.moveTo(i[0],i[1]),$.arc(i[0],i[1],i[2],0,2*Math.PI,!0)}),$.fill()}$.restore()}};_.setFlowBatch=function(B){var T=this;!!T.__flowBatch!=!!B&&(T.__flowBatch=B,B?(T.addBottomPainter(Jl),T.addTopPainter(rq)):(T.removeBottomPainter(Jl),T.removeTopPainter(rq)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);
!function(o,U,x){"use strict";function J(){this.el=[1,0,0,0,1,0,0,0,1]}function $(f,$){if("function"!=typeof $&&null!==$)throw new TypeError("Super expression must either be null or a function");f.prototype=U.create($&&$.prototype,{constructor:{value:f,writable:!0,configurable:!0}}),$&&Rp(f,$)}function i(z){var S=U.prototype.toString.call(z);return"Array]"===S.substring(S.length-6)}function L(f,w,R,D,U,h){w=w||[],R=R||[],D=D||[];try{w.push(f);var v=Function.apply(0,w);return R[R.length]="return "+v,Function.apply(0,R).apply(0,D)}catch(q){return h&&h(q),U}}function A(W){var u={};return{get:function(n){if(u[n]!==x)return u[n];var S;switch(n){case"WEBGL_depth_texture":S=W.getExtension("WEBGL_depth_texture")||W.getExtension("MOZ_WEBGL_depth_texture")||W.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":S=W.getExtension("EXT_texture_filter_anisotropic")||W.getExtension("MOZ_EXT_texture_filter_anisotropic")||W.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":S=W.getExtension("WEBGL_compressed_texture_s3tc")||W.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||W.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":S=W.getExtension("WEBGL_compressed_texture_pvrtc")||W.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":S=W.getExtension("WEBGL_compressed_texture_etc1");break;default:S=W.getExtension(n)}return u[n]=S,S}}}function p(u,S,U){function C(){if(z!==x)return z;var M=S.get("EXT_texture_filter_anisotropic");return z=null!==M?u.getParameter(M.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}function i(H){if("highp"===H){if(u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).precision>0&&u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).precision>0)return"highp";H="mediump"}return"mediump"===H&&u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).precision>0&&u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var z;U=U||{};var D="undefined"!=typeof WebGL2RenderingContext&&u instanceof WebGL2RenderingContext,$=U.precision!==x?U.precision:"highp",a=i($);a!==$&&(console.warn("WebGL:",$,"not supported, using",a,"instead."),$=a);var X=U.logarithmicDepthBuffer===!0,T=u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS),K=u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS),F=u.getParameter(u.MAX_TEXTURE_SIZE),N=u.getParameter(u.MAX_CUBE_MAP_TEXTURE_SIZE),r=u.getParameter(u.MAX_VERTEX_ATTRIBS),O=u.getParameter(u.MAX_VERTEX_UNIFORM_VECTORS),t=u.getParameter(u.MAX_VARYING_VECTORS),Z=u.getParameter(u.MAX_FRAGMENT_UNIFORM_VECTORS),o=K>0,b=D||!!S.get("OES_texture_float"),G=(D||!!S.get("OES_element_index_uint"))&&"undefined"!=typeof Uint32Array,k=o&&b,W=D?u.getParameter(u.MAX_SAMPLES):0;return{getMaxAnisotropy:C,getMaxPrecision:i,precision:$,logarithmicDepthBuffer:X,maxTextures:T,maxVertexTextures:K,maxTextureSize:F,maxCubemapSize:N,maxAttributes:r,maxVertexUniforms:O,maxVaryings:t,maxFragmentUniforms:Z,vertexTextures:o,floatFragmentTextures:b,elementTypeUint:G,floatVertexTextures:k,maxSamples:W}}function T(D,G){return D.z!==G.z?D.z-G.z:D.id-G.id}function E(s,E){return s.z!==E.z?E.z-s.z:s.id-E.id}var t="ht";if(!o[t]){!function(){Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),o.performance&&o.performance.now||function(){var a=Date.now();o.performance||(o.performance={}),o.performance.now=function(){return Date.now()-a}}();for(var t=Date.now(),j=16,h=["ms","moz","webkit","o"],W=0;W<h.length&&!o.requestAnimationFrame;++W)o.requestAnimationFrame=o[h[W]+"RequestAnimationFrame"],o.cancelAnimationFrame=o[h[W]+"CancelAnimationFrame"]||o[h[W]+"CancelRequestAnimationFrame"];o.requestAnimationFrame||(o.requestAnimationFrame=function(S){var s=Date.now(),m=j+t-s;return 0>m&&(m=0),t=s,o.setTimeout(function(){t=Date.now(),S(performance.now())},m)}),o.cancelAnimationFrame||(o.cancelAnimationFrame=function(m){return o.clearTimeout(m)}),U.assign===x&&(U.assign=function(D){if(D===x||null===D)throw new TypeError("Cannot convert undefined or null to object");for(var P=U(D),G=1;G<arguments.length;G++){var h=arguments[G];if(h!==x&&null!==h)for(var u in h)U.prototype.hasOwnProperty.call(h,u)&&(P[u]=h[u])}return P})}();var G=o.document,z=null,R=o[t]={},q=o[t+"config"],m=R.Default=q&&q.Default||{},a=R.Style=q&&q.Style||{},b=R.Attr=q&&q.Attr||{},e=function(){return!0},Z=function(U){return U},r=function(H){return!H},S=R.Color=q&&q.Color||{},f=R.IsGetter=q&&q.IsGetter||{};!function(){var I=!1;try{var n=U.defineProperty({},"passive",{get:function(){return I=!0,x}});o.addEventListener("test",n,n),o.removeEventListener("test",n,n)}catch(Y){I=!1}m.passiveSupported=I}();var X,c,D,M,k=m.passiveSupported,s=m.eventListenerOptionsFalse=k?{passive:!1,capture:!1}:!1,l=m.eventListenerOptionsTrue=k?{passive:!1,capture:!0}:!0,n=function(Y,F,g,c){Y.addEventListener(F,g,c?l:s)},I=function(x,j,A,g){x.removeEventListener(j,A,g?l:s)},K=Math,w=K.round,h=K.floor,v=K.ceil,N=K.sqrt,W=K.max,g=K.min,H=K.abs,d=K.cos,O=K.acos,F=K.sin,Y=K.pow,B=K.asin,Q=K.exp,j=K.PI,y=2*j,P=j/2,_=K.tan,C=K.atan2,u=K.random,V=K.log,bo=!1,ah=!1,vp=o.parseInt||global.parseInt,go="2020-12-25",Wj=o.navigator?o.navigator.platform.indexOf("Win")>-1:!1,si=function(t){return t*t},Qf=o.setTimeout,$g=o.clearTimeout,td=o.location,Ce=o.navigator?o.navigator.userAgent.toLowerCase():"",io=function(p){return p.test(Ce)},Jk=io(/msie/),Nb=io(/msie/)||io(/trident/),lb=io(/msie 10/),tm=io(/edge/),Pn=io(/firefox/),Kh=io(/mac/),vd=m.isTouchable===x?Wj?!1:G?"ontouchend"in G:!1:m.isTouchable,vj="default",Aq="single",Wo="multiple",ws="front",Wb="back",ec="left",Gj="right",$i="top",dh="bottom",sj="center",Aj="eye",dn="middle",xn="east",tl="west",Sd="north",sn="none",Tq="px",yq="absolute",hl="border",Wl="triangle",aq="rect",Uf="circle",pd="cylinder",rp="shape",zf="items",Oc="normal",gm="remove",Zj="clear",en="width",yb="height",Ag="ingroup",Yh="check",ne="uncheck",nb="radio",$o="radioOn",Er="radioOff",mm="points",zd="values",Ok="series",ib="body",ih="label",Ar="label2",up="note",Io="note2",Qg="icons",ek="labelFont",Hi="labelColor",me="labelSelectColor",Xo="note.expanded",fs="note2.expanded",Qn="edge.expanded",_j="edge.points",pr="edge.type",uc="rotation",Ob="hidden",so="visible",Dk="tuv",wd="no",pf="draw",_m="select",nm="currentSubGraph",Yj="selectBackground",Fd="autoMakeVisible",gs="autoHideScrollBar",Jo="scrollBarColor",Hg="scrollBarSize",Bj="indent",Pe="rowHeight",_n="columnLineColor",Bc="rowLineColor",nj="columnLineVisible",th="rowLineVisible",qf="visibleFunc",Rc="expandIcon",bh="collapseIcon",Fg="checkMode",Pf="sortFunc",be="editable",sc="batchEditable",gp="tristate",zb="asc",Gk="desc",db="position",Mr="elevation",Qe="children",cd="translateX",Li="translateY",Ap="dataModel",ki="maxSize",Qk="state",Pi="shape3d",Jh="shape3d.resolution",pq="shape3d.visible",hj="shape3d.from.visible",Zm="shape3d.to.visible",on="shape3d.top.visible",_e="shape3d.bottom.visible",mj="repeat.uv.length",ve="serializeValue",$e="deserializeValue",bd="centerUniform",Mi="uniform",Ol="rgba(255,255,255,0)",kf="style",nn="attr",qh="field",dl="string",Fk="boolean",ij="color",fh="int",Bg="number",ag="ew-resize",nd="ns-resize",Rh="pointer",vf="auto",Ir="mousedown",Gd="mousemove",ig="mouseup",Cs="mouseout",le="touchstart",Jp="touchmove",Qq="touchend",fd="keydown",Gb="keyup",vn=["DOMMouseScroll","mousewheel"],Wr=Pn?vn[0]:vn[1],ym=[le,Jp,Qq],xc=[Ir,Gd,ig,Cs,Wr,"wheel","mouseenter","mouseleave","mouseover"],Gl=[fd,Gb,"keypress","input","contextmenu","compositionstart","compositionupdate","compositionend"],cg=vd?ym.concat(Gl):xc.concat(Gl),hm=z,ul=z,Lg=z,Ec=ig.length,Ed=function(){Lg&&($g(Lg.timeout),Lg=z)},Mj=function(){Lg&&tq(Lg.e,Lg.info)};o.addEventListener&&(vd||(n(o,Cs,function(){Ed()}),n(o,Wr,function(){Eh()})),n(o,Gb,function(N){91===N.keyCode?hf={}:delete hf[N.keyCode]},!0),n(o,fd,function(K){hf[K.keyCode]=!0},!0),n(o,"blur",function(){hf={}}));var mo,Ph,Vq,Yd=0,mk=z,jr=function(I,V){var u=Qf(function(){delete mk[u],ml(mk)&&(mk=z),I()},V);return u},Sm=z,Hh=z,_p={},ad={},wb={},wm={},Ng={},hf={},Zl={},Lf={},pg={},Xj={},Hm=/.json$/,Yn=/^data:image\/svg\+xml/,hs={},Ze=[],is={},ys=z,Fo=z,_h=function(){},fe=function(){throw"Oops!"},_g=[0,0,0],ni={x:0,y:0,width:0,height:0},Oi=z,$j=z,mr=z,zo=function(N,D){ad[N]=D,D&&D.comps&&!D.uuid&&(D.uuid=R.Math.generateUUID()),xd[N]&&(D.cacheRule=xd[N],delete xd[N])},ns=function(F){$j&&!F._72O&&(mr||(mr={}),mr[F._72O=Hf()]=F),mo!=z?mi()<.05&&M&&!Ph&&(kn=Ed):kn=Rr},Jr=function(c,w,X,Z){$j||($j={});var n=$j[c];if(n){if(n.url===w)return;n.image?(n.image.onload=_h,n.image.onerror=_h):n.request&&(n.request.onload=_h,n.request.onerror=_h)}if(Hm.test(w)){var L=new dk;if($j[c]={request:L,url:w},w=m.beforeLoadURL(w,c),w.data){var l=m.parse(w.data);Rb(c,l),m.handleImageLoaded(c,l)}else{L.onload=function(){if(200===this.status||0===this.status){var T=m.parse(L.getResponseText());Rb(c,T),m.handleImageLoaded(c,T)}else Rb(c,m.handleUnfoundImage(c,w)||z)},L.onerror=function(){Rb(c,m.handleUnfoundImage(c,w)||z)};var A={};A.url=encodeURI(w),A.sync=!1,L.send(A)}}else{var l=new Image;$j[c]={image:l,url:w},/^data:image/.test(w)||(w=m.beforeLoadURL(w,c),w=m.appendTimeStamp(w),w=encodeURI(w),l.crossOrigin=m.crossOrigin),m.convertImageSrc(w,function(n){Nb&&(w.toLowerCase().indexOf(".svg")>0||Yn.test(w))?(G.body.appendChild(l),l.style.visibility="hidden",l.onload=function(){Qf(function(){if(X&&(l.width=X),Z&&(l.height=Z),!l.width||!l.height){var x=l.width||l.clientWidth,r=l.height||l.clientHeight;l.width=x,l.height=r}m.handleImageLoaded(c,l),Rb(c,l),G.body.removeChild(l),l.style.visibility=""},180)},l.onerror=function(){Rb(c,m.handleUnfoundImage(c,w)||z),G.body.removeChild(l),l.style.visibility=""}):(l.onload=function(){X&&(l.width=X),Z&&(l.height=Z),m.handleImageLoaded(c,l),Rb(c,l)},l.onerror=function(){Rb(c,m.handleUnfoundImage(c,w)||z)}),l.src=n})}},Rb=function(K,j){if(zo(K,j),delete $j[K],ml($j)&&($j=z,mr)){for(var T in mr){var H=mr[T];H._2O&&H._2O[K]&&(H.deleteTexture(K),delete H._2O[K]),H.invalidateAll&&H.invalidateAll(x,"imageLoaded",K),H.redraw&&H.redraw(),H.iv(),delete H._72O}mr=z}if(j&&mr)for(var T in mr){var H=mr[T];H.invalidateAll&&H.invalidateAll(x,"imageLoading",K),H.redraw&&H.redraw(),H.iv()}},Pc=function(){return V=K&&Date,function(){return o.performance&&o.performance.now?o.performance.now():Date.now()}}(),nk=function(o,W,h){return{width:o,height:W,comps:Mf(h)?h:[h]}},Sf=function(I,C){return{type:Uf,rect:[I,C,1.6,1.6],borderWidth:1,borderColor:Xd,gradient:zi,gradientColor:Oh,background:Xd}},nr=function(i,K){return nk(16,16,{type:Wl,rect:[4,4,10,8],background:i,rotation:K?1.57:3.14})},Af=function(k,t){return nk(16,16,{type:Wl,rect:[4,4,8,7],background:k,rotation:t?3.14:0})},Fr=function(A){var E=A._orientation;return"horizontal"===E||"h"===E},Vb=function(b,q){var D=z||4,p=z||1,x=z||1;0>D?D=0:D>.25&&(D=.25);var r,$,w,e,B,A,i,M=.5,J=[],E=[],W=[],n=y/x,Y=y/p,K=M-D;for($=0;p>=$;$++)for(e=-j+$*Y,A=d(e),B=F(e),r=0;x>=r;r++)w=r*n,i=K+D*A,J.push(d(w)*i,B*D,-F(w)*i),(c=[b,q])&&E.push(r/x,1-$/p);for($=0;p>$;$++){var X=$*(x+1),T=($+1)*(x+1);for(r=0;x>r;r++)W.push(X+r,T+r+1,T+r,X+r,X+r+1,T+r+1),Tc.z=Vh.z=[b,q]}},We=function(Q){var B=2,N=0;for(var i in Q)i.length===B&&vp(i,32)===tn&&(ys=Fo=Q[i]),N++;return N},$q=function(E,C,M,G){return M||(M=vd?5:3,M/=G||1),{x:E-M,y:C-M,width:2*M,height:2*M}},pl=function(v,S,_,H){var X=this;S||(S=vd?5:3,_=20,H=20);var W={x:v,y:S,width:_,height:H};if(_)for(var u=0;_>u;u++)if(3===_)H=20;else for(var U=0;H>U;U++)X=o?o:_;var b={x:j,y:2*j};if(Eq(W,b)){var i=yb[0]+$i[0]+Zj[1]+zb.length,B=Ob[0]+gp[0]+Zj[1]+ib.length;hp[Aj]=[X[i],X[B]],X[i]=Ij[Aj],X[B]=Ij[Pi]}},Vr=function(c){return(/ble$/.test(c)||/ed$/.test(c)||f[c]?"is":"get")+c.charAt(0).toUpperCase()+c.slice(1)},Ij=function(E){return"set"+E.charAt(0).toUpperCase()+E.slice(1)},yk=function(s){return typeof s===dl||s instanceof String},pk=function(P){return typeof P===Bg},Rr=function(i){return typeof i===Fk},Vc=function(Y){return Y&&"object"==typeof Y},Jc=function(F){return"function"==typeof F},Mf=function(T){return T instanceof Array},Id=function(l){return l instanceof df},Nf=function(Y){return Mf(Y)?new df(Y):Y},Vm=function(n){return n instanceof Lh},xr=function(I){return I instanceof Dp},wr=function(Z){return Z instanceof Lp},Te=function(o,q){if(!(o instanceof R.Group))return!1;if(!q)return o.isExpanded();var l=q.getDataUI(o);return l&&l._88I?!0:!1},Nq=function(n){return n instanceof rf},Or=function(z){return z&&"IFRAME"===z.tagName},Fc=function(F){return F==z||m.numberDigits==z?F:parseFloat(F.toFixed(m.numberDigits))},Pr=function(J,T,F){var C,V=T.length;if(F)for(var G=0;F>G;G++)if(3===V)J.push(T[0]),J.push(T[1]),J.push(T[2]);else for(C=0;V>C;C++)J.push(T[C]);else if(3===V)J.push(T[0]),J.push(T[1]),J.push(T[2]);else for(C=0;V>C;C++)J.push(T[C])},js=function(S){return S?Vc(S)?S:{}:!1},ae=function(b,i,I){var F,A=Vc(b)?b:b.prototype;for(F in i)I&&F in A?A[F]===x&&console.warn("class",A,"has own undefined property",F,", keep exist!"):A[F]=i[F];return b},Vp=function(h,g){if(!("wheelDelta"in g)){var D=g.deltaMode;g.wheelDelta=D===g.DOM_DELTA_PIXEL?-g.deltaY:D===g.DOM_DELTA_LINE?40*-g.deltaY:120*-g.deltaY}h.handle_mousewheel(g)},ql=function(U){return String.fromCharCode(U)},wh=function(y){for(var V,G=0,w="";G<y.length;G++)V=y[y.length-1-G],"%"===V?V="'":"a"===V?V='"':"]"===V&&(V="\\"),w+=ql(V.charCodeAt(0)-1);return w},ac=function(Z,T,J){Z.superClass.constructor.apply(T,J)},ml=function(t){for(var n in t)return!1;return!0},Gh=function(X){return X?0===X.length:!0},Gp=function(){var T="";return[ne[0],Bc[0],ih[0]].forEach(function(s){T+=Ij(s).slice(3)}),Mi=G&&G[T]||bd,function(F,E){return F===E?!0:F.x===E.x&&F.y===E.y&&F.width===E.width&&F.height===E.height}}(),Mc=function(F,T,Q){return T>F?T:F>Q?Q:F},Bl=function(w){return 0>w?-1:w>0?1:0},mi=function(){var N=1e4*F(Ec++);return N-h(N)},ss=function(P,E,X){return lq(P.x,P.y,E.x,E.y,X.x,X.y,X.x+X.width,X.y,!0)||lq(P.x,P.y,E.x,E.y,X.x+X.width,X.y,X.x+X.width,X.y+X.height,!0)||lq(P.x,P.y,E.x,E.y,X.x+X.width,X.y+X.height,X.x,X.y+X.height,!0)||lq(P.x,P.y,E.x,E.y,X.x,X.y+X.height,X.x,X.y,!0)},lq=function(T,Z,x,P,F,J,b,H,o){var K=(b-F)*(Z-J)-(H-J)*(T-F),Q=(H-J)*(x-T)-(b-F)*(P-Z);if(0!==Q){var s=K/Q,Y=T+s*(x-T),f=Z+s*(P-Z);return o&&(Y+ep<g(T,x)||Y-ep>W(T,x)||Y+ep<g(F,b)||Y-ep>W(F,b)||f+ep<g(Z,P)||f-ep>W(Z,P)||f+ep<g(J,H)||f-ep>W(J,H))?z:[Y,f]}return z},pc=function(E,n,Y){if(E&&Y)if(n){if(n===kf)return E.getStyle(Y);if(n===nn)return E.getAttr(Y);if(n===qh)return E[Y]}else if(Y=Vr(Y),E[Y])return E[Y]();return x},Yk=function(l,X,o,w){if(l&&o)if(X){if(X===kf)l.s(o,w);else if(X===nn)l.a(o,w);else if(X===qh){var M=l[o];l[o]=w,l.fp("f:"+o,M,w)}}else o=Ij(o),l[o]&&l[o](w)},vo=function(y,Z,q){return Z&&"top"!==Z?"bottom"===Z?{x:y.x,y:y.y,width:y.width,height:y.height*q}:"right"===Z?{x:y.x,y:y.y,width:y.width*q,height:y.height}:"left"===Z?{x:y.x+y.width*(1-q),y:y.y,width:y.width*q,height:y.height}:void 0:{x:y.x,y:y.y+y.height*(1-q),width:y.width,height:y.height*q}},Gm=function(M,$,J,E){if(0>E)return null;var T=Math.floor($.x),A=Math.floor($.y),w=Math.ceil($.width)+1,b=Math.ceil($.height)+1,C=E,l=E;1>=E&&(C=E*w,l=E*b);var f,t;J&&"top"!==J?"bottom"===J?(f={x:T,y:A+b-l},t={x:T,y:A+b}):"right"===J?(f={x:T+w-C,y:A},t={x:T+w,y:A}):"left"===J&&(f={x:T+C,y:A},t={x:T,y:A}):(f={x:T,y:A+l},t={x:T,y:A});var E=M.createLinearGradient(f.x,f.y,t.x,t.y);return E.addColorStop(0,"rgba(0,0,0,0)"),E.addColorStop(1,"rgba(0,0,0,1)"),{gradient:E,rect:{x:Math.min(f.x,t.x),y:Math.min(f.y,t.y),width:Math.abs(f.x-t.x)||w,height:Math.abs(f.y-t.y)||b}}},fg=function(x,r,I,$,j){r&&em(x,I,$,1,j,r)},Do=function(Q,J,B,P){var Z=1-Q;return Z*Z*J+2*Q*Z*B+Q*Q*P},Tc=function(H,o,N,x,a){var r=1-H;return r*r*r*o+3*r*r*H*N+3*r*H*H*x+H*H*H*a},yh=function(h){var E,p,v,A,O=0;return h.forEach(function(I){if(E=I.length,E>0)for(p=I[0],A=1;E>A;A++)v=I[A],O+=id(p,v),p=v}),O},Oo=function(p,d,F){var N="__"+p,H=function(c){F.disabled||F["handle_"+p](c)};F[N]||(F[N]=H,n(d,p,H))},qc=function(b,R,u){var F="__"+b,K=u[F];K&&(I(R,b,K),delete u[F])},Tj=function(i,z){var C="_"+z;i[Vr(z)]=function(){return this[C]},i[Ij(z)]=function(V){var Y=this[C];this[C]=V,this.fp(z,Y,V)}},$b=function(R){return U.create(R)},no=function(L){if(!L.element){var V,l;(V=L.textField)?l=$l(Fs.TextField,V):(V=L.textArea)?l=$l(Fs.TextArea,V):(V=L.button)?l=$l(Fs.Button,V):(V=L.comboBox)?l=$l(Fs.ComboBox,V):(V=L.checkBox)?l=$l(Fs.CheckBox,V):(V=L.radioButton)?l=$l(Fs.RadioButton,V):(V=L.slider)?l=$l(Fs.Slider,V):(V=L.colorPicker)?l=$l(Fs.ColorPicker,V):(V=L.image)&&(l=$l(Fs.Image,V)),l&&(L.element=l)}},Ul=function(p,R){var C=Kk(p);return C._ht=R,C},to=o.top===o?o.top:o||o.document,Kk=function(J,x){var V=G.createElement("div"),k=V.style;return V.tabIndex=-1,V.onkeydown=$r,k.msTouchAction=sn,gq(V,z,0),vd&&k.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",z),J&&(k.overflow=Ob),x&&tc(x,V),V},pn=function(n,$){var h=G.createElement("canvas"),b=h.style;return b.msTouchAction=sn,$||(b.pointerEvents=sn),gq(h,z,0),n&&tc(n,h),h},gq=function(x,J,d){var L=x.style;L.border=J?J+" solid 1px":0,L.outline=0,L.padding=d?"0 "+d+Tq:0,xs(x)},xs=function(q){var H=q.style;H.position=yq,H.margin=0,H.setProperty("box-sizing","border-box",z),H.setProperty("-moz-box-sizing","border-box",z)},vl=function(I,C,F,P){P||(P=Gn),C!=z&&(I.width=C*P,I.style.width=C+Tq),F!=z&&(I.height=F*P,I.style.height=F+Tq)},tc=function(h,C,P){h.appendChild(C),P&&(C.style.position=yq)},di=function(P,m){m.split||(m+="");for(var e,n=m.split("\n"),z=0,c=n.length,Y=0;c>Y;Y++){var b=Yf(P.font,n[Y]);b.width>z&&(z=b.width),e||(e=b.height)}return P.ss=n,{width:z,height:e*c}},Kj=function(S,c,R,M,H,r){var t=c.length;if(1===t)Am(S,c[0],R,M,H);else for(var m=R.height/t,a={x:R.x,y:R.y,width:R.width,height:m},E=0;E<c.length;E++)r?Kq(S,c[E],M,H,a.x,a.y,a.width,a.height,r):Am(S,c[E],a,M,H),a.y+=m},Am=function(X,v,A,Z,g){X.font=Z?Z:un,X.fillStyle=g?g:gh,X.textAlign=sj,X.textBaseline=dn;var Y,E;A?A.width===x?(Y=A.x,E=A.y):(Y=A.x+A.width/2,E=A.y+A.height/2):(Y=0,E=0),X.fillText(v,w(Y),w(E))},Ym=function(v){v.getView&&(v=v.getView());var G=v.offsetWidth||v.scrollWidth;return!G&&v.style.width&&(G=vp(v.style.width)),G},rl=function(J){J.getView&&(J=J.getView());var j=J.offsetHeight||J.scrollHeight;return!j&&J.style.height&&(j=vp(J.style.height)),j},gf=function(C,K,z){var I=K[0].toUpperCase()+K.substring(1,K.length);C["webkit"+I]=z,C["moz"+I]=z,C["ms"+I]=z,C["o"+I]=z,C[K]=z},rs=function(){var Y=function(A){$r(A),A.stopPropagation()},h=function(i){$r(i)},r=[le,fd,Ir];return function(x,l){var P=Kk(),Z=P.style;return Z.backgroundColor=m.disabledBackground,x&&(Z.backgroundImage="url("+x+")",Z.backgroundPosition="50% 50%",Z.backgroundRepeat="no-repeat no-repeat"),l===!1?r.forEach(function(C){n(P,C,h)}):r.forEach(function(D){n(P,D,Y)}),P}}(),vs=function(U){var $=U.getContext("2d");return $.save(),$.lineCap=zn,$.lineJoin=Jd,$},kn=function(F,W,d,k){jm(F,W*Gn,d*Gn),k*=Gn,1!==k&&F.scale(k,k)},jm=function(b,c,r){b.translate(c,r)},Eg=function(P,Q){Q&&P.rotate(Q)},Hl=function(m,D,F){D===x&&(D=1),F===x&&(F=1),(1!==D||1!==F)&&m.scale(D,F)},ai=!1,Q=to[Yh[1]+cd[0]],kk=function(e){var p=G.activeElement;if(G.activeElement!==e){p&&p.forceOnblur&&p.forceOnblur();for(var x=[],M=e.parentNode;M;)x.push([M,M.scrollLeft,M.scrollTop]),M=M.parentNode;if(!ai){var X=[],n=[];try{for(var y=o.parent,U=o;y!==U;)X.push([y,y.scrollX,y.scrollY]),U=y,y=o.parent;var l=o.frameElement;if(l)for(var w=l.parentNode;w;)n.push([w,w.scrollLeft,w.scrollTop]),w=w.parentNode}catch(g){ai=!0}}if(vd)e.focus();else{var q=Rg(),$=q.target;e.focus(),$.scrollLeft=q.left,$.scrollTop=q.top}x.forEach(function(h){h[0].scrollLeft=h[1],h[0].scrollTop=h[2]}),ai||(X.forEach(function(X){X[0].scrollTo(X[1],X[2])}),n.forEach(function(t){t[0].scrollLeft=t[1],t[0].scrollTop=t[2]}))}},zs=function(E){return E&&E.getView?E.getView():E},Ln=function(C,f,b,Q,t){if(2===arguments.length&&(b=f.y,Q=f.width,t=f.height,f=f.x),C.isSelfViewEvent)C.setX(f),C.setY(b),C.setWidth(Q),C.setHeight(t);else{var l=zs(C),M=l.style;if((G.fullscreenElement||G.mozFullScreenElement||G.webkitFullscreenElement||G.msFullscreenElement)!==l)f!==x&&(M.left=f+Tq),b!==x&&(M.top=b+Tq),Q!==x&&(M.width=Q+Tq),t!==x&&(M.height=t+Tq);else{var X=m.getWindowInfo();M.left=(f=X.left)+Tq,M.top=(b=X.top)+Tq,M.width=(Q=X.width)+Tq,M.height=(t=X.height)+Tq}C.endEditing&&!vd&&C.endEditing(),C.redraw&&C.redraw(),C.invalidate&&C.invalidate(),C.onLayouted&&C.onLayouted(f,b,Q,t),C.fireViewEvent&&C.fireViewEvent("layout")}},oh=function(L){if(!L.touches)return L;var K=L.touches[0];return K?K:L.changedTouches[0]},Ci=function(S){return Nd(S)?oh(S).target:S.target},Nd=function(p){return"touches"in p},wl=function(o){m.popup&&m.popup.close(),m.popup=o},Si=z,Jf=function(y){Si.handleWindowTouchMove(y)},Yp=function(w){Si.handleWindowTouchEnd(w),I(o,Jp,Jf),I(o,Qq,Yp),Si=z},Go=function(_){Si.handleWindowMouseMove(_)},Up=function(t){Si.handleWindowMouseUp(t),I(o,Gd,Go),I(o,ig,Up),Si=z},jg=function(F){return 1===po(F)},Xc=function(A,Q){return Q?Q.keyCode===A:hf[A]},Rj=function(o){return Kb(o)&&Xc(65,o)},Mg=function(D){return Xc(46,D)||Xc(8,D)},cn=function(F){return function(E){return E?E.keyCode===F:hf[F]}},tn=573,xe=[65,83,68,87,37,38,39,40,32,13,27],jd=cn(xe[0]),mp=cn(xe[1]),El=cn(xe[2]),ci=cn(xe[3]),sr=cn(xe[4]),Hr=cn(xe[5]),Kf=cn(xe[6]),Fe=cn(xe[7]),Wh=cn(xe[8]),Hk=cn(xe[9]),qd=cn(xe[10]),Om={65:1,83:1,68:1,87:1,37:1,38:1,39:1,40:1},Fm=[2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,5,5,5,5,5,2069],fn=z,mn=z,Hd=function(D,U){fn||(fn=pn()),vl(fn,D,U,1);var T=vs(fn);return T.clearRect(0,0,D,U),T},wc=function(){var s,y={};for(var l in o){var P=Wo.length;if(l.length==P&&l[0]===Wo[2]&&l[1]===sn[1]&&l[4]===Wo[3]&&l[5]===Wo[4]&&l.substr(P-2)===sn[1]+sn[2]){var Z=o[l];for(var G in Z)G.length===P&&G.substr(0,3)===Gj[3]+gm[3]+_m[0]&&G.substr(P-2)===Wo[0]+up[3]&&(vn=Z[G])}}return function(u){var G,z=y[u];return z||(s||(s=pn(),vl(s,1,1,1)),G=s.getContext("2d"),G.clearRect(0,0,1,1),em(G,0,0,1,1,u),z=G.getImageData(0,0,1,1).data,z=y[u]=[z[0],z[1],z[2],z[3]]),z}}(),Em=function(k){if(!yk(k))return k;var W=wc(k);return W.CA||(W.CA=[W[0]/255,W[1]/255,W[2]/255,W[3]/255]),W.CA},dp=function(L,$,x,o,R){var r=pn();r.width=x,r.height=o;var Q=r.getContext("2d");Q.drawImage(L,0,0,x,o);try{for(var c=Q.getImageData(0,0,x,o),D=c.data,l=0,G=D.length;G>l;l+=4){var O=D[l+0],s=D[l+1],p=D[l+2],k=D[l+3];"override_a"===R?D[l+3]=255*$[3]:"override_rgb"===R?(D[l+0]=255*$[0],D[l+1]=255*$[1],D[l+2]=255*$[2]):"override"===R?(D[l+0]=255*$[0],D[l+1]=255*$[1],D[l+2]=255*$[2],D[l+3]=255*$[3]):(D[l+0]=$[0]*O,D[l+1]=$[1]*s,D[l+2]=$[2]*p,D[l+3]=$[3]*k)}Q.putImageData(c,0,0)}catch(d){return L}return r},hp=function(g,p,H){return p&&(p="miter"===H?8*p+20:p+1,g&&km(g,p)),p},gc=function(q,$){if($){var A=new fc($),t=q.width/2,f=q.height/2,E=oe([A.tf(-t,-f),A.tf(t,-f),A.tf(t,f),A.tf(-t,f)]);return E.x+=q.x+t,E.y+=q.y+f,E}return q},Mp=function(S,K,n,r,G,e,L,m){r*=Math.PI/180;var z={x:Math.cos(r)*(S.x-L.x)/2+Math.sin(r)*(S.y-L.y)/2,y:-Math.sin(r)*(S.x-L.x)/2+Math.cos(r)*(S.y-L.y)/2},v=Math.pow(z.x,2)/Math.pow(K,2)+Math.pow(z.y,2)/Math.pow(n,2);v>1&&(K*=Math.sqrt(v),n*=Math.sqrt(v));var k=(G==e?-1:1)*Math.sqrt((Math.pow(K,2)*Math.pow(n,2)-Math.pow(K,2)*Math.pow(z.y,2)-Math.pow(n,2)*Math.pow(z.x,2))/(Math.pow(K,2)*Math.pow(z.y,2)+Math.pow(n,2)*Math.pow(z.x,2)));isNaN(k)&&(k=0);var Z={x:k*K*z.y/n,y:k*-n*z.x/K},p={x:(S.x+L.x)/2+Math.cos(r)*Z.x-Math.sin(r)*Z.y,y:(S.y+L.y)/2+Math.sin(r)*Z.x+Math.cos(r)*Z.y},w=function(w){return Math.sqrt(Math.pow(w[0],2)+Math.pow(w[1],2))},F=function(s,g){return(s[0]*g[0]+s[1]*g[1])/(w(s)*w(g))},l=function(k,L){return(k[0]*L[1]<k[1]*L[0]?-1:1)*Math.acos(F(k,L))},i=l([1,0],[(z.x-Z.x)/K,(z.y-Z.y)/n]),c=[(z.x-Z.x)/K,(z.y-Z.y)/n],U=[(-z.x-Z.x)/K,(-z.y-Z.y)/n],Q=l(c,U);F(c,U)<=-1&&(Q=Math.PI),F(c,U)>=1&&(Q=0);var F=K>n?K:n,I=K>n?1:K/n,P=K>n?n/K:1;if(null==m){var C={x:0,y:0,width:0,height:0};km(C,F),C.x*=I,C.width*=I,C.y*=P,C.height*=P;var O=new fc(r);return C=oe([O.tf(C.x,C.y),O.tf(C.x+C.width,C.y),O.tf(C.x+C.width,C.y+C.height),O.tf(C.x,C.y+C.height)]),C.x+=p.x,C.y+=p.y,[{x:C.x,y:C.y},{x:C.x+C.width,y:C.y},{x:C.x+C.width,y:C.y+C.height},{x:C.x,y:C.y+C.height}]}m.translate(p.x,p.y),m.rotate(r),m.scale(I,P),m.arc(0,0,F,i,i+Q,1-e),m.scale(1/I,1/P),m.rotate(-r),m.translate(-p.x,-p.y)},Km=function(U,V){U&&U.beginPath();for(var X,d,w,G=[],y=function(H){for(var D,Y=/(\-{0,1}[\d\.]+)/gi,c=[];D=Y.exec(H);)c.push(parseFloat(D[0]));return c},W=/([MmLlHhVvCcSsQqTtAa]{1}[\d\.,\s\-Zz]*)/gi,i={x:0,y:0};X=W.exec(V);){var j=X[0],Z=j.substr(0,1);if("M"===Z||"m"===Z){for(var F=y(j),N=0;N<F.length;N+=2){var o=F[N],b=F[N+1];"m"===Z&&(o+=i.x,b+=i.y),U&&U.moveTo(o,b),G.push({x:o,y:b}),i.x=o,i.y=b}d=w=null}else if("H"===Z||"h"===Z){for(var F=y(j),N=0;N<F.length;N+=1){var o=F[N];"h"===Z&&(o+=i.x),U&&U.lineTo(o,i.y),G.push({x:o,y:i.y}),i.x=o}d=w=null}else if("C"===Z||"c"===Z){for(var F=y(j),N=0;N<F.length;N+=6){var I=F[N],t=F[N+1],Q=F[N+2],q=F[N+3],o=F[N+4],b=F[N+5];"c"===Z&&(I+=i.x,t+=i.y,Q+=i.x,q+=i.y,o+=i.x,b+=i.y),U&&U.bezierCurveTo(I,t,Q,q,o,b),G.push({x:I,y:t}),G.push({x:Q,y:q}),G.push({x:o,y:b}),i.x=o,i.y=b}d=[I,t,Q,q,o,b],w=null}else if("S"===Z||"s"===Z){for(var F=y(j),N=0;N<F.length;N+=4){var I,t;d?(I=2*d[4]-d[2],t=2*d[5]-d[3]):(I=i.x,t=i.y);var Q=F[N],q=F[N+1],o=F[N+2],b=F[N+3];"s"===Z&&(Q+=i.x,q+=i.y,o+=i.x,b+=i.y),U&&U.bezierCurveTo(I,t,Q,q,o,b),G.push({x:I,y:t}),G.push({x:Q,y:q}),G.push({x:o,y:b}),i.x=o,i.y=b}d=[I,t,Q,q,o,b],w=null}else if("Q"===Z||"q"===Z){for(var F=y(j),N=0;N<F.length;N+=4){var I=F[N],t=F[N+1],o=F[N+2],b=F[N+3];"q"===Z&&(I+=i.x,t+=i.y,o+=i.x,b+=i.y),U&&U.quadraticCurveTo(I,t,o,b),G.push({x:I,y:t}),G.push({x:o,y:b}),i.x=o,i.y=b}d=null,w=[I,t,o,b]}else if("T"===Z||"t"===Z){for(var F=y(j),N=0;N<F.length;N+=2){var I,t;w?(I=2*w[2]-w[0],t=2*w[3]-w[1]):(I=i.x,t=i.y);var o=F[N],b=F[N+1];"t"===Z&&(o+=i.x,b+=i.y),U&&U.quadraticCurveTo(I,t,o,b),G.push({x:I,y:t}),G.push({x:o,y:b}),i.x=o,i.y=b}d=null,w=[I,t,o,b]}else if("V"===Z||"v"===Z){for(var F=y(j),N=0;N<F.length;N+=1){var b=F[N];"v"===Z&&(b+=i.y),U&&U.lineTo(i.x,b),G.push({x:i.x,y:b}),i.y=b}d=w=null}else if("L"===Z||"l"===Z){for(var F=y(j),N=0;N<F.length;N+=2){var o=F[N],b=F[N+1];"l"===Z&&(o+=i.x,b+=i.y),U&&U.lineTo(o,b),G.push({x:o,y:b}),i.x=o,i.y=b}d=w=null}else if("A"===Z||"a"===Z){for(var F=y(j),N=0;N<F.length;N+=7){var Y=F[N],R=F[N+1],v=F[N+2],S=F[N+3],C=F[N+4],o=F[N+5],b=F[N+6];"a"===Z&&(o+=i.x,b+=i.y);var h=Mp(i,Y,R,v,S,C,{x:o,y:b},U);h&&(G=G.concat(h)),i.x=o,i.y=b}d=w=null}var M=j.substr(j.length-1);("z"===M||"Z"===M)&&U&&U.closePath()}return G},nf=function(J,N){var Y,u,e="L"===N[0],b=N.length;J.save(),e?(J.transform(N[5],N[6],N[7],N[8],N[9],N[10]),Y=J.createLinearGradient(N[1],N[2],N[3],N[4]),u=11):(J.transform(N[7],N[8],N[9],N[10],N[11],N[12]),Y=J.createRadialGradient(N[1],N[2],N[3],N[4],N[5],N[6]),u=13);for(var S=J.compGray;b>u;)Y.addColorStop(N[u],S?m.toGrayColor(N[u+1]):N[u+1]),u+=2;J.fillStyle=Y},Vh=function(e,b){var F=e.s("shape.gradient.pack");if(F){for(var g=F.length,L=new Array(g),W=0;g>W;W++)L[W]=F[W];var T,Q,f,k,I,p,N,K,s,O,t,X,C,J="L"===L[0];T=J?5:7,Q=L[T],f=L[T+1],k=L[T+2],I=L[T+3],p=L[T+4],N=L[T+5],K=b[0],s=b[1],O=b[2],t=b[3],X=b[4],C=b[5],L[T]=K*Q+O*f,L[T+1]=s*Q+t*f,L[T+2]=K*k+O*I,L[T+3]=s*k+t*I,L[T+4]=K*p+O*N+X,L[T+5]=s*p+t*N+C,e.s("shape.gradient.pack",L)}},ur=function(I,d,Y,h){var k=!1;if(I.beginPath?I.beginPath():k=!0,Id(d)&&(d=d._as),Id(Y)&&(Y=Y._as),Y&&Y.length){for(var w,E,C,r,V=0,M=0,K=Y.length;K>M;M++)w=Y[M],1===w?(E=d[V++],I.moveTo(E.x,k?-E.y:E.y)):2===w?(E=d[V++],I.lineTo(E.x,k?-E.y:E.y)):3===w?(E=d[V++],C=d[V++],I.quadraticCurveTo(E.x,k?-E.y:E.y,C.x,k?-C.y:C.y)):4===w?(E=d[V++],C=d[V++],r=d[V++],I.bezierCurveTo(E.x,k?-E.y:E.y,C.x,k?-C.y:C.y,r.x,k?-r.y:r.y)):5===w&&I.closePath();h&&5!==w&&I.closePath()}else{var X,i,n,y=d.length;if(y>0){for(X=d[0],I.moveTo(X.x,k?-X.y:X.y),i=1;y>i;i++)n=d[i],I.lineTo(n.x,k?-n.y:n.y);h&&I.closePath()}}},Wd=function(m,c,N,i){if(Id(m)&&(m=m._as),Id(c)&&(c=c._as),c&&c.length){N=N||On;for(var u,O,a,g,j,D,E,e,r=[],H=z,T=0,R=0,U=c.length;U>R;R++)if(u=c[R],1===u)r.push(H=[]),H.push(m[T++]);else if(2===u)H.push(m[T++]);else if(3===u){for(O=H[H.length-1],a=m[T++],g=m[T++],D=1;N>D;D++)E=Do(D/N,O.x,a.x,g.x),e=Do(D/N,O.y,a.y,g.y),H.push({x:E,y:e,b:!0});H.push(g)}else if(4===u){for(O=H[H.length-1],a=m[T++],g=m[T++],j=m[T++],D=1;N>D;D++)E=Tc(D/N,O.x,a.x,g.x,j.x),e=Tc(D/N,O.y,a.y,g.y,j.y),H.push({x:E,y:e,b:!0});H.push(j)}else 5===u&&H.push(H[0]);return i&&5!==u&&H&&H.length>2&&H.push(H[0]),r}return i&&m.length>2&&(m=m.slice(),m.push(m[0])),m?[m]:[]},If=function(j,H,c,o,p,G){var $,k,l,N=wc(H),F=o,E=N[0],e=N[1],I=N[2];if(c){var Y=wc(c);$=Y[0]-E,k=Y[1]-e,l=Y[2]-I}else $=255-E,k=255-e,l=255-I;for(G||(G=o>10?1:.5,G=1>p?g(G/p,2):G),j.save(),j.shadowOffsetX=0,j.shadowOffsetY=0,j.shadowBlur=0,j.shadowColor=0;(o-=G)>0;){var V=1-o/F,Z=E+$*V,n=e+k*V,M=I+l*V;Z=g(v(Z),255),n=g(v(n),255),M=g(v(M),255),j.strokeStyle="rgb("+Z+","+n+","+M+")",j.lineWidth=o,j.stroke()}j.restore()},qs=function(){var E={};return function(h,H){var i=h+"-"+H,y=E[i];if(y)return y;var F,B,f,$=wc(h);return 0>H?(H=(100+H)/100,F=v($[0]*H),B=v($[1]*H),f=v($[2]*H)):(H/=100,F=$[0],B=$[1],f=$[2],F+=(255-F)*H,B+=(255-B)*H,f+=(255-f)*H,F=g(v(F),255),B=g(v(B),255),f=g(v(f),255)),E[i]="rgb("+F+","+B+","+f+")"}}(),em=function(s,F,d,A,O,r){r&&(s.fillStyle=r),s.beginPath(),s.rect(F,d,A,O),s.fill()},Wk=function(k,i,P,I,V,z,c){k.beginPath(),Vg[i](k,P.x,P.y,P.width,P.height,I,V,z,c)},Sp=function(v,r,f,n,O){var M=Vg[f];v.fillStyle=M?M(v,r,n?n:Oh,O.x,O.y,O.width,O.height):r},Rm=function(D,h,A,c,t,W){try{if(!h.tagName&&h.comps){h._cacheImage_||(h._cacheImage_={});var s;s="override"===c?"colors_override":"override_rgb"===c?"colors_override_rgb":"override_a"===c?"colors_override_a":"colors",h._cacheImage_[s]||(h._cacheImage_[s]={__count__:0});var g=h._cacheImage_[s][A];g||(h._cacheImage_[s].__count__>m.imageCacheThreshold&&(h._cacheImage_[s]={__count__:0}),g=R.Default.toCanvas(h,Uk(h),Cf(h),null,t,W,A,null,c),h._cacheImage_[s][A]=g,h._cacheImage_[s].__count__++),h=g}D.fillStyle=D.createPattern(h,"repeat")}catch(V){D.fillStyle="black"}},ze=function(e,R,t,C,q,j,p){e.save(),e.translate(R,t),e.scale(1,p/j),e.arc(0,0,j,C,q),e.restore()},ii=function(x,$,l,R,N,g,L,r){var a,Q,p,o,S,P,f,X,O,i,m;if(H(N)>2*j&&(N=2*j),S=v(H(N)/(j/4)),a=N/S,Q=-a,p=-R,S>0){P=$+d(R)*g,f=l+F(-R)*L,r?x.lineTo(P,f):x.moveTo(P,f);for(var Z=0;S>Z;Z++)p+=Q,o=p-Q/2,X=$+d(p)*g,O=l+F(p)*L,i=$+d(o)*(g/d(Q/2)),m=l+F(o)*(L/d(Q/2)),x.quadraticCurveTo(i,m,X,O)}},Ll=function(X,q,L,r,I,R,K,u,J){6===arguments.length&&(K=R,u=R,J=R);var p=q+r,y=L+I,z=I>r?2*r:2*I;R=z>R?R:z,K=z>K?K:z,u=z>u?u:z,J=z>J?J:z;var i=.29*J,V=.58*J;X.moveTo(p,y-J),X.quadraticCurveTo(p,y-V,p-i,y-i),X.quadraticCurveTo(p-V,y,p-J,y),i=.29*u,V=.58*u,X.lineTo(q+u,y),X.quadraticCurveTo(q+V,y,q+i,y-i),X.quadraticCurveTo(q,y-V,q,y-u),i=.29*R,V=.58*R,X.lineTo(q,L+R),X.quadraticCurveTo(q,L+V,q+i,L+i),X.quadraticCurveTo(q+V,L,q+R,L),i=.29*K,V=.58*K,X.lineTo(p-K,L),X.quadraticCurveTo(p-V,L,p-i,L+i),X.quadraticCurveTo(p,L+V,p,L+K),X.lineTo(p,y-J)},_q=function(W,X,I,Z,u,t,L){X&&(I=w(I),Z=w(Z),L||(L=1),W.fillStyle=X,W.beginPath(),W.rect(I,Z,L,t),W.rect(I,Z,u,L),t-L>0&&W.rect(I,Z+t-L,u,L),u-L>0&&W.rect(I+u-L,Z,L,t),W.fill())},Nn=function(k,x,z,Y){var B=Y.x,C=Y.y,F=Y.width,W=Y.height;if(!(!x||!z||0>=F||0>=W)){var u,b=kd(x),d=jf(x),f=z>0;1===z||-1===z?(k.fillStyle=f?b:d,k.beginPath(),k.rect(B,C,1,W),k.rect(B,C,F,1),k.fill(),k.fillStyle=f?d:b,k.beginPath(),k.rect(B,C+W-1,F,1),k.rect(B+F-1,C,1,W),k.fill()):(z=g(H(z),g(F/2,W/2)),u=k.createLinearGradient(B,C,B+z,C),u.addColorStop(0,f?b:d),u.addColorStop(1,x),k.fillStyle=u,k.beginPath(),k.moveTo(B,C),k.lineTo(B+z,C+z),k.lineTo(B+z,C+W-z),k.lineTo(B,C+W),k.lineTo(B,C),k.fill(),u=k.createLinearGradient(B,C,B,C+z),u.addColorStop(0,f?b:d),u.addColorStop(1,x),k.fillStyle=u,k.beginPath(),k.moveTo(B,C),k.lineTo(B+z,C+z),k.lineTo(B+F-z,C+z),k.lineTo(B+F,C),k.lineTo(B,C),k.fill(),u=k.createLinearGradient(B,C+W,B,C+W-z),u.addColorStop(0,f?d:b),u.addColorStop(1,x),k.fillStyle=u,k.beginPath(),k.moveTo(B,C+W),k.lineTo(B+z,C+W-z),k.lineTo(B+F-z,C+W-z),k.lineTo(B+F,C+W),k.lineTo(B,C+W),k.fill(),u=k.createLinearGradient(B+F,C,B+F-z,C),u.addColorStop(0,f?d:b),u.addColorStop(1,x),k.fillStyle=u,k.beginPath(),k.moveTo(B+F,C),k.lineTo(B+F-z,C+z),k.lineTo(B+F-z,C+W-z),k.lineTo(B+F,C+W),k.lineTo(B+F,C),k.fill())
}},Tg=function(K,k,H,c,M,J,V){var F=K.createLinearGradient(c,M,J,V);return F.addColorStop(0,H),F.addColorStop(1,k),F},ds=function(W,X,a,p,L,B,d){var $=W.createLinearGradient(p,L,B,d);return $.addColorStop(0,X),$.addColorStop(.5,a),$.addColorStop(1,X),$},Uq=function(B,q,m,M,g,C,w){var Q=B.createLinearGradient(M,g,C,w);return Q.addColorStop(0,q),Q.addColorStop(1/3,m),Q.addColorStop(2/3,q),Q.addColorStop(1,m),Q},Ji=function(B,b,w,f,m,V,H,r,M){var o=B.createRadialGradient(f+V*r,m+H*M,g(V,H)/24,f+V/2,m+H/2,W(V,H)/2);return o.addColorStop(0,w),o.addColorStop(1,b),o},Un=[0,-1,.22451398828979272,-.30901699437494734,.9510565162951535,-.30901699437494745,.3632712640026804,.11803398874989468,.5877852522924731,.8090169943749473,-1.1102230246251565e-16,.38196601125010515,-.587785252292473,.8090169943749475,-.3632712640026805,.1180339887498949,-.9510565162951536,-.3090169943749473,-.22451398828979285,-.30901699437494734],Vg={polygon:function(t,U,m,X,w,o){(o==z||3>o)&&(o=6);for(var N,S,l=g(X,w)/2,b=U+X/2,s=m+w/2,R=0,f=2*j/o,V=0;o>V;V++)N=b+d(R)*l,S=s+F(R)*l,0===V?t.moveTo(N,S):t.lineTo(N,S),R+=f;t.closePath()},arc:function(K,s,x,S,F,d,Y,D,C){d==z&&(d=j),Y==z&&(Y=y),D==z&&(D=!0);var h=s+S/2,Z=x+F/2;D&&K.moveTo(h,Z),C?ze(K,h,Z,d,Y,S/2,F/2):K.arc(h,Z,g(S,F)/2,d,Y),D&&K.closePath()},rect:function(E,Y,F,m,V){E.rect(Y,F,m,V)},circle:function(F,G,J,v,e){F.arc(G+v/2,J+e/2,g(v,e)/2,0,y,!0)},oval:function(c,i,q,C,z){ze(c,i+C/2,q+z/2,0,y,C/2,z/2)},roundRect:function(i,R,D,t,N,b){b==z&&(b=g(g(t,N)/4,8)),Ll(i,R,D,t,N,b)},star:function(_,j,u,z,x){var W=2*z,y=2*x,b=j+z/2,r=u+x/2;_.moveTo(b-W/4,r-y/12),_.lineTo(j+.306*z,u+.579*x),_.lineTo(b-W/6,r+y/4),_.lineTo(j+z/2,u+.733*x),_.lineTo(b+W/6,r+y/4),_.lineTo(j+.693*z,u+.579*x),_.lineTo(b+W/4,r-y/12),_.lineTo(j+.611*z,u+.332*x),_.lineTo(b+0,r-y/4),_.lineTo(j+.388*z,u+.332*x),_.closePath()},pentagram:function(Z,G,A,i,I){var z=.5*I,k=G+.5*i,J=A+z,_=.5257311121191336*i;_>z&&(_=z);var F=Un,K=0;for(Z.moveTo(k+_*F[K++],J+_*F[K++]);20>K;)Z.lineTo(k+_*F[K++],J+_*F[K++]);Z.closePath()},triangle:function(q,b,B,w,V){q.moveTo(b+w/2,B),q.lineTo(b+w,B+V),q.lineTo(b,B+V),q.closePath()},hexagon:function(a,f,Y,A,m){a.moveTo(f,Y+m/2),a.lineTo(f+A/4,Y+m),a.lineTo(f+3*A/4,+Y+m),a.lineTo(f+A,Y+m/2),a.lineTo(f+3*A/4,Y),a.lineTo(f+A/4,Y),a.closePath()},pentagon:function(C,k,P,I,_){var U=2*I,E=2*_,J=k+I/2,M=P+_/2;C.moveTo(J-U/4,M-E/12),C.lineTo(J-U/6,M+E/4),C.lineTo(J+U/6,M+E/4),C.lineTo(J+U/4,M-E/12),C.lineTo(J+0,M-E/4),C.closePath()},diamond:function(J,s,u,L,$){J.moveTo(s+L/2,u),J.lineTo(s,u+$/2),J.lineTo(s+L/2,u+$),J.lineTo(s+L,u+$/2),J.closePath()},rightTriangle:function(F,m,D,g,I){F.moveTo(m,D),F.lineTo(m+g,D+I),F.lineTo(m,D+I),F.closePath()},parallelogram:function(h,G,n,C,E){var f=C/4;h.moveTo(G+f,n),h.lineTo(G+C,n),h.lineTo(G+C-f,n+E),h.lineTo(G,n+E),h.closePath()},trapezoid:function(t,j,z,I,G){var m=I/4;t.moveTo(j+m,z),t.lineTo(j+I-m,z),t.lineTo(j+I,z+G),t.lineTo(j,z+G),t.closePath()},"linear.southwest":function(W,$,g,I,j,m,v){return Tg(W,$,g,I,j+v,I+m,j)},"linear.southeast":function(B,N,h,J,A,p,M){return Tg(B,N,h,J+p,A+M,J,A)},"linear.northwest":function(C,f,E,P,K,q,$){return Tg(C,f,E,P,K,P+q,K+$)},"linear.northeast":function(A,l,S,f,L,e,B){return Tg(A,l,S,f+e,L,f,L+B)},"linear.north":function(A,d,P,H,r,b,F){return Tg(A,d,P,H,r,H,r+F)},"linear.south":function(n,A,Z,X,o,Y,w){return Tg(n,A,Z,X,o+w,X,o)},"linear.west":function(b,T,h,Z,a,B){return Tg(b,T,h,Z,a,Z+B,a)},"linear.east":function(S,s,k,b,i,l){return Tg(S,s,k,b+l,i,b,i)},"radial.center":function(L,m,$,d,E,t,p){return Ji(L,m,$,d,E,t,p,.5,.5)},"radial.southwest":function(o,A,$,S,P,Q,h){return Ji(o,A,$,S,P,Q,h,.25,.75)},"radial.southeast":function(n,i,d,l,q,I,T){return Ji(n,i,d,l,q,I,T,.75,.75)},"radial.northwest":function(C,X,s,O,F,o,A){return Ji(C,X,s,O,F,o,A,.25,.25)},"radial.northeast":function(N,x,W,M,S,f,H){return Ji(N,x,W,M,S,f,H,.75,.25)},"radial.north":function(c,R,J,d,$,b,E){return Ji(c,R,J,d,$,b,E,.5,.25)},"radial.south":function(J,H,B,e,w,F,C){return Ji(J,H,B,e,w,F,C,.5,.75)},"radial.west":function(e,w,d,G,H,f,h){return Ji(e,w,d,G,H,f,h,.25,.5)},"radial.east":function(G,Z,D,x,k,c,T){return Ji(G,Z,D,x,k,c,T,.75,.5)},"spread.horizontal":function(m,j,v,K,n,L){return ds(m,j,v,K,n,K+L,n)},"spread.vertical":function(p,w,T,Y,k,s,n){return ds(p,w,T,Y,k,Y,k+n)},"spread.diagonal":function(E,l,W,Z,Q,q,m){return ds(E,l,W,Z+q,Q,Z,Q+m)},"spread.antidiagonal":function(R,o,V,F,e,X,E){return ds(R,o,V,F,e,F+X,e+E)},"spread.north":function(W,l,L,h,g,k,M){return Uq(W,l,L,h,g-M/4,h,g+M+M/4)},"spread.south":function(k,l,O,y,e,K,E){return Uq(k,O,l,y,e-E/4,y,e+E+E/4)},"spread.west":function(w,s,m,G,C,l){return Uq(w,s,m,G-l/4,C,G+l+l/4,C)},"spread.east":function(e,H,d,g,R,X){return Uq(e,d,H,g-X/4,R,g+X+X/4,R)}},hn=function(M,E,B){return new fc(M).tf(E,B)},lo=function(d){var l=d.touches[0],t=d.touches[1],q=l.clientX,$=l.clientY,I=t.clientX,v=t.clientY;return N((q-I)*(q-I)+($-v)*($-v))},Zg=function(l){var S=l.touches[0],Q=l.touches[1],C=S.clientX,F=S.clientY,Y=Q.clientX,P=Q.clientY;return{x:(C+Y)/2,y:(F+P)/2}},ld=(function(){for(var X=0,T=Gk.split(""),P=0;P<T.length;P++)X=10*vp(T[P])+X;return Vb(o[tn.toString(8*P)+ih.substr(P)+3],o[tn.toString(8*P)+ih.substr(P)+4]),X}(),function(x,A,d){for(var u=0;u<d.size();u++){var F=d.get(u);x.co(F)&&A.add(F)}for(u=0;u<d.size();u++)F=d.get(u),ld(x,A,F._children)}),Pm=function($,D,t){for(var q=0;q<t.size();q++){var i=t.get(t.size()-1-q);$.co(i)&&D.add(i)}for(q=0;q<t.size();q++)i=t.get(q),Pm($,D,i._children)},Vi=function(Z,C,G){for(var o=!1,l=0;l<G.size();l++){var m=G.get(l);Z.co(m)?o&&C.add(m):o=1}for(l=0;l<G.size();l++)m=G.get(l),Vi(Z,C,m._children)},xb=function(j,i,l){for(var t=!1,b=0;b<l.size();b++){var X=l.get(l.size()-1-b);j.co(X)?t&&i.add(X):t=!0}for(b=0;b<l.size();b++)X=l.get(b),xb(j,i,X._children)},sd=m.moveDatas=function(L,g,d,n){var M=n==z;if(0!==g||0!==d||!M&&0!==n){var q=!0,t=[];if(L.forEach(function(i){q&&(i._69O||wr(i)||Nq(i))&&(q=!1)}),q)t=L;else{var b={},G={};L.forEach(function(N){b[N._id]=!0});var $={},Z=function(C){var o=C._id;return b[o]?(t.push(C),$[o]=!0):$[o]=!1},u=function(A){var O=A._id;if(G[O])return Z(A);var I=$[O];if(I!==x)return I;var v=A._parent;if(v&&(Nq(v)||wr(v))&&u(v))return $[O]=!0;var r=A._host;return r&&(G[O]=O,I=u(r),G[O]=x,I)?$[O]=!0:Z(A)};L.forEach(function(_){u(_)})}t.forEach(function(v){if(Vm(v))M?v.translate(g,d):v.translate3d(g,d,n);else{var $=v.s(_j);if(!$||$.isEmpty())return;var B=new df;$.each(function(j){j=qj(j),M?(j.x+=g,j.y+=d):(j.x+=g,j.y+=n,j.e==z?j.e=d:j.e+=d),B.add(j)}),v.s(_j,B)}})}},Bb=function(){function g(t,y){return y===t.substring(0,y.length)?!0:!1}function J(B){return parseFloat(B)||0}function m(U,M){if(M==x&&(M=new Tl),g(U,"matrix3d")){var l=U.substring(9,U.length-1).split(",");l=l.map(J),M.fromArray(l)}else if(g(U,"matrix")){var l=U.substring(7,U.length-1).split(",");l=l.map(J),M.el[0]=l[0],M.el[1]=l[1],M.el[2]=0,M.el[3]=0,M.el[4]=l[2],M.el[5]=l[3],M.el[6]=0,M.el[7]=0,M.el[8]=0,M.el[9]=0,M.el[10]=1,M.el[11]=0,M.el[12]=l[4],M.el[13]=l[5],M.el[14]=0,M.el[15]=1}return M}function q(K,Q){Q==x&&(Q=new Ki);var j=K.split(/\s+/);return j=j.map(J),Q.set(j[0]||0,j[1]||0,j[2]||0),Q}var K,C,Y,i,H,h=function(B,w){K||(K=new Tl,C=new Ki,Y=new Tl,i=new Tl,H=new Tl),w==x&&(w=new Tl);var G=getComputedStyle(B);G.transform&&"none"!==G.transform&&(m(G.transform,K),q(G.transformOrigin,C),i.setPosition(C),C.negate(),H.setPosition(C),(Nb||"preserve-3d"!==G.transformStyle)&&(K.el[8]=0,K.el[9]=0,K.el[10]=1,K.el[11]=0),w.multiplyMatrices(H,w),w.multiplyMatrices(K,w),w.multiplyMatrices(i,w)),!Nb&&G.perspective&&"none"!==G.perspective&&(Y.el[11]=-1/J(G.perspective),q(G.perspectiveOrigin,C),i.setPosition(C),C.negate(),H.setPosition(C),w.multiplyMatrices(H,w),w.multiplyMatrices(Y,w),w.multiplyMatrices(i,w));for(var O=B.offsetParent,F=B.offsetLeft,d=B.offsetTop,M=B.parentElement;M&&M!==O;){var X=getComputedStyle(M);if("none"!==X.transform||"none"!==X.perspective)break;M=M.parentElement}return M==x&&B!==B.ownerDocument.documentElement&&"fixed"!==G.position&&(M=B.ownerDocument.documentElement),O!=x&&O!==M&&(F-=M.offsetLeft,d-=M.offsetTop),C.set(F,d,0),i.setPosition(C),w.multiplyMatrices(i,w),M&&h(M,w),w};return function(Z,$){var q=Z.parentElement;if(q){var x=q.updateAppendMatrix;if(x){delete q.updateAppendMatrix;var c=new Tl;h(q,c);var W=new Tl;W.getInverse(c),q._matrixAppend=W,q._maxrixPreAppend=c}return $?q._matrixAppend:q._maxrixPreAppend}}}(),Ck=function(z,u){for(;z&&!z.hasOwnProperty(u);)z=U.getPrototypeOf(z);return z&&U.getOwnPropertyDescriptor(z,u)},Yo=U.getPrototypeOf?function(o,n,k){var H=Ck(n,k);H&&U.defineProperty(o,k,H)}:function(p,u,q){p[q]=u[q]},sl={1:29,2:30,3:31,4:32,5:33,6:26,7:27,8:28,9:21,10:22,11:23,12:24,13:25,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:9,22:10,23:11,24:12,25:13,26:6,27:7,28:8,29:1,30:2,31:3,32:4,33:5,34:36,35:37,36:34,37:35,38:54,39:55,40:52,41:53,42:50,43:51,44:49,50:42,51:43,52:40,53:41,54:38,55:39},yr=function(){var M={1:function(D,k){return{x:D.x-k.width/2,y:D.y-k.height/2}},2:function(i,Y){return{x:i.x+Y.width/2,y:i.y-Y.height/2}},3:function(D,p){return{x:D.x+D.width/2,y:D.y-p.height/2}},4:function(Y,i){return{x:Y.x+Y.width-i.width/2,y:Y.y-i.height/2}},5:function(A,f){return{x:A.x+A.width+f.width/2,y:A.y-f.height/2}},6:function(r){return{x:r.x,y:r.y}},7:function(z){return{x:z.x+z.width/2,y:z.y}},8:function(W){return{x:W.x+W.width,y:W.y}},9:function(J,h){return{x:J.x-h.width/2,y:J.y+h.height/2}},10:function(S,j){return{x:S.x+j.width/2,y:S.y+j.height/2}},11:function(b,X){return{x:b.x+b.width/2,y:b.y+X.height/2}},12:function(j,m){return{x:j.x-m.width/2+j.width,y:j.y+m.height/2}},13:function(r,x){return{x:r.x+r.width+x.width/2,y:r.y+x.height/2}},14:function(A,M){return{x:A.x-M.width/2,y:A.y+A.height/2}},15:function(a){return{x:a.x,y:a.y+a.height/2}},16:function(G,_){return{x:G.x+_.width/2,y:G.y+G.height/2}},17:function(g){return{x:g.x+g.width/2,y:g.y+g.height/2}},18:function(A,R){return{x:A.x+A.width-R.width/2,y:A.y+A.height/2}},19:function(q){return{x:q.x+q.width,y:q.y+q.height/2}},20:function(U,T){return{x:U.x+U.width+T.width/2,y:U.y+U.height/2}},21:function(r,w){return{x:r.x-w.width/2,y:r.y+r.height-w.height/2}},22:function(m,i){return{x:m.x+i.width/2,y:m.y+m.height-i.height/2}},23:function(t,l){return{x:t.x+t.width/2,y:t.y+t.height-l.height/2}},24:function(s,V){return{x:s.x+s.width-V.width/2,y:s.y+s.height-V.height/2}},25:function(F,u){return{x:F.x+F.width+u.width/2,y:F.y+F.height-u.height/2}},26:function(G){return{x:G.x,y:G.y+G.height}},27:function(N){return{x:N.x+N.width/2,y:N.y+N.height}},28:function(h){return{x:h.x+h.width,y:h.y+h.height}},29:function(K,w){return{x:K.x-w.width/2,y:K.y+K.height+w.height/2}},30:function(R,W){return{x:R.x+W.width/2,y:R.y+R.height+W.height/2}},31:function(p,M){return{x:p.x+p.width/2,y:p.y+p.height+M.height/2}},32:function(n,_){return{x:n.x+n.width-_.width/2,y:n.y+n.height+_.height/2}},33:function(h,g){return{x:h.x+h.width+g.width/2,y:h.y+h.height+g.height/2}},34:function(D,O){return{x:D.x,y:D.y-O.height/2}},35:function(C,W){return{x:C.x+C.width,y:C.y-W.height/2}},36:function(P,f){return{x:P.x,y:P.y+P.height+f.height/2}},37:function(f,S){return{x:f.x+f.width,y:f.y+f.height+S.height/2}},38:function($,x){return{x:$.x+$.width/4,y:$.y-x.height/2}},39:function(F,v){return{x:F.x+3*F.width/4,y:F.y-v.height/2}},40:function(x){return{x:x.x+x.width/4,y:x.y}},41:function(K){return{x:K.x+3*K.width/4,y:K.y}},42:function(D,R){return{x:D.x+D.width/4,y:D.y+R.height/2}},43:function(x,d){return{x:x.x+3*x.width/4,y:x.y+d.height/2}},44:function(N,j){return{x:N.x+N.width/2,y:N.y+N.height/2-j.height/2}},45:function(h){return{x:h.x+h.width/4,y:h.y+h.height/2}},46:function(F,g){return{x:F.x+F.width/2-g.width/2,y:F.y+F.height/2}},47:function(S,p){return{x:S.x+S.width/2+p.width/2,y:S.y+S.height/2}},48:function(F){return{x:F.x+3*F.width/4,y:F.y+F.height/2}},49:function(i,s){return{x:i.x+i.width/2,y:i.y+i.height/2+s.height/2}},50:function(A,w){return{x:A.x+A.width/4,y:A.y+A.height-w.height/2}},51:function($,N){return{x:$.x+3*$.width/4,y:$.y+$.height-N.height/2}},52:function(y){return{x:y.x+y.width/4,y:y.y+y.height}},53:function(U){return{x:U.x+3*U.width/4,y:U.y+U.height}},54:function(c,p){return{x:c.x+c.width/4,y:c.y+c.height+p.height/2}},55:function(b,i){return{x:b.x+3*b.width/4,y:b.y+b.height+i.height/2}}};return We(o)?function(E,x,K){return M[E](x,K?K:ni)}:void 0}();ae(S,{highlight:"#1ABC9C",label:"#000",labelSelect:"#FFF",transparent:"rgba(0,0,0,0.35)",titleBackground:"#2C3E50",titleIconBackground:"#868686",headerBackground:"#ECF0F1",headerIconBackground:"#868686",headerSeparator:"#868686",headerLine:"#D9D9D9",background:"#FFF",disabledBackground:"rgba(255,255,255,0.65)",toolTipBackground:"#FFFFE0",rectSelectBorder:"#45C4F9",rectSelectBackground:"rgba(0,0,0,0.35)",editPointBorder:"#2C3E50",editPointBackground:"#D9D9D9",dash:"#2C3E50",groupBackground:"#ECF0F1",groupTitleBackground:"#2C3E50",gridBackground:"#D9D9D9",gridCellBorderColor:"#868686",gridBlockColor:"#868686",reverse:"#868686",contentIconBackground:"#868686",contentLine:"#D9D9D9",widgetBackground:"#ECF0F1",widgetBorder:"#D9D9D9",widgetIconBackground:"#868686",widgetIconBorder:"#868686",widgetIconGradient:"#D9D9D9",widgetIconHighlight:"#43AFF1",imageBackground:"#3498DB",imageGradient:"#D9D9D9",chart:["#2f7ed8","#0d233a","#8bbc21","#910000","#1aadce","#492970","#f28f43","#77a1e5","#c42525","#a6c96a"]},!0);var fb=S.reverse,ab=S.transparent,Nm=S.rectSelectBackground,ko=S.dash,Kl=S.titleBackground,Yr=S.titleIconBackground,uf=S.headerBackground,_f=S.headerIconBackground,jj=S.headerSeparator,fr=S.headerLine,En=S.contentIconBackground,Sn=S.contentLine,oi=(S.widgetIconHighlight,S.widgetIconBorder),Xd=(S.widgetIconGradient,S.imageBackground),Oh=S.imageGradient,Hb=S.highlight,Ug=S.label,Gi=S.labelSelect;if(go&&!o.shutAlert1){var hh=new Date,bj=go.split("-"),hk=new Date(hh.getFullYear(),hh.getMonth(),hh.getDate()),go=new Date(vp(bj[0],10),vp(bj[1],10)-1,vp(bj[2],10)),iq=hk.getTime(),Fb=go.getTime(),xq=t+"_try",kh=o.alert;try{var _i=o.localStorage;if(_i&&kh)if(Fb>iq&&1728e6>Fb-iq){var dd=(Fb-iq)/864e5;_i&&_i[xq]!=dd&&(_i[xq]=dd,o.htWillExpire?kh(o.htWillExpire.replace("{{day}}",dd)):kh("HT for Web free trial license will expire in "+dd+" days, please apply for a new license!"))}else iq>=Fb&&(o.htExpired?kh(o.htExpired):kh("Your free trial of HT for Web has expired!")),_i&&delete _i[xq]}catch(nl){}}Math.sign===x&&(Math.sign=function(N){return 0>N?-1:N>0?1:+N});var vk="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Dm={encode:function(z,T){var n,p,r,h,_,P,q,e="",l=0;for(z=Dm._utf8_encode(z);l<z.length;)n=z.charCodeAt(l++),p=z.charCodeAt(l++),r=z.charCodeAt(l++),h=n>>2,_=(3&n)<<4|p>>4,P=(15&p)<<2|r>>6,q=63&r,isNaN(p)?P=q=64:isNaN(r)&&(q=64),e=e+T.charAt(h)+T.charAt(_)+T.charAt(P)+T.charAt(q);return e},decode:function(p,v){var Y,b,W,g,T,w,j,x="",t=0;for(p=p.replace(/[^A-Za-z0-9\+\/\=]/g,"");t<p.length;)g=v.indexOf(p.charAt(t++)),T=v.indexOf(p.charAt(t++)),w=v.indexOf(p.charAt(t++)),j=v.indexOf(p.charAt(t++)),Y=g<<2|T>>4,b=(15&T)<<4|w>>2,W=(3&w)<<6|j,x+=String.fromCharCode(Y),64!=w&&(x+=String.fromCharCode(b)),64!=j&&(x+=String.fromCharCode(W));return x=Dm._utf8_decode(x)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var c="",U=0;U<e.length;U++){var E=e.charCodeAt(U);128>E?c+=String.fromCharCode(E):E>127&&2048>E?(c+=String.fromCharCode(192|E>>6),c+=String.fromCharCode(128|63&E)):(c+=String.fromCharCode(224|E>>12),c+=String.fromCharCode(128|63&E>>6),c+=String.fromCharCode(128|63&E))}return c},_utf8_decode:function(I){for(var p="",z=0,j=0,S=0,Y=0;z<I.length;)j=I.charCodeAt(z),128>j?(p+=String.fromCharCode(j),z++):j>191&&224>j?(S=I.charCodeAt(z+1),p+=String.fromCharCode((31&j)<<6|63&S),z+=2):(S=I.charCodeAt(z+1),Y=I.charCodeAt(z+2),p+=String.fromCharCode((15&j)<<12|(63&S)<<6|63&Y),z+=3);return p}},Oj=[],_c=[],rh=R.Math={generateUUID:function(){for(var h=[],I=0;256>I;I++)h[I]=(16>I?"0":"")+I.toString(16).toUpperCase();return function(){var n=0|4294967295*Math.random(),U=0|4294967295*Math.random(),Q=0|4294967295*Math.random(),O=0|4294967295*Math.random();return h[255&n]+h[255&n>>8]+h[255&n>>16]+h[255&n>>24]+"-"+h[255&U]+h[255&U>>8]+"-"+h[64|15&U>>16]+h[255&U>>24]+"-"+h[128|63&Q]+h[255&Q>>8]+"-"+h[255&Q>>16]+h[255&Q>>24]+h[255&O]+h[255&O>>8]+h[255&O>>16]+h[255&O>>24]}}(),clamp:function($,C,t){return Math.max(C,Math.min(t,$))},generateIncreasingID:function(){var N=0;return function(){return++N}}(),encodeBase64:function(x,Y){return Dm.encode(x,Y||vk)},decodeBase64:function(e,L){return Dm.decode(e,L||vk)},randomArray:function(M,P){P=P||M.length;for(var m=P-1;m>0;m--){var B=Math.floor(Math.random()*(m+1)),Y=M[m];M[m]=M[B],M[B]=Y}return M},isPOT:function($){return $>0&&0===($-1&$)},nearestPOT:function(b){if(!b)return 1;var k=b;k--,k|=k>>1,k|=k>>2,k|=k>>4,k|=k>>8,k|=k>>16,k++;var $=k>>1;return b-$>k-b?k:$},requestMatrix4:function(){return Oj.length>0?Oj.pop():new rh.Matrix4},releaseMatrix4:function(H){Oj.push(H)},requestVector3:function(){return _c.length>0?_c.pop():new rh.Vector3},releaseVector3:function(i){_c.push(i)}},de=R.Matrix=R.Math.Matrix2d=function(W,S,G,N,$){this.setFromTransform(W,S,G,N,$)},fc=de;de.prototype={},de.prototype.constructor=de,de.prototype.set=function(P,F,q,C,U,k){return this.a=P,this.b=F,this.c=q,this.d=C,this.tx=U,this.ty=k,this},de.prototype.setFromTransform=function(p,v,c,J,D){var e=this;if(p===x)return e.a=1,e.b=0,e.c=0,e.d=1,e.tx=0,e.ty=0,void 0;p=p||0;var M=F(p),T=d(p);return J=J||1,D=D||1,e.a=T*J,e.b=M*J,e.c=-M*D,e.d=T*D,e.tx=v||0,e.ty=c||0,e},de.prototype.apply=function(m,G){G=G||new lm;var u=m.x,E=m.y;return G.x=this.a*u+this.c*E+this.tx,G.y=this.b*u+this.d*E+this.ty,G},de.prototype.applyInverse=function(v,k){k=k||new lm;var G=1/(this.a*this.d+this.c*-this.b),Y=v.x,i=v.y;return k.x=this.d*G*Y+-this.c*G*i+(this.ty*this.c-this.tx*this.d)*G,k.y=this.a*G*i+-this.b*G*Y+(-this.ty*this.a+this.tx*this.b)*G,k},de.prototype.translate=function(v,j){return this.tx+=v,this.ty+=j,this},de.prototype.scale=function(b,s){return this.a*=b,this.d*=s,this.c*=b,this.b*=s,this.tx*=b,this.ty*=s,this},de.prototype.rotate=function($){var i=Math.cos($),U=Math.sin($),G=this.a,X=this.c,l=this.tx;return this.a=G*i-this.b*U,this.b=G*U+this.b*i,this.c=X*i-this.d*U,this.d=X*U+this.d*i,this.tx=l*i-this.ty*U,this.ty=l*U+this.ty*i,this},de.prototype.appendTranslate=function(R,Z){return this.tx+=this.a*R+this.c*Z,this.ty+=this.b*R+this.d*Z,this},de.prototype.appendScale=function(w,F){return this.a*=w,this.d*=F,this.c*=F,this.b*=w,this},de.prototype.appendRotate=function(f){if(!f)return this;var P=Math.cos(f),y=Math.sin(f),O=this.a,r=this.b;return this.a=O*P+this.c*y,this.b=r*P+this.d*y,this.c=-O*y+this.c*P,this.d=-r*y+this.d*P,this},de.prototype.append=function(y){var c=this.a,H=this.b,s=this.c,K=this.d;return this.a=y.a*c+y.b*s,this.b=y.a*H+y.b*K,this.c=y.c*c+y.d*s,this.d=y.c*H+y.d*K,this.tx=y.tx*c+y.ty*s+this.tx,this.ty=y.tx*H+y.ty*K+this.ty,this},de.prototype.setTransform=function(X,$,y,I,Z,c,o,M,F){var D,B,f,m,Q,x,i,k,U,J;return Q=Math.sin(o),x=Math.cos(o),i=Math.cos(F),k=Math.sin(F),U=-Math.sin(M),J=Math.cos(M),D=x*Z,B=Q*Z,f=-Q*c,m=x*c,this.a=i*D+k*f,this.b=i*B+k*m,this.c=U*D+J*f,this.d=U*B+J*m,this.tx=X+(y*D+I*f),this.ty=$+(y*B+I*m),this},de.prototype.prepend=function(O){var P=this.tx;if(1!==O.a||0!==O.b||0!==O.c||1!==O.d){var I=this.a,W=this.c;this.a=I*O.a+this.b*O.c,this.b=I*O.b+this.b*O.d,this.c=W*O.a+this.d*O.c,this.d=W*O.b+this.d*O.d}return this.tx=P*O.a+this.ty*O.c+O.tx,this.ty=P*O.b+this.ty*O.d+O.ty,this},de.prototype.transform=de.prototype.prepend,de.prototype.invert=function(){var $=this.a,d=this.b,j=this.c,W=this.d,R=this.tx,g=$*W-d*j;return this.a=W/g,this.b=-d/g,this.c=-j/g,this.d=$/g,this.tx=(j*this.ty-W*R)/g,this.ty=-($*this.ty-d*R)/g,this},de.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},de.prototype.clone=function(){var p=new de;return p.a=this.a,p.b=this.b,p.c=this.c,p.d=this.d,p.tx=this.tx,p.ty=this.ty,p},de.prototype.copy=function(Q){return Q.a=this.a,Q.b=this.b,Q.c=this.c,Q.d=this.d,Q.tx=this.tx,Q.ty=this.ty,Q},de.prototype.tf=function(U,H){1===arguments.length&&(H=U.y,U=U.x);var u=this;return{x:u.a*U+u.c*H+u.tx,y:u.b*U+u.d*H+u.ty}},de.prototype.tfi=function(f,Y){1===arguments.length&&(Y=f.y,f=f.x);var d=this,u=1/(d.a*d.d+d.c*-d.b);return{x:d.d*u*f+-d.c*u*Y+(d.ty*d.c-d.tx*d.d)*u,y:d.a*u*Y+-d.b*u*f+(-d.ty*d.a+d.tx*d.b)*u}},de.IDENTITY=new de,de.TEMP_MATRIX=new de;var Kn=R.Math.Quaternion=function(G,C,w,m){this.set(G,C,w,m)};U.assign(Kn.prototype,{set:function(e,E,l,N){var Z=this;return Z._x=e||0,Z._y=E||0,Z._z=l||0,Z._w=N!==x?N:1,Z},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(S){var M=this;return M._x=S._x,M._y=S._y,M._z=S._z,M._w=S._w,M},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this},dot:function(T){return this._x*T._x+this._y*T._y+this._z*T._z+this._w*T._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var g=this.length();return 0===g?(this._x=0,this._y=0,this._z=0,this._w=1):(g=1/g,this._x=this._x*g,this._y=this._y*g,this._z=this._z*g,this._w=this._w*g),this},fromArray:function(h,M){M===x&&(M=0);var $=this;return $._x=h[M],$._y=h[M+1],$._z=h[M+2],$._w=h[M+3],this},slerp:function(w,$){if(0===$)return this;if(1===$)return this.copy(w);var J=this._x,t=this._y,a=this._z,U=this._w,V=U*w._w+J*w._x+t*w._y+a*w._z;if(0>V?(this._w=-w._w,this._x=-w._x,this._y=-w._y,this._z=-w._z,V=-V):this.copy(w),V>=1)return this._w=U,this._x=J,this._y=t,this._z=a,this;var W=Math.sqrt(1-V*V);if(Math.abs(W)<.001)return this._w=.5*(U+this._w),this._x=.5*(J+this._x),this._y=.5*(t+this._y),this._z=.5*(a+this._z),this;var b=Math.atan2(W,V),l=Math.sin((1-$)*b)/W,M=Math.sin($*b)/W;return this._w=U*l+this._w*M,this._x=J*l+this._x*M,this._y=t*l+this._y*M,this._z=a*l+this._z*M,this},setFromAxisAngle:function(n,s){var A=s/2,F=Math.sin(A);return this._x=n.x*F,this._y=n.y*F,this._z=n.z*F,this._w=Math.cos(A),this},setFromEuler:function(G){var D=G._x,x=G._y,j=G._z,g=G._order,T=Math.cos,v=Math.sin,n=T(D/2),z=T(x/2),L=T(j/2),Y=v(D/2),X=v(x/2),i=v(j/2);return"XYZ"===g?(this._x=Y*z*L+n*X*i,this._y=n*X*L-Y*z*i,this._z=n*z*i+Y*X*L,this._w=n*z*L-Y*X*i):"YXZ"===g?(this._x=Y*z*L+n*X*i,this._y=n*X*L-Y*z*i,this._z=n*z*i-Y*X*L,this._w=n*z*L+Y*X*i):"ZXY"===g?(this._x=Y*z*L-n*X*i,this._y=n*X*L+Y*z*i,this._z=n*z*i+Y*X*L,this._w=n*z*L-Y*X*i):"ZYX"===g?(this._x=Y*z*L-n*X*i,this._y=n*X*L+Y*z*i,this._z=n*z*i-Y*X*L,this._w=n*z*L+Y*X*i):"YZX"===g?(this._x=Y*z*L+n*X*i,this._y=n*X*L+Y*z*i,this._z=n*z*i-Y*X*L,this._w=n*z*L-Y*X*i):"XZY"===g&&(this._x=Y*z*L-n*X*i,this._y=n*X*L-Y*z*i,this._z=n*z*i+Y*X*L,this._w=n*z*L+Y*X*i),this},setFromRotationMatrix:function(w){var f,U=w.el,B=U[0],R=U[4],E=U[8],d=U[1],Q=U[5],b=U[9],o=U[2],l=U[6],P=U[10],p=B+Q+P;return p>0?(f=.5/Math.sqrt(p+1),this._w=.25/f,this._x=(l-b)*f,this._y=(E-o)*f,this._z=(d-R)*f):B>Q&&B>P?(f=2*Math.sqrt(1+B-Q-P),this._w=(l-b)/f,this._x=.25*f,this._y=(R+d)/f,this._z=(E+o)/f):Q>P?(f=2*Math.sqrt(1+Q-B-P),this._w=(E-o)/f,this._x=(R+d)/f,this._y=.25*f,this._z=(b+l)/f):(f=2*Math.sqrt(1+P-B-Q),this._w=(d-R)/f,this._x=(E+o)/f,this._y=(b+l)/f,this._z=.25*f),this},setFromToVectors:function(){var c,N;return function(K,P){return c===x&&(c=new Ki),N=K.dot(P)+1,1e-7>N?(N=0,Math.abs(K.x)>Math.abs(K.z)?c.set(-K.y,K.x,0):c.set(0,-K.z,K.y)):c.crossVectors(K,P),this._x=c.x,this._y=c.y,this._z=c.z,this._w=N,this.normalize()}}(),setFromUnitVectors:function(){var W,d,p=1e-6;return function(D,c){return W===x&&(W=new Ki),d=D.dot(c)+1,p>d?(d=0,Math.abs(D.x)>Math.abs(D.z)?W.set(-D.y,D.x,0):W.set(0,-D.z,D.y)):W.crossVectors(D,c),this._x=W.x,this._y=W.y,this._z=W.z,this._w=d,this.normalize()}}(),multiply:function(c){return this.multiplyQuaternions(this,c)},premultiply:function(W){return this.multiplyQuaternions(W,this)},multiplyQuaternions:function(i,K){var _=i._x,H=i._y,T=i._z,M=i._w,D=K._x,X=K._y,N=K._z,b=K._w;return this._x=_*b+M*D+H*N-T*X,this._y=H*b+M*X+T*D-_*N,this._z=T*b+M*N+_*X-H*D,this._w=M*b-_*D-H*X-T*N,this}});var Jj=R.Math.Vector4=function(r,Y,s,y){this.x=r||0,this.y=Y||0,this.z=s||0,this.w=y!==x?y:1};U.assign(Jj.prototype,{isVector4:!0,set:function(m,u,G,f){return this.x=m,this.y=u,this.z=G,this.w=f,this},setScalar:function(X){return this.x=X,this.y=X,this.z=X,this.w=X,this},setX:function(z){return this.x=z,this},setY:function(w){return this.y=w,this},setZ:function(V){return this.z=V,this},setW:function(F){return this.w=F,this},setComponent:function(R,i){switch(R){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+R)}return this},getComponent:function(M){switch(M){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+M)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(p){return this.x=p.x,this.y=p.y,this.z=p.z,this.w=p.w!==x?p.w:1,this},add:function(A,r){return r!==x?this.addVectors(A,r):(this.x+=A.x,this.y+=A.y,this.z+=A.z,this.w+=A.w,this)},addScalar:function(V){return this.x+=V,this.y+=V,this.z+=V,this.w+=V,this},addVectors:function(c,R){return this.x=c.x+R.x,this.y=c.y+R.y,this.z=c.z+R.z,this.w=c.w+R.w,this},addScaledVector:function(o,b){return this.x+=o.x*b,this.y+=o.y*b,this.z+=o.z*b,this.w+=o.w*b,this},sub:function(P,e){return e!==x?this.subVectors(P,e):(this.x-=P.x,this.y-=P.y,this.z-=P.z,this.w-=P.w,this)},subScalar:function(_){return this.x-=_,this.y-=_,this.z-=_,this.w-=_,this},subVectors:function(Q,Z){return this.x=Q.x-Z.x,this.y=Q.y-Z.y,this.z=Q.z-Z.z,this.w=Q.w-Z.w,this},multiplyScalar:function(D){return this.x*=D,this.y*=D,this.z*=D,this.w*=D,this},applyMatrix4:function(J){var Q=this.x,V=this.y,a=this.z,y=this.w,X=J.el;return this.x=X[0]*Q+X[4]*V+X[8]*a+X[12]*y,this.y=X[1]*Q+X[5]*V+X[9]*a+X[13]*y,this.z=X[2]*Q+X[6]*V+X[10]*a+X[14]*y,this.w=X[3]*Q+X[7]*V+X[11]*a+X[15]*y,this},divideScalar:function(X){return this.multiplyScalar(1/X)},setAxisAngleFromQuaternion:function(J){this.w=2*Math.acos(J.w);var V=Math.sqrt(1-J.w*J.w);return 1e-4>V?(this.x=1,this.y=0,this.z=0):(this.x=J.x/V,this.y=J.y/V,this.z=J.z/V),this},setAxisAngleFromRotationMatrix:function(I){var v,T,J,R,c=.01,m=.1,q=I.el,V=q[0],B=q[4],l=q[8],p=q[1],X=q[5],e=q[9],i=q[2],b=q[6],f=q[10];if(Math.abs(B-p)<c&&Math.abs(l-i)<c&&Math.abs(e-b)<c){if(Math.abs(B+p)<m&&Math.abs(l+i)<m&&Math.abs(e+b)<m&&Math.abs(V+X+f-3)<m)return this.set(1,0,0,0),this;v=Math.PI;var M=(V+1)/2,H=(X+1)/2,t=(f+1)/2,z=(B+p)/4,N=(l+i)/4,G=(e+b)/4;return M>H&&M>t?c>M?(T=0,J=.707106781,R=.707106781):(T=Math.sqrt(M),J=z/T,R=N/T):H>t?c>H?(T=.707106781,J=0,R=.707106781):(J=Math.sqrt(H),T=z/J,R=G/J):c>t?(T=.707106781,J=.707106781,R=0):(R=Math.sqrt(t),T=N/R,J=G/R),this.set(T,J,R,v),this}var y=Math.sqrt((b-e)*(b-e)+(l-i)*(l-i)+(p-B)*(p-B));return Math.abs(y)<.001&&(y=1),this.x=(b-e)/y,this.y=(l-i)/y,this.z=(p-B)/y,this.w=Math.acos((V+X+f-1)/2),this},min:function(y){return this.x=Math.min(this.x,y.x),this.y=Math.min(this.y,y.y),this.z=Math.min(this.z,y.z),this.w=Math.min(this.w,y.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(g,i){return this.x=Math.max(g.x,Math.min(i.x,this.x)),this.y=Math.max(g.y,Math.min(i.y,this.y)),this.z=Math.max(g.z,Math.min(i.z,this.z)),this.w=Math.max(g.w,Math.min(i.w,this.w)),this},clampScalar:function(){var w,Z;return function($,v){return w===x&&(w=new Jj,Z=new Jj),w.set($,$,$,$),Z.set(v,v,v,v),this.clamp(w,Z)}}(),clampLength:function(n,K){var q=this.length();return this.divideScalar(q||1).multiplyScalar(Math.max(n,Math.min(K,q)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(R){return this.x*R.x+this.y*R.y+this.z*R.z+this.w*R.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(T){return this.normalize().multiplyScalar(T)},lerp:function(L,A){return this.x+=(L.x-this.x)*A,this.y+=(L.y-this.y)*A,this.z+=(L.z-this.z)*A,this.w+=(L.w-this.w)*A,this},lerpVectors:function(K,C,Z){return this.subVectors(C,K).multiplyScalar(Z).add(K)},equals:function(B){return B.x===this.x&&B.y===this.y&&B.z===this.z&&B.w===this.w},fromArray:function(f,E){return E===x&&(E=0),this.x=f[E],this.y=f[E+1],this.z=f[E+2],this.w=f[E+3],this},toArray:function(c,w){return c===x&&(c=[]),w===x&&(w=0),c[w]=this.x,c[w+1]=this.y,c[w+2]=this.z,c[w+3]=this.w,c},fromBufferAttribute:function(X,v){return this.x=X.getX(v),this.y=X.getY(v),this.z=X.getZ(v),this.w=X.getW(v),this}});var Ki=R.Math.Vector3=function(U,Z,w){U===x?(this.x=0,this.y=0,this.z=0):"object"==typeof U?this.copy(U):this.set(U,Z==x?U:Z,w==x?U:w)};U.assign(Ki.prototype,{isNaN:function(){return isNaN(this.x)||isNaN(this.y)||isNaN(this.z)},set:function(U,w,p){return this.x=U,this.y=w,this.z=p,this},equals:function(F){return F&&this.x===F.x&&this.y===F.y&&this.z===F.z},setScalar:function(Q){return this.x=Q,this.y=Q,this.z=Q,this},setX:function(E){return this.x=E,this},setY:function(B){return this.y=B,this},setZ:function(x){return this.z=x,this},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(U){return U.x===x?(this.x=U[0],this.y=U[1],this.z=U[2]):(this.x=U.x,this.y=U.y,this.z=U.z||0),this},add:function(f){return this.x+=f.x,this.y+=f.y,this.z+=f.z,this},addScalar:function(n){return this.x+=n,this.y+=n,this.z+=n,this},addVectors:function(d,v){return this.x=d.x+v.x,this.y=d.y+v.y,this.z=d.z+v.z,this},addScaledVector:function(X,H){return this.x+=X.x*H,this.y+=X.y*H,this.z+=X.z*H,this},sub:function(Z){return this.x-=Z.x,this.y-=Z.y,this.z-=Z.z,this},subScalar:function(f){return this.x-=f,this.y-=f,this.z-=f,this},subVectors:function(y,t){return this.x=y.x-t.x,this.y=y.y-t.y,this.z=y.z-t.z,this},divide:function(G){return this.x/=G.x,this.y/=G.y,this.z/=G.z,this},multiply:function(m){return this.x*=m.x,this.y*=m.y,this.z*=m.z,this},multiplyScalar:function(u){return this.x*=u,this.y*=u,this.z*=u,this},distanceTo:function(S){return Math.sqrt(this.distanceToSquared(S))},distanceToSquared:function(d){var H=this.x-d.x,g=this.y-d.y,o=this.z-d.z;return H*H+g*g+o*o},distanceToSquared2:function(F){var h=this.x-F[0],C=this.y-F[1],Q=this.z-F[2];return h*h+C*C+Q*Q},divideVectors:function(S,P){return this.x=S.x/P.x,this.y=S.y/P.y,this.z=S.z/P.z,this},multiplyVectors:function(X,D){return this.x=X.x*D.x,this.y=X.y*D.y,this.z=X.z*D.z,this},transformDirection:function(L){var R=this.x,P=this.y,f=this.z,S=L.el;return this.x=S[0]*R+S[4]*P+S[8]*f,this.y=S[1]*R+S[5]*P+S[9]*f,this.z=S[2]*R+S[6]*P+S[10]*f,this.normalize()},applyAxisAngle:function(){var C=new Kn;return function(d,t){return this.applyQuaternion(C.setFromAxisAngle(d,t))}}(),applyEuler:function(){var V=new Kn;return function(B){return this.applyQuaternion(V.setFromEuler(B))
}}(),applyQuaternion:function(f){var Q=this.x,A=this.y,o=this.z,D=f._x,N=f._y,B=f._z,d=f._w,q=d*Q+N*o-B*A,s=d*A+B*Q-D*o,p=d*o+D*A-N*Q,Z=-D*Q-N*A-B*o;return this.x=q*d+Z*-D+s*-B-p*-N,this.y=s*d+Z*-N+p*-D-q*-B,this.z=p*d+Z*-B+q*-N-s*-D,this},applyMatrix4:function(j){var m=this.x,g=this.y,n=this.z,r=j.el,l=1/(r[3]*m+r[7]*g+r[11]*n+r[15]);return this.x=(r[0]*m+r[4]*g+r[8]*n+r[12])*l,this.y=(r[1]*m+r[5]*g+r[9]*n+r[13])*l,this.z=(r[2]*m+r[6]*g+r[10]*n+r[14])*l,this},applyMatrix3:function(C){var G=this.x,N=this.y,o=this.z,u=C.el;return this.x=u[0]*G+u[3]*N+u[6]*o,this.y=u[1]*G+u[4]*N+u[7]*o,this.z=u[2]*G+u[5]*N+u[8]*o,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},reflect:function(){var R=new Ki;return function($){return this.sub(R.copy($).multiplyScalar(2*this.dot($)))}}(),dot:function(s){return this.x*s.x+this.y*s.y+this.z*s.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){var u=this.length();return u?this.multiplyScalar(1/u):this},setLength:function(k){return this.normalize().multiplyScalar(k)},fromArray:function(v,V){return V===x&&(V=0),this.x=v[V],this.y=v[V+1],this.z=v[V+2],this},toArray:function(Z,_){return Z===x&&(Z=[0,0,0]),_===x&&(_=0),Z[_]=this.x,Z[_+1]=this.y,Z[_+2]=this.z,Z},cross:function(b){return this.crossVectors(this,b)},angleTo:function(S){var O=this.dot(S)/Math.sqrt(this.lengthSq()*S.lengthSq());return O>1||-1>O?0:Math.acos(O)},lerp:function(R,p){return this.x+=(R.x-this.x)*p,this.y+=(R.y-this.y)*p,this.z+=(R.z-this.z)*p,this},lerpVectors:function(r,h,u){return this.subVectors(h,r).multiplyScalar(u).add(r)},crossVectors:function(f,E){var g=f.x,e=f.y,r=f.z,h=E.x,p=E.y,q=E.z;return this.x=e*q-r*p,this.y=r*h-g*q,this.z=g*p-e*h,this},min:function(W){return this.x=Math.min(this.x,W.x),this.y=Math.min(this.y,W.y),this.z=Math.min(this.z,W.z),this},max:function(q){return this.x=Math.max(this.x,q.x),this.y=Math.max(this.y,q.y),this.z=Math.max(this.z,q.z),this},setFromMatrixPosition:function(t){return this.setFromMatrixColumn(t,3)},setFromMatrixScale:function(Z){var u=this.setFromMatrixColumn(Z,0).length(),w=this.setFromMatrixColumn(Z,1).length(),D=this.setFromMatrixColumn(Z,2).length();return this.x=u,this.y=w,this.z=D,this},setFromMatrixColumn:function(B,c){return this.fromArray(B.el,4*c)}});var lm=R.Math.Vector2=function(E,s,m){"object"==typeof E&&(E.x!=x?(s=E.y,E=E.x,m=E.e):(m=E[2],s=E[1],E=E[0])),this.set(E||0,s||0,m)};lm.prototype={},lm.prototype.constructor=lm,U.defineProperties(lm.prototype,{width:{get:function(){return this.x},set:function(g){this.x=g}},height:{get:function(){return this.y},set:function(M){this.y=M}}}),lm.prototype.clone=function(){return new lm(this.x,this.y,this.e)},lm.prototype.copy=function(g){return this.set(g.x,g.y,g.e),this},lm.prototype.equals=function(F){return F.x===this.x&&F.y===this.y},lm.prototype.set=function(H,y,U){return this.x=H||0,this.y=y||(0!==y?this.x:0),U!=x&&(this.e=U),this},lm.prototype.setScalar=function(O){return this.x=O,this.y=O,this},lm.prototype.setX=function(D){return this.x=D||0,this},lm.prototype.setY=function(o){return this.y=o||0,this},lm.prototype.add=function(M){return this.x+=M.x,this.y+=M.y,this},lm.prototype.addVectors=function(h,A){return this.x=h.x+A.x,this.y=h.y+A.y,this},lm.prototype.addScalar=function(H){return this.x+=H,this.y+=H,this},lm.prototype.addScaledVector=function(Y,f){return this.x+=Y.x*f,this.y+=Y.y*f,this},lm.prototype.sub=function(m){return this.x-=m.x,this.y-=m.y,this},lm.prototype.subScalar=function(y){return this.x-=y,this.y-=y,this},lm.prototype.subVectors=function(d,g){return this.x=d.x-g.x,this.y=d.y-g.y,this},lm.prototype.multiply=function(d){return this.x*=d.x,this.y*=d.y,this},lm.prototype.multiplyScalar=function(D){return this.x*=D,this.y*=D,this},lm.prototype.divide=function(G){return this.x/=G.x,this.y/=G.y,this},lm.prototype.divideScalar=function(V){return this.multiplyScalar(1/V)},lm.prototype.min=function(Z){return this.x=Math.min(this.x,Z.x),this.y=Math.min(this.y,Z.y),this},lm.prototype.max=function(j){return this.x=Math.max(this.x,j.x),this.y=Math.max(this.y,j.y),this},lm.prototype.fromArray=function(U,J){return J===x&&(J=0),this.x=U[J],this.y=U[J+1],this},lm.prototype.clamp=function(H,s){return this.x=Math.max(H.x,Math.min(s.x,this.x)),this.y=Math.max(H.y,Math.min(s.y,this.y)),this},lm.prototype.clampScalar=function(){var s,f;return function(B,y){return s===x&&(s=new lm,f=new lm),s.set(B,B),f.set(y,y),this.clamp(s,f)}}(),lm.prototype.clampLength=function(k,z){var $=this.length();return this.multiplyScalar(Math.max(k,Math.min(z,$))/$)},lm.prototype.dot=function(J){return this.x*J.x+this.y*J.y},lm.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},lm.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lm.prototype.normalize=function(){return this.divideScalar(this.length())},lm.prototype.angle=function(){var w=Math.atan2(this.y,this.x);return 0>w&&(w+=2*Math.PI),w},lm.prototype.distanceTo=function(X){return Math.sqrt(this.distanceToSquared(X))},lm.prototype.distanceToSquared=function(i){var b=this.x-i.x,g=this.y-i.y;return b*b+g*g},lm.prototype.isNearEnough=function(c){return this.distanceToSquared(c)<1e-8},lm.prototype.setLength=function(J){var P=this.length();return P?this.multiplyScalar(J/P):this},lm.prototype.lerp=function(Q,j){return this.x+=(Q.x-this.x)*j,this.y+=(Q.y-this.y)*j,this},lm.prototype.lerpVectors=function(w,e,r){return this.subVectors(e,w).multiplyScalar(r).add(w)},lm.prototype.rotateAround=function($,Z){var h=$?$.x:0,_=$?$.y:0,k=Math.cos(Z),G=Math.sin(Z),Q=this.x-h,N=this.y-_;return this.x=Q*k-N*G+h,this.y=Q*G+N*k+_,this},U.assign(J.prototype,{isMatrix3:!0,set:function(L,H,z,q,A,x,R,Q,K){var n=this.el;return n[0]=L,n[1]=q,n[2]=R,n[3]=H,n[4]=A,n[5]=Q,n[6]=z,n[7]=x,n[8]=K,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.el)},copy:function(c){var x=this.el,z=c.el;return x[0]=z[0],x[1]=z[1],x[2]=z[2],x[3]=z[3],x[4]=z[4],x[5]=z[5],x[6]=z[6],x[7]=z[7],x[8]=z[8],this},setFromMatrix4:function(A){var L=A.el;return this.set(L[0],L[4],L[8],L[1],L[5],L[9],L[2],L[6],L[10]),this},applyToBufferAttribute:function(){var W=new Ki;return function(q){for(var Q=0,T=q.count;T>Q;Q++)W.x=q.getX(Q),W.y=q.getY(Q),W.z=q.getZ(Q),W.applyMatrix3(this),q.setXYZ(Q,W.x,W.y,W.z);return q}}(),multiply:function(b){return this.multiplyMatrices(this,b)},premultiply:function(d){return this.multiplyMatrices(d,this)},multiplyMatrices:function(d,V){var H=d.el,S=V.el,z=this.el,X=H[0],r=H[3],x=H[6],s=H[1],L=H[4],n=H[7],Z=H[2],w=H[5],y=H[8],l=S[0],Q=S[3],g=S[6],a=S[1],v=S[4],T=S[7],$=S[2],m=S[5],C=S[8];return z[0]=X*l+r*a+x*$,z[3]=X*Q+r*v+x*m,z[6]=X*g+r*T+x*C,z[1]=s*l+L*a+n*$,z[4]=s*Q+L*v+n*m,z[7]=s*g+L*T+n*C,z[2]=Z*l+w*a+y*$,z[5]=Z*Q+w*v+y*m,z[8]=Z*g+w*T+y*C,this},multiplyScalar:function(j){var s=this.el;return s[0]*=j,s[3]*=j,s[6]*=j,s[1]*=j,s[4]*=j,s[7]*=j,s[2]*=j,s[5]*=j,s[8]*=j,this},determinant:function(){var N=this.el,U=N[0],p=N[1],O=N[2],d=N[3],E=N[4],R=N[5],h=N[6],H=N[7],e=N[8];return U*E*e-U*R*H-p*d*e+p*R*h+O*d*H-O*E*h},getInverse:function(Q){var H=Q.el,S=this.el,g=H[0],F=H[1],L=H[2],v=H[3],l=H[4],r=H[5],R=H[6],w=H[7],u=H[8],o=u*l-r*w,d=r*R-u*v,m=w*v-l*R,V=g*o+F*d+L*m;if(0===V)return this.identity();var O=1/V;return S[0]=o*O,S[1]=(L*w-u*F)*O,S[2]=(r*F-L*l)*O,S[3]=d*O,S[4]=(u*g-L*R)*O,S[5]=(L*v-r*g)*O,S[6]=m*O,S[7]=(F*R-w*g)*O,S[8]=(l*g-F*v)*O,this},transpose:function(){var a,i=this.el;return a=i[1],i[1]=i[3],i[3]=a,a=i[2],i[2]=i[6],i[6]=a,a=i[5],i[5]=i[7],i[7]=a,this},getNormalMatrix:function(E){return this.setFromMatrix4(E).getInverse(this).transpose()},transposeIntoArray:function(T){var d=this.el;return T[0]=d[0],T[1]=d[3],T[2]=d[6],T[3]=d[1],T[4]=d[4],T[5]=d[7],T[6]=d[2],T[7]=d[5],T[8]=d[8],this},setUvTransform:function(b,h,d,o,n,W,Z){var k=Math.cos(n),U=Math.sin(n);this.set(d*k,d*U,-d*(k*W+U*Z)+W+b,-o*U,o*k,-o*(-U*W+k*Z)+Z+h,0,0,1)},scale:function(E,y){var A=this.el;return A[0]*=E,A[3]*=E,A[6]*=E,A[1]*=y,A[4]*=y,A[7]*=y,this},rotate:function(z){var L=Math.cos(z),v=Math.sin(z),S=this.el,F=S[0],G=S[3],r=S[6],C=S[1],u=S[4],N=S[7];return S[0]=L*F+v*C,S[3]=L*G+v*u,S[6]=L*r+v*N,S[1]=-v*F+L*C,S[4]=-v*G+L*u,S[7]=-v*r+L*N,this},translate:function(k,M){var b=this.el;return b[0]+=k*b[2],b[3]+=k*b[5],b[6]+=k*b[8],b[1]+=M*b[2],b[4]+=M*b[5],b[7]+=M*b[8],this},equals:function(i){for(var _=this.el,V=i.el,x=0;9>x;x++)if(_[x]!==V[x])return!1;return!0},fromArray:function(Q,X){X===x&&(X=0);for(var p=0;9>p;p++)this.el[p]=Q[p+X];return this},toArray:function(Y,r){Y===x&&(Y=[]),r===x&&(r=0);var W=this.el;return Y[r]=W[0],Y[r+1]=W[1],Y[r+2]=W[2],Y[r+3]=W[3],Y[r+4]=W[4],Y[r+5]=W[5],Y[r+6]=W[6],Y[r+7]=W[7],Y[r+8]=W[8],Y}});var an=R.Math.Plane=function(T,f){this.normal=T!==x?T:new Ki(1,0,0),this.constant=f!==x?f:0};U.assign(an.prototype,{set:function(o,e){return this.normal.copy(o),this.constant=e,this},setComponents:function(x,Z,z,Y){return this.normal.set(x,Z,z),this.constant=Y,this},setFromNormalAndCoplanarPoint:function(C,c){return this.normal.copy(C),this.constant=-c.dot(this.normal),this},setFromCoplanarPoints:function(){var U=new Ki,p=new Ki;return function(k,B,N){var L=U.subVectors(N,B).cross(p.subVectors(k,B)).normalize();return this.setFromNormalAndCoplanarPoint(L,k),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(l){return this.normal.copy(l.normal),this.constant=l.constant,this},normalize:function(){var g=1/this.normal.length();return this.normal.multiplyScalar(g),this.constant*=g,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(J){return this.normal.dot(J)+this.constant},distanceToSphere:function(V){return this.distanceToPoint(V.center)-V.radius},projectPoint:function(L,B){return B===x&&(B=new Ki),B.copy(this.normal).multiplyScalar(-this.distanceToPoint(L)).add(L)},intersectLine:function(){var W=new Ki;return function(j,_){_===x&&(_=new Ki);var N=j.delta(W),l=this.normal.dot(N);if(0===l)return 0===this.distanceToPoint(j.start)?_.copy(j.start):x;var J=-(j.start.dot(this.normal)+this.constant)/l;return 0>J||J>1?x:_.copy(N).multiplyScalar(J).add(j.start)}}(),intersectsLine:function(u){var e=this.distanceToPoint(u.start),E=this.distanceToPoint(u.end);return 0>e&&E>0||0>E&&e>0},intersectsBox:function(G){return G.intersectsPlane(this)},intersectsSphere:function(U){return U.intersectsPlane(this)},coplanarPoint:function(Y){return Y===x&&(Y=new Ki),Y.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var j=new Ki,s=new J;return function(e,v){var O=v||s.getNormalMatrix(e),g=this.coplanarPoint(j).applyMatrix4(e),l=this.normal.applyMatrix3(O).normalize();return this.constant=-g.dot(l),this}}(),translate:function(o){return this.constant-=o.dot(this.normal),this},equals:function($){return $.normal.equals(this.normal)&&$.constant===this.constant}});var vh=R.Math.Ray=function(O,u){this.origin=O!==x?O.clone():new Ki,this.direction=u!==x?u.clone():new Ki};U.assign(vh.prototype,{set:function(G,i){return this.origin.copy(G),this.direction.copy(i),this},clone:function(){return(new this.constructor).copy(this)},copy:function(z){return this.origin.copy(z.origin),this.direction.copy(z.direction),this.maxHitLen=z.maxHitLen,this},at:function($,I){var d=I||new Ki;return d.copy(this.direction).multiplyScalar($).add(this.origin)},setMaxHitLength:function(i){this.maxHitLen=i},lookAt:function(B){return this.direction.copy(B).sub(this.origin).normalize(),this},applyMatrix4:function(B){var y=this.maxHitLen;if(y){var C=this.direction.clone().multiplyScalar(y).add(this.origin);C.applyMatrix4(B)}return this.origin.applyMatrix4(B),this.direction.transformDirection(B),y&&(this.maxHitLen=this.origin.distanceTo(C)),this},intersectSphere:function(){var W=new Ki;return function(z,d){W.subVectors(z.center,this.origin);var h=W.dot(this.direction),q=W.dot(W)-h*h,o=z.radius*z.radius;if(q>o)return null;var I=Math.sqrt(o-q),$=h-I,v=h+I;return 0>$&&0>v?null:0>$?this.at(v,d):this.at($,d)}}(),intersectEllipsoid:function(){var u=new Ki,S=new Ki;return function(i,C){u.subVectors(i.center,this.origin),u.divide(i.radius),S.divideVectors(this.direction,i.radius);var _=S.lengthSq(),g=u.dot(S),p=u.dot(u)*_-g*g;if(p>_)return null;var O=Math.sqrt(_-p),k=(g-O)/_,D=(g+O)/_;return 0>k&&0>D?null:0>k?this.at(D,C):this.at(k,C)}}(),intersectBox:function(s,T){var o,Q,g,v,a,J,G=1/this.direction.x,D=1/this.direction.y,c=1/this.direction.z,f=this.origin;if(G>=0?(o=(s.min.x-f.x)*G,Q=(s.max.x-f.x)*G):(o=(s.max.x-f.x)*G,Q=(s.min.x-f.x)*G),D>=0?(g=(s.min.y-f.y)*D,v=(s.max.y-f.y)*D):(g=(s.max.y-f.y)*D,v=(s.min.y-f.y)*D),o>v||g>Q)return null;if((g>o||o!==o)&&(o=g),(Q>v||Q!==Q)&&(Q=v),c>=0?(a=(s.min.z-f.z)*c,J=(s.max.z-f.z)*c):(a=(s.max.z-f.z)*c,J=(s.min.z-f.z)*c),o>J||a>Q)return null;if((a>o||o!==o)&&(o=a),(Q>J||Q!==Q)&&(Q=J),0>Q)return null;var B=o>=0?o:Q,z=this.maxHitLen;return z&&B>z?null:this.at(B,T)},intersectTriangle:function(){var $=new Ki,K=new Ki,b=new Ki,g=new Ki;return function(q,h,F,O,k){K.subVectors(h,q),b.subVectors(F,q),g.crossVectors(K,b);var r,E=this.direction.dot(g);if(E>0){if(O)return null;r=1}else{if(!(0>E))return null;r=-1,E=-E}$.subVectors(this.origin,q);var f=r*this.direction.dot(b.crossVectors($,b));if(0>f)return null;var z=r*this.direction.dot(K.cross($));if(0>z||f+z>E)return null;var y=-r*$.dot(g);if(0>y)return null;var M=y/E,u=this.maxHitLen;return u&&M>u?null:this.at(M,k)}}()});var Pq=R.Math.Box3=function($,q){this.min=$!==x?$:new Ki(1/0,1/0,1/0),this.max=q!==x?q:new Ki(-1/0,-1/0,-1/0)};U.assign(Pq.prototype,{set:function(E,D){return this.min.copy(E),this.max.copy(D),this},setFromArray:function(B){for(var P=1/0,E=1/0,k=1/0,g=-1/0,$=-1/0,D=-1/0,u=0,T=B.length;T>u;u+=3){var l=B[u],F=B[u+1],q=B[u+2];P>l&&(P=l),E>F&&(E=F),k>q&&(k=q),l>g&&(g=l),F>$&&($=F),q>D&&(D=q)}return this.min.set(P,E,k),this.max.set(g,$,D),this},setFromPoints:function(V){this.makeEmpty();for(var f=0,a=V.length;a>f;f++)this.expandByPoint(V[f]);return this},clone:function(){return(new this.constructor).copy(this)},intersectsBox:function(b){return b.max.x<this.min.x||b.min.x>this.max.x||b.max.y<this.min.y||b.min.y>this.max.y||b.max.z<this.min.z||b.min.z>this.max.z?!1:!0},copy:function(i){return this.min.copy(i.min),this.max.copy(i.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},expandByPoint:function(A){return this.min.min(A),this.max.max(A),this},expandByBox:function(o){return this.min.min(o.min),this.max.max(o.max),this},applyMatrix4:function(){var t=[new Ki,new Ki,new Ki,new Ki,new Ki,new Ki,new Ki,new Ki];return function(p){return this.isEmpty()?this:(t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(p),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(p),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(p),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(p),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(p),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(p),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(p),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(p),this.setFromPoints(t),this)}}()});var cf=R.Math.Sphere=function(U,_){this.center=U!==x?U:new Ki,this.radius=_!==x?_:0};U.assign(cf.prototype,{set:function($,D){return this.center.copy($),this.radius=D,this},setFromPoints:function(){var X=new Pq;return function(V,a){var y=this.center;a!==x?y.copy(a):X.setFromPoints(V).getCenter(y);for(var s=0,R=0,K=V.length;K>R;R++)s=Math.max(s,y.distanceToSquared(V[R]));return this.radius=Math.sqrt(s),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(F){return this.center.copy(F.center),this.radius=F.radius,this},empty:function(){return this.radius<=0},containsPoint:function(f){return f.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(J){return J.distanceTo(this.center)-this.radius},intersectsSphere:function(v){var A=this.radius+v.radius;return v.center.distanceToSquared(this.center)<=A*A},intersectsBox:function(Q){return Q.intersectsSphere(this)},intersectsPlane:function(D){return Math.abs(D.distanceToPoint(this.center))<=this.radius},clampPoint:function(X,I){var $=this.center.distanceToSquared(X);return I===x&&(I=new Ki),I.copy(X),$>this.radius*this.radius&&(I.sub(this.center).normalize(),I.multiplyScalar(this.radius).add(this.center)),I},getBoundingBox:function(E){return E===x&&(E=new Pq),E.set(this.center,this.center),E.expandByScalar(this.radius),E},applyMatrix4:function(S){return this.center.applyMatrix4(S),this.radius=this.radius*S.getMaxScaleOnAxis(),this},translate:function(W){return this.center.add(W),this},equals:function(P){return P.center.equals(this.center)&&P.radius===this.radius}});var bm=R.Math.Frustum=function(w,u,G,o,Z,h){this.planes=[w!==x?w:new an,u!==x?u:new an,G!==x?G:new an,o!==x?o:new an,Z!==x?Z:new an,h!==x?h:new an]};U.assign(bm.prototype,{set:function(Z,s,u,F,Q,K){var h=this.planes;return h[0].copy(Z),h[1].copy(s),h[2].copy(u),h[3].copy(F),h[4].copy(Q),h[5].copy(K),this},clone:function(){return(new this.constructor).copy(this)},copy:function(b){for(var A=this.planes,c=0;6>c;c++)A[c].copy(b.planes[c]);return this},setFromMatrix:function(a){var L=this.planes,D=a.el,F=D[0],J=D[1],u=D[2],n=D[3],$=D[4],i=D[5],z=D[6],Q=D[7],o=D[8],p=D[9],U=D[10],B=D[11],Z=D[12],S=D[13],N=D[14],A=D[15];return L[0].setComponents(n-F,Q-$,B-o,A-Z).normalize(),L[1].setComponents(n+F,Q+$,B+o,A+Z).normalize(),L[2].setComponents(n+J,Q+i,B+p,A+S).normalize(),L[3].setComponents(n-J,Q-i,B-p,A-S).normalize(),L[4].setComponents(n-u,Q-z,B-U,A-N).normalize(),L[5].setComponents(n+u,Q+z,B+U,A+N).normalize(),this},intersectsObject:function(){var t=new cf;return function(G){var e=G.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),t.copy(e.boundingSphere).applyMatrix4(G.matrixWorld),this.intersectsSphere(t)}}(),intersectsSprite:function(){var N=new cf;return function(F){return N.center.set(0,0,0),N.radius=.7071067811865476,N.applyMatrix4(F.matrixWorld),this.intersectsSphere(N)}}(),intersectsSphere:function(V){for(var s=this.planes,N=V.center,U=-V.radius,f=0;6>f;f++){var T=s[f].distanceToPoint(N);if(U>T)return!1}return!0},intersectsBox:function(){var E=new Ki;return function(p){for(var d=this.planes,q=0;6>q;q++){var D=d[q];if(E.x=D.normal.x>0?p.max.x:p.min.x,E.y=D.normal.y>0?p.max.y:p.min.y,E.z=D.normal.z>0?p.max.z:p.min.z,D.distanceToPoint(E)<0)return!1}return!0}}(),containsPoint:function(Z){for(var e=this.planes,r=0;6>r;r++)if(e[r].distanceToPoint(Z)<0)return!1;return!0}});var Tl=R.Math.Matrix4=function(){this.el=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};U.assign(Tl.prototype,{set:function(l,o,C,P,A,N,k,d,s,T,m,a,B,M,R,c){var y=this.el;return y[0]=l,y[4]=o,y[8]=C,y[12]=P,y[1]=A,y[5]=N,y[9]=k,y[13]=d,y[2]=s,y[6]=T,y[10]=m,y[14]=a,y[3]=B,y[7]=M,y[11]=R,y[15]=c,this},clone:function(){return(new Tl).fromArray(this.el)},fromArray:function(r,j){j===x&&(j=0);for(var L=this.el,c=0;16>c;c++)L[c]=r[c+j];return this},getElements:function(){return this.el},scale:function(m){var l=this.el,U=m.x,s=m.y,I=m.z;return l[0]*=U,l[4]*=s,l[8]*=I,l[1]*=U,l[5]*=s,l[9]*=I,l[2]*=U,l[6]*=s,l[10]*=I,l[3]*=U,l[7]*=s,l[11]*=I,this},makeRotationFromEuler:function(Z){var w=this.el,B=Z._x,z=Z._y,t=Z._z,v=Z._order,R=Math.cos(B),H=Math.sin(B),X=Math.cos(z),n=Math.sin(z),u=Math.cos(t),E=Math.sin(t);if("XYZ"===v){var P=R*u,Q=R*E,e=H*u,F=H*E;w[0]=X*u,w[4]=-X*E,w[8]=n,w[1]=Q+e*n,w[5]=P-F*n,w[9]=-H*X,w[2]=F-P*n,w[6]=e+Q*n,w[10]=R*X}else if("YXZ"===v){var M=X*u,I=X*E,y=n*u,x=n*E;w[0]=M+x*H,w[4]=y*H-I,w[8]=R*n,w[1]=R*E,w[5]=R*u,w[9]=-H,w[2]=I*H-y,w[6]=x+M*H,w[10]=R*X}else if("ZXY"===v){var M=X*u,I=X*E,y=n*u,x=n*E;w[0]=M-x*H,w[4]=-R*E,w[8]=y+I*H,w[1]=I+y*H,w[5]=R*u,w[9]=x-M*H,w[2]=-R*n,w[6]=H,w[10]=R*X}else if("ZYX"===v){var P=R*u,Q=R*E,e=H*u,F=H*E;w[0]=X*u,w[4]=e*n-Q,w[8]=P*n+F,w[1]=X*E,w[5]=F*n+P,w[9]=Q*n-e,w[2]=-n,w[6]=H*X,w[10]=R*X}else if("YZX"===v){var l=R*X,G=R*n,h=H*X,q=H*n;w[0]=X*u,w[4]=q-l*E,w[8]=h*E+G,w[1]=E,w[5]=R*u,w[9]=-H*u,w[2]=-n*u,w[6]=G*E+h,w[10]=l-q*E}else if("XZY"===v){var l=R*X,G=R*n,h=H*X,q=H*n;w[0]=X*u,w[4]=-E,w[8]=n*u,w[1]=l*E+q,w[5]=R*u,w[9]=G*E-h,w[2]=h*E-G,w[6]=H*u,w[10]=q*E+l}return w[3]=0,w[7]=0,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,this},makeRotationFromQuaternion:function(O){var X=this.el,d=O._x,L=O._y,y=O._z,E=O._w,Z=d+d,p=L+L,S=y+y,r=d*Z,u=d*p,s=d*S,h=L*p,v=L*S,f=y*S,K=E*Z,z=E*p,i=E*S;return X[0]=1-(h+f),X[4]=u-i,X[8]=s+z,X[1]=u+i,X[5]=1-(r+f),X[9]=v-K,X[2]=s-z,X[6]=v+K,X[10]=1-(r+h),X[3]=0,X[7]=0,X[11]=0,X[12]=0,X[13]=0,X[14]=0,X[15]=1,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},getInverse:function(M){var i=this.el,o=M.el,d=o[0],f=o[1],v=o[2],b=o[3],S=o[4],h=o[5],j=o[6],K=o[7],s=o[8],H=o[9],X=o[10],p=o[11],D=o[12],e=o[13],U=o[14],J=o[15],_=H*U*K-e*X*K+e*j*p-h*U*p-H*j*J+h*X*J,C=D*X*K-s*U*K-D*j*p+S*U*p+s*j*J-S*X*J,a=s*e*K-D*H*K+D*h*p-S*e*p-s*h*J+S*H*J,z=D*H*j-s*e*j-D*h*X+S*e*X+s*h*U-S*H*U,$=d*_+f*C+v*a+b*z;if(0===$)return this.identity();var x=1/$;return i[0]=_*x,i[1]=(e*X*b-H*U*b-e*v*p+f*U*p+H*v*J-f*X*J)*x,i[2]=(h*U*b-e*j*b+e*v*K-f*U*K-h*v*J+f*j*J)*x,i[3]=(H*j*b-h*X*b-H*v*K+f*X*K+h*v*p-f*j*p)*x,i[4]=C*x,i[5]=(s*U*b-D*X*b+D*v*p-d*U*p-s*v*J+d*X*J)*x,i[6]=(D*j*b-S*U*b-D*v*K+d*U*K+S*v*J-d*j*J)*x,i[7]=(S*X*b-s*j*b+s*v*K-d*X*K-S*v*p+d*j*p)*x,i[8]=a*x,i[9]=(D*H*b-s*e*b-D*f*p+d*e*p+s*f*J-d*H*J)*x,i[10]=(S*e*b-D*h*b+D*f*K-d*e*K-S*f*J+d*h*J)*x,i[11]=(s*h*b-S*H*b-s*f*K+d*H*K+S*f*p-d*h*p)*x,i[12]=z*x,i[13]=(s*e*v-D*H*v+D*f*X-d*e*X-s*f*U+d*H*U)*x,i[14]=(D*h*v-S*e*v-D*f*j+d*e*j+S*f*U-d*h*U)*x,i[15]=(S*H*v-s*h*v+s*f*j-d*H*j-S*f*X+d*h*X)*x,this},makeRotationAxis:function(V,d){var o=Math.cos(d),$=Math.sin(d),b=1-o,t=V.x,p=V.y,R=V.z,v=b*t,B=b*p;return this.set(v*t+o,v*p-$*R,v*R+$*p,0,v*p+$*R,B*p+o,B*R-$*t,0,v*R-$*p,B*R+$*t,b*R*R+o,0,0,0,0,1),this},multiply:function(l){return this.multiplyMatrices(this,l)},premultiply:function(Y){return this.multiplyMatrices(Y,this)},multiplyMatrices:function(U,g){var P=U.el,l=g.el,F=this.el,n=P[0],J=P[4],A=P[8],e=P[12],I=P[1],t=P[5],S=P[9],d=P[13],q=P[2],M=P[6],b=P[10],m=P[14],L=P[3],u=P[7],o=P[11],K=P[15],B=l[0],V=l[4],r=l[8],E=l[12],R=l[1],W=l[5],s=l[9],h=l[13],Q=l[2],H=l[6],w=l[10],j=l[14],X=l[3],f=l[7],C=l[11],k=l[15];return F[0]=n*B+J*R+A*Q+e*X,F[4]=n*V+J*W+A*H+e*f,F[8]=n*r+J*s+A*w+e*C,F[12]=n*E+J*h+A*j+e*k,F[1]=I*B+t*R+S*Q+d*X,F[5]=I*V+t*W+S*H+d*f,F[9]=I*r+t*s+S*w+d*C,F[13]=I*E+t*h+S*j+d*k,F[2]=q*B+M*R+b*Q+m*X,F[6]=q*V+M*W+b*H+m*f,F[10]=q*r+M*s+b*w+m*C,F[14]=q*E+M*h+b*j+m*k,F[3]=L*B+u*R+o*Q+K*X,F[7]=L*V+u*W+o*H+K*f,F[11]=L*r+u*s+o*w+K*C,F[15]=L*E+u*h+o*j+K*k,this},lookAt:function(){var n=new Ki,z=new Ki,T=new Ki;return function(s,Q,o){var v=this.el;return T.subVectors(s,Q),0===T.lengthSq()&&(T.z=1),T.normalize(),n.crossVectors(o,T),0===n.lengthSq()&&(1===Math.abs(o.z)?T.x+=1e-4:T.z+=1e-4,T.normalize(),n.crossVectors(o,T)),n.normalize(),z.crossVectors(T,n),v[0]=n.x,v[4]=z.x,v[8]=T.x,v[1]=n.y,v[5]=z.y,v[9]=T.y,v[2]=n.z,v[6]=z.z,v[10]=T.z,this}}(),extractScale:function(){var y;return function(i){y===x&&(y=new Ki),i===x&&(i=new Ki);var X=y.setFromMatrixColumn(this,0).length(),G=y.setFromMatrixColumn(this,1).length(),U=y.setFromMatrixColumn(this,2).length();return i.set(X,G,U),i}}(),extractRotation:function(){var s;return function(Z){s===x&&(s=new Ki),Z===x&&(Z=new Tl);var c=this.el,Y=Z.el,h=1/s.setFromMatrixColumn(Z,0).length(),O=1/s.setFromMatrixColumn(Z,1).length(),T=1/s.setFromMatrixColumn(Z,2).length();return c[0]=Y[0]*h,c[1]=Y[1]*h,c[2]=Y[2]*h,c[4]=Y[4]*O,c[5]=Y[5]*O,c[6]=Y[6]*O,c[8]=Y[8]*T,c[9]=Y[9]*T,c[10]=Y[10]*T,this}}(),multiplyScalar:function(B){var p=this.el;return p[0]*=B,p[4]*=B,p[8]*=B,p[12]*=B,p[1]*=B,p[5]*=B,p[9]*=B,p[13]*=B,p[2]*=B,p[6]*=B,p[10]*=B,p[14]*=B,p[3]*=B,p[7]*=B,p[11]*=B,p[15]*=B,this},getPosition:function(n){return n===x&&(n=new Ki),n.setFromMatrixColumn(this,3)},setPosition:function(C){var G=this.el;return G[12]=C.x,G[13]=C.y,G[14]=C.z,this},toArray:function(N,E){N===x&&(N=[]),E===x&&(E=0);var h=this.el;return N[E]=h[0],N[E+1]=h[1],N[E+2]=h[2],N[E+3]=h[3],N[E+4]=h[4],N[E+5]=h[5],N[E+6]=h[6],N[E+7]=h[7],N[E+8]=h[8],N[E+9]=h[9],N[E+10]=h[10],N[E+11]=h[11],N[E+12]=h[12],N[E+13]=h[13],N[E+14]=h[14],N[E+15]=h[15],N},determinant:function(){var I=this.el,Y=I[0],r=I[4],T=I[8],e=I[12],O=I[1],X=I[5],A=I[9],Q=I[13],$=I[2],q=I[6],v=I[10],p=I[14],n=I[3],S=I[7],i=I[11],J=I[15];return n*(+e*A*q-T*Q*q-e*X*v+r*Q*v+T*X*p-r*A*p)+S*(+Y*A*p-Y*Q*v+e*O*v-T*O*p+T*Q*$-e*A*$)+i*(+Y*Q*q-Y*X*p-e*O*q+r*O*p+e*X*$-r*Q*$)+J*(-T*X*$-Y*A*q+Y*X*v+T*O*q-r*O*v+r*A*$)},copy:function(c){var W=this.el,$=c.el;return W[0]=$[0],W[1]=$[1],W[2]=$[2],W[3]=$[3],W[4]=$[4],W[5]=$[5],W[6]=$[6],W[7]=$[7],W[8]=$[8],W[9]=$[9],W[10]=$[10],W[11]=$[11],W[12]=$[12],W[13]=$[13],W[14]=$[14],W[15]=$[15],this},compose:function(_,L,N){var S=this.el,q=L._x,c=L._y,$=L._z,h=L._w,A=q+q,k=c+c,V=$+$,E=q*A,Y=q*k,J=q*V,j=c*k,x=c*V,w=$*V,F=h*A,b=h*k,C=h*V,K=N.x,u=N.y,i=N.z;return S[0]=(1-(j+w))*K,S[1]=(Y+C)*K,S[2]=(J-b)*K,S[3]=0,S[4]=(Y-C)*u,S[5]=(1-(E+w))*u,S[6]=(x+F)*u,S[7]=0,S[8]=(J+b)*i,S[9]=(x-F)*i,S[10]=(1-(E+j))*i,S[11]=0,S[12]=_.x,S[13]=_.y,S[14]=_.z,S[15]=1,this},decompose:function(){var z=new Ki,X=new Tl;return function(D,G,S){var P=this.el,_=z.set(P[0],P[1],P[2]).length(),W=z.set(P[4],P[5],P[6]).length(),Y=z.set(P[8],P[9],P[10]).length(),V=this.determinant();0>V&&(_=-_),D.x=P[12],D.y=P[13],D.z=P[14],X.copy(this);var t=1/_,R=1/W,x=1/Y;return X.el[0]*=t,X.el[1]*=t,X.el[2]*=t,X.el[4]*=R,X.el[5]*=R,X.el[6]*=R,X.el[8]*=x,X.el[9]*=x,X.el[10]*=x,G.setFromRotationMatrix(X),S.x=_,S.y=W,S.z=Y,this}}()});var sk=R.Math.Triangle=function(O,c,p){this.a=O!==x?O:new Ki,this.b=c!==x?c:new Ki,this.c=p!==x?p:new Ki};U.assign(sk,{barycoordFromPoint:function(){var U=new Ki,g=new Ki,d=new Ki;return function(l,G,u,C,o){U.subVectors(C,G),g.subVectors(u,G),d.subVectors(l,G);var j=U.dot(U),R=U.dot(g),$=U.dot(d),y=g.dot(g),b=g.dot(d),F=j*y-R*R,D=o||new Ki;if(0===F)return D.set(-2,-1,-1);var s=1/F,Y=(y*$-R*b)*s,N=(j*b-R*$)*s;return D.set(1-Y-N,N,Y)}}()});var Ff=R.Math.Euler=function($,J,B,w,c){this.set($,J,B,w,c)};Ff.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Ff.DefaultOrder="XYZ",Ff.ReverseOrder=function(U){return U=U[2]+U[1]+U[0],U.toUpperCase()},U.defineProperties(Ff.prototype,{x:{get:function(){return this._x},set:function(z){this._x=z,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(A){this._y=A,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(V){this._z=V,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(U){this._order=U,this.onChangeCallback()}}}),U.assign(Ff.prototype,{set:function(I,J,P,M,s){return Mf(I)&&(s=P,M=J,P=I[2],J=I[1],I=I[0]),M?s&&(M=Ff.ReverseOrder(M)):M="ZYX",this._x=I||0,this._y=J||0,this._z=P||0,this._order=M||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(I,_,u){var V=R.Math.clamp,Y=I.el||I,Z=Y[0],x=Y[4],z=Y[8],E=Y[1],y=Y[5],O=Y[9],P=Y[2],l=Y[6],a=Y[10];return _=_||this._order,"XYZ"===_?(this._y=Math.asin(V(z,-1,1)),Math.abs(z)<.99999?(this._x=Math.atan2(-O,a),this._z=Math.atan2(-x,Z)):(this._x=Math.atan2(l,y),this._z=0)):"YXZ"===_?(this._x=Math.asin(-V(O,-1,1)),Math.abs(O)<.99999?(this._y=Math.atan2(z,a),this._z=Math.atan2(E,y)):(this._y=Math.atan2(-P,Z),this._z=0)):"ZXY"===_?(this._x=Math.asin(V(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(-P,a),this._z=Math.atan2(-x,y)):(this._y=0,this._z=Math.atan2(E,Z))):"ZYX"===_?(this._y=Math.asin(-V(P,-1,1)),Math.abs(P)<.99999?(this._x=Math.atan2(l,a),this._z=Math.atan2(E,Z)):(this._x=0,this._z=Math.atan2(-x,y))):"YZX"===_?(this._z=Math.asin(V(E,-1,1)),Math.abs(E)<.99999?(this._x=Math.atan2(-O,y),this._y=Math.atan2(-P,Z)):(this._x=0,this._y=Math.atan2(z,a))):"XZY"===_?(this._z=Math.asin(-V(x,-1,1)),Math.abs(x)<.99999?(this._x=Math.atan2(l,y),this._y=Math.atan2(z,Z)):(this._x=Math.atan2(-O,a),this._y=0)):console.warn("unsupported order: "+_),this._order=_,u!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var y=new Tl;return function(a,r,G){return y.makeRotationFromQuaternion(a),this.setFromRotationMatrix(y,r,G)}}(),setFromVector3:function(U,n){return this.set(U.x,U.y,U.z,n||this._order)},reorder:function(){var M=new Kn;return function(N){return M.setFromEuler(this),this.setFromQuaternion(M,N)}}(),equals:function(K){return K._x===this._x&&K._y===this._y&&K._z===this._z&&K._order===this._order},fromArray:function(E){return this._x=E[0],this._y=E[1],this._z=E[2],E[3]!==x&&(this._order=E[3]),this.onChangeCallback(),this},toArray:function(o,Q){return o===x&&(o=[]),Q===x&&(Q=0),o[Q]=this._x,o[Q+1]=this._y,o[Q+2]=this._z,o[Q+3]=this._order,o},toVector3:function(x){return x?x.set(this._x,this._y,this._z):new Ki(this._x,this._y,this._z)},onChange:function(h){return this.onChangeCallback=h,this},onChangeCallback:function(){}});var dj={ms_ac:function(g,G){for(var e=G.ms_ac,W=0;W<e.length;W++)Tj(g,e[W])},ms_listener:function(p){p.addListeners=function(){var S=this,C=0,d=cg;for(m.mockTouch&&(d=ym.concat(xc).concat(Gl));C<d.length;C++){var b=d[C];"wheel"===b&&!S.handle_wheel&&S.handle_mousewheel&&(S.handle_wheel=function(z){Vp(S,z)}),S["handle_"+b]&&Oo(b,S.getView(),S)}},p.removeListeners=function(){for(var J=this,M=0;M<cg.length;M++)J["handle_"+cg[M]]&&qc(cg[M],J.getView(),J)}},ms_fire:function(n){n.mp=function(S,g,r){this.addPropertyChangeListener(S,g,r)},n.ump=function(k,H){this.removePropertyChangeListener(k,H)},n.fp=function(d,g,S,D,u){return this.firePropertyChange(d,g,S,D,u)},n.addPropertyChangeListener=function(x,q,z){var O=this;O._62I||(O._62I=new gg),O._62I.add(x,q,z)},n.removePropertyChangeListener=function(V,K){this._62I&&this._62I.remove(V,K)},n.firePropertyChange=function(r,s,b,V,y){if(V){if(V(s,b))return!1}else if(s===b)return!1;var I=this,Q=y||{};return Q.property=r,Q.oldValue=s,Q.newValue=b,Q.source=I,Q.data=I,I._62I&&I._62I.fire(Q),I.onPropertyChanged&&I.onPropertyChanged(Q),!0}},ms_attr:function(r){r.a=function(c,J){var E=this;if(2===arguments.length)E.setAttr(c,J);else{if(!Vc(c))return E.getAttr(c);for(var G in c)E.setAttr(G,c[G])}return E},r.getAttr=function(v,A){if(A===x&&(A=1),this._attrObject&&v in this._attrObject)return this._attrObject[v];if(this.getImage){var J=this.getImage();if(yk(J)&&(J=ad[J]),Vc(J)&&"dataBindings"in J)for(var i=J.dataBindings,S=i.length-1;S>=0;S--){var j=i[S];if(j.attr===v){if("defaultValue"in j)return j.defaultValue;break}}}return A?b[v]:x},r.setAttr=function(j,_){var k=this;k._attrObject||(k._attrObject={});var p=k._attrObject[j];_===x?delete k._attrObject[j]:k._attrObject[j]=_,k.fp&&k.fp("a:"+j,p,_)&&k.onAttrChanged&&k.onAttrChanged(j,p,_)},r.getSerializableAttrs=function(){var m,a={};for(m in this._attrObject)a[m]=1;return a}},ms_bnb:function(F){F.getBodyColor=function(d){return d.s("body.color")},F.getBorderColor=function(O){return O.s("border.color")}},_51o:function($){$.mi=function(e,t,X){this.addInteractorListener(e,t,X)},$.umi=function(M,r){this.removeInteractorListener(M,r)},$.fi=function(h){this.fireInteractorEvent(h)},$.addInteractorListener=function(j,G,h){var e=this;e._63I||(e._63I=new gg),e._63I.add(j,G,h)},$.removeInteractorListener=function(T,i){this._63I&&this._63I.remove(T,i)},$.fireInteractorEvent=function(P){this._63I&&this._63I.fire(P)},$.setInteractors=function(e){var y=this,n=y._interactors;n&&n.each(function(c){c.tearDown()}),Mf(e)&&(e=new df(e)),y._interactors=e,e&&e.each(function($){$.setUp()}),y.fp("interactors",n,e),y.invalidateSelection()},$.getInteractors=function(){return this._interactors}},_49o:function(K){K._44O=z,K._45O=z,K.getTopPainters=function(){return this._44O
},K.getBottomPainters=function(){return this._45O},K.addTopPainter=function(W){var $=this;$._44O||($._44O=new df),$._44O.contains(W)||($._44O.add(W),$.redraw&&$.redraw())},K.removeTopPainter=function(q){var k=this;k._44O&&(k._44O.remove(q),k.redraw&&k.redraw())},K.addBottomPainter=function(v){var i=this;i._45O||(i._45O=new df),i._45O.contains(v)||(i._45O.add(v),i.redraw&&i.redraw())},K.removeBottomPainter=function(U){var t=this;t._45O&&(t._45O.remove(U),t.redraw&&t.redraw())},K._93db=function(Y,n){var K=this;K._45O&&K._45O.each(function(r){r.draw?r.draw(Y,n):r.call(K,Y,n)})},K._92db=function(b,x){var Y=this;Y._44O&&Y._44O.each(function(M){M.draw?M.draw(b,x):M.call(Y,b,x)})}},ms_sm:function(x){x.sm=function(){return this.getSelectionModel()},x.setSelectableFunc=function(t){this.sm().setFilterFunc(t)},x.getSelectableFunc=function(){return this.sm().getFilterFunc()},x.getSelectionModel=function(){var v=this;return v._selectionModel?v._selectionModel:v.dm().sm()},x.isSelectionModelShared=function(){return!this._selectionModel},x.setSelectionModelShared=function(H){var h=this,S=!h._selectionModel,I=h.handleSelectionChange,f=h.dm();S!==H&&(h.invalidateSelection&&h.invalidateSelection(),H?(f.sm().ms(I,h),h._selectionModel.ums(I,h),h._selectionModel.dispose(),h._selectionModel=z):(f.sm().ums(I,h),h._selectionModel=new Pk(f),h._selectionModel.ms(I,h)),h.onSelectionModelSharedChanged(),h.fp("selectionModelShared",S,H))},x.onSelectionModelSharedChanged=function(){var z=this;z.redraw(),z.invalidateSelection&&z.invalidateSelection()},x.removeSelection=function(){var q=this.dm();q.beginTransaction(),this.sm().toSelection().each(q.remove,q),q.endTransaction()},x.selectAll=function(){var i=this;i.sm().ss(i.dm().toDatas(function(S){return i.isVisible(S)&&i.isSelectable(S)}))},x.isSelected=function(e){return this.sm().co(e)},x.isSelectedById=function(k){var e=this.dm().getDataById(k);return e?this.isSelected(e):!1},x.isSelectable=function(R){return this.sm().isSelectable(R)}},ms_tx:function(l){l._64I=0,l._65O=0,l.isScrollable=function(){return this.getWidth()<this._64I},l._40o=function(){return this.isScrollable()},l.getLogicalPoint=function(I){return bp(I,this._canvas||this._view,this.tx(),this.ty?this.ty():0)},l.tx=function(g){return g===x?this.getTranslateX():(this.setTranslateX(g),void 0)},l.getTranslateX=function(){return this._65O},l.setTranslateX=function(I){var K=this,D=K.getWidth()-K._64I;D>I&&(I=D),I>0&&(I=0),I=w(I);var U=K._65O;K._65O=I,K.fp(cd,U,I)}},ms_ty:function(X){X._23Q=0,X._66O=0,X._41o=function(){return this.getHeight()<this._23Q},X.getLogicalPoint=function(R){return bp(R,this._canvas||this._view,this.tx?this.tx():0,this.ty())},X.ty=function(z){return z===x?this.getTranslateY():(this.setTranslateY(z),void 0)},X.getTranslateY=function(){return this._66O},X.setTranslateY=function(S){var k=this,G=k.getHeight()-k._23Q;G>S&&(S=G),S>0&&(S=0),S=w(S);var Q=k._66O;k._66O=S,k.fp(Li,Q,S)}},ms_txy:function(O){O._65O=0,O._66O=0,O.tx=function(Z){return Z===x?this.getTranslateX():(this.setTranslateX(Z),void 0)},O.ty=function(L){return L===x?this.getTranslateY():(this.setTranslateY(L),void 0)},O.onTranslateEnded=function(){},O.setTranslate=function(P,r,Z){var q=this;if(Z=js(Z)){q._65I&&q._65I.stop(!0);var R=q.tx(),c=q.ty();Z.action=function(B){q.setTranslate(R+(P-R)*B,c+(r-c)*B)},Z._37o=function(){delete q._66I,delete q._65I,q.onTranslateEnded()},q._66I=1,q._65I=Ib(Z)}else q.tx(P),q.ty(r)},O.getTranslateX=function(){return this._65O},O.setTranslateX=function(X){var Y=this;X=Y.adjustTranslateX(X);var L=Y._65O;Y._65O=X,Y.fp(cd,L,X)},O.getTranslateY=function(){return this._66O},O.setTranslateY=function(N){var Q=this;N=Q.adjustTranslateY(N);var g=Q._66O;Q._66O=N,Q.fp(Li,g,N)},O.adjustTranslateX=function(A){return w(A)},O.adjustTranslateY=function(o){return w(o)},O.translate=function(d,r,j){this.setTranslate(this.tx()+d,this.ty()+r,j)},O.getLogicalPoint=function(N){var K=this;return bp(N,this._canvas||K._view,K.tx(),K.ty())}},ms_dm:function(G){G.dm=function(S){return S?(this.setDataModel(S),void 0):this.getDataModel()},G.getDataModel=function(){return this._dataModel}},ms_lp:function(T){T.lp=function(i){return this.getLogicalPoint(i)}},ms_v:function(W){W._disabled=!1,W.setDisabled=function(c,Z){var w=this,T=w._disabled;T!==c&&(T&&(Rd(w._63O),delete w._63O),c&&(tc(w._view,w._63O=rs(Z)),w.iv()),w._disabled=c,w.fp("disabled",T,c))},W.isDisabled=function(){return this._disabled},W.getDisabledDiv=function(){return this._63O},W.getView=function(){return this._view},W.addToDOM=function(v){var d=this,P=d.getView(),h=P.style;v=v||G.body,v.appendChild(P),h.left="0",h.right="0",h.top="0",h.bottom="0",n(o,"resize",function(){d.iv()}),d.iv()},W.getWidth=function(){return this._view.clientWidth},W.getHeight=function(){return this._view.clientHeight},W.setWidth=function(o){var d=this;d._view.style.width=o+Tq,d.iv(),d.fp&&d.fp(en,z,o)},W.setHeight=function(Q){var K=this;K._view.style.height=Q+Tq,K.iv(),K.fp&&K.fp(yb,z,Q)},W.setFocus=function(K){var _=this,e=_._currentEditor;return K&&e&&(e.getView&&(e=e.getView()),e.contains(K.target))?!1:(kk(_._view),_.endEditing&&_.endEditing(),_.fireViewEvent("focus"),!0)},W.iv=function(_){this.invalidate(_)},W.invalidate=function(Z){var b=this;b._68I||(b._68I=1,dr(b.validate,b,z,Z),b.onInvalidated&&b.onInvalidated(),b.fireViewEvent("invalidate"))},W.validate=function(){var g=this,i=g._view;if(g._68I&&(delete g._68I,i.parentNode))if(0===i.offsetWidth&&0===i.offsetHeight&&g._67I!==z)g._67I===x&&(g._67I=m.reinvalidateCount),g._67I>0?g._67I--:g._67I=z,g.iv();else{g.fireViewEvent("beginValidate"),g.validateImpl(),g.onValidated&&g.onValidated(),g.fireViewEvent("validate");var C=g._63O;C&&(i.lastChild!==C&&(Rd(C),tc(i,C)),Ln(C,0,0,g.getWidth(),g.getHeight())),ns(g),od(g),Xn(g)}},W.layout=function(F,v,H,W){1===arguments.length?Ln(this,F):Ln(this,F,v,H,W)},W.addViewListener=function(j,E,I){var L=this;L._67O||(L._67O=new gg),L._67O.add(j,E,I)},W.removeViewListener=function(y,Q){this._67O.remove(y,Q)},W.fireViewEvent=function(O){var J=this;J._67O&&(yk(O)&&(O={kind:O}),J._67O.fire(O)),m.viewListener&&m.viewListener(J,O)}},ms_tip:function(F){F.setToolTipEnabled=function(H){var g=this;H?vd||g._13o||(g.enableToolTip(),g.fp("toolTipEnabled",!1,!0)):g._13o&&(g.disableToolTip(),g.fp("toolTipEnabled",!0,!1))},F.isToolTipEnabled=function(){return!!this._13o},F.enableToolTip=function(){var F=this;if(!vd&&!F._13o){F._13o=function(N){var y=F.getToolTip(N);y!=z?m.toolTipContinual&&m.isToolTipShowing()?tq(N,y):(Eh(),Lg={timeout:Qf(Mj,Ig),e:N,info:y}):Eh()};var o=F.getView();n(o,Gd,F._13o),n(o,"mouseleave",m.hideToolTip)}},F.disableToolTip=function(){var h=this;if(h._13o){var N=h.getView();I(N,Gd,h._13o),I(N,"mouseleave",m.hideToolTip),delete h._13o}},F.getToolTip=function(C){var H=this;if(H.getDataAt){var P=H.getDataAt(C);return P?P.getToolTip():z}return H.getValue?H.getValue():void 0}},_52o:function(I){I._zoom=1,I._29I=ni,I.zoomIn=function(z,B){this.setZoom(this._zoom*Sj,z,B)},I.zoomOut=function(s,j){this.setZoom(this._zoom/Sj,s,j)},I.zoomReset=function(Y,K){this.setZoom(1,Y,K)},I.scrollZoomIn=function(H){this.setZoom(this._zoom*or,z,H)},I.scrollZoomOut=function(N){this.setZoom(this._zoom/or,z,N)},I.pinchZoomIn=function(i){this.setZoom(this._zoom*ue,z,i)},I.pinchZoomOut=function(i){this.setZoom(this._zoom/ue,z,i)},I.adjustZoom=function(t){return xg>t?xg:t>lf?lf:t},I.getZoom=function(){return this._zoom},I.setZoom=function(E,h,K){var J=this;if(h=js(h)){J._14o&&J._14o.stop(!0);var U=J._zoom;h.action=function(b){J._96O(U+(E-U)*b,K)},h._37o=function(){delete J._zooming,delete J._14o,J.onZoomEnded()},J._zooming=1,J._14o=Ib(h)}else J._96O(E,K)},I._96O=function(m,G){var Q=this;if(m=Q.adjustZoom(m),m!==Q._zoom){Q.validate();var V=Q._29I,y=Q._zoom;0!==V.width&&0!==V.height&&(G=G?G:{x:V.x+V.width/2,y:V.y+V.height/2},Q.tx((G.x-V.x)*y-G.x*m),Q.ty((G.y-V.y)*y-G.y*m)),Q._zoom=m,Q.fp("zoom",y,m)}}},ms_edge:function(i){i._2I=function(C){var E=this;E._44I||(E._44I=new df),E._42I||(E._42I=new df),E._44I.add(C),E._42I.add(C),E._20I()},i._4I=function(A){var s=this;s._44I||(s._44I=new df),s._43I||(s._43I=new df),s._44I.add(A),s._43I.add(A),s._20I()},i._16I=function(Y){var p=this;p._44I.remove(Y),p._42I.remove(Y),p._44I.isEmpty()&&delete p._44I,p._42I.isEmpty()&&delete p._42I,p._20I()},i._18I=function(G){var Z=this;Z._44I.remove(G),Z._43I.remove(G),Z._44I.isEmpty()&&delete Z._44I,Z._43I.isEmpty()&&delete Z._43I,Z._20I()},i._20I=function(){var s=this;if(delete s._45I,!s._44I||s._44I.isEmpty())return delete s._70O,void 0;var L;s._44I.each(function(e){e.isLooped()&&(L||(L={}),L[e._id]||(s._45I||(s._45I=new df),s._45I.add(e),L[e._id]=e))}),L?(s._70O=new df,s._44I.each(function(S){L[S._id]?"A"===L[S._id]||(L[S._id]="A",s._70O.add(S)):s._70O.add(S)})):s._70O=s._44I},i.hasAgentEdges=function(){return!!this._49I&&!this._49I.isEmpty()},i.getSourceAgentEdges=function(){return this._46I},i.getTargetAgentEdges=function(){return this._47I},i._1I=function(y){var z=this;z._46I||(z._46I=new df),z._48I||(z._48I=new df),z._46I.add(y),z._48I.add(y),z._19I()},i._3I=function(k){var f=this;f._47I||(f._47I=new df),f._48I||(f._48I=new df),f._47I.add(k),f._48I.add(k),f._19I()},i._15I=function(N){var e=this;e._46I.remove(N),e._48I.remove(N),e._46I.isEmpty()&&delete e._46I,e._48I.isEmpty()&&delete e._48I,e._19I()},i._17I=function(l){var A=this;A._47I.remove(l),A._48I.remove(l),A._47I.isEmpty()&&delete A._47I,A._48I.isEmpty()&&delete A._48I,A._19I()},i._19I=function(){var n=this;delete n._49I;var Y=n._48I;if(Y&&!Y.isEmpty()){var D={};Y.each(function(e){D[e._id]?n._49I||(n._49I=new df):D[e._id]=e}),n._49I?Y.each(function(Q){D[Q._id]&&(n._49I.add(Q),delete D[Q._id])}):n._49I=Y}},i.getLoopedEdges=function(){return this._45I},i.getEdges=function(){return this._70O},i.getAgentEdges=function(){return this._49I},i.getSourceEdges=function(){return this._42I},i.getTargetEdges=function(){return this._43I},i._8I=function(){this._70O&&this._70O.each(function(S){S._7I()})}}};ae(m,{getVersion:function(){return"7.1.2-GIS-dev6"}},!0),ae(m,{numberDigits:5,crossOrigin:"",baseZIndex:x,isTouchable:vd,devicePixelRatio:o.devicePixelRatio?o.devicePixelRatio:1,reinvalidateCount:3,hitMaxArea:3e3,imageCacheThreshold:20,autoMakeVisible:!0,autoHideScrollBar:!0,disabledOpacity:.4,disabledBackground:S.disabledBackground,forceHierarchicalSerialization:!0,hoverDelay:600,clickDelay:200,toolTipDelay:800,toolTipContinual:!1,getDragger:function(){return Si},lineCap:"butt",lineJoin:"round",imageGradient:"linear.northeast",dashPattern:[16,16],blockMinSize:1,encodeStringKey:null,doubleClickRange:1,doubleTouchRange:20,touchMoveThreshold:10,animDuration:200,animEasing:function(w){return w*w},labelColor:Ug,labelSelectColor:Gi,labelFont:"12px arial, sans-serif",widgetIndent:vd?30:20,widgetRowHeight:vd?30:20,widgetHeaderHeight:vd?32:22,widgetTitleHeight:vd?34:24,scrollBarColor:ab,scrollBarSize:7,scrollBarTimeout:1e3,scrollBarMinLength:20,scrollBarInteractiveSize:vd?32:16,zoomIncrement:1.3,scrollZoomIncrement:1.05,pinchZoomIncrement:1.08,pinchZoomThreshold:1,zoomMax:20,zoomMin:.01,segmentResolution:12,shapeResolution:24,shapeSide:24,intersectionLineRect:ss,intersectionLineLine:lq,isEnter:Hk,isEsc:qd,isDelete:Mg,isSpace:Wh,isLeft:sr,isUp:Hr,isRight:Kf,isDown:Fe,isTouchEvent:Nd,getTarget:Ci,isString:yk,isNumber:pk,isBoolean:Rr,isArray:Mf,isSelectAll:Rj,isFunction:Jc,isObject:Vc,getPropertyValue:pc,setPropertyValue:Yk,addMethod:ae,isMobile:function(){var e;return function(){return e!==x?e:(e=!1,function(y){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(y)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(y.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||o.opera),e)}}(),createGradient:function(j,i,N,D,S,T,$,B){var p=Vg[i];return p(j,N,D,S,T,$,B)},appendToScreen:function(m){m=m.getView?m.getView():m,(G.fullscreenElement||G.mozFullScreenElement||G.webkitFullscreenElement||G.msFullscreenElement||G.body).appendChild(m)},encodeString:function(W){return R.Math.encodeBase64(W,m.encodeStringKey)},decodeString:function(j){return R.Math.decodeBase64(j,m.encodeStringKey)},findView:function(a){var E=function(q,B){var s=B._ht;s&&q.push(s);var z=B.children,O=z.length;if(O)for(var k=0;O>k;k++)E(q,z[k])},V=[];E(V,G.body);var n=function(S,Q){for(var r="2d"===Q?ks.GraphView:Ab.Graph3dView,c=0,L=S.length;L>c;c++)if(S[c]instanceof r)return V[c];return null};return"all"===a?V:"2d"===a?n(V,"2d"):"3d"===a?n(V,"3d"):n(V,"3d")||n(V,"2d")},toggleFullscreen:function(T){var V=T.getView();if(G.fullscreenElement||G.mozFullScreenElement||G.webkitFullscreenElement||G.msFullscreenElement)G.exitFullscreen?G.exitFullscreen():G.msExitFullscreen?G.msExitFullscreen():G.mozCancelFullScreen?G.mozCancelFullScreen():G.webkitExitFullscreen&&G.webkitExitFullscreen();else{var p=!0;if(T.isSelfViewEvent){var D=T.getX(),l=T.getY(),E=T.getWidth(),U=T.getHeight(),H=V.style.background,Q=V.style.backgroundColor;H||Q||(V.style.backgroundColor="white"),V.requestFullscreen?V.requestFullscreen():V.msRequestFullscreen?V.msRequestFullscreen():V.mozRequestFullScreen?V.mozRequestFullScreen():V.webkitRequestFullscreen&&V.webkitRequestFullscreen();var $=setInterval(function(){if(V!==(G.fullscreenElement||G.mozFullScreenElement||G.webkitFullscreenElement||G.msFullscreenElement))clearInterval($),T.setX(D),T.setY(l),T.setWidth(E),T.setHeight(U),T._fullscreen=!1,V.style.oldBackgroundColor=Q,T.iv();else{var v=R.Default.getWindowInfo();(p||v.width!==T.getWidth()||v.height!==T.getHeight())&&(T.setX(v.left),T.setY(v.top),T.setWidth(v.width),T.setHeight(v.height),T._fullscreen=!0,T.iv(),p=!1)}},500)}else{var Y=V.style.left,_=V.style.top,E=V.style.width,U=V.style.height,H=V.style.background,Q=V.style.backgroundColor;H||Q||(V.style.backgroundColor="white"),V.requestFullscreen?V.requestFullscreen():V.msRequestFullscreen?V.msRequestFullscreen():V.mozRequestFullScreen?V.mozRequestFullScreen():V.webkitRequestFullscreen&&V.webkitRequestFullscreen();var $=setInterval(function(){if(V!==(G.fullscreenElement||G.mozFullScreenElement||G.webkitFullscreenElement||G.msFullscreenElement))clearInterval($),V.style.left=Y,V.style.top=_,V.style.width=E,V.style.height=U,V.style.oldBackgroundColor=Q,T.iv();else{var Z=R.Default.getWindowInfo();(p||Z.width!==T.getWidth()||Z.height!==T.getHeight())&&(Ln(T),p=!1)}},500)}}},appendTimeStamp:function(E){return E},setCompType:function(p,c){Jc(c)||Vc(c)?Zl[p]=c:pj(p)},getCompType:function(V){var S=Zl[V];return S===x&&Hm.test(V)&&pj(V),S},getCompTypeMap:function(){return Zl},drawCompType:function(X,M,t,p,r,Z){X(M,t,p,r,Z)},numberListener:function(){var v={46:1,8:1,9:1,27:1,13:1,109:1,110:1,189:1,190:1};return function(c){var l=c.keyCode;v[l]||65===l&&m.isCtrlDown(c)||86===l&&m.isCtrlDown(c)||67===l&&m.isCtrlDown(c)||88===l&&m.isCtrlDown(c)||l>=35&&40>=l||(c.shiftKey||48>l||l>57)&&(96>l||l>105)&&c.preventDefault()}}(),ignoreKeyCodes:[122,123],preventDefault:function(S){var T=S.target.tagName;("DIV"===T||"CANVAS"===T)&&!(m.ignoreKeyCodes.indexOf(S.keyCode)>=0)&&("keydown"!==S.type||sr(S)||Kf(S)||Hr(S)||Fe(S)||Mg(S)||65===S.keyCode&&(S.metaKey||S.ctrlKey))&&(S.preventDefault(),S.preventManipulation&&S.preventManipulation())},getWindowInfo:function(){var m=G.documentElement,r=m&&(m.scrollLeft||m.scrollTop)?m:G.body;return{target:r,left:r.scrollLeft,top:r.scrollTop,width:o.innerWidth||r.clientWidth,height:o.innerHeight||r.clientHeight}},isDragging:function(){return!!Si},isLeftButton:function(E){return Nd(E)?!0:0===E.button},isMiddleButton:function(I){return Nd(I)?!1:I&&(1===I.button||4&(I.buttons||0))},isRightButton:function(D){return Nd(D)?!1:D&&(2===D.button||2&(D.buttons||0))},isInput:function($){if(!$)return!1;var O=$.tagName;return"INPUT"===O||"TEXTAREA"===O||"SELECT"===O},getTouchCount:function(L){return Nd(L)?L.touches.length:1},isDoubleClick:function(){function v(n){n.details=0,n.timeout=null,n.lastPoint=null}var p={};return Sm=new V,Hh=Sm.getTime(),function(j){if(po(j)>1)return!1;var c=j.button==z?"":j.button,f=j.type+c,S=f+"_isDoubleClick",L=p[f];if(L||(L=p[f]={details:0,timeout:null,lastPoint:null}),j[S]===x){j[S]=!0;var Z=sb(j);L.timeout&&($g(L.timeout),L.timeout=null);var h=Nd(j)?m.doubleTouchRange:m.doubleClickRange;L.lastPoint&&id(L.lastPoint,Z)>h&&v(L),L.lastPoint=Z,L.details++,L.timeout=Qf(function(){v(this)}.bind(L),500)}return 2===L.details}}(),isShiftDown:function(j){return j?j.shiftKey:hf["16"]},isCtrlDown:function(H){return H?Kh?H.metaKey:H.ctrlKey:Kh?hf["91"]:hf["17"]},getClientPoint:function(N){return Nd(N)&&(N=oh(N)),{x:N.clientX,y:N.clientY}},isMouseEvent:function(s){return s instanceof MouseEvent||0===s.type.indexOf("mouse")},getTargetElement:function(S){if(m.isMouseEvent(S)||!G.elementFromPoint)return S.target;var k=op(S);return G.elementFromPoint(k.x,k.y)},getPagePoint:function(r){return Nd(r)&&(r=oh(r)),{x:r.pageX,y:r.pageY}},createObject:function(t,D){var i=new t;for(var p in D){var z=D[p];if(Jc(z))i[p]=z;else if(0===p.indexOf("s:"))i.s(p.substr(2),D[p]);else if(0===p.indexOf("a:"))i.a(p.substr(2),D[p]);else{var N=Ij(p),z=D[p];i[N]?(i[N](z),"setToolTip"===N&&i.enableToolTip&&i.enableToolTip()):i[p]=z}}return i},setImage:function(c,G,C,x){var Y=arguments.length;4===Y?Jr(c,x,G,C):2===Y?yk(G)?Jr(c,G):zo(c,G):1===Y&&Jr(c,c)},getImage:function(C,T,w){var r;if(C==z)return z;if(Vc(C)?r=C:(r=ad[C],C&&r===x&&($j&&$j[C]||Jr(C,C))),T&&r&&r.tagName){var J;J="override"===w?"colors_override":"override_rgb"===w?"colors_override_rgb":"override_a"===w?"colors_override_a":"colors",r[J]||(r[J]={__count__:0});var u=r[J][T];return u||(r[J].__count__>m.imageCacheThreshold&&(r[J]={__count__:0}),u=dp(r,Em(T),r.width,r.height,w),r[J][T]=u,r[J].__count__++),u}return r},isImageComplete:function(J,g,d){var c=Qd(J);if(!c)return!1;if(c.tagName)return c.complete;for(var Q,J,I,o=c.comps,n=!0,w=0,e=o.length;e>w;w++)if(Q=o[w],I=Q.type,"image"===Q.type){J=Q.name,J&&J.func&&(J=Lq(J,g));var Z=zq(J,g,d);if(!Z){n=!1;break}}else if(Hm.test(I)&&m.getCompType(I)===x){n=!1,pj(I);break}return n},getId:function(){var J=1;return function(){return++J}}(),callLater:function(E,K,J,h){var C=function(){E.apply(K,J)};return h?Qf(C,h):o.requestAnimationFrame(C)},cancelLater:function(a,X){X?$g(a):o.cancelAnimationFrame(a)},clone:function(D){if(null==D||"object"!=typeof D)return D;if(D instanceof Date){var l=new Date;return l.setTime(D.getTime()),l}if(D instanceof Array){for(var l=[],_=0,u=D.length;u>_;_++)l[_]=qj(D[_]);return l}if(D instanceof df){for(var l=new df,_=0,u=D.length;u>_;_++)l.set(_,qj(D.get(_)));return l}if(D instanceof bq)return D;if(D instanceof U){var l={};for(var i in D)D.hasOwnProperty(i)&&(l[i]=qj(D[i]));return l}return D},callWhenLoaded:function(h,W){W=W||100;var Z=jr(h,W);mk||(mk={}),mk[Z]={tick:Z,cb:h,delay:W}},beforeLoadURL:function(U,p){if(mk){var X={};for(var p in mk){var a=mk[p];$g(a.tick);var C=jr(a.cb,a.delay);X[C]={tick:C,delay:a.delay,cb:a.cb}}mk=X}return m.convertURL?m.convertURL(U,p):U},convertURL:function(w){return w},handleRefGraphLoaded:function(){},handleCompTypeLoaded:function(){},handleImageLoaded:function(){},handleUnfoundImage:function(){return m.getImage("default_blank")},resizeImagePOT:function(O,D){if(!O||!O.tagName)return O;var P=O.width,d=O.height;if(!P||!d)return O;if(rh.isPOT(P)&&rh.isPOT(d)&&(!D||P===d))return O;var L,Q;D?Q=L=rh.nearestPOT(Math.min(P,d)):(L=rh.nearestPOT(P),Q=rh.nearestPOT(d));var Z=pn(),h=Z.getContext("2d");return vl(Z,L,Q,1),h.drawImage(O,0,0,P,d,0,0,L,Q),Z},sortFunc:function($,K){if($===K)return 0;if($==z&&K!=z)return 1;if($!=z&&K==z)return-1;if($==z&&K==z)return 0;var Y,u=typeof $,M=typeof K;return u===dl&&M===dl?Y=$.localeCompare(K):u===Bg&&M===Bg&&(Y=$-K),Y===x&&(Y=(""+$).localeCompare(""+K)),Y>0?1:0>Y?-1:0},getClassMap:function(){return _p},getClass:function(l){if(yk(l)){var T,O=_p[l];if(!O){T=l.split("."),O=o;for(var D=0;D<T.length;D++)O=O[T[D]];_p[l]=O}return O}return l},def:function(f,e,Q){var $,P,T,w=function(){};if(w.prototype=e.prototype,$=new w,yk(f)){if(_p[f])throw"'"+f+"' already defined";T=lj(f),$.getClassName=function(){return f}}else T=f;if($.constructor=T,$.getClass=function(){return T},$.getSuperClass=function(){return e},Q)for(P in Q)dj[P]&&dj.hasOwnProperty(P)?dj[P]($,Q):Yo($,Q,P);T.prototype=$,T.superClass=e.prototype},startAnim:function(){var s=function(c){c.duration&&(c.startTime=Pc()),c.timeId=dr(c.tick,z,z,c.interval)};return function(l){return l=qj(l),l.easing=l.easing||m.animEasing,l.duration||l.frames||(l.duration=m.animDuration),l.t=0,l.duration?l.interval=0:(l.frame=0,l.interval=l.interval||10),l.tick=function(){if(l.duration){var R=(Pc()-l.startTime)/l.duration;if(R>1&&(R=1),l.t=R,l.action(l.easing(R),R),!l.isRunning())return;1===R?l.stop():l._isPaused||(l.timeId=dr(l.tick))}else{if(l.frame++,R=l.t=l.frame/l.frames,l.action(l.easing(R),R),!l.isRunning())return;l.frame<l.frames?l._isPaused||(l.timeId=dr(l.tick,z,z,l.interval)):l.stop()}},l.resume=function(){l._isPaused&&(delete l._isPaused,l.duration?l.t<1&&(l.startTime=Pc()-l.duration*l.t,l.timeId=dr(l.tick)):l.frame<l.frames&&(l.timeId=dr(l.tick,z,z,l.interval)))},l.pause=function(){Ih(l.timeId,!l.duration),l._isPaused=!0},l.isPaused=function(){return this._isPaused},l.stop=function(w){l.isRunning()&&(Ih(l.timeId,!l.duration),delete l.timeId,l.duration?l.t<1&&w&&(l.t=1,l.action(l.easing(1),1)):l.frame<l.frames&&w&&(l.frame=l.frames,l.action(l.easing(1),1)),l._37o&&l._37o(),l.finishFunc&&l.finishFunc())},l.isRunning=function(){return l.timeId!=z},l.delay?dr(s,z,[l],l.delay):s(l),l}}(),getTextSize:function(){var S={},F=G?pn().getContext("2d"):z;return function(c,s){F.font=c?c:un;var J=S[F.font];return J||(J=2*F.measureText("e").width+4,S[F.font]=J),{width:F.measureText(s).width+4,height:J}}}(),drawText:function(v,A,n,e,U,S,w,h,c,r){if(A!=z){var E=Yf(n,A),C={};C.y=r&&r!==dn?r===$i?S+E.height/2:S+h-E.height/2:S+h/2,C.x=c&&c!==ec?c===Gj?U+w-E.width/2:U+w/2:U+E.width/2,Am(v,A,C,n,e)}},getDistance:function(i,p){var k=i.length;return p?3===k?N(si(i[0]-p[0])+si(i[1]-p[1])+si(i[2]-p[2])):2===k?N(si(i[0]-p[0])+si(i[1]-p[1])):i.z===x?N(si(p.x-i.x)+si(p.y-i.y)):N(si(p.x-i.x)+si(p.y-i.y)+si(p.z-i.z)):3===k?N(si(i[0])+si(i[1])+si(i[2])):2===k?N(si(i[0])+si(i[1])):void 0},brighter:function(T,N){return 0>N&&(N=-N),qs(T,N?N:40)},darker:function(U,T){return T>0&&(T=-T),qs(U,T?T:-40)},unionPoint:function(J,i){if(!J)return z;if(2===arguments.length)return J&&i?{x:g(J.x,i.x),y:g(J.y,i.y),width:H(J.x-i.x),height:H(J.y-i.y)}:z;var q=J;if(q._as&&(q=q._as),q.length===x)return z;var m=q.length;if(0>=m)return z;for(var R=1,w=q[0],n={x:w.x,y:w.y,width:0,height:0};m>R;R++){w=q[R];var L=g(n.x,w.x),F=W(n.x+n.width,w.x),u=g(n.y,w.y),r=W(n.y+n.height,w.y);n.x=L,n.y=u,n.width=F-L,n.height=r-u}return n},unionRect:function(Z,I){if(Z&&!I)return qj(Z);if(!Z&&I)return qj(I);if(Z&&I){var n={x:g(Z.x,I.x),y:g(Z.y,I.y)};return n.width=W(Z.x+Z.width,I.x+I.width)-n.x,n.height=W(Z.y+Z.height,I.y+I.height)-n.y,n}return z},containsPoint:function(t,N,x,i){if(i!=z&&1!==i){var I=t.x+t.width/2,Z=t.y+t.height/2;t={x:I-t.width/2*i,y:Z-t.height/2*i,width:t.width*i,height:t.height*i}}if(x){var W=t.width/2,Q=t.height/2,r=F(-x),k=d(-x),s=N.x-t.x-W,l=N.y-t.y-Q;return N={x:k*s-r*l,y:r*s+k*l},Eq({x:-W,y:-Q,width:t.width,height:t.height},N)}return!(!t||N.x<t.x||N.y<t.y||N.x>t.x+t.width||N.y>t.y+t.height)},containsRect:function(A,_){if(!A||!_)return!1;var W=_.x,z=_.y,G=_.width,u=_.height,M=A.width,L=A.height;if(0>(M|L|G|u))return!1;var o=A.x,V=A.y;if(o>W||V>z)return!1;if(M+=o,G+=W,W>=G){if(M>=o||G>M)return!1}else if(M>=o&&G>M)return!1;if(L+=V,u+=z,z>=u){if(L>=V||u>L)return!1}else if(L>=V&&u>L)return!1;return!0},intersectsRect:function(f,_){if(!f||!_)return!1;var o=_.width,W=_.height,k=f.width,G=f.height;if(0>=k||0>=G||0>=o||0>=W)return!1;var d=_.x,T=_.y,u=f.x,a=f.y;return k+=u,G+=a,o+=d,W+=T,k>d&&G>T&&o>u&&W>a},intersection:function(E,p){if(!E||!p)return z;var F=p.x,t=p.y,W=E.x,Q=E.y,c=F,h=t,I=W,v=Q;return c+=p.width,h+=p.height,I+=E.width,v+=E.height,W>F&&(F=W),Q>t&&(t=Q),c>I&&(c=I),h>v&&(h=v),c-=F,h-=t,0>=c||0>=h?z:{x:F,y:t,width:c,height:h}},grow:function(I,k,j){j===x&&(j=k),I.x-=k,I.y-=j,I.width=I.width+2*k,I.height=I.height+2*j},getScreenPoint:function(t,J,s,P,j,U,q){var Y=s.getBoundingClientRect(),d=t*(U||1)-s.scrollLeft+(P||0),$=J*(q||1)-s.scrollTop+(j||0),Q=Bb(s,!1);if(Q){var K=new Ki(d,$,0);return K.applyMatrix4(Q),console.log(K),{x:K.x,y:K.y}}return{x:d+Y.left,y:$+Y.top}},getLogicalPoint:function(S,W,f,B,X,j){var k,K,E=W.getBoundingClientRect();S.target?(Kb(S)?Kh?hf["91"]=!0:hf["17"]=!0:Kh?hf["91"]=!1:hf["17"]=!1,hf["16"]=Zh(S)?!0:!1,S=Nd(S)?oh(S):S,k=S.clientX,K=S.clientY):(k=S.x,K=S.y);var h=Bb(W,!0);if(h){var o=new Ki(k,K,0);o.applyMatrix4(h);do{if(Math.abs(o.z)<=1e-6)break;var R=new Ki(k,K,1);if(R.applyMatrix4(matrix),Math.abs(R.z)<=1e-6){o=R;break}if(R.sub(o),Math.abs(R.z)<=1e-6)break;o.addScaledVector(R,-o.z/R.z)}while(!1);return{x:(o.x+W.scrollLeft-(f||0))/(X||1),y:(o.y+W.scrollTop-(B||0))/(j||1)}}return{x:(k-E.left+W.scrollLeft-(f||0))/(X||1),y:(K-E.top+W.scrollTop-(B||0))/(j||1)}},removeHTML:function(){var b;return function(l){return l&&l.getView&&(l=l.getView()),l&&l.parentNode?b===l?!0:(b=l,l.parentNode.removeChild(l),b=z,!0):!1}}(),getToolTipDiv:function(){if(!hm){hm=Kk(),ul=Kk();var C=hm.style;m.baseZIndex!=z&&(C.zIndex=vp(m.baseZIndex)+3+""),C.whiteSpace="nowrap",C.color=m.toolTipLabelColor,C.background=m.toolTipBackground,C.font=m.toolTipLabelFont,C.padding="5px",C.boxShadow="0px 0px 3px "+m.toolTipShadowColor}return hm},isToolTipShowing:function(){return hm&&hm.parentNode?!0:ul&&ul.parentNode?!0:!1},hideToolTip:function(){Rd(hm),Rd(ul),Ed()},showToolTip:function(q,Z){if(!q||Z==z)return Eh(),void 0;m.getToolTipDiv();var G,w;if(Z.html?(Z=Z.html,G=ul,Rd(hm)):(G=hm,Rd(ul)),w=G.style,G.innerHTML=Z,G.parentNode||R.Default.appendToScreen(G),q.target){q=op(q);var n=Rg(),X=q.x,T=q.y,r=vd?60:12;if(vd){var B=G.getBoundingClientRect();w.left=X-B.width/2+Tq,w.top=T-B.height-r<n.top?T+r+Tq:T-B.height-r+Tq}else{w.left=X+r+Tq,w.top=T+r+Tq;var B=G.getBoundingClientRect();B.left+B.width>n.width&&(w.left=X-r-B.width+Tq),B.top+B.height>n.height&&(w.top=T-r-B.height+Tq),B.left<0&&(w.left=X+r+Tq),B.top<0&&(w.top=T+r+Tq)}}else w.left=q.x+Tq,w.top=q.y+Tq;Ed()},startDragging:function(f,B,p){p==x&&(p=!0),f!==Si&&(Si?p&&(Nd(B)?Si.handleWindowTouchEnd(B):Si.handleWindowMouseUp(B)):Nd(B)?(n(o,Jp,Jf),n(o,Qq,Yp)):(n(o,Gd,Go),n(o,ig,Up)),Si=f)},getImageMap:function(){return ad},toBoundaries:function(k,m,B,D){var p=[];return Wd(k,m,B,D).forEach(function(D){var u=[];D.forEach(function(n){u.push(n.x,n.y)}),p.push(u)}),p},getCurrentKeyCodeMap:function(){return hf},drawCenterImage:function(r,N,G,v,R,O,Y,B){!R&&O&&O.isSelfViewEvent&&(R=O);var I=Uk(N,R,O),P=Cf(N,R,O);rb(r,N,w(G-I/2),w(v-P/2),I,P,R,O,Y,B)},drawStretchImage:function(v,G,D,T,W,t,u,c,q,E,R,I){!c&&q&&q.isSelfViewEvent&&(c=q);var $,Y=Uk(G,c,q,t),b=Cf(G,c,q,u);"uniform"===D?($=g(t/Y,u/b),Y*=$,b*=$,T+=w((t-Y)/2),W+=w((u-b)/2),t=Y,u=b):"centerUniform"===D&&((Y>t||b>u)&&($=g(t/Y,u/b),Y*=$,b*=$),T+=w((t-Y)/2),W+=w((u-b)/2),t=Y,u=b);var J=v.interactiveInfo;if(J){var p;if(p="center"===D?{x:T+t/2-Y/2,y:W+u/2-b/2,width:Y,height:b}:{x:T,y:W,width:t,height:u},J.rect){var e=J.compInfos,B=e.length;B&&(e[B-1].rect.image=G)}else J.rect=p}if("center"===D){var C=R!==!1&&(Y>t||b>u);C&&(v.save(),v.beginPath(),v.rect(T,W,t,u),v.clip()),rb(v,G,T+t/2-Y/2,W+u/2-b/2,Y,b,c,q,E,I),C&&v.restore()}else rb(v,G,T,W,t,u,c,q,E,I)},toCanvas:function(c,m,d,F,v,E,n,X,I){c=Qd(c,n),m=m||Uk(c,v),d=d||Cf(c,v);var M=pn(),B=vs(M);return X?(vl(M,m,d,X),B.scale(X,X)):vl(M,m,d,1),Xm(B,c,F,0,0,m,d,v,E,n,I),c&&c.clampToEdge&&(M.clampToEdge=c.clampToEdge),B.restore(),M},toGrayColor:function(t){if(!t)return t;var j=wc(t),P=w(.299*j[0]+.587*j[1]+.114*j[2]);return"rgba("+P+","+P+","+P+","+j[3]/255+")"},createGradientImage:function(h,A,K,v){for(var x=["L",0,0,h,0,1,0,0,1,0,0],t=0,n=Math.min(A.length,K.length);n>t;t++)x.push(K[t],A[t]);var j=R.Default.toCanvas({width:h,height:h,clampToEdge:!0,comps:[{type:"shape",rotation:v||0,points:[0,0,h,0,h,h,0,h],background:"#ffffff",gradientPack:x}]});return j},createElement:function(h,W,d,X){var p=G.createElement(h);return gq(p,W||S.widgetBorder,2),p.style.font=d?d:un,X!=z&&(p.value=X),m.onElementCreated&&m.onElementCreated(p),p},containedInView:function(L,H){var i=zs(H).getBoundingClientRect();return Eq({x:i.left,y:i.top,width:i.width,height:i.height},sb(L))},isIsolating:function(){return Yd>0},setIsolating:function(F){F?Yd++:Yd--},getMSMap:function(){return dj},stringify:function(X,n,l){var w=Date.prototype.toJSON;Date.prototype.toJSON=function(){return"__ht__date"+this.getTime()};var G=JSON.stringify(X,function(T,q){return"function"==typeof q?"__ht__"+(q.__ht__||q.toString()):pk(q)?Fc(q):q instanceof R.List?"__ht__list"+(q.__ht__list||m.stringify(q._as)):q},n==z?2:n);return Date.prototype.toJSON=w,l&&(G="__ht__encode"+m.encodeString(G)),G},parse:function(P){return yk(P)?"__ht__encode"!=P.substr(0,12)||(P=m.decodeString(P.substr(12)),yk(P))?JSON.parse(P,function(A,s){if(yk(s))if("__ht__function"==s.substr(0,14)){var $=s.indexOf("{")+1,b=s.lastIndexOf("}"),R=s.indexOf("(")+1,D=s.indexOf(")");if($&&b&&R&&D){var p=new Function(s.substring(R,D),s.substring($,b));return p.__ht__=s.substr(6),p}}else{if("__ht__date"==s.substr(0,10))return new Date(vp(s.substr(10)));if("__ht__list"===s.substr(0,10))return new df(m.parse(s.substr(10)))}return s}):P:P},loadJS:function(V,X){X&&V.push(X);var q=V.shift();if(Mf(q))V=q.contact(V),m.loadJS(V);else if(Jc(q))q(),m.loadJS(V);else if(yk(q)){var h=G.createElement("script");h.onload=function(){m.loadJS(V)},h.setAttribute("src",q),G.getElementsByTagName("head")[0].appendChild(h)}else V.length&&m.loadJS(V)},extendClass:function(P,i){var v=P.prototype;for(var R in i)dj[R]&&dj.hasOwnProperty(R)?dj[R](v,i):v[R]=i[R]},toRoundedCorner:function(){function u(V,F,g){V.x=F.x,V.y=F.e||g,V.z=F.y}var W=new Ki,y=new Ki,d=new Ki,h=new Ki;return function(n,C){var S,q=0;n.getPoints&&(q=n.getElevation(),n=n.getPoints()),S=n instanceof df?n:new df(n);var s=S.size();if(0>=C)return{points:S};var E=new df,X=new df,R=S.get(0);u(W,R,q),E.add(R),X.add(1);for(var N=1;s>N;N++)if(s>N+1){var f=S.get(N),V=S.get(N+1);u(y,f,q),u(d,V,q),h.subVectors(W,y).setLength(Math.min(.99*h.length(),C)).add(y),f.e!==x||R.e!==x?E.add({x:h.x,y:h.z,e:h.y}):E.add({x:h.x,y:h.z}),E.add(f),h.subVectors(d,y).setLength(Math.min(.99*h.length(),C)).add(y),f.e!==x||V.e!==x?E.add(R={x:h.x,y:h.z,e:h.y}):E.add(R={x:h.x,y:h.z}),W.copy(h),X.addAll([2,3])
}else E.add(S.get(N)),X.add(2);return{points:E,segments:X}}}(),toColorData:wc,setCanvas:vl,createDiv:Kk,createDisabledDiv:rs,createView:Ul,createCanvas:pn,appendChild:tc,initContext:vs,checkLoadingImage:ns,translateAndScale:kn,layout:Ln,getPosition:yr,drawPoints:ur,drawRoundRect:Ll,drawBorder:_q,setFocus:kk,getter:Vr,setter:Ij,isEmptyObject:ml,cameraPriority:function(){var k={skybox:0,main:1e4,top:1e7,infinity:1/0};return U.seal(U.defineProperties({},{skybox:{configurable:!1,enumerable:!1,get:function(){return k.skybox},set:function(w){if(w>=k.main)throw new RangeError("Skybox camera must have lower priority than the main camera.");k.skybox=Number(w)}},main:{configurable:!1,enumerable:!1,get:function(){return k.main},set:function(n){if(n<=k.skybox)throw new RangeError("Main camera must have higher priority than the skybox camera.");if(n>=k.top)throw new RangeError("Main camera must have lower priority than the top camera.");k.main=Number(n)}},top:{configurable:!1,enumerable:!1,get:function(){return k.top},set:function(j){if(j<=k.main)throw new RangeError("Top camera must have higher priority than the main camera.");k.top=Number(j)}}}))}()},!0),ae(f,{autoAdjustIndex:1,hierarchicalRendering:1,adjustChildrenToTop:1,autoHideScrollBar:1,autoUpdate:1,firstPersonMode:1,ortho:1,strict:1,stickToRight:1,instant:1,closePath:1,hierarchical:1,doubleClickToToggle:1,continuousLayout:1,syncSize:1},!0);var Kd=m.disabledOpacity,Ig=m.toolTipDelay,Gn=m.devicePixelRatio,yg=m.autoMakeVisible,ce=m.autoHideScrollBar,zi=m.imageGradient,tq=m.showToolTip,Eh=m.hideToolTip,xj=m.dashPattern,zn=m.lineCap,Jd=m.lineJoin,gh=m.labelColor,Gq=m.labelSelectColor,un=m.labelFont,Ef=m.widgetIndent,vb=m.widgetRowHeight,Mo=m.widgetHeaderHeight,al=m.widgetTitleHeight,Bi=m.scrollBarColor,Pl=m.scrollBarSize,Cc=m.scrollBarTimeout,Cp=m.scrollBarMinLength,rk=m.scrollBarInteractiveSize,Sj=m.zoomIncrement,or=m.scrollZoomIncrement,ue=m.pinchZoomIncrement,lf=m.zoomMax,xg=m.zoomMin,$l=m.createObject,$r=m.preventDefault,ll=m.setImage,Qd=m.getImage,zq=m.isImageComplete,Op=m.drawCenterImage,Xm=m.drawStretchImage,Hf=m.getId,dr=m.callLater,Ih=m.cancelLater,qp=m.sortFunc,qj=m.clone,lj=m.getClass,Ib=m.startAnim,kd=m.brighter,jf=m.darker,Kq=m.drawText,Yf=m.getTextSize,wn=m.isLeftButton,ie=m.isMiddleButton,qg=m.isRightButton,po=m.getTouchCount,cm=m.isDoubleClick,Zh=m.isShiftDown,Kb=m.isCtrlDown,sb=m.getClientPoint,op=m.getPagePoint,id=m.getDistance,oe=m.unionPoint,Mq=m.unionRect,Eq=m.containsPoint,Sr=m.containsRect,dm=m.intersectsRect,Og=m.intersection,Rg=m.getWindowInfo,km=m.grow,bp=m.getLogicalPoint,hr=m.getScreenPoint,np=m.startDragging,Rd=m.removeHTML,li=m.createElement,On=m.segmentResolution,rc=m.shapeResolution,De=m.shapeSide,Ad=m.def,Wp=function(f,M,X){Ad(t+"."+f,M,X)},bc=function(c,_){c.childNodes.forEach(function(q){_(q),bc(q,_)})};ae(m,{toolTipLabelColor:gh,toolTipLabelFont:un,toolTipBackground:S.toolTipBackground,toolTipShadowColor:ab,debugTipLabelFont:un,debugTipLabelColor:gh,debugTipBackground:S.toolTipBackground,drawBreakableText:Kj,setDevicePixelRatio:function(f){Gn=m.devicePixelRatio="number"==typeof f?f:o.devicePixelRatio,bc(G.body,function(S){var V=S._ht;V&&V._canvas&&(vl(V._canvas,V.getWidth(),V.getHeight()),V.redraw?V.redraw():V.iv())})}},!0);var ep=1e-6,hg="undefined"!=typeof Uint16Array?Uint16Array:Array,Gg="undefined"!=typeof Float32Array?Float32Array:Array,fi=function(m,K,p){var S=[m[0]-K[0],m[1]-K[1],m[2]-K[2]];if(p){var C=id(S);C>0&&(S[0]/=C,S[1]/=C,S[2]/=C)}return S},te=function(){var l="charCodeAt",U=2*(2*yq.length+1);for(var B in o)if(B===t+ec[0]+(Tq.length+2)){var X=o[B];if(!X)break;for(var c=X.length,C=0;c>C;C++)if(X[C][l](0)===U&&X[C+1]!=z&&X[C+1]===Tq[0]&&X[C+2]!=z&&X[C+2][l](0)===U){for(var n=C+3;c>n;n++)if(X[n][l](0)===U){if(0==X[n+1])for(var v,S=n+2;c>S;S++){if(X[S][l](0)===U){0==X[S-1]&&v&&(Jk=v.substr(0,v.length-1));break}v==z?v=X[S]:v+=X[S]}break}break}break}return function(H){return[-H[0],-H[1],-H[2]]}}(),cl=function(y,c){return 3===y.length?y[0]*c[0]+y[1]*c[1]+y[2]*c[2]:y[0]*c[0]+y[1]*c[1]},Re=function(){var K=new Array(16);return K[0]=1,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=1,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=1,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K},_r=Re(),ls=function(z){var r=new Array(16);return r[0]=z[0],r[1]=z[1],r[2]=z[2],r[3]=z[3],r[4]=z[4],r[5]=z[5],r[6]=z[6],r[7]=z[7],r[8]=z[8],r[9]=z[9],r[10]=z[10],r[11]=z[11],r[12]=z[12],r[13]=z[13],r[14]=z[14],r[15]=z[15],r},Pd=function(Q,E){return Q[0]=E[0],Q[1]=E[1],Q[2]=E[2],Q[3]=E[3],Q[4]=E[4],Q[5]=E[5],Q[6]=E[6],Q[7]=E[7],Q[8]=E[8],Q[9]=E[9],Q[10]=E[10],Q[11]=E[11],Q[12]=E[12],Q[13]=E[13],Q[14]=E[14],Q[15]=E[15],Q},Xh=function(O){return O[0]=1,O[1]=0,O[2]=0,O[3]=0,O[4]=0,O[5]=1,O[6]=0,O[7]=0,O[8]=0,O[9]=0,O[10]=1,O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,O},Eb=function(g,y){var U=g[0],C=g[1],R=g[2];return g[0]=y[0]*U+y[4]*C+y[8]*R+y[12],g[1]=y[1]*U+y[5]*C+y[9]*R+y[13],g[2]=y[2]*U+y[6]*C+y[10]*R+y[14],g},lp=function(e,x){var n=e[0],q=e[1],j=e[2],A=e[3];return e[0]=x[0]*n+x[4]*q+x[8]*j+x[12]*A,e[1]=x[1]*n+x[5]*q+x[9]*j+x[13]*A,e[2]=x[2]*n+x[6]*q+x[10]*j+x[14]*A,e[3]=x[3]*n+x[7]*q+x[11]*j+x[15]*A,e},Kg=function(){var U,i,r,L,d=ql(xe[1]+xe[7]),T=ql(xe[0]+xe[3]-xe[10]),R=ql(xe[8]+2),A=function(){return i=r.charAt(U),U+=1,i},E=function(){var f="";if(i===R)for(;A();){if(i===R)return A(),f;f+=i}else A()},n=function(){for(;i&&" ">=i;)A()},h=function(){var m,X={};if(i===d){if(A(),n(),i===T)return A(),X;for(;i;){if(m=E(),n(),A(),X[m]=L(),n(),i===T)return A(),X;A(),n()}}};return L=function(){switch(n(),i){case d:return h();default:return E()}},function($){if(M={},$){var k;if(r=$,U=0,i=" ",k=L(),n(),!i)return k}}}(),ri=function(I,C){if(C){var q=F(C),l=d(C),x=I[4],U=I[5],i=I[6],X=I[7],f=I[8],L=I[9],c=I[10],n=I[11];I[4]=x*l+f*q,I[5]=U*l+L*q,I[6]=i*l+c*q,I[7]=X*l+n*q,I[8]=f*l-x*q,I[9]=L*l-U*q,I[10]=c*l-i*q,I[11]=n*l-X*q}},He=function(Q,V){if(V){var _=F(V),s=d(V),Y=Q[0],l=Q[1],z=Q[2],G=Q[3],T=Q[8],A=Q[9],S=Q[10],O=Q[11];Q[0]=Y*s-T*_,Q[1]=l*s-A*_,Q[2]=z*s-S*_,Q[3]=G*s-O*_,Q[8]=Y*_+T*s,Q[9]=l*_+A*s,Q[10]=z*_+S*s,Q[11]=G*_+O*s}},mf=function(i,k){if(k){var S=F(k),l=d(k),x=i[0],N=i[1],p=i[2],R=i[3],_=i[4],h=i[5],Y=i[6],C=i[7];i[0]=x*l+_*S,i[1]=N*l+h*S,i[2]=p*l+Y*S,i[3]=R*l+C*S,i[4]=_*l-x*S,i[5]=h*l-N*S,i[6]=Y*l-p*S,i[7]=C*l-R*S}},dg=function(a,E,F){return rr(z,F===!1?z:a.getFinalScale3d(),a.getFinalRotation3d(),a.getRotationMode(),a.p3(),z,E)},rr=function($,M,j,Z,E,k,s){return k||(k=Re()),E&&$f(k,E),Tb(k,j,Z),s&&Tk(k,k,s),M&&Pp(k,M),$&&Tk(k,k,$),k},Ae=function(O,s,U){s=vp(s),U=vp(U);var u=this;u.g=O,u._84O=s,u._85O=U,u._70I=!0,u.F=0,u._83O=s+U,u.pen={x:0,y:0}},Ve="lineDashOffset",Mn="setLineDash",Ud=function(R){for(var B in R)1===B.length&&(Ve=R[B]);return B?1:0},Dh=function(Z,C,R){return Gh(C)?Z:Z[Mn]?(Z[Mn](C),R&&(Z.lineDashOffset=R),Z):new Ae(Z,C[0],C.length>1?C[1]:C[0])},Rf=function(W,y){!Gh(y)&&W[Mn]&&(W[Mn](Ze),W.lineDashOffset=0)};if(Ad(Ae,U,{_69I:6,moveTo:function(g,G){var I=this,s=I.pen;s.x=g,s.y=G,I.g.moveTo(g,G),I.start||(I.start={x:g,y:G})},lineTo:function(I,p){var Z=this,g=Z.pen,i=I-g.x,D=p-g.y,t=C(D,i),U=d(t),H=F(t),e=Z._23O(g.x,g.y,I,p),G=Z._85O,z=Z._84O,O=Z._83O;if(Z.F){if(Z.F>e)return Z._70I?Z._72I(I,p):Z.moveTo(I,p),Z.F-=e,void 0;if(Z._70I?Z._72I(g.x+U*Z.F,g.y+H*Z.F):Z.moveTo(g.x+U*Z.F,g.y+H*Z.F),e-=Z.F,Z.F=0,Z._70I=!Z._70I,!e)return}var B=h(e/O);if(B){for(var s=U*z,K=H*z,v=U*G,j=H*G,S=0;B>S;S++)Z._70I?(Z._72I(g.x+s,g.y+K),Z.moveTo(g.x+v,g.y+j)):(Z.moveTo(g.x+v,g.y+j),Z._72I(g.x+s,g.y+K));e-=O*B}Z._70I?e>z?(Z._72I(g.x+U*z,g.y+H*z),Z.moveTo(I,p),Z.F=G-(e-z),Z._70I=!1):(Z._72I(I,p),e===z?(Z.F=0,Z._70I=!Z._70I):(Z.F=z-e,Z.moveTo(I,p))):e>G?(Z.moveTo(g.x+U*G,g.y+H*G),Z._72I(I,p),Z.F=z-(e-G),Z._70I=!0):(Z.moveTo(I,p),e===G?(Z.F=0,Z._70I=!Z._70I):Z.F=G-e)},quadraticCurveTo:function(n,F,Q,o){var U,$=this,K=$.pen,f=K.x,g=K.y,E=$._22O(f,g,n,F,Q,o),l=0,s=0,c=$._85O,a=$._84O;if($.F){if($.F>E)return $._70I?$._71I(n,F,Q,o):$.moveTo(Q,o),$.F-=E,void 0;if(l=$.F/E,U=$._20O(f,g,n,F,Q,o,l),$._70I?$._71I(U[2],U[3],U[4],U[5]):$.moveTo(U[4],U[5]),$.F=0,$._70I=!$._70I,!E)return}var x=E-E*l,S=h(x/$._83O),t=a/E,X=c/E;if(S)for(var M=0;S>M;M++)$._70I?(s=l+t,U=$._21O(f,g,n,F,Q,o,l,s),$._71I(U[2],U[3],U[4],U[5]),l=s,s=l+X,U=$._21O(f,g,n,F,Q,o,l,s),$.moveTo(U[4],U[5])):(s=l+X,U=$._21O(f,g,n,F,Q,o,l,s),$.moveTo(U[4],U[5]),l=s,s=l+t,U=$._21O(f,g,n,F,Q,o,l,s),$._71I(U[2],U[3],U[4],U[5])),l=s;x=E-E*l,$._70I?x>a?(s=l+t,U=$._21O(f,g,n,F,Q,o,l,s),$._71I(U[2],U[3],U[4],U[5]),$.moveTo(Q,o),$.F=c-(x-a),$._70I=!1):(U=$._19O(f,g,n,F,Q,o,l),$._71I(U[2],U[3],U[4],U[5]),E===a?($.F=0,$._70I=!$._70I):($.F=a-x,$.moveTo(Q,o))):x>c?(s=l+X,U=$._21O(f,g,n,F,Q,o,l,s),$.moveTo(U[4],U[5]),U=$._19O(f,g,n,F,Q,o,s),$._71I(U[2],U[3],U[4],U[5]),$.F=a-(x-c),$._70I=!0):($.moveTo(Q,o),x===c?($.F=0,$._70I=!$._70I):$.F=c-x)},bezierCurveTo:function(){var S=arguments;this.pen={x:S[4],y:S[5]},this.g.bezierCurveTo(S[0],S[1],S[2],S[3],S[4],S[5])},arc:function(X,n,P,y,v,r){r||(y=-y,v=-v),ii(this,X,n,y,v-y,P,P,!1)},rect:function(x,B,w,k){var r=this;r.pen={x:x,y:B},r.moveTo(x,B),r.lineTo(x,B+k),r.lineTo(x+w,B+k),r.lineTo(x+w,B),r.lineTo(x,B)},beginPath:function(){this.g.beginPath()},closePath:function(){this.lineTo(this.start.x,this.start.y)},_23O:function(m,C,A,k){var G=A-m,J=k-C;return N(G*G+J*J)},_22O:function(F,j,k,v,J,e,W){for(var D,S,c,y,Y,n,h,f=0,u=F,P=j,t=W>0?W:this._69I,m=1;t>=m;m++)c=m/t,y=1-c,Y=y*y,n=2*c*y,h=c*c,D=Y*F+n*k+h*J,S=Y*j+n*v+h*e,f+=this._23O(u,P,D,S),u=D,P=S;return f},_21O:function(n,o,d,p,X,W,f,r){var v=this;if(0===f)return v._20O(n,o,d,p,X,W,r);if(1===r)return v._19O(n,o,d,p,X,W,f);var x=v._20O(n,o,d,p,X,W,r);return x.push(f/r),v._19O.apply(v,x)},_20O:function(t,V,q,I,J,Y,U){if(1!==U){var A=q+(J-q)*U,g=I+(Y-I)*U;q=t+(q-t)*U,I=V+(I-V)*U,J=q+(A-q)*U,Y=I+(g-I)*U}return[t,V,q,I,J,Y]},_19O:function(x,T,k,R,h,L,N){if(1!==N){var D=x+(k-x)*N,f=T+(R-T)*N;k+=(h-k)*N,R+=(L-R)*N,x=D+(k-D)*N,T=f+(R-f)*N}return[x,T,k,R,h,L]},_72I:function(y,I){var H=this.pen;(y!==H.x||I!==H.y)&&(H.x=y,H.y=I,this.g.lineTo(y,I))},_71I:function(J,m,z,O){var M=this.pen;(J!==z||m!==O||z!==M.x||O!==M.y)&&(M.x=z,M.y=O,this.g.quadraticCurveTo(J,m,z,O))}}),bo&&td){var vr=td.toString();ah=vr.indexOf(Ob.substr(0,2))>0&&vr.indexOf($i+$i.substr(1,1))>1||vr.indexOf(qh.substr(0,2)+Ob.substr(2,2)+ec[0]+Ob[4])>1?!0:!1}var Sc=z,nq=z,od=m.checkLoadingCompType=function(O){Sc&&!O._72O&&(nq||(nq={}),nq[O._72O=Hf()]=O)},pj=function($,v){if(v||(v=$),v&&(Sc||(Sc={}),!Sc[$])){var D=new dk;if(Sc[v]={request:D,url:v},v=m.beforeLoadURL(v,$),v.data){var A=m.parse(v.data);$n($,A),m.handleCompTypeLoaded($,A)}else{D.onload=function(){if(200===this.status||0===this.status){var h=m.parse(D.getResponseText());$n($,h),m.handleCompTypeLoaded($,h)}else $n($,z)},D.onerror=function(){$n($,z)};var u={};u.url=encodeURI(v),u.sync=!1,D.send(u)}}},$n=function(R,u){if(Zl[R]=u,delete Sc[R],ml(Sc)&&(Sc=z,nq)){for(var D in nq){var V=nq[D];V.invalidateAll&&V.invalidateAll(x,"compTypeLoaded",R),V.redraw&&V.redraw(),V.iv(),delete V._72O}nq=z}if(u&&nq)for(var D in nq){var V=nq[D];V.invalidateAll&&V.invalidateAll(x,"compTypeLoading",R),V.redraw&&V.redraw(),V.iv()}},xh=S.chart,aj="",lg=!0,ol=m.compStack=[],Tp=/^style@/,cs=/^attr@/,ak=/^field@/,Xk={x:.5,y:.5},ph=function(){lg=!0},Cq=function(){return lg},Uk=function(U,E,Y,T){if(!U)return 0;if(Lq(U.fitSize,E,Y)&&T)return T;var i=Lq(U.width,E,Y);return null==i?20:i},Cf=function(V,n,y,F){if(!V)return 0;if(Lq(V.fitSize,n,y)&&F)return F;var v=Lq(V.height,n,y);return null==v?20:v},Lq=function(d,h,i){if(!d||!d.func)return d;var C,Z=d.func,m=d.value;return C=Jc(Z)?i&&i.vectorDataBindingDisabled&&!d.isSafeFunc?m:Z(h,i):h instanceof bq||(R.ui?h instanceof R.ui.View:0)?cs.test(Z)?h.a(aj+Z.slice(5)):Tp.test(Z)?h.s(aj+Z.slice(6)):ak.test(Z)?h[Z.slice(6)]:h[Z]?h[Z](i):m:m,m!==x&&C==z?m:C},rb=m.drawImage=function(){var L,q,c,u,b,Y,I=function(O,k){O.getValue&&O.getValue.compType===k||(O.getValue=function(V){var w=D(O,V);if(w===x&&k.properties){var B=k.properties[V];B&&(w=B.defaultValue)}return w},O.getColor=function(x){return U(O.getValue(x))},O.getValue.compType=k)},D=function(O,v,L){var I,F=!1;if(O.prefix&&q instanceof bq){var J=q.a(aj+v);J!==x&&(F=!0,I=J)}return I===x&&(I=O[v]),I&&I.func&&(F=!0,I=Lq(I,q,c)),L&&(I=L(I),F||(O[v]=I)),I},U=function(A,$){var x;if(x=$?D(A,$):A,L&&L.compGray&&x)return m.toGrayColor(x);if(b&&x){if("override"===Y)return b;if("override_rgb"===Y){var M=Em(b);return x=wc(x),"rgba("+w(255*M[0])+","+w(255*M[1])+","+w(255*M[2])+","+x[3]/255+")"}if("override_a"===Y){var M=Em(b);return x=wc(x),"rgba("+x[0]+","+x[1]+","+x[2]+","+M[3]+")"}var M=Em(b);return x=wc(x),"rgba("+w(x[0]*M[0])+","+w(x[1]*M[1])+","+w(x[2]*M[2])+","+x[3]/255*M[3]+")"}return x},i=function(m){if(Mf(m)){for(var X=new df,Z=m.length,t=0;Z>t;t+=2)X.add({x:m[t],y:m[t+1]});m=X}return m},B=function(C){var u=D(C,"anchorX"),n=D(C,"anchorY");if(u!==x||n!==x)return{x:u===x?Xk.x:u,y:n===x?Xk.y:n};var w=D(C,"type"),L=D(C,"name");if("image"!==w||!L)return Xk;var l=Qd(L);return l&&l.anchorX!==x&&l.anchorY!==x?{x:l.anchorX,y:l.anchorY}:Xk},l=function(q,x){var I=D(q,aq),d=B(q);if(Mf(I)){var E=I.length,K=D(q,"relative"),T=x.width,p=x.height;if(4===E)I={x:I[0],y:I[1],width:I[2],height:I[3]},K&&(I.x*=T,I.y*=p,I.width*=T,I.height*=p);else if(3===E){var n=I[0];I={width:I[1],height:I[2]},K&&(I.width*=T,I.height*=p),"object"==typeof n?n.length&&(n={x:n[0],y:n[1]}):n=yr(n,x,I),I.x=n.x-I.width*d.x,I.y=n.y-I.height*d.y}I.x+=D(q,"offsetX")||0,I.y+=D(q,"offsetY")||0,!K&&x.fitSize&&(I=a(q,I,x))}return I},a=function(U,M,p){if(M){var T,Q,V,Y={x:M.x,y:M.y,width:M.width,height:M.height},t=B(U),h=D(U,"layoutH"),m=D(U,"layoutV"),j=1,f=1,O=0,L=0,u=1,d=1;switch(h){case"left":break;case"right":Y.x+=p.width-p.rw;break;case"center":Y.x+=.5*(p.width-p.rw);break;case"scale":case"leftright":default:T=D(U,uc)||0,T&&(O=Math.abs(L=Math.sin(T)),u=Math.abs(d=Math.cos(T))),"leftright"!==h?(j+=u*(p.widthScale-1),f+=O*(p.widthScale-1)):(j+=Y.width?u*(p.width-p.rw)/Y.width:0,f+=Y.height?O*(p.width-p.rw)/Y.height:0,Q=-Math.min(-t.x*d+t.y*L,-t.x*d-(1-t.y)*L,(1-t.x)*d+t.y*L,(1-t.x)*d-(1-t.y)*L))}switch(m){case"top":break;case"bottom":Y.y+=p.height-p.rh;break;case"center":Y.y+=.5*(p.height-p.rh);break;case"scale":case"topbottom":default:T==z&&(T=D(U,uc),T&&(O=Math.abs(L=Math.sin(T)),u=Math.abs(d=Math.cos(T)))),"topbottom"!==m?(j+=O*(p.heightScale-1),f+=u*(p.heightScale-1)):(j+=Y.width?O*(p.height-p.rh)/Y.width:0,f+=Y.height?u*(p.height-p.rh)/Y.height:0,V=-Math.min(-t.x*L-t.y*d,-t.x*L+(1-t.y)*d,(1-t.x)*L-t.y*d,(1-t.x)*L+(1-t.y)*d))}return(1!==j||1!==f)&&("scale"!==h&&h?"leftright"===h&&(Y.x+=Y.width*(1-j)*t.x+Q*(p.width-p.rw)):Y.x+=Y.x*(p.widthScale-1)+t.x*Y.width*(p.widthScale-j),"scale"!==m&&m?"topbottom"===m&&(Y.y+=Y.height*(1-f)*t.y+V*(p.height-p.rh)):Y.y+=Y.y*(p.heightScale-1)+t.y*Y.height*(p.heightScale-f),Y.width*=j,Y.height*=f),Y.width<0&&(Y.width=0),Y.height<0&&(Y.height=0),Y}},A=function(y){return Mf(y)?new df(y):y},N=function(T,b,v,I,_,s,O){var n=L.interactiveInfo,q=T.transform;if(q)return L.save(),L.setTransform(q.a,q.b,q.c,q.d,q.tx,q.ty),n&&n.compInfos.push({comp:T,rect:b,matrix:q.clone(),prefix:aj,refRect:n.refRect}),!0;_===x&&(_=1),s===x&&(s=1);var U=D(T,"clipPercentage"),m=Gp(v,b);if(m&&!I&&1===_&&1===s&&!(1>U))return n&&n.compInfos.push({comp:T,rect:b,matrix:n.matrix.clone(),prefix:aj,refRect:n.refRect}),!1;O=O||Xk;var F=b.x+b.width*O.x,C=b.y+b.height*O.y,l=v.x+v.width*O.x,d=v.y+v.height*O.y,B=v.width?_*(b.width/v.width):1,k=v.height?s*(b.height/v.height):1;if(L.save(),n&&(n.matrix.appendTranslate(F,C).appendRotate(I).appendScale(B,k).appendTranslate(-l,-d),n.compInfos.push({comp:T,rect:b,matrix:n.matrix.clone(),prefix:aj,refRect:n.refRect})),jm(L,F,C),Eg(L,I||0),Hl(L,B,k),jm(L,-l,-d),1>U){0>U&&(U=0);var Y=vo(v,D(T,"clipDirection"),U),i=D(T,"clipColor");return i||(L.beginPath(),L.rect(Y.x,Y.y,Y.width,Y.height),L.clip()),Y}return!0},H=function(M,a){if(!(M instanceof Boolean)){var B=D(a,"clipColor");if(B)L.globalCompositeOperation="multiply",L.fillStyle=B,L.clip(),L.fillRect(M.x,M.y,M.width,M.height);else{var Y=D(a,"clipGradient");if(Y!=z&&Y>0){L.globalCompositeOperation="destination-out";var J=Gm(L,M,D(a,"clipDirection"),Y);L.fillStyle=J.gradient;var f=J.rect;L.clip(),L.fillRect(f.x,f.y,f.width,f.height)}}}L.restore()},s=function(c,e,G){var t=D(c,"path"),X=D(c,uc),k=D(c,"scaleX"),n=D(c,"scaleY"),V=B(c),o=z,M=Km(null,t);if(G||(G=c.unionRect,G||(G=oe(M),c.path.func||(c.unionRect=G)),o=G),G){o||(o=c.unionRect,o||(o=oe(M),c.path.func||(c.unionRect=o)));var R=N(c,G,o,X,k,n,V),P=D(c,"borderPattern"),d=Dh(L,P),s=U(c,"background"),O=U(c,"borderColor"),x=D(c,"borderWidth"),Q=D(c,"gradient"),Y=U(c,"gradientColor"),a=D(c,"border3d"),b=U(c,"border3dColor"),y=D(c,"border3dAccuracy"),T=L.lineJoin,F=L.lineCap;L.lineJoin=D(c,"borderJoin")||Jd,L.lineCap=D(c,"borderCap")||zn,s?(Sp(L,s,Q,Y,o),Km(L,t),L.fill(),d!==L&&Km(L,t)):Km(L,t);var m=D(c,"borderWidthAbsolute");if(m&&(L.save(),L.setTransform(1,0,0,1,0,0)),x&&O&&(L.lineWidth=x,L.strokeStyle=O,L.stroke(),a&&If(L,O,b,x,u,y)),Rf(L,P),D(c,"dash")){var q=D(c,"dashWidth")||x;if(q>0){P=D(c,"dashPattern")||xj;var d=Dh(L,P,D(c,"dashOffset")),W=U(c,"dashColor")||U(ko);d!==L&&Km(L,t),L.strokeStyle=W,L.lineWidth=q,L.stroke(),D(c,"dash3d")&&If(L,W,U(c,"dash3dColor"),q,u,D(c,"dash3dAccuracy")),Rf(L,P)}}m&&L.restore(),e===aq&&Nn(L,s,D(c,"depth"),o),L.lineJoin=T,L.lineCap=F,R&&H(R,c)}},M=function(t,j,Q,s){var $=D(t,mm,i),v=D(t,uc),f=B(t);if($&&s.fitSize){var k=new df,G=oe($),C=a(t,G,s),R=G.x+f.x*G.width,O=G.y+f.y*G.height,I=C.x+f.x*C.width,P=C.y+f.y*C.height,o=G.width?C.width/G.width:1,e=G.height?C.height/G.height:1;$.each(function(C){k.add({x:I+(C.x-R)*o,y:P+(C.y-O)*e})}),$=k,t.unionRect=null}var X=D(t,"scaleX"),S=D(t,"scaleY"),Z=j===rp,W=z;if(!Q&&Z&&(Q=t.unionRect,Q||(Q=oe($),t.points.func||(t.unionRect=Q)),W=Q),Q){Z?W||(W=t.unionRect,W||(W=oe($),t.points.func||(t.unionRect=W))):W=Q;var r,p,h,J,F=N(t,Q,W,v,X,S,f),m=D(t,"borderPattern"),E=Dh(L,m),x=U(t,"background"),n=Qd(D(t,"repeatImage"),b,Y),d=D(t,"gradientPack"),M=U(t,"borderColor"),w=D(t,"borderWidth"),y=D(t,"segments",A),K=D(t,"gradient"),l=U(t,"gradientColor"),T=D(t,"border3d"),V=U(t,"border3dColor"),g=D(t,"border3dAccuracy"),_=D(t,"closePath"),ad=D(t,"fillRule")||"nonzero",Wo=L.lineJoin,de=L.lineCap;if(L.lineJoin=D(t,"borderJoin")||Jd,L.lineCap=D(t,"borderCap")||zn,Z)if(x||n||d){var gg,Bi=D(t,"fillClipPercentage"),xi=D(t,"fillClipColor");if(1>Bi&&(0>Bi&&(Bi=0),gg=vo(W,D(t,"fillClipDirection"),Bi),L.save(),xi||(L.beginPath(),L.rect(gg.x,gg.y,gg.width,gg.height),L.clip())),ur(L,$,y,_),d?nf(L,d):n?Rm(L,n,b,Y,q,c):Sp(L,x,K,l,W),L.fill(ad),1>Bi){if(xi)L.globalCompositeOperation="multiply",L.fillStyle=xi,L.clip(),L.fillRect(gg.x,gg.y,gg.width,gg.height);else{var zo=D(t,"fillClipGradient");if(zo!=z&&zo>0){L.globalCompositeOperation="destination-out";var cg=Gm(L,gg,D(t,"fillClipDirection"),zo);L.fillStyle=cg.gradient;var Ri=cg.rect;L.clip(),L.fillRect(Ri.x,Ri.y,Ri.width,Ri.height)}}L.restore()}d&&L.restore(),E!==L&&ur(E,$,y,_)}else ur(E,$,y,_);else if("roundRect"===j?r=D(t,"cornerRadius"):"polygon"===j?r=D(t,"polygonSide"):"arc"===j&&(r=D(t,"arcFrom"),p=D(t,"arcTo"),h=D(t,"arcClose"),J=D(t,"arcOval")),x||n||d){var gg,Bi=D(t,"fillClipPercentage"),xi=D(t,"fillClipColor");if(1>Bi&&(0>Bi&&(Bi=0),gg=vo(W,D(t,"fillClipDirection"),Bi),L.save(),xi||(L.beginPath(),L.rect(gg.x,gg.y,gg.width,gg.height),L.clip())),Wk(L,j,W,r,p,h,J),d?nf(L,d):n?Rm(L,n,b,Y,q,c):Sp(L,x,K,l,W),L.fill(ad),1>Bi){if(xi)L.globalCompositeOperation="multiply",L.fillStyle=xi,L.clip(),L.fillRect(gg.x,gg.y,gg.width,gg.height);else{var zo=D(t,"fillClipGradient");if(zo!=z&&zo>0){L.globalCompositeOperation="destination-out";var cg=Gm(L,gg,D(t,"fillClipDirection"),zo);L.fillStyle=cg.gradient;var Ri=cg.rect;L.clip(),L.fillRect(Ri.x,Ri.y,Ri.width,Ri.height)}}L.restore()}d&&L.restore(),L!==E&&Wk(E,j,W,r,p,h,J)}else Wk(E,j,W,r,p,h,J);var Cq=D(t,"borderWidthAbsolute");if(Cq&&(L.save(),L.setTransform(1,0,0,1,0,0)),w&&M&&(L.lineWidth=w,L.strokeStyle=M,L.stroke(),T&&If(L,M,V,w,u,g)),Rf(L,m),D(t,"dash")){var jl=D(t,"dashWidth")||w;if(jl>0){m=D(t,"dashPattern")||xj;var E=Dh(L,m,D(t,"dashOffset")),kq=U(t,"dashColor")||U(ko);E!==L&&(Z?ur(E,$,y,_):Wk(E,j,W,r,p,h,J)),L.strokeStyle=kq,L.lineWidth=jl,L.stroke(),D(t,"dash3d")&&If(L,kq,U(t,"dash3dColor"),jl,u,D(t,"dash3dAccuracy")),Rf(L,m)}}Cq&&L.restore(),j===aq&&Nn(L,x,D(t,"depth"),W),L.lineJoin=Wo,L.lineCap=de,F&&H(F,t)}},r=function(S,C){var N=b||D(S,ij),k=Y||D(S,"blendMode"),t=D(S,"name"),E=Qd(t,N,k);E?Xm(L,E,D(S,"stretch"),C.x,C.y,C.width,C.height,q,c,N,null,k):lg=!1},k=function(l,r){var T=D(l,"text");T!=z&&Kq(L,T,D(l,"font"),U(l,ij),r.x,r.y,r.width,r.height,D(l,"align"),D(l,"vAlign"))},n=function(J,u){_q(L,U(J,ij),u.x,u.y,u.width,u.height,D(J,"width"))},f=function(H,i){var s=D(H,zd),t=0;if(s&&(s.forEach(function(i){t+=i}),t>0)){for(var $=D(H,"colors")||xh,Q=D(H,"startAngle")||0,S=D(H,"hollow"),u=D(H,ih),V=D(H,ek),k=D(H,Hi),b=u?new df:z,c=i.x,e=i.y,G=i.width,h=i.height,M=c+G/2,p=e+h/2,W=g(G,h)/2,l=0,o=0;o<s.length;o++){var C=s[o],K=y*C/t,f=Q+K;if(L.fillStyle=$[l++],l===$.length&&(l=0),L.beginPath(),S){var X=M+d(Q)*W/2,m=p+F(Q)*W/2,j=M+d(f)*W,Y=p+F(f)*W;L.moveTo(X,m),L.arc(M,p,W/2,Q,f,!1),L.lineTo(j,Y),L.arc(M,p,W,f,Q,!0)}else L.moveTo(M,p),L.arc(M,p,W,f,Q,!0);b&&(K=(Q+f)/2,b.add({text:Jc(u)?u(C,o,t,q):C,x:M+.75*d(K)*W,y:p+.75*F(K)*W})),L.closePath(),L.fill(),Q=f}b&&b.each(function(w){Kq(L,w.text,V,k,w.x,w.y,0,0,sj)})}},Q=function(v,n){var u=D(v,Ok);if(u&&u.length>0){var j=u.length,B=D(v,ih),T=D(v,ek),c=D(v,Hi),K=B?new df:z,w=D(v,"minValue")||0,F=D(v,"maxValue");if(F==z&&(F=0,u.forEach(function(j){D(j,zd).forEach(function(B){F=W(F,B)})})),w===F)return;for(var I=n.height/(F-w),$=n.y+F*I,H=D(u[0],zd).length,P=n.width/(3*H+1),l=2*P/j,d=0,R=0;j>R;R++)for(var b=u[R],x=D(b,ij),t=D(b,"colors"),X=D(b,zd),M=0;H>M;M++){t?L.fillStyle=t[M]:x?L.fillStyle=x:(L.fillStyle=xh[d++],d===xh.length&&(d=0));var h=X[M],Q=h*I,g=n.x+(1+3*M)*P+R*l;if(em(L,g,$-Q,l,Q),K){var e=Jc(B)?B(h,M,b,q):h,S=Yf(T,e).height;K.add({x:g,y:$-Q-S,width:l,height:S,text:e})}}K&&K.each(function(x){Kq(L,x.text,T,c,x.x,x.y,x.width,x.height,sj)})}},Z=function(i,X){var y=D(i,Ok);if(y&&y.length>0){var C=y.length,p=D(y[0],zd).length,P=X.width/(3*p+1),A=0,t=D(i,"maxValue"),e=D(i,ih),Q=D(i,ek),Z=D(i,Hi),c=e?new df:z;if(t==z){t=0;for(var j=0;p>j;j++){for(var r=0,m=0;C>m;m++)r+=D(y[m],zd)[j];t=W(t,r)}}if(t>0){for(var j=0;p>j;j++)for(var S=X.y+X.height,m=0;C>m;m++){var $=y[m],H=D($,ij),B=D($,zd)[j],k=B/t*X.height;H?L.fillStyle=H:(L.fillStyle=xh[A++],A===xh.length&&(A=0)),S-=k;var T={x:X.x+(1+3*j)*P,y:S,width:2*P,height:k};em(L,T.x,T.y,T.width,T.height),c&&(T.text=Jc(e)?e(B,j,$,q):B,c.add(T))}c&&c.each(function(v){Kq(L,v.text,Q,Z,v.x,v.y,v.width,v.height,sj)})}}},v=function(v,b){var J=D(v,Ok);if(J&&J.length>0){for(var k=J.length,l=D(J[0],zd).length,E=b.width/(3*l+1),g=0,A=D(v,ih),Y=D(v,ek),w=D(v,Hi),h=A?new df:z,i=0;l>i;i++){for(var I=0,o=0;k>o;o++)I+=D(J[o],zd)[i];if(I>0){var d=b.y+b.height;for(o=0;k>o;o++){var r=J[o],R=D(r,ij),$=D(r,zd)[i],F=$/I*b.height;R?L.fillStyle=R:(L.fillStyle=xh[g++],g===xh.length&&(g=0)),d-=F;var B={x:b.x+(1+3*i)*E,y:d,width:2*E,height:F};em(L,B.x,B.y,B.width,B.height),h&&(B.text=Jc(A)?A($,i,r,q):$,h.add(B))}}}h&&h.each(function(O){Kq(L,O.text,Y,w,O.x,O.y,O.width,O.height,sj)})}},C=function(j,d){var n=D(j,Ok);if(n&&n.length>0){var C=n.length,V=D(j,"minValue")||0,Q=D(j,"maxValue");if(Q==z&&(Q=0,n.forEach(function(u){D(u,zd).forEach(function(c){Q=W(Q,c)})})),V===Q)return;for(var Y=d.height/(Q-V),F=d.y+Q*Y,w=D(n[0],zd).length,J=d.width/(3*w+1),T=0,N=D(j,"lineWidth")||2,H=D(j,"line3d"),t=D(j,"linePoint"),e=D(j,ih),U=D(j,ek),$=D(j,Hi),f=0;C>f;f++){var I=n[f],K=D(I,ij),l=D(I,zd);K?L.strokeStyle=K:(K=L.strokeStyle=xh[T++],T===xh.length&&(T=0)),L.beginPath();for(var b=0;w>b;b++){var R=d.x+(2+3*b)*J,E=F-l[b]*Y;0===b?L.moveTo(R,E):L.lineTo(R,E)}if(L.lineWidth=N,L.stroke(),H&&If(L,K,z,N,u),t||e){var p,r=N/2+2;for(b=0;w>b;b++){var Z=l[b];if(R=d.x+(2+3*b)*J,E=F-Z*Y,Jc(t)?t(L,R,E,K,b,I,q):t&&(L.fillStyle=K,L.beginPath(),L.arc(R,E,r,0,y,!0),L.fill()),Jc(e)?p=e(Z,b,I,q):e&&(p=Z),p){var s=Yf(U,p).height,a=L.shadowBlur;if(a){var B=L.shadowOffsetX,k=L.shadowOffsetY,X=L.shadowColor;L.shadowOffsetX=0,L.shadowOffsetY=0,L.shadowBlur=0,L.shadowColor=z}Kq(L,p,U,$,R,E-s-r+2,0,s,sj),a&&(L.shadowOffsetX=B,L.shadowOffsetY=k,L.shadowBlur=a,L.shadowColor=X)}}}}}},$=function(R){L=R[0],q=R[1],c=R[2],u=R[3],b=R[4],Y=R[5]},_=function(){return[L,q,c,u,b,Y]},R=function(a,W){var k;c&&c.getDrawableState?k=c.getDrawableState(q):c&&c.getState?k=c.getState(q):(k=q instanceof bq?q.s(Qk):null,(k===x||null===k)&&(k=D(a,Qk)));var v=D(W,Qk);return v!==x&&null!==v&&v!==k?!1:D(W,so)},T={border:n,image:r,text:k,pieChart:f,columnChart:Q,stackedColumnChart:Z,percentageColumnChart:v,lineChart:C};return function(t,X,P,k,w,n,K,G,g,p){if(X&&w&&n){var e=_();L=t,q=K,c=G,!q&&c&&c.isSelfViewEvent&&(q=c),u=c?c._zoom?c._zoom:1:1,b=g,Y=p;var O=w,W=n;if(gd()){var V,Z,C,F,h;0===L[ki]?gd[0]&&(V=!0):V=!0,L.texureImage2D?gd[1]&&(Z=!0):Z=!0,L.texureImage3D?gd[2]&&(C=!0):C=!0,L.drawDNDState?gd[3]&&(h=!0):h=!0,Fo.widget[0]?gd[4]&&(F=!0):F=!0,V&&Z&&C&&F&&h&&(O=P,W=k)}if(X.tagName)return yk(Jk)&&!o[Jk]||L.drawImage(X,O,W,w,n),$(e),void 0;if(D(X,"visible")===!1)return $(e),void 0;b||(b=Lq(X.color,q,c)),p||(Y=Lq(X.blendMode,q,c)),yk(Jk)&&!o[Jk]&&(w=O,n=W);var v=Uk(X,q,c,w),S=Cf(X,q,c,n),J={x:0,y:0,width:v,height:S,fitSize:D(X,"fitSize")},E=D(X,"clip"),j=D(X,"opacity");if(J.fitSize){var Q=J.rw=Lq(X.width,q,c)||20;J.widthScale=v/Q;var r=J.rh=Lq(X.height,q,c)||20;J.heightScale=S/r}if(L.save(),L.interactiveInfo){var d=L.interactiveInfo.matrix,a=d.clone();d.appendTranslate(O,W).appendScale(w/v,n/S),L.interactiveInfo.refRect=J}jm(L,O,W),(v!==w||S!==n)&&L.scale(w/v,n/S),E&&(Jc(E)?E(L,v,S,q,c,X):(L.beginPath(),L.rect(0,0,v,S),L.clip())),j!=z&&(L.globalAlpha*=j),D(X,"comps").forEach(function(n){if(n.prefix){var e=aj,j=Lq(n.prefix,q,c);j&&(aj=aj+j+".")}if(R(X,n)===!1)return n.prefix&&(aj=e),void 0;if(ol.splice(0,0,n),L.interactiveInfo)var O=L.interactiveInfo.matrix.clone();var Y=D(n,"opacity"),g=D(n,"shadow"),G=D(n,"type"),p=D(n,"refRect")||J,F=l(n,p);if(Y!=z){var _=L.globalAlpha;L.globalAlpha*=Y}if(g){var w=L.shadowOffsetX,v=L.shadowOffsetY,h=L.shadowBlur,S=L.shadowColor,Z=D(n,"shadowOffsetX"),t=D(n,"shadowOffsetY"),E=D(n,"shadowBlur"),k=U(n,"shadowColor");L.shadowOffsetX=(Z==z?3:Z)*u,L.shadowOffsetY=(t==z?3:t)*u,L.shadowBlur=(E==z?6:E)*u,L.shadowColor=k||U(Hb)}if("save"===G)L.save();else if("endClip"===G||"restore"===G)L.restore();else if("clip"===G)L.save(),ur(L,D(n,"points",i),D(n,"segments",A),!0),L.clip();else if(Vg[G])F=F||{x:0,y:0,width:p.width,height:p.height},M(n,G,F,p);else if(G===rp)M(n,G,F,p);else if("SVGPath"===G)s(n,G,F);else{F=F||{x:0,y:0,width:p.width,height:p.height};var P=D(n,uc),o=D(n,"scaleX"),V=D(n,"scaleY"),Q=B(n),C=N(n,F,F,P,o,V,Q);if(Jc(G))I(n,G),m.drawCompType(G,L,F,n,q,c);else if(m.getCompType(G)){var $=m.getCompType(G),y=$.func||$;I(n,$),m.drawCompType(y,L,F,n,q,c)}else T[G]?T[G](n,F):m.getCompType(G)===x&&Hm.test(G)&&pj(G);C&&H(C,n)}g&&(L.shadowOffsetX=w,L.shadowOffsetY=v,L.shadowBlur=h,L.shadowColor=S),Y!=z&&(L.globalAlpha=_),L.interactiveInfo&&(L.interactiveInfo.matrix=O),n.prefix&&(aj=e),ol.splice(0,1)}),L.interactiveInfo&&(L.interactiveInfo.matrix=a),L.restore(),$(e)}}}();m.getCurrentComp=function(){return ol[0]},m.getParentComp=function(){return ol[1]},m.getInternal=function(){return{isEnter:Hk,isEsc:qd,isSpace:Wh,isLeft:sr,isUp:Hr,isRight:Kf,isDown:Fe,addMethod:ae,superCall:ac,toPointsArray:Wd,translateAndScale:kn,appendArray:Pr,createWorldMatrix:rr,vec3TransformMat4:Eb,setCanvas:vl,createDiv:Kk,createView:Ul,createCanvas:pn,createImage:nk,initContext:vs,layout:Ln,fillRect:em,Mat:fc,drawBorder:_q,isString:yk,setBorder:gq,getPropertyValue:pc,setPropertyValue:Yk,drawVerticalLine:fg,draw3DRect:Nn,getPinchDist:lo,isSameRect:Gp,getPosition:yr,intersectionLineRect:ss,getNodeRect:vg,getEdgeAgentPosition:oo,getEdgeHostPosition:bb,getImageWidth:Uk,getImageHeight:Cf,initItemElement:no,drawPoints:ur,createG2:Dh,closePopup:wl,isH:Fr,createAnim:js,createNormalMatrix:bl,toColorArray:Em,createNormals:oc,toFloatArray:Qc,glMV:Ld,glPop:Qj,batchShape:ir,createNodeMatrix:dg,getShapeModel:Dg,getFaceInfo:bf,transformAppend:vm,drawFaceInfo:wf,to3dPointsArray:ye,setGLDebugMode:function(E){cj=E},cube:function(){return{vs:oq,is:Zq,uv:wg}},ui:function(){return{DataUI:vi,NodeUI:Bo,EdgeUI:Pj,GroupUI:ff,ShapeUI:Nk,GridUI:Wq,Data3dUI:Ie,Node3dUI:Ei,Shape3dUI:Qp}},getInternalVersion:function(){return"U2FsdGVkX1859ehcGWXsOVwD/93qDwiCYvYx5FrTikM="},getDragger:function(){return Si},addMSMap:function(K){ae(dj,K)},k:X,addEventListener:n,removeEventListener:I}},function(G){function S(Z,X){Z!=z&&(X==z&&dl!=typeof Z?this._54O(Z,256):this._54O(Z,X))}function q(){return new S(z)}function l(s,y,T,$,p,P){for(;--P>=0;){var B=y*this[s++]+T[$]+p;p=h(B/67108864),T[$++]=67108863&B}return p}function O(O,F,h,C,z,w){for(var i=32767&F,x=F>>15;--w>=0;){var $=32767&this[O],n=this[O++]>>15,y=x*$+n*i;$=i*$+((32767&y)<<15)+h[C]+(1073741823&z),z=($>>>30)+(y>>>15)+x*n+(z>>>30),h[C++]=1073741823&$}return z}function i(P,U,n,u,M,T){for(var V=16383&U,e=U>>14;--T>=0;){var K=16383&this[P],A=this[P++]>>14,i=e*K+A*V;K=V*K+((16383&i)<<14)+n[u]+M,M=(K>>28)+(i>>14)+e*A,n[u++]=268435455&K}return M}function K(v){return Si.charAt(v)}function j(v,f){var F=Fc[v.charCodeAt(f)];return F==z?-1:F}function I(E){for(var O=this.t-1;O>=0;--O)E[O]=this[O];E.t=this.t,E.s=this.s}function E(d){this.t=1,this.s=0>d?-1:0,d>0?this[0]=d:-1>d?this[0]=d+this.DV:this.t=0}function R(V){var G=q();return G._58O(V),G}function L(W,J){var w,H=this;if(16==J)w=4;else if(8==J)w=3;else if(256==J)w=8;else if(2==J)w=1;else if(32==J)w=5;else{if(4!=J)return H.fromRadix(W,J),void 0;w=2}H.t=0,H.s=0;for(var E=W.length,g=!1,a=0;--E>=0;){var f=8==w?255&W[E]:j(W,E);0>f?"-"==W.charAt(E)&&(g=!0):(g=!1,0==a?H[H.t++]=f:a+w>H.DB?(H[H.t-1]|=(f&(1<<H.DB-a)-1)<<a,H[H.t++]=f>>H.DB-a):H[H.t-1]|=f<<a,a+=w,a>=H.DB&&(a-=H.DB))}8==w&&0!=(128&W[0])&&(H.s=-1,a>0&&(H[H.t-1]|=(1<<H.DB-a)-1<<a)),H._57O(),g&&S.ZERO._78O(H,H)}function n(){for(var z=this,e=z.s&z.DM;z.t>0&&z[z.t-1]==e;)--z.t}function P(u){var h=this;if(h.s<0)return"-"+h._85O()[mf](u);var p;if(16==u)p=4;else if(8==u)p=3;else if(2==u)p=1;else if(32==u)p=5;else{if(4!=u)return h.toRadix(u);p=2}var Y,e=(1<<p)-1,l=!1,o="",B=h.t,U=h.DB-B*h.DB%p;if(B-->0)for(U<h.DB&&(Y=h[B]>>U)>0&&(l=!0,o=K(Y));B>=0;)p>U?(Y=(h[B]&(1<<U)-1)<<p-U,Y|=h[--B]>>(U+=h.DB-p)):(Y=h[B]>>(U-=p)&e,0>=U&&(U+=h.DB,--B)),Y>0&&(l=!0),l&&(o+=K(Y));return l?o:"0"}function w(){var T=q();return S.ZERO._78O(this,T),T}function $(){return this.s<0?this._85O():this}function Z(o){var h=this,B=h.s-o.s;if(0!=B)return B;var T=h.t;if(B=T-o.t,0!=B)return h.s<0?-B:B;for(;--T>=0;)if(0!=(B=h[T]-o[T]))return B;return 0}function V(L){var R,b=1;return 0!=(R=L>>>16)&&(L=R,b+=16),0!=(R=L>>8)&&(L=R,b+=8),0!=(R=L>>4)&&(L=R,b+=4),0!=(R=L>>2)&&(L=R,b+=2),0!=(R=L>>1)&&(L=R,b+=1),b}function a(){var k=this;return k.t<=0?0:k.DB*(k.t-1)+V(k[k.t-1]^k.s&k.DM)}function s(E,G){var u;for(u=this.t-1;u>=0;--u)G[u+E]=this[u];for(u=E-1;u>=0;--u)G[u]=0;G.t=this.t+E,G.s=this.s}function A(R,F){for(var l=R;l<this.t;++l)F[l-R]=this[l];F.t=W(this.t-R,0),F.s=this.s}function o(m,O){var K,p=this,j=m%p.DB,P=p.DB-j,_=(1<<P)-1,F=h(m/p.DB),e=p.s<<j&p.DM;for(K=p.t-1;K>=0;--K)O[K+F+1]=p[K]>>P|e,e=(p[K]&_)<<j;for(K=F-1;K>=0;--K)O[K]=0;O[F]=e,O.t=p.t+F+1,O.s=p.s,O._57O()}function f(P,k){var c=this;k.s=c.s;var z=h(P/c.DB);if(z>=c.t)return k.t=0,void 0;var p=P%c.DB,r=c.DB-p,R=(1<<p)-1;k[0]=c[z]>>p;for(var W=z+1;W<c.t;++W)k[W-z-1]|=(c[W]&R)<<r,k[W-z]=c[W]>>p;p>0&&(k[c.t-z-1]|=(c.s&R)<<r),k.t=c.t-z,k._57O()}function B(O,b){for(var d=this,R=0,C=0,J=g(O.t,d.t);J>R;)C+=d[R]-O[R],b[R++]=C&d.DM,C>>=d.DB;if(O.t<d.t){for(C-=O.s;R<d.t;)C+=d[R],b[R++]=C&d.DM,C>>=d.DB;C+=d.s}else{for(C+=d.s;R<O.t;)C-=O[R],b[R++]=C&d.DM,C>>=d.DB;C-=O.s}b.s=0>C?-1:0,-1>C?b[R++]=d.DV+C:C>0&&(b[R++]=C),b.t=R,b._57O()}function _(Z,L){var Q=this.abs(),K=Z.abs(),C=Q.t;for(L.t=C+K.t;--C>=0;)L[C]=0;for(C=0;C<K.t;++C)L[C+Q.t]=Q.am(0,K[C],L,C,0,Q.t);
L.s=0,L._57O(),this.s!=Z.s&&S.ZERO._78O(L,L)}function r(G){for(var O=this.abs(),T=G.t=2*O.t;--T>=0;)G[T]=0;for(T=0;T<O.t-1;++T){var o=O.am(T,O[T],G,2*T,0,1);(G[T+O.t]+=O.am(T+1,2*O[T],G,2*T+1,o,O.t-T-1))>=O.DV&&(G[T+O.t]-=O.DV,G[T+O.t+1]=1)}G.t>0&&(G[G.t-1]+=O.am(T,O[T],G,2*T,0,1)),G.s=0,G._57O()}function H(G,d,X){var C=G.abs(),P=this;if(!(C.t<=0)){var s=P.abs();if(s.t<C.t)return d!=z&&d._58O(0),X!=z&&P._77O(X),void 0;X==z&&(X=q());var m=q(),D=P.s,F=G.s,B=P.DB-V(C[C.t-1]);B>0?(C._44O(B,m),s._44O(B,X)):(C._77O(m),s._77O(X));var r=m.t,J=m[r-1];if(0!=J){var i=J*(1<<P.F1)+(r>1?m[r-2]>>P.F2:0),k=P.FV/i,c=(1<<P.F1)/i,l=1<<P.F2,U=X.t,a=U-r,Z=d==z?q():d;for(m._59O(a,Z),X._52O(Z)>=0&&(X[X.t++]=1,X._78O(Z,X)),S.ONE._59O(r,Z),Z._78O(m,m);m.t<r;)m[m.t++]=0;for(;--a>=0;){var x=X[--U]==J?P.DM:h(X[U]*k+(X[U-1]+l)*c);if((X[U]+=m.am(0,x,X,a,0,r))<x)for(m._59O(a,Z),X._78O(Z,X);X[U]<--x;)X._78O(Z,X)}d!=z&&(X._45O(r,d),D!=F&&S.ZERO._78O(d,d)),X.t=r,X._57O(),B>0&&X._46O(B,X),0>D&&S.ZERO._78O(X,X)}}}function p(e){var M=q();return this.abs()._49O(e,z,M),this.s<0&&M._52O(S.ZERO)>0&&e._78O(M,M),M}function x(p){this.m=p}function m(Z){return Z.s<0||Z._52O(this.m)>=0?Z.mod(this.m):Z}function U(b){return b}function J(h){h._49O(this.m,z,h)}function k(Y,g,B){Y._47O(g,B),this._74O(B)}function Q(d,v){d._48O(v),this._74O(v)}function C(){if(this.t<1)return 0;var M=this[0];if(0==(1&M))return 0;var w=3&M;return w=15&w*(2-(15&M)*w),w=255&w*(2-(255&M)*w),w=65535&w*(2-(65535&(65535&M)*w)),w=w*(2-M*w%this.DV)%this.DV,w>0?this.DV-w:-w}function T(w){var H=this;H.m=w,H.mp=w._50O(),H.mpl=32767&H.mp,H.mph=H.mp>>15,H.um=(1<<w.DB-15)-1,H.mt2=2*w.t}function M(t){var u=q();return t.abs()._59O(this.m.t,u),u._49O(this.m,z,u),t.s<0&&u._52O(S.ZERO)>0&&this.m._78O(u,u),u}function c(s){var F=q();return s._77O(F),this._74O(F),F}function e(_){for(var Q=this;_.t<=Q.mt2;)_[_.t++]=0;for(var r=0;r<Q.m.t;++r){var J=32767&_[r],H=J*Q.mpl+((J*Q.mph+(_[r]>>15)*Q.mpl&Q.um)<<15)&_.DM;for(J=r+Q.m.t,_[J]+=Q.m.am(0,H,_,r,0,Q.m.t);_[J]>=_.DV;)_[J]-=_.DV,_[++J]++}_._57O(),_._45O(Q.m.t,_),_._52O(Q.m)>=0&&_._78O(Q.m,_)}function b(w,k){w._48O(k),this._74O(k)}function Ah(S,P,f){S._47O(P,f),this._74O(f)}function Jg(){return 0==(this.t>0?1&this[0]:this.s)}function On(E,f){if(E>4294967295||1>E)return S.ONE;var M=q(),b=q(),k=f._73O(this),$=V(E)-1;for(k._77O(M);--$>=0;)if(f._76O(M,b),(E&1<<$)>0)f._75O(b,k,M);else{var W=M;M=b,b=W}return f.revert(M)}function Dc(N,e){var w;return w=256>N||e._51O()?new x(e):new T(e),this.exp(N,w)}function Xl(){var H=this;if(H.s<0){if(1==H.t)return H[0]-H.DV;if(0==H.t)return-1}else{if(1==H.t)return H[0];if(0==H.t)return 0}return(H[1]&(1<<32-H.DB)-1)<<H.DB|H[0]}function co(D,y){return new S(D,y)}function Yh(){var Q=this;Q.n=z,Q.e=0,Q.d=z,Q.p=z,Q.q=z,Q.dmp1=z,Q.dmq1=z,Q._10A=z}function ik(q){return q._53O(this.e,this.n)}function Zl(T){var p,g,x,q="",r=0;for(p=0;p<T.length&&T.charAt(p)!=Ik;++p)x=bn.indexOf(T.charAt(p)),0>x||(0==r?(q+=K(x>>2),g=3&x,r=1):1==r?(q+=K(g<<2|x>>4),g=15&x,r=2):2==r?(q+=K(g),q+=K(x>>2),g=3&x,r=3):(q+=K(g<<2|x>>4),q+=K(15&x),r=0));return 1==r&&(q+=K(g<<2)),q}function dh(q){var a=q.split(""),i=Zl(q);return a.forEach(function(q){var j=q.length;j>0&&i&&(mo+=vp(q))}),i}function gr(Z,v){var N=qr._4O.Util._56O(Z,"ss"),W={},g=0;return W.v=N==v,W.t=1,W.s=0>g?-1:0,Ph=W.v,g>0?W[0]=g:-1>g?W[0]=g+W.DV:W.t=0,[N,W]}function Iq(x){var E=38,f=x.substring(0,E);if(f&&30==f.indexOf("05000420")){var s=["ss",x.substring(E)];return s}return[]}function Sk(l,u){u=u.replace(ks,""),u=u.replace(/[ \n]+/g,"");var t=co(u,16);if(t._55O()>this.n._55O())return 0;var b=this._37O(t),z=b[mf](16).replace(/^1f+00/,""),w=Iq(z);if(0==w.length)return!1;for(var f,m,j,G=.5,P=De,C=[0,.5,.75,.875,.9375],X=[],T=[],A=[],c=y/P,I=w[1],B=gr(l,I)[0],N=0,e=0;N<C.length;N++){var n=0===N%2?0:.5;for(f=0;P>=f;f++)m=(f+n)*c,j=1-C[N],X.push(d(m)*G*j,-G+2*C[N]*G,-F(m)*G*j),T.push((f+n)/P,j)}for(N=0;N<C.length-1;N++){var $=N*(P+1),Z=(N+1)*(P+1);for(f=0;P>f;f++)A.push($+f,Z+f+1,Z+f,$+f,$+f+1,Z+f+1)}return A.forEach(function(R){e+=R}),I==B&&e>10}var Yr,Mh=0xdeadbeefcafe,bo=15715070==(16777215&Mh),mf="toString",ci="",fk="nat",Ug=function(){};D=G["D"+11182[mf](Y(2,5))];var uq=S.prototype;wd+=tl.substr(0,1);var rr=G.navigator?G.navigator.appName:"";bo&&"Microsoft Internet Explorer"==rr?(uq.am=O,Yr=30):bo&&"Netscape"!=rr?(uq.am=l,Yr=26):(uq.am=i,Yr=28),uq.DB=Yr,uq.DM=(1<<Yr)-1,uq.DV=1<<Yr;var Ho=52;uq.FV=Y(2,Ho),uq.F1=Ho-Yr,uq.F2=2*Yr-Ho;var ul,Id,Si="0123456789abcdefghijklmnopqrstuvwxyz",Fc=[],zp=function(v){return String.fromCharCode(v)};for(ul="0".charCodeAt(0),Id=0;9>=Id;++Id)Fc[ul++]=Id;for(ul="a".charCodeAt(0),Id=10;36>Id;++Id)Fc[ul++]=Id;for(ul="A".charCodeAt(0),Id=10;36>Id;++Id)Fc[ul++]=Id;var Sm=x.prototype;Sm._73O=m,Sm.revert=U,Sm._74O=J,Sm._75O=k,Sm._76O=Q;var Np=T.prototype;Np._73O=M,Np.revert=c,Np._74O=e,Np._75O=Ah,Np._76O=b,uq._77O=I,uq._58O=E,uq._54O=L,uq._57O=n,uq._59O=s,uq._45O=A,uq._44O=o,uq._46O=f,uq._78O=B,uq._47O=_,uq._48O=r,uq._49O=H,uq._50O=C,uq._51O=Jg,uq.exp=On,uq.toString=P,uq._85O=w,uq.abs=$,uq._52O=Z,uq._55O=a,uq.mod=p,uq._53O=Dc,S.ZERO=R(0),S.ONE=R(1),uq._86O=Xl;var Pr=function(v,C){var Q=this;Q.isPublic=!0,typeof v!==dl?(Q.n=v,Q.e=C):v!=z&&C!=z&&v.length>0&&C.length>0&&(Q.n=co(v,16),Q.e=vp(C,16))};mn=function(){var b,u,P=dh(Vb),O=P.substr(0,4),o=P.substr(4,2),s=P.substr(6,2),I=1,t=!I,k=X,e=[],E=nd.charAt(7);if(D&&(D[mf]().indexOf(fk)<0||D[wd][mf]().indexOf(fk)<0||!P?b=z:(P=new D(O-0,o-I,s-0),u=P.setHours(9),D[wd]()>u?b=Vh[E]:t=!0)),P&&b&&b[0]&&b[v(.5)]&&k){var l=Kg(b[0]),K=Kg(b[1]);for(var J in K)e.push(J);var A,Z=0,r=l[e[Z]],Q=K[e[Z++]],g=K[e[Z++]],C=K[e[Z++]],G=K[e[Z++]],N=K[e[Z++]],h=K[e[Z++]],n=l[e[Z]],W=K[e[Z++]],L=db._27O(k);if(r===Q&&L&&W){A=Q+g+C+G+N+h;var d=!h||h===vn;if(!d&&h)for(var R,p=0,M=h.length;M>p;p++)h[p]===qf[Z]?R===vn?d=!0:R[0]===me[5]&&vn&&vn.indexOf(R.substr(1))>=0?d=!0:R=z:(R==z?R=h[p]:R+=h[p],p===M-1&&(R===vn?d=!0:R[0]===me[5]&&vn&&vn.indexOf(R.substr(1))>=0&&(d=!0)));A&&L._31O(A,W)&&L._31O(r,n)&&d&&(!N||D[wd]()<N)&&(t=!0)}}return t||(Wk=Gh),E};var Jl=Yh.prototype;Jl._37O=ik,Jl._38O=Pr;var bn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ik="=",Kk=25,Pg=10,Vb="ICASJQ==",Pm=Pm||function(F,y){var e={},l=e._7A={},S=l._6A=function(){function z(){}return{_80O:function(q){z.prototype=this;var W=new z;return q&&W._5A(q),W.hasOwnProperty("_82O")||(W._82O=function(){W.$super._82O.apply(this,arguments)}),W._82O.prototype=W,W.$super=this,W},_3A:function(){var P=this._80O();return P._82O.apply(P,arguments),P},_82O:function(){},_5A:function(k){for(var C in k)k.hasOwnProperty(C)&&(this[C]=k[C]);k.hasOwnProperty(mf)&&(this.toString=k.toString)},_88O:function(){return this._82O.prototype._80O(this)}}}(),K=l._39O=S._80O({_82O:function(P,f){P=this._84O=P||[],this._65O=f!=y?f:4*P.length},toString:function(Q){return(Q||Z).stringify(this)},_89O:function(D){var c=this._84O,o=D._84O,X=this._65O,m=D._65O;if(this._57O(),X%4)for(var V=0;m>V;V++){var U=255&o[V>>>2]>>>24-8*(V%4);c[X+V>>>2]|=U<<24-8*((X+V)%4)}else if(o.length>65535)for(var V=0;m>V;V+=4)c[X+V>>>2]=o[V>>>2];else c.push.apply(c,o);return this._65O+=m,this},_57O:function(){var i=this._84O,A=this._65O;i[A>>>2]&=4294967295<<32-8*(A%4),i.length=v(A/4)},_88O:function(){var i=S._88O.call(this);return i._84O=this._84O.slice(0),i},_87O:function(n){for(var w=[],f=0;n>f;f+=4)w.push(0|4294967296*u);return new K._82O(w,n)}}),P=e._2A={},Z=P._69O={stringify:function(X){var D,G=X._84O,o=X._65O,J=[];for(D=0;o>D;D++){var b=255&G[D>>>2]>>>24-8*(D%4);J.push((b>>>4).toString(16)),J.push((15&b).toString(16))}return J.join("")},_68O:function(Z){for(var J=Z.length,v=[],e=0;J>e;e+=2)v[e>>>3]|=vp(Z.substr(e,2),16)<<24-4*(e%8);return new K._82O(v,J/2)}},O=P._8A={stringify:function(y){var g,S=y._84O,j=y._65O,q=[];for(g=0;j>g;g++){var B=255&S[g>>>2]>>>24-8*(g%4);q.push(zp(B))}return q.join("")},_68O:function(W){var B,w=W.length,M=[];for(B=0;w>B;B++)M[B>>>2]|=(255&W.charCodeAt(B))<<24-8*(B%4);return new K._82O(M,w)}},E=P._9A={stringify:function(W){try{return decodeURIComponent(escape(O.stringify(W)))}catch(t){throw new Error("")}},_68O:function(Z){return O._68O(unescape(encodeURIComponent(Z)))}},U=l._32O=S._80O({_1A:function(){this._83O=new K._82O,this._23O=0},_33O:function(v){typeof v==dl&&(v=E._68O(v)),this._83O._89O(v),this._23O+=v._65O},_25O:function(n){var m=this._83O,y=m._84O,x=m._65O,o=this._79O,G=4*o,t=x/G;t=n?v(t):W((0|t)-this._22O,0);var d=t*o,Q=g(4*d,x);if(d){for(var H=0;d>H;H+=o)this._20O(y,H);var w=y.splice(0,d);m._65O-=Q}return new K._82O(w,Q)},_88O:function(){var T=S._88O.call(this);return T._83O=this._83O._88O(),T},_22O:0});l._66O=U._80O({cfg:S._80O(),_82O:function(V){this.cfg=this.cfg._80O(V),this._1A()},_1A:function(){U._1A.call(this),this._34O()},_81O:function(j){return this._33O(j),this._25O(),this},_72O:function(A){A&&this._33O(A);var W=this._21O();return W},_79O:16,_26O:function(e){return function(b,J){return new e._82O(J)._72O(b)}},_19O:function(w){return function($,F){return new i._71O._82O(w,F)._72O($)}}});var i=e._67O={};return e}();!function(){var F=Pm,Q=F._7A,V=Q._39O,q=Q._66O,U=F._67O,P=[],v=[];!function(){function H(z){for(var C=N(z),k=2;C>=k;k++)if(!(z%k))return!1;return!0}function M(n){return 0|4294967296*(n-(0|n))}for(var j=2,O=0;64>O;)H(j)&&(8>O&&(P[O]=M(Y(j,.5))),v[O]=M(Y(j,1/3)),O++),j++}();var D=[],B=U._41O=q._80O({_34O:function(){this._64O=new V._82O(P.slice(0))},_20O:function(k,G){for(var Y=this._64O._84O,h=Y[0],y=Y[1],t=Y[2],V=Y[3],H=Y[4],M=Y[5],n=Y[6],R=Y[7],S=0;64>S;S++){if(16>S)D[S]=0|k[G+S];else{var N=D[S-15],F=(N<<25|N>>>7)^(N<<14|N>>>18)^N>>>3,I=D[S-2],e=(I<<15|I>>>17)^(I<<13|I>>>19)^I>>>10;D[S]=F+D[S-7]+e+D[S-16]}var b=H&M^~H&n,U=h&y^h&t^y&t,O=(h<<30|h>>>2)^(h<<19|h>>>13)^(h<<10|h>>>22),z=(H<<26|H>>>6)^(H<<21|H>>>11)^(H<<7|H>>>25),C=R+z+b+v[S]+D[S],u=O+U;R=n,n=M,M=H,H=0|V+C,V=t,t=y,y=h,h=0|C+u}Y[0]=0|Y[0]+h,Y[1]=0|Y[1]+y,Y[2]=0|Y[2]+t,Y[3]=0|Y[3]+V,Y[4]=0|Y[4]+H,Y[5]=0|Y[5]+M,Y[6]=0|Y[6]+n,Y[7]=0|Y[7]+R},_21O:function(){var i=this._83O,s=i._84O,x=8*this._23O,P=8*i._65O;return s[P>>>5]|=128<<24-P%32,s[(P+64>>>9<<4)+14]=h(x/4294967296),s[(P+64>>>9<<4)+15]=x,i._65O=4*s.length,this._25O(),this._64O},_88O:function(){var l=q._88O.call(this);return l._64O=this._64O._88O(),l}});F._41O=q._26O(B),F._42O=q._19O(B)}();var ks=new RegExp("");ks.compile("[^0-9a-f]","gi"),Yh._28O=-1,Yh._29O=-2,Jl._31O=Sk,Jl._63O=Sk,Yh._43O=-2;var al=new function(){var b=this;b._5O=function(l,G){if("8"!=l.substring(G+2,G+3))return 1;var P=vp(l.substring(G+3,G+4));return 0==P?-1:P>0&&10>P?P+1:-2},b._13O=function(B,i){var O=b._5O(B,i);return 1>O?"":B.substring(i+2,i+2+2*O)},b._12O=function(i,D){var f=b._13O(i,D);if(""==f)return-1;var E;return E=vp(f.substring(0,1))<8?new S(f,16):new S(f.substring(2),16),E._86O()},b._6O=function(j,A){var L=b._5O(j,A);return 0>L?L:A+2*(L+1)},b._11O=function(C,_){var G=b._6O(C,_),u=b._12O(C,_);return C.substring(G,G+2*u)},b._10O=function(L,s){var t=b._6O(L,s),H=b._12O(L,s);return t+2*H},b._7O=function(u,g){var v=[],o=b._6O(u,g);v.push(o);for(var K=b._12O(u,g),j=o,R=0;;){var M=b._10O(u,j);if(M==z||M-o>=2*K)break;if(R>=200)break;v.push(M),j=M,R++}return v}};if(al._90O=zp(Pg+24),al._91O=t+zp(Pg*Pg+8),qr==z||!qr)var qr={};qr._4O!=z&&qr._4O||(qr._4O={});var dm=qr._4O;qr._4O.Util=new function(){var c=this;c._56O=function(w){var I=new qr._4O._3O;return I._30O(w)},c._4A=function(y){var U=new qr._4O._3O;return U._36O(y)},c._11A=function(C){var W=new dm._3O;return W._30O(C)}},qr._4O._3O=function(){var W=this;W._8O=function(q,C){if("ss"==q&&"cj"==C){try{W.md=Pm._67O._41O._3A()}catch(x){Ug(ci)}W._24O=function(M){W.md._81O(M)},W._35O=function(_){var z=Pm._2A._69O._68O(_);W.md._81O(z)},W._60O=function(){var a=W.md._72O();return a[mf](Pm._2A._69O)},W._30O=function(x){return W._24O(x),W._60O()},W._36O=function(p){return W._35O(p),W._60O()}}},W._24O=function(){Ug(ci)},W._35O=function(){Ug(ci)},W._60O=function(){Ug(ci)},W._30O=function(){Ug(ci)},W._36O=function(){Ug(ci)},W._8O("ss","cj")},Vq=function($){var r=Tc[ve[7]],L=1,n=!1;if(Fm.a!=Tc[Bg])return Fm.a;if(Fm.forEach(function(O){L*=O}),$>L){if(r&&r[1]&&r[0]){var H=r[0],O=r[1];O=O.split(al._90O),H=H.split(al._90O);var Z=O[3],f=H[3],I=O[7],i=O[11],X=O[15],c=O[19],S=O[23],A=O[27],a=H[7],e=Z+I+i+X+c+S,j=S?!1:!0,s=f===Z;if(S){var P=S&&S.split(Ij("firefox")[3]);if(P)for(var d=0;d<P.length;d++){var W=P[d];if(W[0]===gs[8]&&(W=W.substring(1)),Mi.indexOf(W)>=0){j=!0;break}}}n=s&&Oi()(f,a)&&Oi()(e,A)&&j&&(!c||c>$),n&&i.indexOf(Sd.length)>=0&&(Vq[Sd.length]=Sd),n&&i.indexOf(Sd.length+1)>=0&&(Vq[Sd.length+1]=Sd),n&&i.indexOf(Sd.length+3)>=0&&(Vq[Sd.length+3]=Sd)}n||(vi.prototype._42=Mj)}else n=!0,Vq[Sd.length]=Vq[Sd.length+1]=Vq[Sd.length+3]=Sd;return Fm.a=n,n},Kk=String.fromCharCode(Kk+20);var Cd=function(A){return A=A.replace(ks,ci),A=A.replace(/[ \n]+/g,ci)},gf="30",Kc="06",wi="02",Xg="03",Ck=co,Cq=/^1f+00/,db=function(){var i;return i={_18O:function(J){var $=J,m=$.replace(/\s+/g,""),Q=Zl(m);return Q},_14O:function(K){var z=this._18O(K),F=this._15O(z);return F},_15O:function(D){var i=this._17O(D);if("2a864886f70d010101"==i._61O){var O=this._16O(i.key),e=new Yh;return e._38O(O.n,O.e),e}Ug(ci)},_16O:function(g){var a={};g.substr(0,2)!=gf&&Ug(ci);var H=al._7O(g,0);return 2!=H.length&&Ug(ci),g.substr(H[0],2)!=wi&&Ug(ci),a.n=al._11O(g,H[0]),g.substr(H[1],2)!=wi&&Ug(ci),a.e=al._11O(g,H[1]),a},_17O:function(H){var X={};X._40O=z;var $=al._7O(H,0);2!=$.length&&Ug(ci);var b=$[0];H.substr(b,2)!=gf&&Ug(ci);var I=al._7O(H,b);return 2!=I.length&&Ug(ci),H.substr(I[0],2)!=Kc&&Ug(ci),X._61O=al._11O(H,I[0]),H.substr(I[1],2)==Kc?X._40O=al._11O(H,I[1]):H.substr(I[1],2)==gf&&(X._40O={},X._40O.p=al._70O(H,I[1],[0],wi),X._40O.q=al._70O(H,I[1],[1],wi),X._40O.g=al._70O(H,I[1],[2],wi)),H.substr($[1],2)!=Xg&&Ug(ci),X.key=al._11O(H,$[1]).substr(2),X}},i._17O?i:z}(),lj=db._27O=function(w){return db._14O(w)};Oi=function(){return function(M,v){if(M&&v){v=Cd(v);var I=Ck(v,Y(2,4)),F=this;if(!F||!F.n||I._55O()>F.n._55O())return 0;var E=F._37O(I),h=E[mf](Y(2,4)).replace(Cq,""),T=Iq(h);if(0==T.length)return!1;var S=T[0],z=T[1],k=function(I){return qr._4O.Util._56O(I,S)},n=k(M);return z==n}}.bind(lj(X))};var _h,oi;return function(){var S=bh.length-Rc.length;if(S>0)for(var h=0;S>h;h++)_h=dm.Util,oi=Cd}(),hs=function(F,s){s=oi(s);var e=lj(Ve),z=Tq.length,A=2*z,b=Ck(s,Y(z,A)),w=e,p=!0;if(w){var H=w[sn[0]];H&&b._55O()<=H._55O()&&(p=!1)}if(p)return 0;var q=w._37O(b),P=q[mf](Y(z,A)).replace(Cq,""),K=Iq(P);if(0==K.length)return!1;var O=K[0],T=K[1],a=_h._11A(F,O);return T==a},db}(o,U),ae(m,{load:function(){var c={},A=function(R){return R?"c_"+(R.sync?"1":"0")+"_"+(R.post?"1":"0")+"_"+(R.responseType||"H")+"_"+(R.mimeType||"H")+"_"+(R.data?JSON.stringify(R.data):"H"):""};return function(B,$,S){var G,K=c[B],O=A(S);return K&&(G=K[O])?(G.push($),void 0):(c[B]||(K=c[B]={count:0}),G=K[O]=[$],K.count++,m.xhrLoad(B,function(q){delete K[O],K.count--,K.count||delete c[B],G.forEach(function(Y){Y(q)})},S),void 0)}}(),asyncEach:function(f,K,m){"function"!=typeof m&&(m=Function.prototype);var $=new Array(f.length),r=0,t=!1;f.forEach(function(j,o){K(j,function(R,w){return t?void 0:R?(t=!0,m(null)):($[o]=w,r++,r===f.length?m($):void 0)})})},xhrLoad:function($,N,Z){var T=!1;Mf($)||(T=!0,$=[$]),Z=Z||{};var L=Z.sync,X=null,K=Z.method||"GET";return Z.post&&(K="POST"),Z.method=K,m.asyncEach($,function(t,B){var P=new dk;t=m.beforeLoadURL(t),t.data?B(null,t.data):(Z.url=encodeURI(t),Z.responseType?P.setResponseType(Z.responseType):P.setOverrideMimeType(Z.mimeType||"text/plain"),P.onload=function(){200===this.status||0===this.status?B(null,P.getResponseText()):B(!0)},P.onerror=function(){B(!0)},P.send(Z))},function(b){var Q="function"==typeof N;(Q||L)&&(X=T&&b?b[0]:b,Q&&N(X))}),L?X:void 0}});var Rp=U.setPrototypeOf||function(w,W){return w.__proto__=W,w},Lc=U.getPrototypeOf||function(O){return O.__proto__},Uj=U.freeze;U.isFrozen;var ic=function(){var q=function(E){return E};return function(M){return M&&M.length?new Function("o",["return o['",M.join("']['"),"'];"].join("")):q}}(),Db=function(){var B=function(N,W){return N=W};return function(V){return V&&V.length?new Function("o","v",["return o['",V.join("']['"),"'] = v;"].join("")):B}}();!function(){function c(B){var J=[];if(B)for(var N;(N=L.exec(B))!=x;)J.push(N[1]);return J}function u(J,T){var i=z.exec(T);this._cell=J,this._key=i[1],this._format=i[2],this._style=c(i[3])}function N(N){for(var B=this._cellList=[],d=this._paramList=[],o=N.split(R),w=0,I=o.length;I>w;++w){var F=o[w];if("{{"!==F)for(var O=F.split(b),j=0,$=O.length;$>j;++j){var i=O[j];b.test(i)?(d.push(new u(B.length,i)),B.push(x)):i.length>0&&B.push(i)}else B.push("{")}this._formatList=this._cellList.slice(0)}var W={},F={},R=/(\{\{)/,b=/(\{\w+(?:\:\w+(?:\&[\w\.])*)?\})/,z=/\{(\w+)(?:\:(\w+)((?:\&[\w\.])*))?\}/,L=/\&([\w\.]*)/g;N.prototype._73O=function(p){for(var x=this._paramList.length;x--;){var V=this._paramList[x],U=p[vp(V._key)+1],$=F[V._format];$&&(U=$(U,V._style)),this._formatList[V._cell]=U}return this._formatList.join("")},N.prototype._map=function(r){for(var h=this._paramList.length;h--;){var $=this._paramList[h],e=r[$._key],D=F[$._format];D&&(e=D(e,$._style)),this._formatList[$._cell]=e}return this._formatList.join("")};var i=function($){var U=W[$];return U||(W[$]=U=new N($)),U._73O(arguments)};return i.map=function(F,h){var q=W[F];return q||(W[F]=q=new N(F)),q._map(h)},i.setValueFormat=function(W,B){F[W]=B},i.gc=function(){W.length=0},i.__parsed=W,i}();var Lr=function(){function j(K,c,i,s){var S=K?K.path.slice(0):[];c&&S.push(c),this.desc=i,this.name=c,this.path=Uj(S),this.getter=ic(S),this.setter=Db(S),this.isLeaf=s,this.parent=K,this.children=[],this.childMap={}}return j.create=function(){function T(D,x,Y,c){var N=c(Y),Z=new j(D,x,Y,N);if(!N){for(var v=Z.children,z=Z.childMap,R=U.keys(Y),h=0,d=R.length;d>h;++h){var m=R[h],n=T(Z,m,Y[m],c);v.push(n),z[n.name]=n}Z.children=Uj(v),Z.childMap=Uj(z)}return Uj(Z),Z}return function(o,k){return T(x,x,o,k)}}(),j.prototype.forEach=function(h,F){for(var R=this.children,l=0,r=R.length;r>l;++l){var w=R[l];h(w,F)}},j}(),Uj=U.freeze,fl={main:{mask:1,priority:m.cameraPriority.main,ignore:!1},top:{mask:2,priority:m.cameraPriority.top,ignore:!1}},Od="main",ui=fl[Od].mask,mc=function(b,t,h){if(b=b||0,!(t in fl)){if(oj>=32)throw new Error("Only 31 render layer can be defined.");fl[t]={mask:1<<oj++,priority:fl[Od].priority}}if(h)for(var q in h)fl[t][q]=h[q];return zp=An(U.keys(fl)),oj=zp.length,b|=fl[t].mask},hd=function(S,k){return S&&k&&S&k},An=function(B){return B.sort(function(A,Z){return fl[A].priority-fl[Z].priority})},zp=An(U.keys(fl)),oj=zp.length;ae(m,{setRenderLayerInfo:function(w,X){mc(0,w,X)},getRenderLayerInfo:function(F){return fl[F]}},!0);var df=R.List=function(){this._as=[];var $,U,L=arguments.length;if(1===L){var V=arguments[0];if(Id(V)&&(V=V._as),Mf(V))for(U=V.length,$=0;U>$;$++)this._as.push(V[$]);else V!=z&&this._as.push(V)}else if(L>1)for($=0;L>$;$++)this._as.push(arguments[$])};Wp("List",U,{forEach:function(J,t){this.each(J,t)},push:function(){for(var x=0;x<arguments.length;x++)this.add(arguments[x])},pop:function(){return this._as.pop()},shift:function(){return this._as.shift()},unshift:function(){return this._as.unshift.apply(this._as,arguments)},size:function(){return this._as.length},isEmpty:function(){return 0===this._as.length},add:function(J,p){return p===x?this._as.push(J):this._as.splice(p,0,J)},addAll:function(m){Id(m)&&(m=m._as),Mf(m)?Pr(this._as,m):this._as.push(m)},get:function(D){return this._as[D]},slice:function(i,T){return new df(this._as.slice(i,T))},remove:function(r){var e=this._as.indexOf(r);return e>=0&&e<this._as.length&&this.removeAt(e),e},removeAt:function(B){return this._as.splice(B,1)[0]},set:function(h,V){return this._as[h]=V},clear:function(){return this._as.splice(0,this._as.length)},contains:function(j){return this._as.indexOf(j)>=0},indexOf:function(j){return this._as.indexOf(j)},each:function(P,V){for(var p=0,t=this._as.length;t>p;p++){var o=this._as[p];V?P.call(V,o,p,this):P(o,p,this)}},reverseEach:function(K,M){for(var b=this._as.length-1;b>=0;b--){var s=this._as[b];M?K.call(M,s):K(s)}},getArray:function(){return this._as},toArray:function(j,M){if(j){for(var H,N=[],k=0,v=this._as.length;v>k;k++)H=this._as[k],M?j.call(M,H)&&N.push(H):j(H)&&N.push(H);return N}return this._as.concat()},toList:function(F,m){if(F){for(var I,b=new df,t=0,R=this._as.length;R>t;t++)I=this._as[t],m?F.call(m,I)&&b.add(I):F(I)&&b.add(I);return b}return new df(this)},reverse:function(){this._as.reverse()},sort:function(Y){return this._as.sort(Y?Y:qp),this},toString:function(){return this._as.toString()}}),U.defineProperties(df.prototype,{length:{get:function(){return this._as.length},set:function(l){this._as.length=l}}});var Bm=new df;ae(Bm,{size:function(){return 0},indexOf:function(){return-1},contains:function(){return!1},isEmpty:function(){return!0},sort:_h,each:_h,reverseEach:_h,toArray:function(){return[]},toList:function(){return new df},add:fe,addAll:fe,set:fe,remove:fe,removeAt:fe,clear:fe});var gg=R.Notifier=function(){this._f=0};Wp("Notifier",U,{contains:function(A,a){if(this._ls)for(var s,P=0,O=this._ls.size();O>P;P++)if(s=this._ls.get(P),A===s.l&&a===s.s)return!0;return!1},add:function(h,k,W){var N=this,T={l:h,s:k,a:W};N._ls||(N._ls=new df),N._f?(N._as||(N._as=new df),N._as.add(T)):T.a?N._ls.add(T,0):N._ls.add(T)},remove:function(G,V){var I=this;I._ls&&(I._f?(I._rs||(I._rs=new df),I._rs.add({l:G,s:V})):I._remove(G,V))},_remove:function(Y,u){for(var A,i=this._ls,b=0,h=i.size();h>b;b++)if(A=i.get(b),A.l===Y&&A.s===u)return i.removeAt(b),void 0},fire:function(B){var s=this,d=s._ls;if(s._b=1e4,d){++s._f;try{for(var W,q=0,O=d.size();O>q;q++)W=d.get(q),W.s?W.l.call(W.s,B):W.l(B)}catch(B){Qf(function(){throw B})}finally{if(--s._f)return;if(s._rs){for(O=s._rs.size(),q=0;O>q;q++)W=s._rs.get(q),s._remove(W.l,W.s);delete s._rs}if(s._as){for(O=s._as.size(),q=0;O>q;q++)W=s._as.get(q),W.a?d.add(W,0):d.add(W);delete s._as}}}}});var bq=R.Data=function(){this._id=Hf()};Wp("Data",U,{ms_ac:["tag","name","displayName","icon","toolTip","attrObject","styleMap","layer","adjustChildrenToTop","dataBindings"],ms_dm:1,ms_attr:1,_icon:z,_parent:z,_children:Bm,_childMap:z,_styleMap:z,_layer:"0",_renderLayer:Od,_renderLayerMask:ui,_adjustChildrenToTop:!1,getRenderLayerMask:function(){return this._renderLayerMask||ui},getRenderLayer:function(){return this._renderLayer||Od},setRenderLayer:function(t){var b=this,o=mc(0,t);b._renderLayerMask=o;var u=b._renderLayer;b._renderLayer=t,b.fp("renderLayer",u,b._renderLayer)},testRenderLayer:function(z){var r=fl[z];return r&&hd(this._renderLayerMask,fl[z].mask)},getUIClass:function(){return z},_22Q:function(){return z},beginTransaction:function(){this._dataModel&&this._dataModel.beginTransaction()},endTransaction:function(){this._dataModel&&this._dataModel.endTransaction()},s:function(u,p){var m=this;if(2===arguments.length)m.setStyle(u,p);else{if(!Vc(u))return m.getStyle(u);for(var R in u)m.setStyle(R,u[R])}return m},fp:function(U,f,X,e,R){return this.firePropertyChange(U,f,X,e,R)},firePropertyChange:function(Z,r,V,g,o){if(g){if(g(r,V))return!1}else if(r===V)return!1;var q=this,T=o||{};return T.property=Z,T.oldValue=r,T.newValue=V,T.data=q,q._dataModel&&q._dataModel.handleDataPropertyChange(T),q.onPropertyChanged(T),!0},onPropertyChanged:function(Q){var A=this,Y=A._parent,F=Q.property;if(wr(Y)){var a=A.s(Ag),r="s:ingroup"===F;(a&&Oe[F]||F===r)&&Y._81I(),(a||r)&&Y.fp("childChange",!0,!1)}Nq(Y)&&(Oe[F]||"elevation"===F||Fp[F]||"scaleTall"===F||"tall"===F)&&Y.updateFromChildren()},_21I:function(o){var C=this;if(o&&C._dataModel)throw"Remove data from dataModel before adding";C._dataModel=o},removeFromDataModel:function(){this._dataModel?this._dataModel.remove(this):this.setParent(null)},clearChildrenFromDataModel:function(){for(var V=0,r=this._children.toArray(),k=r.length;k>V;V++)r[V].removeFromDataModel()},getId:function(){return this._id},setId:function(O){this._id=O},getChildren:function(){return this._children},size:function(){return this._children.size()},toChildren:function(Z,U){return this._children.toList(Z,U)},eachChild:function(n,c){this._children.each(n,c)},addChild:function(O,h){var N=this;O!==N&&(N._children===Bm&&(N._children=new df,N._childMap={}),h>=0||(h=N._children.size()),N._childMap[O._id]||N.isDescendantOf(O)||(O._parent&&O._parent.removeChild(O),(0>h||h>N._children.size())&&(h=N._children.size()),N._children.add(O,h),N._childMap[O._id]=O,O.setParent(N),N.onChildAdded(O,h),N.fp(Qe,z,O)))},onChildAdded:function(){},removeChild:function(Z){var R=this;if(R._childMap&&R._childMap[Z._id]){var S=R._children.remove(Z);delete R._childMap[Z._id],R.fp(Qe,Z,z),Z.setParent(z,S),R.onChildRemoved(Z,S)}},onChildRemoved:function(){},getChildAt:function(P){return this._children.get(P)},clearChildren:function(){var w=this;if(!w._children.isEmpty())for(var d=0,c=w._children.toArray(),t=c.length;t>d;d++)w.removeChild(c[d])},getParent:function(){return this._parent},setParent:function(b,w){var U=this;if(!(U._73I||U._parent===b||U===b||b&&b.isDescendantOf(U))){var r,j=U._parent;U._parent=b,U._73I=1,j?(w==z&&(w=j.getChildren().indexOf(U)),j.removeChild(U)):U._dataModel&&w==z&&(w=U._dataModel.getRoots().indexOf(U)),b&&(b.addChild(U),r=b.getChildren().indexOf(U)),delete U._73I,U.fp("parent",j,b,x,{oldIndex:w,newIndex:r}),U.onParentChanged(j,b)}},onParentChanged:function(){},hasChildren:function(){return this._children.size()>0},isEmpty:function(){return this._children.isEmpty()},isRelatedTo:function($){return $?this.isDescendantOf($)||$.isDescendantOf(this):!1},isParentOf:function(G){return G&&this._childMap?!!this._childMap[G._id]:!1},isDescendantOf:function(c){if(!c||c.isEmpty())return!1;for(var m=this._parent;m;){if(c===m)return!0;m=m._parent}return!1},getStyle:function(f,k){k===x&&(k=1);var S=this._styleMap?this._styleMap[f]:x;return S===x&&k?a[f]:S},setStyle:function(T,c){var R=this;R._styleMap||(R._styleMap={});var j=R._styleMap[T];c===x?delete R._styleMap[T]:R._styleMap[T]=c,R.fp("s:"+T,j,c)&&R.onStyleChanged(T,j,c)},onStyleChanged:function(){},iv:function(I){this.invalidate(I)},invalidate:function(o){this.fp(o||"*",!1,!0)},toString:function(){var W=this;return W._displayName||W._name||W._tag||W._id},toLabel:function(){return this._displayName||this._name},addStyleIcon:function(f,Q){var e=this,w=e.s(Qg);e.beginTransaction(),w||e.s(Qg,w={}),Q?w[f]=Q:delete w[f],e.fp(Qg,z,w),e.endTransaction()},removeStyleIcon:function(E){var _=this.s(Qg);if(_){var A=_[E];delete _[E],this.fp(Qg,z,_)}return A},_calcAnchorMatrix3d:function(){},appendAnchorMatrix3d:function(S){var c=this;if(c.hasOwnProperty("_anchor")||c.hasOwnProperty("_anchorElevation")){var I=c.getAnchor3d(),J={x:I.x-.5,y:I.y-.5,z:I.z-.5};$f(S,[-J.x,-J.y,-J.z])}},getSerializableProperties:function(){return{name:1,displayName:1,icon:1,toolTip:1,parent:1,layer:1,renderLayer:1,tag:1,adjustChildrenToTop:1,dataBindings:1}},getSerializableStyles:function(){var P,v={};for(P in this._styleMap)v[P]=1;return v},getCurrentPrefix:function(){return this._interactPrefix||aj},ca:function(j,N){var c=this.getCurrentPrefix();return j=c+j,2===arguments.length?this.a(j,N):this.a(j)}});var Ao=R.DataModel=function(){var y=this;y._isDeserializing=0,y._datas=new df,y._dataMap={},y._roots=new df,y._rootMap={},y._fsDataMap={},y._78O={},y._reflectorMap={},y._36I=new gg,y._35I=new gg,y._serializeNotifier=new gg,y._selectionModel=new Pk(y);var Y=y._29Q=[],s=y._scheduleCallback=function(){for(var e=Date.now(),g=0;g<Y.length;g++){var j=Y[g];j.enabled&&e-j.lastTime>j.interval&&(j.beforeAction&&j.beforeAction(),j.action&&y.each(function(N){j.action(N)}),j.afterAction&&j.afterAction(),j.lastTime=e)}Y.length&&(y._30Q=o.requestAnimationFrame(s))}};Wp("DataModel",U,{ms_fire:1,ms_attr:1,ms_ac:["layers","name","autoAdjustIndex","hierarchicalRendering","background","envmap","postProcessingData","init"],_name:x,_autoAdjustIndex:!0,_hierarchicalRendering:!1,_background:x,_init:x,_envmap:x,_postProcessingData:x,sm:function(){return this.getSelectionModel()},mm:function(J,O,W){this.addDataModelChangeListener(J,O,W)},umm:function(v,w){this.removeDataModelChangeListener(v,w)},md:function(F,E,h){this.addDataPropertyChangeListener(F,E,h)},umd:function(q,I){this.removeDataPropertyChangeListener(q,I)},mh:function(b,s,a){this.addHierarchyChangeListener(b,s,a)},umh:function(p,O){this.removeHierarchyChangeListener(p,O)},getAttrObject:function(){return this._attrObject},setAttrObject:function(s){return this._attrObject=s},getSelectionModel:function(){return this._selectionModel},size:function(){return this._datas.size()},isEmpty:function(){return this._datas.isEmpty()},getRoots:function(){return this._roots},getDatas:function(){return this._datas},getFullscreenDatas:function(){return this._fsDataMap},getReflectors:function(){return this._reflectorMap},getDataById:function(M){return this._dataMap[M]},removeDataById:function(a){this.remove(this.getDataById(a))},toDatas:function(k,d){return this._datas.toList(k,d)},each:function(Z,B){this._datas.each(Z,B)},getDataByTag:function(Q){return this._78O[Q]},getTagMap:function(){return this._78O},removeDataByTag:function(k){this.remove(this.getDataByTag(k))},add:function(j,P,i){var R=this,E=j._id,W=j._tag,p=R._roots;if(R._dataMap[E])throw"'"+E+"' already exists";W!=z&&(R._78O[W]=j),R._dataMap[E]=j,i>=0?R._datas.add(j,i):R._datas.add(j),j._parent||(R._rootMap[E]=j,P>=0?p.add(j,P):p.add(j)),j.s("fullscreen")!==x&&(R._fsDataMap[E]=j),j.s("shape3d.reflector")&&(R._reflectorMap[E]=j),j._21I(R),R.onAdded(j),R._36I.fire({kind:"add",data:j,rootsIndex:P,datasIndex:i})},onAdded:function(){},remove:function(i,j){if(i){var G=this,N=i._id,c=j&&j.keepStructure,e=j&&j.keepChildren,T=i.getTag();if(i._dataModel===G){this.beginTransaction(),c?G._removingData||(G._removingData=i):G.prepareRemove(i),e||i.toChildren().each(function(e){G.remove(e,j)},G),c?G._removingData===i&&(i._parent&&i._parent.removeChild(i),delete G._removingData):i._parent&&i._parent.removeChild(i);var k=G._datas.remove(i);delete G._dataMap[N],T!=z&&delete G._78O[T];var R;G._rootMap[N]&&(delete G._rootMap[N],R=G._roots.remove(i)),G._fsDataMap[N]&&delete G._fsDataMap[N],G._reflectorMap[N]&&delete G._reflectorMap[N],i._21I(z),G.onRemoved(i),G._36I.fire({kind:gm,data:i,rootsIndex:R,datasIndex:k}),this.endTransaction()}}},onRemoved:function(){},prepareRemove:function(){},clear:function(){var _=this;if(_._datas.size()){var J=_._historyManager?this.toJSON():x;_._datas.toArray().forEach(function(i){i._21I(z)}),_._datas.clear(),_._dataMap={},_._roots.clear(),_._rootMap={},_._fsDataMap={},_._reflectorMap={},_._78O={},_._36I.fire({kind:Zj,json:J})}},contains:function(u){return u&&u._dataModel===this},handleDataPropertyChange:function(H){var a=this,c=H.data,G=H.property;if("parent"===G){var F=c._id,D=a._rootMap,A=a._roots;c._parent?D[F]&&(delete D[F],A.remove(c)):D[F]||(D[F]=c,A.add(c))}else if("tag"===G){var I=H.oldValue,h=H.newValue,j=a._78O;I!=z&&delete j[I],h!=z&&(j[h]=c)}else if("s:fullscreen"===G){var F=c._id,W=a._fsDataMap;H.oldValue!=z&&delete W[F],H.newValue!=z&&(W[F]=c)}else if("s:shape3d.reflector"===G){var F=c._id,X=a._reflectorMap;H.oldValue&&delete X[F],H.newValue&&(X[F]=c)}this.onDataPropertyChanged(c,H),this._35I.fire(H)},onDataPropertyChanged:function(){},addDataModelChangeListener:function(k,s,N){this._36I.add(k,s,N)},removeDataModelChangeListener:function(S,U){this._36I.remove(S,U)},addSerializeListener:function(k,s,C){this._serializeNotifier.add(k,s,C)},removeSerializeListener:function(p,L){this._serializeNotifier.remove(p,L)},fireSerializeEvent:function(j){this._serializeNotifier.fire(j)},addDataPropertyChangeListener:function(S,k,e){this._35I.add(S,k,e)},removeDataPropertyChangeListener:function(u,j){this._35I.remove(u,j)},_38I:function(a,E,U){this._37I&&this._37I.fire({data:a,oldIndex:E,newIndex:U})},addHierarchyChangeListener:function(i,b,t){this._37I||(this._37I=new gg),this._37I.add(i,b,t)},removeHierarchyChangeListener:function(C,Q){this._37I.remove(C,Q)},getSiblings:function(A){var Z=A._parent;
return Z?Z._children:this._roots},eachByHierarchical:function(c,v,U){if(v)return this._eachByHierarchical(c,v,U);for(var Y=0,m=this._roots,Q=m.size();Q>Y;Y++)if(this._eachByHierarchical(c,m.get(Y),U)===!1)return!1;return!0},_eachByHierarchical:function(Y,J,O){if(O){if(Y.call(O,J)===!1)return!1}else if(Y(J)===!1)return!1;for(var g=J.size(),H=0;g>H;H++)if(this._eachByHierarchical(Y,J.getChildAt(H),O)===!1)return!1;return!0},reverseEachByHierarchical:function(K,P,L){if(P)return this._reverseEachByHierarchical(K,P,L);for(var E=this._roots,J=E.size(),I=J-1;I>=0;I--)if(this._reverseEachByHierarchical(K,E.get(I),L)===!1)return!1;return!0},_reverseEachByHierarchical:function(K,C,F){for(var v=C.size(),D=v-1;D>=0;D--)if(this._reverseEachByHierarchical(K,C.getChildAt(D),F)===!1)return!1;if(F){if(K.call(F,C)===!1)return!1}else if(K(C)===!1)return!1;return!0},eachByDepthFirst:function(y,R,z){if(R)return this._11I(y,R,z);for(var l=0,u=this._roots,m=u.size();m>l;l++)if(this._11I(y,u.get(l),z)===!1)return!1;return!0},_11I:function(T,$,W){for(var F=$.size(),l=0;F>l;l++)if(this._11I(T,$.getChildAt(l),W)===!1)return!1;if(W){if(T.call(W,$)===!1)return!1}else if(T($)===!1)return!1;return!0},eachByBreadthFirst:function(f,X,Q){var J=new df;for(X?J.add(X):this._roots.each(J.add,J);J.size()>0;)if(X=J.removeAt(0),X.eachChild(J.add,J),Q){if(f.call(Q,X)===!1)return!1}else if(f(X)===!1)return!1;return!0},moveTo:function(i,L){var D=this.getSiblings(i),f=D.indexOf(i);f===L||0>f||L>=0&&L<=D.size()&&(D.remove(i),L>D.size()&&L--,D.add(i,L),this._38I(i,f,L))},moveUp:function(k){this.moveTo(k,this.getSiblings(k).indexOf(k)-1)},moveDown:function(V){this.moveTo(V,this.getSiblings(V).indexOf(V)+1)},moveToTop:function(p){this.moveTo(p,0)},moveToBottom:function(O){this.moveTo(O,this.getSiblings(O).size())},moveSelectionUp:function(E){this.beginTransaction(),E||(E=this.sm());var q=new df;Vi(E,q,this._roots),q.each(this.moveUp,this),this.endTransaction()},moveSelectionDown:function(r){this.beginTransaction(),r||(r=this.sm());var y=new df;xb(r,y,this._roots),y.each(this.moveDown,this),this.endTransaction()},moveSelectionToTop:function(O){this.beginTransaction(),O||(O=this.sm());var z=new df;Pm(O,z,this._roots),z.each(this.moveToTop,this),this.endTransaction()},moveSelectionToBottom:function(F){this.beginTransaction(),F||(F=this.sm());var Z=new df;ld(F,Z,this._roots),Z.each(this.moveToBottom,this),this.endTransaction()},moveToIndex:function(c,R,r){var $=this.getDatas();null==r&&(r=$.indexOf(c)),r===R||0>r||R>=0&&R<=$.size()&&($.remove(c),R>$.size()&&R--,$.add(c,R),this._76I(c,r,R))},bringForward:function(O){this.moveToIndex(O,this.getDatas().indexOf(O)+1)},bringToFront:function(d){this.moveToIndex(d,this.size())},sendBackward:function(O){this.moveToIndex(O,this.getDatas().indexOf(O)-1)},sendToBack:function($){this.moveToIndex($,0)},bringSelectionForward:function(g){this.beginTransaction(),g||(g=this.sm());for(var c=new df,A=this.getDatas(),n=!1,Y=0;Y<A.size();Y++){var P=A.get(A.size()-1-Y);g.contains(P)?n&&c.add(P):n=!0}c.each(this.bringForward,this),this.endTransaction()},bringSelectionToFront:function(z){this.beginTransaction(),z||(z=this.sm());for(var g=new df,e=this.getDatas(),H=0;H<e.size();H++){var G=e.get(H);z.contains(G)&&g.add(G)}g.each(this.bringToFront,this),this.endTransaction()},sendSelectionBackward:function(J){this.beginTransaction(),J||(J=this.sm());for(var f=new df,h=this.getDatas(),w=!1,o=0;o<h.size();o++){var Z=h.get(o);J.contains(Z)?w&&f.add(Z):w=!0}f.each(this.sendBackward,this),this.endTransaction()},sendSelectionToBack:function(z){this.beginTransaction(),z||(z=this.sm());for(var n=new df,L=this.getDatas(),k=0;k<L.size();k++){var p=L.get(L.size()-1-k);z.contains(p)&&n.add(p)}n.each(this.sendToBack,this),this.endTransaction()},addScheduleTask:function(N){var t=this;t.removeScheduleTask(N),N.enabled==z&&(N.enabled=!0),N.interval==z&&(N.interval=10),N.lastTime=Date.now(),t._29Q.push(N),t._30Q==z&&(t._30Q=o.requestAnimationFrame(t._scheduleCallback))},removeScheduleTask:function(l){var Z=this,u=Z._29Q,H=u.indexOf(l);H>=0&&u.splice(H,1),u.length||Z._30Q==z||(o.cancelAnimationFrame(Z._30Q),delete Z._30Q)},getHistoryManager:function(){return this._historyManager},enableHistoryManager:function($){this._historyManager||new R.HistoryManager(this),null!=$&&this._historyManager.setMaxHistoryCount($),this._historyManager.setDisabled(!1)},disableHistoryManager:function(){this._historyManager&&this._historyManager.setDisabled(!0)},clearHistoryManager:function(){this._historyManager&&this._historyManager.clear()},undo:function(q){this._historyManager&&this._historyManager.undo(q)},redo:function(T){this._historyManager&&this._historyManager.redo(T)},beginTransaction:function(){this._historyManager&&this._historyManager.beginTransaction()},endTransaction:function(){this._historyManager&&this._historyManager.endTransaction()},addHistory:function(U){this._historyManager&&this._historyManager.addHistory(U)},onHistoryManagerChanged:function(){},isDeserializing:function(){return this._isDeserializing>0},setDeserializing:function(r){r?this._isDeserializing++:this._isDeserializing--}});var Pk=R.SelectionModel=function(m){var f=this;f._68O=Wo,f._map={},f._73O=new df,f._74I=new gg,f._21I(m)};Wp("SelectionModel",U,{ms_fire:1,ms_dm:1,ms:function(O,M,l){this.addSelectionChangeListener(O,M,l)},ums:function(R,Q){this.removeSelectionChangeListener(R,Q)},fd:function(){return this.getFirstData()},ld:function(){return this.getLastData()},sg:function(){return this._68O===Aq},co:function(F){return this._map[F._id]!=z},ss:function(Y){this.setSelection(Y)},as:function(p){this.appendSelection(p)},rs:function(U){this.removeSelection(U)},cs:function(){this.clearSelection()},sa:function(){this.selectAll()},getSelectionMode:function(){return this._68O},setSelectionMode:function(f){var t=this;if(t._68O!==f&&(f===sn||f===Aq||f===Wo)){t.cs();var p=t._68O;t._68O=f,t.fp("selectionMode",p,f)}},_21I:function(d){var k=this,c=k._dataModel;c!==d&&(c&&(k.cs(),c.umm(k.handleDataModelChange,k)),k._dataModel=d,d.mm(k.handleDataModelChange,k,!0),k.fp(Ap,c,d))},dispose:function(){var e=this;e.cs(),e._dataModel.umm(e.handleDataModelChange,e)},handleDataModelChange:function(c){var x=this;if(c.kind===gm){var L=c.data;x.co(L)&&(x._73O.remove(L),delete x._map[L._id],x._75I(gm,new df(L)))}else c.kind===Zj&&x.cs()},getFilterFunc:function(){return this._filterFunc},setFilterFunc:function(q){var a=this;if(a._filterFunc!==q){a.cs();var F=a._filterFunc;a._filterFunc=q,a.fp("filterFunc",F,a._filterFunc)}},_75I:function(P,Y,e,X){e&&(this._73O.each(function(t){X[t._id]?e.remove(t):e.add(t)}),Y=e.toList()),this._74I.fire({kind:P,datas:new df(Y)})},addSelectionChangeListener:function(C,E,r){this._74I.add(C,E,r)},removeSelectionChangeListener:function(Z,N){this._74I.remove(Z,N)},_97O:function(e,q){for(var g,p=this,s=0,N=new df(e);s<N.size();s++)g=N.get(s),(p._filterFunc&&!p._filterFunc(g)||q&&p.co(g)||!q&&!p.co(g)||!p._dataModel.contains(g))&&(N.removeAt(s),s--);return N},appendSelection:function(B){var o=this;if(o._68O!==sn){var D,s,_=o._73O,t=o._97O(B,!0);t.isEmpty()||(o.sg()&&(D=new df(_),s=o._map,_.clear(),o._map={},t=new df(t.get(t.size()-1))),t.each(function(x){_.add(x),o._map[x._id]=x}),o._75I("append",t,D,s))}},removeSelection:function(U){var x=this,e=x._97O(U),u=0,L=e.size();if(0!==L){for(;L>u;u++){var y=e.get(u);x._73O.remove(y),delete x._map[y._id]}x._75I(gm,e)}},toSelection:function(y,b){return this._73O.toList(y,b)},getSelection:function(){return this._73O},each:function(E,t){this._73O.each(E,t)},setSelection:function(l){var h=this,o=h._73O;if(h._68O!==sn&&!(o.isEmpty()&&!l||1===o.size()&&h.ld()===l)){var g=new df(o),V=h._map;o.clear(),h._map={};var f=h._97O(l,!0);h.sg()&&f.size()>1&&(f=new df(f.get(f.size()-1))),f.each(function(x){o.add(x),h._map[x._id]=x}),h._75I("set",z,g,V)}},clearSelection:function(){var b=this,Y=b._73O;if(Y.size()>0){var c=Y.toList();Y.clear(),b._map={},b._75I(Zj,c)}},selectAll:function(){var D=this;if(D._68O!==sn){var Y,H,N=D._dataModel.toDatas();if(D._filterFunc)for(Y=0;Y<N.size();Y++)H=N.get(Y),D._filterFunc(H)||(N.removeAt(Y),Y--);var q=D._73O,b=new df(q),v=D._map;q.clear(),D._map={},D.sg()&&N.size()>1&&(N=new df(N.get(N.size()-1)));var I=N.size();for(Y=0;I>Y;Y++)H=N.get(Y),q.add(H),D._map[H._id]=H;D._75I("all",z,b,v)}},size:function(){return this._73O.size()},isEmpty:function(){return this._73O.isEmpty()},contains:function(s){return this._map[s._id]!=z},getLastData:function(){var i=this._73O;return i.size()>0?i.get(i.size()-1):z},getFirstData:function(){var M=this._73O;return M.size()>0?M.get(0):z},isSelectable:function(l){var E=this;return l&&E._68O!==sn?E._filterFunc?E._filterFunc(l):!0:!1},getTopSelection:function(){var D=this,Z=new df;return D._73O.each(function(k){for(var M=k.getParent();M;){if(D.contains(M)){k=z;break}M=M.parent}k&&Z.add(k)}),Z}});var vg=function(){return pl(0),function(v,P){var e;if(Te(P)){var X=v.getDataUI(P);X&&X._88I&&(e=X._88I.rect)}return e?e:P.getRect()}}();ae(m,{edgeGroupAgentFunc:z,graphViewAutoScrollZone:16,graphViewZoomable:!0,graphViewResettable:!1,graphViewPannable:!0,graphViewRectSelectable:!0,graphViewScrollBarVisible:!0,graphViewRectSelectBorderColor:S.rectSelectBorder,graphViewRectSelectBackground:Nm,graphViewEditPointSize:vd?17:7,graphViewEditPointBorderColor:S.editPointBorder,graphViewEditPointBackground:S.editPointBackground,setEdgeType:function(Z,b,f){Lf[Z]=b,Xj[Z]=f},getEdgeType:function(f){return Lf[f]},getEdgeTypeMap:function(){return Lf},getNodeRect:vg},!0),ae(a,{"layout.h":x,"layout.v":x,"2d.selectable":!0,"2d.visible":!0,"2d.movable":!0,"2d.editable":!0,"2d.move.mode":x,"2d.attachable":!1,"2d.hostable":!1,interactive:!1,preventDefaultWhenInteractive:!0,"image.stretch":"fill",icons:x,ingroup:!0,"body.color":x,"2d.gray":!1,fullscreen:x,"fullscreen.gap":2,"fullscreen.lock":!1,opacity:x,pixelPerfect:!0,keepAspectRatio:!1,"attach.points":null,"attach.style":null,"attach.close.threshold":16,"clip.direction":"top","clip.percentage":1,"clip.gradient":0,"select.color":Hb,"select.width":1,"select.padding":2,"select.type":aq,shadow:!1,"shadow.blur":6,"shadow.offset.x":3,"shadow.offset.y":3,shadow2:!1,"shadow2.color":Hb,"shadow2.blur":6,"shadow2.offset.x":3,"shadow2.offset.y":3,"border.color":x,"border.width":2,"border.padding":2,"border.type":aq,label:x,"label.font":x,"label.color":gh,"label.background":x,"label.position":31,"label.position.fixed":!1,"label.offset.x":0,"label.offset.y":2,"label.rotation":x,"label.max":x,"label.opacity":x,"label.scale":1,"label.align":x,"label.selectable":!0,label2:x,"label2.font":x,"label2.color":gh,"label2.background":x,"label2.position":34,"label2.position.fixed":!1,"label2.offset.x":0,"label2.offset.y":-2,"label2.rotation":x,"label2.max":x,"label2.opacity":x,"label2.scale":1,"label2.align":x,"label2.selectable":!0,note:x,"note.expanded":!0,"note.font":x,"note.color":Gq,"note.background":Hb,"note.position":8,"note.offset.x":-3,"note.offset.y":3,"note.max":x,"note.toggleable":!0,"note.border.width":1,"note.border.color":x,"note.opacity":x,"note.scale":1,"note.align":x,note2:x,"note2.expanded":!0,"note2.font":x,"note2.color":Gq,"note2.background":Hb,"note2.position":3,"note2.offset.x":3,"note2.offset.y":-3,"note2.max":x,"note2.toggleable":!0,"note2.border.width":1,"note2.border.color":x,"note2.opacity":x,"note2.scale":1,"note2.align":x,"group.type":x,"group.image":x,"group.image.stretch":"fill","group.repeat.image":x,"group.padding":8,"group.padding.left":0,"group.padding.right":0,"group.padding.top":0,"group.padding.bottom":0,"group.position":17,"group.toggleable":!0,"group.title.font":x,"group.title.color":Gq,"group.title.background":S.groupTitleBackground,"group.title.align":ec,"group.title.orientation":$i,"group.background":S.groupBackground,"group.depth":1,"group.border.width":1,"group.border.pattern":x,"group.border.color":Xd,"group.border.radius":x,"group.border.cap":zn,"group.border.join":Jd,"group.border.width.absolute":!1,"group.splitLine":!1,"group.gradient":z,"group.gradient.color":"#FFF",shape:x,"shape.background":Xd,"shape.repeat.image":x,"shape.border.width":0,"shape.border.width.absolute":!1,"shape.border.color":Xd,"shape.border.3d":!1,"shape.border.3d.color":x,"shape.border.3d.accuracy":x,"shape.border.cap":zn,"shape.border.join":Jd,"shape.border.pattern":x,"shape.gradient":z,"shape.gradient.color":"#FFF","shape.depth":0,"shape.dash":!1,"shape.dash.pattern":xj,"shape.dash.offset":0,"shape.dash.color":ko,"shape.dash.width":x,"shape.dash.3d":!1,"shape.dash.3d.color":x,"shape.dash.3d.accuracy":x,"shape.polygon.side":6,"shape.arc.from":j,"shape.arc.to":y,"shape.arc.close":!0,"shape.arc.oval":!1,"shape.corner.radius":x,"shape.gradient.pack":x,"shape.fill.rule":"nonzero","shape.fill.clip.direction":"top","shape.fill.clip.percentage":1,"shape.fill.clip.gradient":0,"shape.foreground":x,"shape.foreground.gradient":z,"shape.foreground.gradient.color":"#FFF","shape.foreground.clip.direction":"top","shape.foreground.clip.percentage":1,"shape.foreground.clip.gradient":0,"autolayout.gap":x,"autolayout.hgap":x,"autolayout.vgap":x,"edge.type":x,"edge.points":x,"edge.segments":x,"edge.color":Xd,"edge.width":2,"edge.width.absolute":!1,"edge.offset":0,"edge.group":0,"edge.expanded":!0,"edge.gap":12,"edge.toggleable":!0,"edge.center":!1,"edge.3d":!1,"edge.3d.color":x,"edge.3d.accuracy":x,"edge.cap":zn,"edge.join":Jd,"edge.source.position":17,"edge.source.anchor.x":x,"edge.source.anchor.y":x,"edge.source.offset.x":0,"edge.source.offset.y":0,"edge.source.index":-1,"edge.source.percent":0,"edge.target.position":17,"edge.target.anchor.x":x,"edge.target.anchor.y":x,"edge.target.offset.x":0,"edge.target.offset.y":0,"edge.target.index":-1,"edge.target.percent":0,"edge.pattern":x,"edge.dash":!1,"edge.dash.pattern":xj,"edge.dash.offset":0,"edge.dash.color":ko,"edge.dash.width":x,"edge.dash.3d":!1,"edge.dash.3d.color":x,"edge.dash.3d.accuracy":x,"edge.independent":!1,"attach.row.index":0,"attach.column.index":0,"attach.row.span":1,"attach.column.span":1,"attach.padding":0,"attach.padding.left":0,"attach.padding.right":0,"attach.padding.top":0,"attach.padding.bottom":0,"attach.index":-1,"attach.offset":0,"attach.offset.relative":!1,"attach.offset.opposite":!1,"attach.thickness":x,"attach.gap":0,"attach.gap.relative":!1,"grid.row.count":1,"grid.column.count":1,"grid.row.percents":x,"grid.column.percents":x,"grid.border":1,"grid.border.left":0,"grid.border.right":0,"grid.border.top":0,"grid.border.bottom":0,"grid.gap":1,"grid.background":S.gridBackground,"grid.depth":1,"grid.cell.depth":-1,"grid.cell.border.color":S.gridCellBorderColor,"grid.block":x,"grid.block.padding":3,"grid.block.width":1,"grid.block.color":S.gridBlockColor,text:"","text.align":"left","text.vAlign":"middle","text.color":gh,"text.font":un,"text.shadow":!1,"text.shadow.color":Hb,"text.shadow.blur":6,"text.shadow.offset.x":3,"text.shadow.offset.y":3,"text.scale.x":1,"text.scale.y":1},!0),ae(Ao,{_76I:function(j,L,Z){this._39I&&this._39I.fire({data:j,oldIndex:L,newIndex:Z})},addIndexChangeListener:function(J,V,O){var c=this;c._39I||(c._39I=new gg),c._39I.add(J,V,O)},removeIndexChangeListener:function(Z,A){this._39I.remove(Z,A)},prepareRemove:function(v){xr(v)&&(v.setSource(z),v.setTarget(z)),v._70O&&v._70O.toList().each(this.remove,this),v._69O&&v._69O.toList().each(function(X){X.setHost(z)}),v._host&&v.setHost(z)},onAdded:function(i){this.isAutoAdjustIndex()&&this.adjustIndex(i)},onDataPropertyChanged:function($,d){As[d.property]&&this.isAutoAdjustIndex()&&this.adjustIndex($)},isAdjustable:function(_){return Vm(_)||xr(_)},isAdjustedToBottom:function(w){return wr(w)?w.isExpanded()&&Zf(w):!1},adjustIndex:function(H){var N=this;this.isHierarchicalRendering()||(N.isAdjustedToBottom(H)?(N.sendToBottom(H),H.eachChild(N.adjustIndex,N)):N.sendToTop(H))},sendToTop:function(Y){var A=this;if(A.contains(Y)&&A.isAdjustable(Y)){var V=A._datas;if(Y!==V.get(A.size()-1)){var p=V.indexOf(Y);V.removeAt(p),V.add(Y),A._76I(Y,p,A.size()-1)}if(xr(Y)){var N=Y._40I;N&&!A.isAdjustedToBottom(N)&&A.sendToTop(N),N=Y._41I,N&&!A.isAdjustedToBottom(N)&&A.sendToTop(N)}Y._69O&&Y._69O.each(function(R){R.isRelatedTo(Y)||Vm(Y)&&R.isLoopedHostOn(Y)||A.sendToTop(R)}),Y.ISubGraph||(!wr(Y)||Y.isExpanded())&&Y._adjustChildrenToTop&&Y.eachChild(function(m){xr(m)||A.sendToTop(m)})}},sendToBottom:function(N,p){var z=this;if(N!==p&&z.contains(N)&&z.isAdjustable(N)&&(!p||z.contains(p))){var R=z._datas,B=R.remove(N),s=p?z._datas.indexOf(p):0;if(R.add(N,s),B!==s){z._76I(N,B,s);var g=N._parent;!g||g.ISubGraph||xr(g)||z.sendToBottom(N._parent,N)}}}}),ae(dj,{ms_edit:function(D){D._46O=function(L){var $=this,M=$.gv.dm(),r=$._index,G=$._89I,z=$._node,J=$._shape,x=$._edge,n=$._77I;z&&G?(this.fi({kind:"endEditRect",event:L,data:z,direction:G}),M.endTransaction()):J&&r>=0?($.fi({kind:"endEditPoint",event:L,data:J,index:r}),M.endTransaction()):x&&r>=0?($.fi({kind:"endEditPoint",event:L,data:x,index:r}),M.endTransaction()):n&&($.fi({kind:"endEditRotation",event:L,data:n}),M.endTransaction())},D._78I=function(I){var i=this;i.autoScroll(I);var Z=i.gv.lp(I),d=i._index,g=i._89I,B=i._node,a=i._shape,U=i._edge,n=i._77I;if(B&&g)i._80O(Z),i.fi({kind:"betweenEditRect",event:I,data:B,direction:g});else if(a&&d>=0)Z.e=a.getPoints().get(d).e,a.setPoint(d,Z),i.fi({kind:"betweenEditPoint",event:I,data:a,index:d});else if(U&&d>=0){var Q=U.s(_j);Z.e=Q.get(d).e,Q.set(d,Z),U.fp(_j,z,Q),i.fi({kind:"betweenEditPoint",event:I,data:U,index:d})}else if(n){var J=n.p(),O=n.getScale(),v=P+C(Z.y-J.y,Z.x-J.x);O.y<0&&(v+=j),H(v)<.04&&(v=0),n.setRotation(v),i.fi({kind:"betweenEditRotation",event:I,data:n})}},D._80O=function(g){var n=this,w=n._node,j=n._rect,r=j.x,M=j.y,p=j.width,U=j.height,V=n._89I,C=n._anchor,z=n._matrix,g=z.tfi(g);"northwest"===V?j=oe(g,{x:r+p,y:M+U}):V===Sd?j=oe({x:r,y:g.y},{x:r+p,y:M+U}):"northeast"===V?j=oe({x:r,y:g.y},{x:g.x,y:M+U}):V===tl?j=oe({x:g.x,y:M},{x:r+p,y:M+U}):V===xn?j=oe({x:r,y:M},{x:g.x,y:M+U}):"southwest"===V?j=oe({x:g.x,y:M},{x:r+p,y:g.y}):"south"===V?j=oe({x:r,y:M},{x:r+p,y:g.y}):"southeast"===V&&(j=oe({x:r,y:M},g)),w.setPosition(z.tf(j.x+j.width*C.x,j.y+j.height*C.y)),w.setWidth(j.width),w.setHeight(j.height)},D._80I=function(v,z,j,c){var B=this,m=B.gv._zoom,o=(B.gv.getEditPointSize()+2)/m;return Eq({x:z-o/2,y:j-o/2,width:o,height:o},v)?(B._89I!==c&&(B._89I=c),!0):!1},D._79I=function(J,x,V){var w=this,g=w.gv,Z=x?g.getDataUI(x):z,v=Z?Z._55O:z;if(v){var s,M,i,u,G=g._zoom,l=(g.getEditPointSize()+2)/G,N=g.lp(J);if(Vm(x)){if(v._56O&&Vm(x)&&(M=v._98o,Eq({x:M.x-l/2,y:M.y-l/2,width:l,height:l},N)))return w._77I=x,V&&w.fi({kind:"beginEditRotation",event:J,data:x}),w.setCursor("crosshair"),!0;if(v._43O&&x instanceof tj)for(i=x.getPoints(),s=i.size()-1;s>=0;s--)if(M=i.get(s),Eq({x:M.x-l/2,y:M.y-l/2,width:l,height:l},N))return w._index=s,w._shape=x,V&&w.fi({kind:"beginEditPoint",event:J,data:x,index:s}),w.setCursor("crosshair"),!0;if(v._42O)for(var R=x.getEditControlPoints(),W=["northwest",-1,-1,tl,-1,0,"southwest",-1,1,"south",0,1,"southeast",1,1,xn,1,0,"northeast",1,-1,Sd,0,-1],s=0,u=R.length;u>s;s++){var t=W[3*s],Q=R[s];if(w._80I(N,Q.x,Q.y,t)){w._node=x;var K=x.getWidth(),E=x.getHeight(),q=x.getAnchor();w._rect={x:-K*q.x,y:-E*q.y,width:K,height:E},w._anchor=q,w._matrix=x.getMatrix();var e=x.getRotation(),j=d(e),h=F(e),P=W[3*s+1]*Bl(x.getScale().x),B=W[3*s+2]*Bl(x.getScale().y),X=Math.atan2(-h*P-j*B,j*P-h*B),U=(Math.round(X/(Math.PI/4))+8)%8,o=[ag,"nesw-resize",nd,"nwse-resize",ag,"nesw-resize",nd,"nwse-resize"][U];return w.setCursor(o),V&&w.fi({kind:"beginEditRect",event:J,data:x,direction:w._89I}),!0}}}if(v._43O&&xr(x)&&x.s(pr)===mm&&(i=x.s(_j)))for(s=i.size()-1;s>=0;s--)if(M=i.get(s),Eq({x:M.x-l/2,y:M.y-l/2,width:l,height:l},N))return w._index=s,w._edge=x,V&&w.fi({kind:"beginEditPoint",event:J,data:x,index:s}),w.setCursor("crosshair"),!0}return!1}},ms_gv:function(c){c._currentSubGraph=z,c._initView=function(){this._fpsInfo={time:0,fps:0,frames:0}},c.upSubGraph=function(){this.setCurrentSubGraph(Qo(this._currentSubGraph))},c.isVisible=function(X){var L=this;if(Qo(X)!==L._currentSubGraph)return!1;if(xr(X)){var N=X._40I,k=X._41I;if(!N||!k)return!1;if(!(X.s("edge.independent")||L.isVisible(N)&&L.isVisible(k)))return!1;if(X.isEdgeGroupHidden())return!1}else for(var l=X._parent;l&&!l.ISubGraph;){if(wr(l)&&(!l.isExpanded()||!L.isVisible(l)))return!1;l=l._parent}if(X._parent instanceof rf&&!L.isVisible(X._parent))return!1;if(X._refGraph instanceof Hq&&!L.isVisible(X._refGraph))return!1;if(L instanceof bn){if(!X.s("3d.visible"))return!1}else{var e=L.getLayersInfo();if(e){var b=e[X._layer];if(b&&b.visible===!1)return!1}if(!X.s("2d.visible"))return!1}return L._visibleFunc?L._visibleFunc(X):!0},c.handleSelectionChange=function(a){var h=this;a.datas.each(function(C){h.invalidateData(C);var M=C._parent;wr(M)&&Vm(C)&&C.s(Ag)&&(h.invalidateData(M),M._49I&&M._49I.each(function(T){h.invalidateData(T)}))}),h.onSelectionChanged(a)},c.onSelectionChanged=function(x){var C=this,J=C.sm();if(1===J.size()&&("set"===x.kind||"append"===x.kind)){var I=J.ld();C.isAutoMakeVisible()&&C.makeVisible(I),C.adjustIndex&&C._dataModel.isAutoAdjustIndex()&&C.adjustIndex(I)}},c.makeVisible=function(I){if(I){var L=this,R=L.getDataUI?L.getDataUI(I):L.getData3dUI(I);if(R){var G=I,a=Qo(I);for(a!==L._currentSubGraph&&L.setCurrentSubGraph(a);(G=G._parent)&&G!==a;)wr(G)&&G.setExpanded(!0);L._23I=I,L.iv()}}},c.getLabel=function(E){var k=E.getStyle(ih);return k===x?E.getName():k},c.getLabelBackground=function(U){return U.getStyle("label.background")},c.getLabelColor=function(V){return V.getStyle("label.color")},c.getLabel2=function(e){return e.getStyle("label2")},c.getLabel2Background=function(b){return b.getStyle("label2.background")},c.getLabel2Color=function(t){return t.getStyle("label2.color")},c.getNote=function(Y){return Y.getStyle(up)},c.getNoteBackground=function(Y){return Y.getStyle("note.background")},c.getNote2=function(E){return E.getStyle(Io)},c.getNote2Background=function(u){return u.getStyle("note2.background")},c.handleClick=function(n,D,T){var u=this;D?(u.fi({kind:"clickData",event:n,data:D,part:T}),u.onDataClicked(D,n)):(u.fi({kind:"clickBackground",event:n}),u.onBackgroundClicked(n))},c.handleDoubleClick=function(h,s,W){var d=this;wn(h)&&(s?(d.fi({kind:"doubleClickData",event:h,data:s,part:W}),d.onDataDoubleClicked(s,h,W),d.checkDoubleClickOnNote(h,s,W)||d.checkDoubleClickOnRotation&&d.checkDoubleClickOnRotation(h,s,W)||(xr(s)?d.onEdgeDoubleClicked(s,h,W):s.ISubGraph?d.onSubGraphDoubleClicked(s,h,W):wr(s)?d.onGroupDoubleClicked(s,h,W):s.IDoorWindow?d.onDoorWindowDoubleClicked(s,h,W):s.ICSGBox&&d.onCSGBoxDoubleClicked(s,h,W))):(d.fi({kind:"doubleClickBackground",event:h}),d.onBackgroundDoubleClicked(h)))},c.onSubGraphDoubleClicked=function(y){this.setCurrentSubGraph(y)},c.onEdgeDoubleClicked=function(S,_){this.isEditable(S)||(S.ISubGraph&&!Kb(_)?this.setCurrentSubGraph(S):S.s("edge.toggleable")&&S.toggle())},c._39Q=function(S){return this.isInteractive(S)?this.preventDefaultWhenInteractive(S):!1},c.preventDefaultWhenInteractive=function(B){return B.s("preventDefaultWhenInteractive")},c.onGroupDoubleClicked=function(b){b.s("group.toggleable")&&b.toggle()},c.onDoorWindowDoubleClicked=function(j){j.s("dw.toggleable")&&j.toggle(!0)},c.onCSGBoxDoubleClicked=function(M,e){var v=this;if(v instanceof bn){var w=v.intersectObject(e,M);w&&M.s(w.part+".toggleable")&&M.toggleFace(w.part,!0)}},c.onBackgroundClicked=function(){},c.onBackgroundDoubleClicked=function(){this.upSubGraph()},c.onDataClicked=function(){},c.onDataDoubleClicked=function(){},c.onAutoLayoutEnded=function(){},c.onMoveEnded=function(){},c.onPanEnded=function(){},c.onPinchEnded=function(){},c.onRectSelectEnded=function(){},c.onZoomEnded=function(){},c.serialize=function(q){return this.dm().serialize(q)},c.toJSON=function(){return this.dm().toJSON()},c.deserialize=function(B,Q){var G=this;Q=Q instanceof bq?{rootParent:Q}:Rr(Q)?{setId:Q}:Jc(Q)?{finishFunc:Q}:Q||{},Q.view=G;var p=G.dm();return Q.__innerHandler__=function(r){if(Rr(p.a("toolTipEnable"))&&(p.a("toolTipEnable")?G.enableToolTip():G.disableToolTip()),G instanceof R.graph.GraphView&&(Rr(p.a("zoomable"))&&G.setZoomable&&G.setZoomable(p.a("zoomable")),Rr(p.a("pannable"))&&G.setPannable&&G.setPannable(p.a("pannable")),Rr(p.a("rectSelectable"))&&G.setRectSelectable&&G.setRectSelectable(p.a("rectSelectable")),p.a("fitContent")===!0&&G.fitContent&&G.fitContent(!0,0)),G instanceof R.graph3d.Graph3dView){var N=r.scene;N&&(N.eye&&G.setEye(N.eye),N.center&&G.setCenter(N.center),N.shadow!=z&&G.shadowMap.setShadow(N.shadow,N.shadowParams),N.batchInfoMap&&m.setBatchInfoMap(N.batchInfoMap)),pk(p.a("sceneNear"))&&G.setNear(p.a("sceneNear")),pk(p.a("sceneFar"))&&G.setFar(p.a("sceneFar")),Rr(p.a("sceneDashEnable"))&&G.setDashDisabled(!p.a("sceneDashEnable")),yk(p.a("sceneHighlightMode"))&&G.setHighlightMode(p.a("sceneHighlightMode")),pk(p.a("sceneHighlightWidth"))&&G.setHighlightWidth(p.a("sceneHighlightWidth")),p.a("sceneHighlightColor")&&G.setHighlightColor(p.a("sceneHighlightColor")),Rr(p.a("sceneHeadlightEnable"))&&G.setHeadlightDisabled(!p.a("sceneHeadlightEnable")),pk(p.a("sceneHeadlightRange"))&&G.setHeadlightRange(p.a("sceneHeadlightRange")),p.a("sceneHeadlightColor")&&G.setHeadlightColor(p.a("sceneHeadlightColor")),pk(p.a("sceneHeadlightIntensity"))&&G.setHeadlightIntensity(p.a("sceneHeadlightIntensity")),pk(p.a("sceneHeadlightAmbientIntensity"))&&G.setHeadlightAmbientIntensity(p.a("sceneHeadlightAmbientIntensity")),Rr(p.a("sceneFogEnable"))&&G.setFogDisabled(!p.a("sceneFogEnable")),p.a("sceneFogColor")&&G.setFogColor(p.a("sceneFogColor")),pk(p.a("sceneFogNear"))&&G.setFogNear(p.a("sceneFogNear")),pk(p.a("sceneFogFar"))&&G.setFogFar(p.a("sceneFogFar")),Rr(p.a("sceneBatchBrightnessDisabled"))&&G.setBatchBrightnessDisabled(p.a("sceneBatchBrightnessDisabled")),Rr(p.a("sceneBatchBlendDisabled"))&&G.setBatchBlendDisabled(p.a("sceneBatchBlendDisabled")),Rr(p.a("sceneBatchColorDisabled"))&&G.setBatchColorDisabled(p.a("sceneBatchColorDisabled"))}},p.deserialize(B,Q.rootParent,Q)},c.isDebugTipShowing=function(){return!!this._debugDiv},c.showDebugTip=function(){var V=this,k=V._debugDiv;if(!k){k=V._debugDiv=G.createElement("div"),k.style.position="absolute",k.style.overflow="hidden",k.style.font=m.debugTipLabelFont,k.style.padding="6px",k.style.backgroundColor=m.debugTipBackground,k.style.color=m.debugTipLabelColor;var Y=V.getView();V._79O?Y.insertBefore(k,V._79O):Y.appendChild(k);var O=function(){V.redraw();var A=V._canvas,J="FPS: "+V._fpsInfo.fps+"<br/>"+"Datas: "+V.dm().getDatas().length+(A?"<br/>Size: "+A.width+" * "+A.height:""),D=V.dm()._historyManager;D&&(J+="<br/>Undoes: "+D.getHistories().length+" index: "+D.getHistoryIndex());var b=V.getDebugTip();b&&(J+="<hr>"+b),k.innerHTML=J,V._isDebugging&&requestAnimationFrame(O)};requestAnimationFrame(O),V._isDebugging=!0}},c.hideDebugTip=function(){var g=this,O=g._debugDiv;O&&(delete g._debugDiv,g.getView().removeChild(O),g._isDebugging=!1)},c.updateDOMAppendMatrix=function(){var l=this.getView();l&&(l.updateAppendMatrix=!0)},c.countFrame=function(){if(this._isDebugging){var z=Date.now(),S=this._fpsInfo;z-S.time>1e3?(S.fps=Math.round(1e5*(S.frames+1)/(z-S.time))/100,S.time=z,S.frames=0):S.frames++}}},ms_icons:function(b){b.getRotation=function(c){return c==z?0:c},b._15O=function(){var L=this,J=L.s(Qg);if(J){var U=L,K=L.data||L._data,v=L._38o={icons:J,rects:{}};for(var s in J){var q=J[s],$=Lq(q.shape3d,K,U);if(!(Lq(q.visible,K,U)===!1||Lq(q.for3d,K,U)&&!L.I3d||$&&!L.I3d)){var m=$?[$]:Lq(q.names,K,U),I=m?m.length:0,w=Lq(q.position,K,U)||3,e=Lq(q.offsetX,K,U)||0,i=Lq(q.offsetY,K,U)||0,S=Lq(q.direction,K,U)||xn,b=Lq(q.gap,K,U),D=b!=z?b:1,R=Lq(q.rotation,K,U),H=Lq(q.keepOrien,K,U),F=Lq(q.rotationFixed,K,U)?R:L.getRotation(R,H,w),P=z,W=v.rects[s]=new Array(I);W.rotation=F;for(var r=0;I>r;r++){var d,h,Y,Q,c=m[r];if($)Y=0,Q=0;else{var V=Qd(c);Y=Lq(q.width,K,U),Q=Lq(q.height,K,U),Y==z&&(Y=Uk(V,K)),Q==z&&(Q=Cf(V,K))}if(P?S===xn?e+=Y/2:S===tl?e-=Y/2:S===Sd?i-=Q/2:i+=Q/2:P={width:Y,height:Q},L.I3d){var C=-Y/2,n=-Q/2;h={width:Y,height:Q,mat:L._16O(Lq(q.autorotate,K,U),w,P,Lq(q.face,K,U)||ws,Lq(q.t3,K,U),Lq(q.r3,K,U),Lq(q.rotationMode,K,U),e,i),vs:new Gg([C,-n,0,C,-n-Q,0,C+Y,-n-Q,0,C+Y,-n,0])}}else d=L.getPosition(w,e,i,P,Lq(q.positionFixed,K,U)),h={x:d.x-Y/2,y:d.y-Q/2,width:Y,height:Q},L._68o(h,F);W[r]=h,S===xn?e+=Y/2+D:S===tl?e-=Y/2+D:S===Sd?i-=Q/2+D:i+=Q/2+D}}}}}}});var Sg={1:1,2:1,6:1,9:1,10:1,14:1,15:1,16:1,21:1,22:1,26:1,29:1,30:1,34:1,36:1,38:1,40:1,42:1,45:1,50:1,52:1,54:1},Pb={3:1,7:1,11:1,17:1,23:1,27:1,31:1,44:1,46:1,47:1,49:1},Mb={translateX:1,translateY:1,zoom:1,scrollBarVisible:1},As={sourceAgent:1,targetAgent:1,expanded:1,parent:1,host:1},Oe={position:1,width:1,height:1,expanded:1,rotation:1,anchor:1,scale:1,"s:edge.points":1},yl={"edge.type":1,"edge.group":1},Fp={rotation:1,rotationX:1,rotationZ:1},Np={rotation:1,rotationX:1,rotationZ:1,position:1,width:1,height:1,anchor:1,scale:1},Lm={position:1,width:1,height:1,anchor:1,scale:1,"s:grid.row.count":1,"s:grid.column.count":1,"s:grid.row.percents":1,"s:grid.column.percents":1,"s:grid.border":1,"s:grid.border.left":1,"s:grid.border.right":1,"s:grid.border.top":1,"s:grid.border.bottom":1,"s:grid.gap":1},Yg={"attach.row.index":1,"attach.column.index":1,"attach.row.span":1,"attach.column.span":1,"attach.padding":1,"attach.padding.left":1,"attach.padding.right":1,"attach.padding.top":1,"attach.padding.bottom":1,"attach.index":1,"attach.offset":1,"attach.offset.relative":1,"attach.offset.opposite":1,"attach.gap":1,"attach.gap.relative":1,"attach.thickness":1},Be={shape:1,thickness:1,position:1,anchor:1,scale:1},Qo=function(Y){if(!Y)return z;if(xr(Y)){var a=Y._40I,V=Y._41I;if(!a||!V)return z;var r=Qo(a),j=Qo(V);return r===j?r:z}for(var O=Y._parent;xr(O)&&!O.ISubGraph;)O=O._parent;return O?O.ISubGraph?O:Qo(O):z},fm=function(g,k,i,J){var s=k.getStyle(i)*J;s&&km(g,s),s=k.getStyle(i+".left")*J,s&&(g.x-=s,g.width+=s),s=k.getStyle(i+".right")*J,s&&(g.width+=s),s=k.getStyle(i+".top")*J,s&&(g.y-=s,g.height+=s),s=k.getStyle(i+".bottom")*J,s&&(g.height+=s),g.width<0&&(g.width=-g.width,g.x-=g.width),g.height<0&&(g.height=-g.height,g.y-=g.height)},Zf=function(F){for(var W,N=0,I=F.size();I>N;N++)if(W=F.getChildAt(N),Vm(W)&&Zf(W))return!0;return F.hasAgentEdges()},pm=function(k){if(!k)return z;for(var q=k._parent;wr(q);){if(!wr(q._parent))return q.isExpanded()?k:q;q.isExpanded()||(k=q),q=q._parent}return k},Nc=function(d,i){if(!d||!i)return z;var L,q,B,v=Qo(d),s=Qo(i);if(v!==s){for(;s&&v!==s;)s=Qo(s);if(v===s)return d;L=new df,L.add(d,0);for(var H=d._parent;Vm(H)&&!i.isDescendantOf(H);)L.add(H,0),H=H._parent;for(B=L.size(),q=0;B>q;q++){var Y=L.get(q);if(wr(Y)&&!Y.isExpanded())return Y;if(Y.ISubGraph)return Y}return d}return d},ee=function(t){if(t.isLooped())return t._source;var U=pm(t._source),o=pm(t._target);return U===o?t._source:Nc(U,o)},Ep=function(Y){if(Y.isLooped())return Y._target;var d=pm(Y._source),m=pm(Y._target);return d===m?Y._target:Nc(m,d)},bb=function(w,X,E){"target"!==E&&(E="source");var j="target"===E?X.getTargetAgent():X.getSourceAgent(),S="edge."+E+".";if(xr(j)){var K=w.getDataUI(j);K._79o();var V=X.s(S+"index");if(V>=0){var B=ip(K);return B[Math.max(0,Math.min(V,B.length-1))]}var O=X.s(S+"percent")||0;O=Math.max(0,Math.min(O,1));var N=wk(K);return _o(N,100*O)}return oo(w,j,X.s(S+"position"),X.s(S+"offset.x"),X.s(S+"offset.y"),X.s(S+"anchor.x"),X.s(S+"anchor.y"))},oo=function(y,J,f,H,o,h,c){if(!J)return z;var r,R=J.getRotation?J.getRotation():0;if(h!==x||c!==x){h=h===x?.5:h,c=c===x?.5:c;var j=J.getScale();if(R&&!Te(J,y)||j.x<0||j.y<0){var V=J.getPosition(),T=J.getWidth(),n=J.getHeight(),t=J.getAnchor(),M=new fc(R,V.x,V.y,j.x,j.y);f=M.tf((h-t.x)*T,(c-t.y)*n)}else r=vg(y,J),f={x:r.x+h*r.width,y:r.y+c*r.height}}else f=yr(f,vg(y,J));if(R){var Q=d(R),G=F(R),e=H*Q-o*G;o=H*G+o*Q,H=e}return f.x+=H,f.y+=o,f},Bq=function(a,A){if(!a||!A)return z;var I,h,H,q,K,N;if(a===A){if(q=a.getLoopedEdges(),!q)return z;q=new df(q)}else{if(K=a.getAgentEdges(),N=A.getAgentEdges(),!K||!N)return z;
for(h=K.size(),I=0;h>I;I++)H=K.get(I),N.contains(H)&&(q||(q=new df),q.add(H))}if(q)for(I=0;I<q.size();I++)H=q.get(I),H.getStyle(pr)===mm&&(H._22I(z),q.removeAt(I),I--);return q},zl=function(w,H){var f=Bq(w,H);if(f&&!f.isEmpty()){if(1===f.size())return f.get(0)._22I(z),void 0;var X=new df,W=new df;f.each(function(O){var d=O.s("edge.group");X.contains(d)||X.add(d)}),X.sort(),X.each(function(J){W.add(new R.EdgeGroup(f.toList(function(C){return J===C.s("edge.group")}),W))}),W.each(function(D){D.each(function(p){p._22I(D)})})}},os=function(h,N,g){var s=h._canvas;h._zoom;var X=bp(N,s),O=bp(g,s);return{x:X.x-O.x,y:X.y-O.y}},eg=function(J,e){if(e){var Z=e.rect,l=e.color,y=e.rotation,T=e.labelWidth,_=e.background,B=e.opacity,v=e.scale,X=v!=z&&1!==v;if(B!=z){var b=J.globalAlpha;J.globalAlpha*=B}if(y||X){J.save();var k=Z.x+Z.width/2,t=Z.y+Z.height/2;jm(J,k,t),y&&Eg(J,y),X&&J.scale(v,v),jm(J,-k,-t)}if(_&&em(J,Z.x,Z.y,Z.width,Z.height,_),T){var M=Z.width,i=J.createLinearGradient(Z.x,Z.y,Z.x+M,Z.y);i.addColorStop(0,l),i.addColorStop(.9,l),i.addColorStop(1,Ol),l=i,Z.width=T}Kj(J,e.ss,Z,e.font,l,e.align),T&&(Z.width=M),(y||X)&&J.restore(),B!=z&&(J.globalAlpha=b)}},im=function(m,V){if(V){var a=V.rect,d=a.x,W=a.y,E=a.width,K=a.height,O=V.background,e=V.backgroundImage,I=V.borderWidth,F=V.borderColor,b=V.labelWidth,B=V.opacity,G=V.scale,r=G!=z&&1!==G;if(B!=z){var w=m.globalAlpha;m.globalAlpha*=B}if(r){m.save();var Q=a.x+a.width/2,s=a.y+a.height/2;jm(m,Q,s),m.scale(G,G),jm(m,-Q,-s)}if(V.expanded){var k=g(8,E/4),X=W+K-8;if(m.fillStyle=O,m.beginPath(),m.moveTo(d,W),m.lineTo(d,X),m.lineTo(d+E/2,X),m.lineTo(d+E/2,W+K),m.lineTo(d+E/2+k,X),m.lineTo(d+E,X),m.lineTo(d+E,W),m.closePath(),m.fill(),I&&(m.lineWidth=I,m.lineJoin="round",m.lineCap="round",F?(m.strokeStyle=F,m.stroke()):(m.strokeStyle=jf(O),m.beginPath(),m.moveTo(d+E,W),m.lineTo(d+E,X),m.lineTo(d+E/2+k,X),m.lineTo(d+E/2,W+K),m.stroke(),m.strokeStyle=kd(O),m.beginPath(),m.moveTo(d+E,W),m.lineTo(d,W),m.lineTo(d,X),m.lineTo(d+E/2,X),m.lineTo(d+E/2,W+K),m.stroke())),e)Xm(m,Qd(e),bd,a.x,a.y,a.width,a.height-8,V.data,V.view);else{if(a.height-=8,O=V.color,b){var u=E,q=m.createLinearGradient(d,W,d+u,W);q.addColorStop(0,O),q.addColorStop(.9,O),q.addColorStop(1,Ol),O=q,a.width=b}Kj(m,V.ss,a,V.font,O,V.align),b&&(a.width=u),a.height+=8}}else if(V.icon)rb(m,Qd(V.icon),d,W,E,K,V.data,V.view);else{var f=E/2;I&&(m.lineWidth=I,m.lineJoin="round",m.lineCap="round",m.strokeStyle=F?F:jf(O),m.beginPath(),m.arc(d+f,W+f,f,P,1.6*j,!0),m.moveTo(d+f,W+K),m.lineTo(d+E-f/5,W+f),m.stroke(),m.strokeStyle=F?F:kd(O),m.beginPath(),m.arc(d+f,W+f,f,1.6*j,P,!0),m.moveTo(d+f,W+K),m.lineTo(d+f/5,W+f),m.stroke()),m.fillStyle=O,m.beginPath(),m.arc(d+f,W+f,f,0,y,!0),m.moveTo(d+f,W+K),m.lineTo(d+E-f/5,W+f),m.lineTo(d+f/5,W+f),m.closePath(),m.fill(),m.fillStyle=V.color,m.beginPath(),m.arc(d+f,W+f,f/3,0,y,!0),m.fill()}r&&m.restore(),B!=z&&(m.globalAlpha=w)}},wq=function(Z,T){return T>2*Z?Z:T/2},Wm=function(Q,w,y,T){if(!Q||!w)return 0;var h=C(w.y-Q.y,w.x-Q.x);return y||(h=w.x<Q.x?h+j:h),h+T},Zn=function(G,h,w,d,b,p,A){A&&(G.x>h.x||G.x===h.x&&G.y>h.y)&&(w=sl[w],b=-b);var H=yr(w,{x:0,y:0,width:id(G,h),height:0},p);return H.x+=d,H.y+=b,H=new fc(C(h.y-G.y,h.x-G.x)).tf(H),H.x+=G.x,H.y+=G.y,H},jh=function(P,y,R,t,H){if(P._19Q=!0,!R.getEdgeGroup())return t?R.s("edge.gap"):0;if(xr(R.getSourceAgent())||xr(R.getTargetAgent()))return 0;var k,c=0,$=0,i=0;if(R.getEdgeGroup().getSiblings().each(function(e){e.each(function(Y){if(y.isVisible(Y)&&Y.s(pr)==H){var u=Y.s("edge.gap");k?($+=i/2+u/2,i=u):(k=Y,i=u),Y===R&&(c=$)}})}),t)return $-c+i;var O=c-$/2;return k&&R._40I!==k._40I&&(P._19Q=!1),O},Bf=function(){var x=function(g){var c=[];return g.forEach(function(q){c.push({x:q.x,y:q.y}),c.push({x:q.x+q.width,y:q.y+q.height}),c.push({x:q.x+q.width,y:q.y}),c.push({x:q.x,y:q.y+q.height})}),c};return function(F,r,m){if("oval"===F){var J=0,j=m.height/m.width,o=j*j,C=m.x+m.width/2,q=m.y+m.height/2,c=x(r);c.forEach(function(X){var p=X.x-C,I=X.y-q,x=p*p+I*I/o;x>J&&(J=x)}),J=N(J);var B=j*J;return{x:C-J,y:q-B,width:2*J,height:2*B}}if("circle"===F){var f=0,C=m.x+m.width/2,q=m.y+m.height/2,c=x(r);return c.forEach(function(j){var b=j.x-C,n=j.y-q,J=b*b+n*n;J>f&&(f=J)}),f=N(f),{x:C-f,y:q-f,width:2*f,height:2*f}}return"roundRect"===F?(km(m,g(m.width,m.height)/16),m):m}}(),ks=R.graph={},us=function(J,q,L){Ad(t+".graph."+J,q,L)};R.layout={};var xd={},Xb=function(z,y,O,Y,H,Z,C,b){var i=[y.uuid,Math.round(Y),Math.round(H),O].join("_");y.cacheRule&&(i+=Lq(y.cacheRule,Z,C));var q=C._zoom;q!==C._cacheZoom&&(C._cacheZoom=q,C._cacheImage={}),q*=Gn;var X=C._cacheImage[i];return X||(ph(),X=R.Default.toCanvas(y,Math.ceil(Y*q),Math.ceil(H*q),O,Z,C,b),Cq()&&(C._cacheImage[i]=X)),X};ae(m,{setImageCacheRule:function(s,b){var e;b||"object"!=typeof s?(e={},e[s]=b):e=s;for(var u in e){var z=e[u];yk(u)?(Ad=Qd(u),Ad?Ad.cacheRule=z:xd[u]=z):u.cacheRule=z}}});var ln={comps:[{type:rp,points:[85,50,70,115,100,71,86,107,88,49,47,71,55,55,73,78,99,111,81,65,102,107,98,85,71,113,80,87,79,83,110,101,106,82,106,66,76,101,98,106,74,108,81,61],borderWidth:1,borderColor:z}]};if(ln[en]=ln[yb]=160,o.Image){var jk=new o.Image;jk.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAALUlEQVRYR+3QQREAAAABQfqXFsNnFTizzXk99+MAAQIECBAgQIAAAQIECBAgMBo/ACHo7lH9AAAAAElFTkSuQmCC",ll("default_blank",jk)}ll("node_image",nk(30,30,[{type:aq,rect:[4,5,22,16],gradient:zi,gradientColor:Oh,background:Xd},{type:aq,rect:[2,3,26,20],borderWidth:1,borderColor:Xd},{type:aq,rect:[11,23,8,4],background:Xd},{type:aq,rect:[6,27,18,2],background:Xd}])),ll("node_icon",nk(16,16,[{type:aq,rect:[2,2,12,10],gradient:zi,gradientColor:Oh,background:Xd},{type:hl,rect:[2,2,12,10],width:1,color:Xd},{type:aq,rect:[6,12,4,2],background:Xd},{type:aq,rect:[4,14,8,1],background:Xd}])),ll("block_icon",nk(16,16,[{type:hl,rect:[1,1,14,14],width:1,color:Xd}])),ll("group_image",nk(66,39,[{type:aq,rect:[44.3,18,18.1,12.8],gradient:zi,gradientColor:Oh,background:Xd},{type:aq,rect:[3.3,17.8,18.1,12.8],gradient:zi,gradientColor:Oh,background:Xd},{type:aq,rect:[15.8,3.2,33.5,26.4],borderWidth:1,borderColor:Xd,gradient:zi,gradientColor:Oh,background:Xd},{type:aq,rect:[26.2,29.4,12.8,4.2],background:Xd},{type:aq,rect:[21.3,33.5,22.5,2.3],background:Xd},{type:aq,rect:[5.3,32.7,14.1,2.1],background:Xd},{type:aq,rect:[9,30.4,6.7,2.4],background:Xd},{type:aq,rect:[50,30.7,6.7,2.4],background:Xd},{type:aq,rect:[46.3,33,14.1,2.1],background:Xd}])),ll("group_icon",nk(16,16,[{type:aq,rect:[4,12,4,2],background:Xd},{type:aq,rect:[2,13,8,1],background:Xd},{type:aq,rect:[12,12,2,1],background:Xd},{type:aq,rect:[11,13,4,1],background:Xd},{type:aq,rect:[10,7,6,5],gradient:zi,gradientColor:Oh,background:Xd},{type:aq,rect:[1,2,10,10],gradient:zi,gradientColor:Oh,background:Xd},{type:hl,rect:[1,2,10,10],width:1,color:Xd}])),ll("refGraph_icon",nk(16,16,[{type:"shape",borderWidth:1,borderColor:Xd,borderCap:"round",rotation:.7854,points:[12.5502,6.7981,12.5502,6.7981,12.5502,4.8181,12.5502,3.7981,12.5502,2.7781,11.36687,1.7981,10.0502,1.7981,8.73354,1.7981,7.5502,2.8181,7.5502,3.7981,7.5502,4.55989,7.5502,7.79805,7.5502,7.79805,7.5502,7.79805,7.5502,9.7981,10.0502,9.7981],segments:[1,4,4,4,4,4]},{type:"shape",borderWidth:1,borderColor:Xd,borderCap:"round",rotation:-2.35619,points:[8.4498,11.2019,8.4498,11.2019,8.4498,9.2219,8.4498,8.2019,8.4498,7.1819,7.26646,6.2019,5.9498,6.2019,4.63313,6.2019,3.4498,7.2219,3.4498,8.2019,3.4498,8.9637,3.4498,12.20186,3.4498,12.20186,3.4498,12.20186,3.4498,14.2019,5.9498,14.2019],segments:[1,4,4,4,4,4]}])),ll("edge_icon",nk(16,16,[{type:aq,rect:[2.1,6.9,11.5,2.6],rotation:-.79,gradient:zi,gradientColor:Oh,background:Xd},{type:aq,rect:[10.8,1,4,4],background:Xd},{type:aq,rect:[1,11,4,4],background:Xd}])),ll("subGraph_image",nk(72,45,[{type:rp,points:[9,42,.3,38.4,2.4,28.8,5.7,21.6,11.7,22.5,11.7,15.9,16.8,13.8,21.6,12,24.3,15.9,27.9,3,42.3,2.1,59.4,4.5,57.3,18.3,67.5,18.9,69.6,27.3,69.9,38.4,64.2,41.4],segments:[1,3,3,3,3,3,3,3,3],gradient:zi,gradientColor:Oh,background:Xd},{type:aq,rect:[29.6,30.7,3.6,1.8],background:Xd},{type:aq,rect:[28.4,32.3,6,1.2],background:Xd},{type:aq,rect:[37.3,32,10.8,1.8],background:Xd},{type:aq,rect:[39.1,29.9,7.2,2.3],background:Xd},{type:aq,rect:[26.6,23.7,9.6,7.2],gradient:zi,gradientColor:Oh,background:Xd},{type:aq,rect:[34.3,16.8,16.8,13.2],borderWidth:1,borderColor:Xd,gradient:zi,gradientColor:Oh,background:Xd}])),ll("subGraph_icon",nk(17,17,[{type:rp,points:[2.2,14.6,.2,11.9,.8,8.8,1.8,5.9,5.6,7.4,3.8,1.6,10.3,3,14.5,4.2,12.2,7.5,18.9,7.2,14.5,14.5],segments:[1,3,3,3,3,3],gradient:zi,gradientColor:Oh,background:Xd}])),ll("shape_icon",nk(16,16,[{type:rp,points:[1.5,1,8.4,1,8.4,7.2,14.6,7.1,14.6,14.9,1.5,14.9,1.5,1],background:Xd}])),ll("polyline_icon",nk(16,16,[{type:rp,points:[1.5,1,8.4,1,8.4,7.2,14.6,7.1,14.6,14.9,1.5,14.9,1.5,1],borderWidth:1,borderColor:Xd},Sf(7.5,.4),Sf(7.5,6.3),Sf(13.6,6.3),Sf(13.6,14),Sf(.7,13.9),Sf(.7,.3)])),ll("grid_icon",nk(16,16,[{type:aq,rect:[1,1,4,4],background:Xd,gradient:zi,gradientColor:Oh},{type:aq,rect:[6,1,4,4],background:Xd,gradient:zi,gradientColor:Oh},{type:aq,rect:[11,1,4,4],background:Xd,gradient:zi,gradientColor:Oh},{type:aq,rect:[11,6,4,4],background:Xd,gradient:zi,gradientColor:Oh},{type:aq,rect:[6,6,4,4],background:Xd,gradient:zi,gradientColor:Oh},{type:aq,rect:[1,6,4,4],background:Xd,gradient:zi,gradientColor:Oh},{type:aq,rect:[11,11,4,4],background:Xd,gradient:zi,gradientColor:Oh},{type:aq,rect:[6,11,4,4],background:Xd,gradient:zi,gradientColor:Oh},{type:aq,rect:[1,11,4,4],background:Xd,gradient:zi,gradientColor:Oh}])),ll("light_icon",nk(16,16,[{type:"rect",rect:[6,9,5,5],borderWidth:1,borderColor:Xd},{type:"circle",rect:[1,1,15,10],borderWidth:1,borderColor:Xd,gradient:zi,gradientColor:Oh,background:{func:function(I){var E=I?I.s(yo):z;return Mf(E)?"rgb("+vp(255*E[0])+","+vp(255*E[1])+","+vp(255*E[2])+")":E||Xd}}}])),ll("text_icon",nk(16,16,[{type:"shape",points:[3,3,13,3,8,3,8,14],segments:[1,2,1,2],borderWidth:1,borderColor:Xd}])),ll("border_image",{fitSize:!0,comps:[{type:"border",relative:!0,rect:[0,0,1,1],color:{func:"style@border_color"},width:{func:"style@border_width"}}]}),ll("columnChart_image",{fitSize:!0,boundExtend:150,comps:[{type:{func:"style@chart.type"},relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},series:{func:"style@chart.series"},minValue:{func:"style@chart.min.value"},maxValue:{func:"style@chart.max.value"}}]}),ll("lineChart_image",{fitSize:!0,boundExtend:150,comps:[{type:"lineChart",relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},series:{func:"style@chart.series"},minValue:{func:"style@chart.min.value"},maxValue:{func:"style@chart.max.value"},linePoint:{func:"style@chart.line.point"},lineWidth:{func:"style@chart.line.width"},line3d:{func:"style@chart.line.3d"}}]}),ll("pieChart_image",{fitSize:!0,boundExtend:150,comps:[{type:"pieChart",relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},hollow:{func:"style@chart.hollow"},startAngle:{func:"style@chart.start.angle"},values:{func:"style@chart.values"},colors:{func:"style@chart.colors"}}]});var Rl=function(X,t,h,V,Z,H){var m,P,s,z,g,N,n,B,w,f,R,j=[];if(Math.abs(V)>2*Math.PI&&(V=2*Math.PI),g=Math.ceil(Math.abs(V)/(Math.PI/4)),m=V/g,P=-m,s=-h,g>0){N=X+Math.cos(h)*Z,n=t+Math.sin(-h)*H,j.push({x:N,y:n});for(var e=0;g>e;e++)s+=P,z=s-P/2,B=X+Math.cos(s)*Z,w=t+Math.sin(s)*H,f=X+Math.cos(z)*(Z/Math.cos(P/2)),R=t+Math.sin(z)*(H/Math.cos(P/2)),j.push({x:f,y:R}),j.push({x:B,y:w})}return j},Um=function($){if($){var z=$._data;if(z instanceof R.Shape)return{points:z.getPoints(),segments:z.getSegments()};var t;if(z instanceof R.Edge&&(t=$._78o)){var m,T,Y=t.type,G=t.points,u=t.segments,p=t.edgeTypeInfo;if(!Y||G){var h=t.sourcePoint,X=h.x,a=h.y,H=t.targetPoint,q=H.x,l=H.y;if(Y)u?(m=new df({x:X,y:a}),m.addAll(G),m.add({x:q,y:l}),T=new df(u._as)):(m=new df({x:X,y:a}),G.each(function(K){m.add(K)}),m.add({x:q,y:l}));else if(t.looped){m=new df(Rl(X,a,0,2*Math.PI,t.radius,t.radius)),T=new df([1]);for(var S=0;S<(m.size()-1)/2;S++)T.add(3)}else m=new df,t.center?(m.add({x:t.c1.x,y:t.c1.y}),m.add({x:X,y:a}),m.add({x:q,y:l}),m.add({x:t.c2.x,y:t.c2.y})):(m.add({x:X,y:a}),m.add({x:q,y:l}))}else p&&(m=new df(p.points._as),p.segments&&(T=new df(p.segments._as)));return{points:m,segments:T}}}},wk=function(A,p,i){if(null==p){var g=Um(A);if(!g)return;p=g.points,i=g.segments}if(p){if(Array.isArray(p)&&(p=new df(p)),"number"==typeof p.get(0)){for(var v=new R.List,V=0;V<p.size();V+=2)v.add({x:p.get(V),y:p.get(V+1)});p=v}if(!i){i=[1];for(var n=p.length-1;n>0;n--)i.push(2)}Array.isArray(i)&&(i=new df(i));for(var E=Wd(p._as,i._as,50),k=E.length,X=[],V=0;k>V;V++){var o=E[V];o.length>1&&X.push(o)}return X}},Tn=function(i){for(var T=0,o=i.length-1,Y=0;o>Y;Y++){var c=i[Y],Z=i[Y+1],a=Z.x-c.x,B=Z.y-c.y;T+=Math.sqrt(a*a+B*B)}return T},Mh=function(h,_){for(var T=0,u=_.length,I=0;u>I;I++){var B=_[I];if(T+=B,T>h)return I}return Math.min(I,u-1)},Xe=function(A,Z){for(var w=0,O=0,$=0,X=A.length-1,u=0;X>u;u++){var h=A[u],b=A[u+1],c=b.x-h.x,f=b.y-h.y;if($=Math.sqrt(c*c+f*f),w+=$,w>Z){w-=$,O=u;break}}var z=A[O],W=A[O+1],C=Math.atan2(W.y-z.y,W.x-z.x),D=Z-w,f=Math.sin(C)*D,c=Math.cos(C)*D;return{x:z.x+c,y:z.y+f}},_o=function(y,G){if(y){var q;if(0===G)q=y[0][0];else if(100===G)y=y[y.length-1],q=y[y.length-1];else{for(var w=0,u=[],Z=y.length,$=0;Z>$;$++){var T=y[$],j=Tn(T);w+=j,u.push(j)}for(var o=w*G/100,f=Mh(o,u),H=0,E=0;f>E;E++)H+=u[E];o-=H,q=Xe(y[f],o)}return q}},ip=function(G){var l,q,B,c,d=Um(G),N=[],I=d.points,f=d.segments,R=-1;for(q=0,B=f?f.length:I.length;B>q;q++){if(l=f?f.get(q):1,3===l)c=2;else if(4===l)c=3;else{if(5===l)continue;c=1}R+=c,N.push(I.get(R))}return N},Vl=function(w,L,k,O){function M(X){if(X>=0&&1>=X){h=L(X);var K=(w.x-h.x)*(w.x-h.x)+(w.y-h.y)*(w.y-h.y);return F>K?(F=K,$=X,!0):!1}}k=k||100,O=O||1e-5;for(var F=1/0,$=0,h=new lm,b=0;k>b;++b)M(b/k);for(var q=1/(2*k);q>O;)M($-q)||M($+q)||(q/=2);return $};ae(m,{_edgeProtectMethod:{getStraightLinePoints:wk,calculateLineLength:Tn,calcSegmentIndexByDistance:Mh,calculatePointAlongLine:Xe,getPercentPosition:_o,getRealPointsFromDataUI:ip}});var Cn=function(v,p){for(var u=v.vertices,S=0;S<u.length;S++){var G=u[S],R=G.y;G.y=G.z,G.z=-R,p&&(G.y+=p)}},tr=function(o){for(var f,A,X,_,s,g,x=[],k=[],y=[],V=o.faces,j=0,h=0,T=0,Y=V.length;Y>j;j++,h+=6,T+=9){var B=V[j];1===B.i?(f||(f=[],A=[],X=[]),om(B,j,h,T,o,f,X,A)):2===B.i?(_||(_=[],s=[],g=[]),om(B,j,h,T,o,_,g,s)):om(B,j,h,T,o,x,y,k)}return{vs:x,uv:k,ns:y,top_vs:f,top_uv:A,top_ns:X,bottom_vs:_,bottom_uv:s,bottom_ns:g}},om=function(q,b,y,m,R,j,K,l){var h=R.vertices,f=R.faceVertexUvs,d=h[q.a],n=h[q.b],s=h[q.c];j.push(d.x,d.y,d.z,n.x,n.y,n.z,s.x,s.y,s.z);var I,E,Q,A=q.vertexNormals;3===A.length?(I=A[0],E=A[1],Q=A[2]):I=E=Q=q.normal,K.push(I.x,I.y,I.z,E.x,E.y,E.z,Q.x,Q.y,Q.z);var k=f[0][b][0],B=f[0][b][1],S=f[0][b][2];l.push(k.x,k.y,B.x,B.y,S.x,S.y)},hc=function(){function l(E,H){return E.dot(H)>0}function S(b,C,D,$,Q,R,v){for(var i,I,G=[C,D,$],F=[Q,R,v],q=[],B=G.length,c=!0;B--&&c;){for(var P=G[B],u=F.length,j=!1;u--;)if(P.equals(F[u])){F.splice(u,1),q.push(P),j=!0;break}if(!j){if(i){c=!1;break}i=P}}return c&&2===q.length&&(I=F[0],e.subVectors(i,q[0]),r.subVectors(I,q[0]),g.subVectors(i,q[1]),e.x*g.y*r.z+g.x*r.y*e.z+r.x*e.y*g.z-r.x*g.y*e.z-r.y*g.z*e.x-r.z*g.x*e.y<1e-6&&(T.subVectors(I,q[1]),N.subVectors(q[1],q[0]),l(N,e)&&l(N,r)&&(N.negate(),l(N,g)&&l(N,T))))?(b.push(q[1].x,q[1].y,q[1].z),b.push(i.x,i.y,i.z),b.push(i.x,i.y,i.z),b.push(q[0].x,q[0].y,q[0].z),b.push(q[0].x,q[0].y,q[0].z),b.push(I.x,I.y,I.z),b.push(I.x,I.y,I.z),b.push(q[1].x,q[1].y,q[1].z),2):(b.push(C.x,C.y,C.z),b.push(D.x,D.y,D.z),b.push(D.x,D.y,D.z),b.push($.x,$.y,$.z),b.push($.x,$.y,$.z),b.push(C.x,C.y,C.z),1)}function I(){this._vertexMap={},this._lineMap={},this._lineList=[]}function t(N,m,Y,A,g,i,h){var M=[Y,g];N[0]===A&&M.reverse();var q=[M[0]._key,M[1]._key].join("|"),T=N._triangles[q];T||(N._triangles[q]=T={});var D=[i._key,h._key].join("|");T[D]||(T[D]=[i,h])}function b(h,_,Z){var q=h._planes[Z._key];if(!q)for(var K in h._planes){var V=h._planes[K];if(V._normal.angleTo(Z)<.001){q=V;break}}return q?(q._vertices.indexOf(_)<0&&q._vertices.push(_),void 0):(h._planes[Z.key]={_normal:Z,_vertices:[_]},void 0)}function A(b){var w=b._ctlineModel;if(w||(b._ctlineModel=w=[]),w[0])return w[0];var e;e=Mf(b)?b:[b];var z,F,L,R,O,N,q,d,P,r,j,h,a,C,p,Z,g,U,G,n=["","top_","bottom_"];for(w=[],z=0,F=e.length;F>z;z++)if(r=e[z])for(Dn(r),L=0,R=n.length;R>L;L++)if(P=r[n[L]+"lvs"])for(g=w.length,U=P.length,w.length=g+U,G=0;U>G;++G,++g)w[g]=P[G];else if(q=r[n[L]+"vs"]){d=r[n[L]+"is"],N=d?d.length:q.length/3;for(var O=0;N-1>O;)d?(j=d[O],h=d[O+1],a=d[O+2],C=d[O+3],p=d[O+4],Z=d[O+5]):(j=O,h=O+1,a=O+2,C=O+3,p=O+4,Z=O+5),K.fromArray(q,3*j),k.fromArray(q,3*h),X.fromArray(q,3*a),Q.fromArray(q,3*C),W.fromArray(q,3*p),s.fromArray(q,3*Z),O+=3*S(w,K,k,X,Q,W,s);N>O&&(d?(j=d[O],h=d[O+1],a=d[O+2]):(j=O,h=O+1,a=O+2),K.fromArray(q,3*j),k.fromArray(q,3*h),X.fromArray(q,3*a),w.push(K.x,K.y,K.z),w.push(k.x,k.y,k.z),w.push(k.x,k.y,k.z),w.push(X.x,X.y,X.z),w.push(X.x,X.y,X.z),w.push(K.x,K.y,K.z))}return b._ctlineModel[0]=w,w}function n(d){var z=d._ctlineModel;if(z||(d._ctlineModel=z=[]),z[1])return z[1];var X;X=Mf(d)?d:[d];var F,s,A,H,t,R,S,i,P,p,h,j,k=["","top_","bottom_"],V=new I;for(z=[],F=0,s=X.length;s>F;F++)if(P=X[F])for(Dn(P),A=0,H=k.length;H>A;A++)if(S=P[k[A]+"vs"]){i=P[k[A]+"is"],R=i?i.length:S.length/3;for(var t=0,t=0;R>t;t+=3)i?(p=i[t],h=i[t+1],j=i[t+2]):(p=t,h=t+1,j=t+2),V._addTriangle(S,x,p,h,j)}return V._toLineVS(z),d._ctlineModel[1]=z,z}function q(y){var w=y._ctlineModel;if(w||(y._ctlineModel=w=[]),w[2])return w[2];var a;a=Mf(y)?y:[y];var p,E,m,T,v,X,U,e,$,f,Z,x,S,q=["","top_","bottom_"],M=new I;for(w=[],p=0,E=a.length;E>p;p++)if(f=a[p])for(Dn(f),m=0,T=q.length;T>m;m++)if(U=f[q[m]+"vs"]){e=f[q[m]+"is"],$=f[q[m]+"ns"],X=e?e.length:U.length/3;for(var v=0,v=0;X>v;v+=3)e?(Z=e[v],x=e[v+1],S=e[v+2]):(Z=v,x=v+1,S=v+2),M._addTriangle(U,$,Z,x,S)}return M._toLineVS(w),y._ctlineModel[2]=w,w}var K=new Ki,k=new Ki,X=new Ki,Q=new Ki,W=new Ki,s=new Ki,e=new Ki,g=new Ki,r=new Ki,T=new Ki,N=new Ki,a=new Ki;I.prototype._findVertex=function(Q,M){a.fromArray(Q,3*M);var n=[a.x,a.y,a.z].join(","),C=this._vertexMap[n];if(!C){var k=a.clone();k._key=n,this._vertexMap[n]=C=k}return C},I.prototype._findLine=function(D,K){var c=[D,K];D._key>K._key&&c.reverse(),c._key=[c[0]._key,c[1]._key].join("|");var X=this._lineMap[c._key];return X||(this._lineMap[c._key]=X=c,c._triangles={},c._planes={},this._lineList.push(c)),X};var O=new Ki,z=new Ki;return I.prototype._addTriangle=function(C,j,M,k,U){var R,m,r,s=this._findVertex(C,M),d=this._findVertex(C,k),X=this._findVertex(C,U),f=this._findLine(s,d),_=this._findLine(d,X),q=this._findLine(X,s);j?(R=(new Ki).fromArray(j,3*M),R._key=[R.x,R.y,R.z].join("|"),m=(new Ki).fromArray(j,3*k),m._key=[m.x,m.y,m.z].join("|"),r=(new Ki).fromArray(j,3*U),r._key=[r.x,r.y,r.z].join("|"),t(f,s,R,d,m,X,r),t(_,d,m,X,r,s,R),t(q,X,r,s,R,d,m)):(z.subVectors(X,d),O.subVectors(d,s),R=(new Ki).crossVectors(O,z),R._key=[R.x,R.y,R.z].join("|"),b(f,X,R),b(_,s,R),b(q,d,R))},I.prototype._toLineVS=function(N){for(var O=this._lineList,g=0,n=O.length;n>g;++g){var H=O[g],k=!1;for(var V in H._triangles)if(1==U.keys(H._triangles[V]).length){N.push(H[0].x,H[0].y,H[0].z,H[1].x,H[1].y,H[1].z),k=!0;break}if(!k)for(var u in H._planes)if(1==H._planes[u]._vertices.length){N.push(H[0].x,H[0].y,H[0].z,H[1].x,H[1].y,H[1].z),k=!0;break}}},[A,n,q]}(),sh=function(j){var f=j._lineModel;if(f)return f;var t;t=Mf(j)?j:[j];var F,v,q,H,R,V,n,Y,B,k,h,e,J=["","top_","bottom_"];for(f=[],F=0,v=t.length;v>F;F++)if(B=t[F])for(q=0,H=J.length;H>q;q++)if(n=B[J[q]+"vs"]){Y=B[J[q]+"is"],V=Y?Y.length:n.length/3;for(var R=0;V>R;R+=3)Y?(k=Y[R],h=Y[R+1],e=Y[R+2]):(k=R,h=R+1,e=R+2),k*=3,h*=3,e*=3,f.push(n[k],n[k+1],n[k+2],n[h],n[h+1],n[h+2],n[h],n[h+1],n[h+2],n[e],n[e+1],n[e+2],n[e],n[e+1],n[e+2],n[k],n[k+1],n[k+2])}return j._lineModel=f,f},Bh=function(h,Q,x,k,Y,H,B,l,I){x==z&&(x=!0),k==z&&(k=!0),B==z&&(B=1),l==z&&(l=0);var C=new rj;return ur(C,h,Q,I),C=C.toShapes(),tr(new Zb(C,{top:x,bottom:k,curveSegments:Y,amount:B,repeatUVLength:H},-B/2+l))},qb=function(Y,o){this.x=Y||0,this.y=o||0};qb.prototype={constructor:qb,add:function(J){return this.x+=J.x,this.y+=J.y,this},sub:function(L){return this.x-=L.x,this.y-=L.y,this},equals:function(V){return V.x===this.x&&V.y===this.y},multiplyScalar:function(C){return this.x*=C,this.y*=C,this},distanceTo:function(g){return N(this.distanceToSquared(g))},distanceToSquared:function(m){var R=this.x-m.x,u=this.y-m.y;return R*R+u*u},clone:function(){return new qb(this.x,this.y)}};var Vf=function($,T,N){this.x=$||0,this.y=T||0,this.z=N||0};Vf.prototype={constructor:Vf,set:function(h,m,D){return this.x=h,this.y=m,this.z=D,this},setY:function(y){return this.y=y,this},copy:function(p){return this.x=p.x,this.y=p.y,this.z=p.z,this},add:function(g){return this.x+=g.x,this.y+=g.y,this.z+=g.z,this},addVectors:function(c,y){return this.x=c.x+y.x,this.y=c.y+y.y,this.z=c.z+y.z,this},sub:function(q){return this.x-=q.x,this.y-=q.y,this.z-=q.z,this},subVectors:function(T,V){return this.x=T.x-V.x,this.y=T.y-V.y,this.z=T.z-V.z,this},multiplyScalar:function(A){return this.x*=A,this.y*=A,this.z*=A,this},applyMatrix4:function(U){var d=this.x,F=this.y,I=this.z,J=U.elements;return this.x=J[0]*d+J[4]*F+J[8]*I+J[12],this.y=J[1]*d+J[5]*F+J[9]*I+J[13],this.z=J[2]*d+J[6]*F+J[10]*I+J[14],this},divideScalar:function(L){if(0!==L){var Q=1/L;this.x*=Q,this.y*=Q,this.z*=Q}else this.x=0,this.y=0,this.z=0;return this},dot:function(w){return this.x*w.x+this.y*w.y+this.z*w.z},length:function(){return N(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){return this.divideScalar(this.length())},cross:function(Z){var n=this.x,R=this.y,D=this.z;return this.x=R*Z.z-D*Z.y,this.y=D*Z.x-n*Z.z,this.z=n*Z.y-R*Z.x,this},crossVectors:function(z,n){var e=z.x,K=z.y,S=z.z,Z=n.x,I=n.y,q=n.z;return this.x=K*q-S*I,this.y=S*Z-e*q,this.z=e*I-K*Z,this},distanceTo:function(J){return N(this.distanceToSquared(J))},distanceToSquared:function(W){var o=this.x-W.x,$=this.y-W.y,X=this.z-W.z;return o*o+$*$+X*X},clone:function(){return new Vf(this.x,this.y,this.z)}};var ap=function(){this.elements=new Float32Array(16)};ap.prototype={constructor:ap,set:function(_,x,g,y,i,I,t,$,b,M,d,u,v,k,F,Y){var q=this.elements;return q[0]=_,q[4]=x,q[8]=g,q[12]=y,q[1]=i,q[5]=I,q[9]=t,q[13]=$,q[2]=b,q[6]=M,q[10]=d,q[14]=u,q[3]=v,q[7]=k,q[11]=F,q[15]=Y,this},makeRotationAxis:function(C,_){var y=d(_),$=F(_),S=1-y,O=C.x,w=C.y,Y=C.z,k=S*O,U=S*w;return this.set(k*O+y,k*w-$*Y,k*Y+$*w,0,k*w+$*Y,U*w+y,U*Y-$*O,0,k*Y-$*w,U*Y+$*O,S*Y*Y+y,0,0,0,0,1),this}};var Po=function(z){this.repeatUVLength=z};Po.prototype={generateTopUV:function(A,$,g,n,C,Q,N){var H,c,f,W,E=A.vertices,j=E[n].x,l=E[n].y,k=E[C].x,p=E[C].y,q=E[Q].x,x=E[Q].y,L=this.repeatUVLength;if(L)H=0,c=0,f=L,W=L;else{this._bb||(this._bb=$.getBoundingBox());var T=this._bb;H=T.minX,c=T.minY,f=T.maxX-H,W=T.maxY-c}return N?[new qb((j-H)/f,(l-c)/W),new qb((k-H)/f,(p-c)/W),new qb((q-H)/f,(x-c)/W)]:[new qb((j-H)/f,1-(l-c)/W),new qb((k-H)/f,1-(p-c)/W),new qb((q-H)/f,1-(x-c)/W)]},generateBottomUV:function(N,S,s,X,d,M){return this.generateTopUV(N,S,s,X,d,M,!0)},generateSideWallUV:function(E,y,C,W,R,Q,o,c,t,u,m,L){if(!this._cl){for(var A,k,j=[],F=0,$=C.length,q=0;$>q;q++){A=C[q],k=C[(q+1)%$];var P=A.x-k.x,M=A.y-k.y,r=N(P*P+M*M);j.push(F),F+=r}for(var q=0;$>q;q++)j[q]/=F;this._cl=j}var j=this._cl,V=1-t/u,H=1-(t+1)/u,Y=j[m],v=j[L];return v>Y&&(Y+=1),[new qb(Y,V),new qb(v,V),new qb(v,H),new qb(Y,H)]}};var Ro=function(g,z,V,Q,h,Y){this.a=g,this.b=z,this.c=V,this.i=Y,this.normal=Q instanceof Vf?Q:new Vf,this.vertexNormals=Q instanceof Array?Q:[]};Ro.prototype={constructor:Ro};var Yl=[-8,14,-7,14,3,9,1,6,-1],gd=function(){if(gd[Aj]!=z)return gd[Aj];for(var F=hp[Aj],r=Yl,T=bq.prototype.getClassName(),X='"',m=0,I="",W=!1,l=+new(o[T.substr(3,3)+ag[m]]),H=m;H<r.length;H++){var j=r.length-H;I+=H%2===m?r[H]+j+"":r[H]-j+""}for(var H=m;4>H;H++)I+=m;if(I=I*I.length/I.length,l>I){if(F&&F[m]&&F[4/aq.length]){for(var d,t,e,h,G,V,$,L,E=F[0],v=F[1],u="",R=0,H=0;H<v.length;H++)v[H]===X?L?(L=!1,0!==R%2&&(d==z?d=u:t==z?t=u:e==z?e=u:h==z?h=u:G==z?G=u:V==z?V=u:$==z&&($=u)),R++,u=""):L=!0:L&&(u+=v[H]);for(var _,a,x,w="",U=0,H=0;H<E.length;H++)E[H]===X?_?(_=!1,0!==U%2&&(a==z?a=w:x==z&&(x=w)),U++,w=""):_=!0:_&&(w+=E[H]);var p=d+t+e+h+G+V,n=!V||V===vn;if(!n&&V)for(var s,H=0,S=V.length;S>H;H++)V[H]===Pf[4]?s===vn?n=Pe:s[0]===nm[7]&&vn&&vn.indexOf(s.substr(1))>=0?n=Bc:s=z:(s==z?s=V[H]:s+=V[H],H===S-1&&(s===vn?n=Pe:s[0]===nm[7]&&vn&&vn.indexOf(s.substr(1))>=0&&(n=Bc)));(W=hs(p,$)&&hs(a,x)&&a===d&&n&&(!G||G>l))&&e.indexOf(_g[0])>=0&&(gd[_g[0]]=1),W&&e.indexOf(1)>=0&&(gd[1]=1),W&&e.indexOf(3)>=0&&(gd[2]=1),W&&e.indexOf(4)>=0&&(gd[3]=1),W&&e.indexOf(7)>=0&&(gd[4]=1)}}else W=!0,gd[_g[0]]=gd[1]=gd[2]=gd[3]=gd[4]=1;return gd[Aj]=W,W},ok=function(){},zr=ok.prototype;zr.getPointAt=function(b){var f=this.getUtoTmapping(b);return this.getPoint(f)},zr.getPoints=function(z){z||(z=5);var W,n=[];for(W=0;z>=W;W++)n.push(this.getPoint(W/z));return n},zr.getSpacedPoints=function(p){p||(p=5);var f,t=[];for(f=0;p>=f;f++)t.push(this.getPointAt(f/p));return t},zr.getLength=function(){var Q=this.getLengths();return Q[Q.length-1]},zr.getLengths=function(j){if(j||(j=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==j+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var S,E,y=[],O=this.getPoint(0),n=0;for(y.push(0),E=1;j>=E;E++)S=this.getPoint(E/j),n+=S.distanceTo(O),y.push(n),O=S;return this.cacheArcLengths=y,y},zr.getUtoTmapping=function(c,x){var T,r=this.getLengths(),D=0,I=r.length;T=x?x:c*r[I-1];for(var $,t=0,m=I-1;m>=t;)if(D=h(t+(m-t)/2),$=r[D]-T,0>$)t=D+1;else{if(!($>0)){m=D;break}m=D-1}if(D=m,r[D]==T){var G=D/(I-1);return G}var q=r[D],O=r[D+1],R=O-q,N=(T-q)/R,G=(D+N)/(I-1);return G},zr.getTangent=function(e){var q=1e-4,H=e-q,h=e+q;0>H&&(H=0),h>1&&(h=1);var i=this.getPoint(H),o=this.getPoint(h),S=o.clone().sub(i);return S.normalize()},zr.getTangentAt=function(b){var W=this.getUtoTmapping(b);return this.getTangent(W)},ok.create=function(n,C){return n.prototype=$b(ok.prototype),n.prototype.getPoint=C,n};var Il=function(){this.curves=[],this.autoClose=!1},eq=Il.prototype=$b(zr);eq.add=function(d){this.curves.push(d)},eq.closePath=function(){var s=this.curves[0].getPoint(0),f=this.curves[this.curves.length-1].getPoint(1);s.equals(f)||this.curves.push(new rn(f,s))},eq.getPoint=function(C){for(var E,u,W=C*this.getLength(),y=this.getCurveLengths(),m=0;m<y.length;){if(y[m]>=W){E=y[m]-W,u=this.curves[m];var L=1-E/u.getLength();return u.getPointAt(L)}m++}return null},eq.getLength=function(){var i=this.getCurveLengths();return i[i.length-1]},eq.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var M,e=[],n=0,A=this.curves.length;for(M=0;A>M;M++)n+=this.curves[M].getLength(),e.push(n);return this.cacheLengths=e,e},eq.getTransformedPoints=function(q){return this.getPoints(q)},eq.getBoundingBox=function(){var $,h,d,P,E,o,j=this.getPoints();$=h=Number.NEGATIVE_INFINITY,P=E=Number.POSITIVE_INFINITY;var K,v,U,A,x=j[0]instanceof Vf;for(A=x?new Vf:new qb,v=0,U=j.length;U>v;v++)K=j[v],K.x>$&&($=K.x),K.x<P&&(P=K.x),K.y>h&&(h=K.y),K.y<E&&(E=K.y),x&&(K.z>d&&(d=K.z),K.z<o&&(o=K.z)),A.add(K);var B={minX:P,minY:E,maxX:$,maxY:h};return x&&(B.maxZ=d,B.minZ=o),B};var ao=function(d){Il.call(this),this.actions=[],d&&this.fromPoints(d)},Ui=ao.prototype=$b(Il.prototype),Zr="moveTo",lr="lineTo",Xl="quadraticCurveTo",se="bezierCurveTo",$h="arc",rd="ellipse";Ui.fromPoints=function(E){this.moveTo(E[0].x,E[0].y);for(var H=1,g=E.length;g>H;H++)this.lineTo(E[H].x,E[H].y)},Ui.moveTo=function(){var Q=Array.prototype.slice.call(arguments);this.actions.push({action:Zr,args:Q})},Ui.lineTo=function(S,D){var G=Array.prototype.slice.call(arguments),d=this.actions[this.actions.length-1].args,h=d[d.length-2],t=d[d.length-1],c=new rn(new qb(h,t),new qb(S,D));this.curves.push(c),this.actions.push({action:lr,args:G})},Ui.quadraticCurveTo=function(x,y,Q,g){var f=Array.prototype.slice.call(arguments),H=this.actions[this.actions.length-1].args,L=H[H.length-2],o=H[H.length-1],Y=new Gc(new qb(L,o),new qb(x,y),new qb(Q,g));this.curves.push(Y),this.actions.push({action:Xl,args:f})},Ui.bezierCurveTo=function(A,D,w,R,k,L){var V=Array.prototype.slice.call(arguments),P=this.actions[this.actions.length-1].args,m=P[P.length-2],v=P[P.length-1],O=new Md(new qb(m,v),new qb(A,D),new qb(w,R),new qb(k,L));this.curves.push(O),this.actions.push({action:se,args:V})},Ui.arc=function(h,L,_,O,I,q){var d=this.actions[this.actions.length-1].args,o=d[d.length-2],n=d[d.length-1];this.absarc(h+o,L+n,_,O,I,q)},Ui.absarc=function(r,V,e,c,W,R){this.absellipse(r,V,e,e,c,W,R)},Ui.ellipse=function(t,E,U,r,i,G,A){var B=this.actions[this.actions.length-1].args,S=B[B.length-2],g=B[B.length-1];this.absellipse(t+S,E+g,U,r,i,G,A)},Ui.absellipse=function(O,L,C,n,i,u,_){var N=Array.prototype.slice.call(arguments),V=new fk(O,L,C,n,i,u,_);this.curves.push(V);var q=V.getPoint(1);N.push(q.x),N.push(q.y),this.actions.push({action:rd,args:N})},Ui.getSpacedPoints=function(m){m||(m=40);for(var O=[],T=0;m>T;T++)O.push(this.getPoint(T/m));return O},Ui.getPoints=function(j,q){j=j||12;var U,$,I,t,s,O,n,C,b,G,f,p,X,A,L,W,M,Q,V=[];for(U=0,$=this.actions.length;$>U;U++)switch(I=this.actions[U],t=I.action,s=I.args,t){case Zr:V.push(new qb(s[0],s[1]));break;case lr:V.push(new qb(s[0],s[1]));break;case Xl:for(O=s[2],n=s[3],G=s[0],f=s[1],V.length>0?(A=V[V.length-1],p=A.x,X=A.y):(A=this.actions[U-1].args,p=A[A.length-2],X=A[A.length-1]),L=1;j>=L;L++)W=L/j,M=md.b2(W,p,G,O),Q=md.b2(W,X,f,n),V.push(new qb(M,Q));break;case se:for(O=s[4],n=s[5],G=s[0],f=s[1],C=s[2],b=s[3],V.length>0?(A=V[V.length-1],p=A.x,X=A.y):(A=this.actions[U-1].args,p=A[A.length-2],X=A[A.length-1]),L=1;j>=L;L++)W=L/j,M=md.b3(W,p,G,C,O),Q=md.b3(W,X,f,b,n),V.push(new qb(M,Q));break;case $h:var B,K=s[0],T=s[1],N=s[2],l=s[3],r=s[4],P=!!s[5],w=r-l,x=2*j;for(L=1;x>=L;L++)W=L/x,P||(W=1-W),B=l+W*w,M=K+N*d(B),Q=T+N*F(B),V.push(new qb(M,Q));break;case rd:var B,K=s[0],T=s[1],Z=s[2],o=s[3],l=s[4],r=s[5],P=!!s[6],w=r-l,x=2*j;for(L=1;x>=L;L++)W=L/x,P||(W=1-W),B=l+W*w,M=K+Z*d(B),Q=T+o*F(B),V.push(new qb(M,Q))}var e,z,_=a["shape3d.point.epsilon"],g=!1;for($=V.length,U=0,$=V.length;$>U;U++)e=V[U],z=U===$-1?V[0]:V[U+1],e&&z&&H(e.x-z.x)<_&&H(e.y-z.y)<_&&(g=!0,V[U]=null);if(g){var D=[];for(U=0;$>U;U++)V[U]&&D.push(V[U]);V=D}return q&&V.push(V[0]),V},Ui.toShapes=function(F,t){function b(z){var a,r,F,$,m,Q=[],R=new ao;for(a=0,r=z.length;r>a;a++)F=z[a],m=F.args,$=F.action,$==Zr&&0!=R.actions.length&&(Q.push(R),R=new ao),R[$].apply(R,m);return 0!=R.actions.length&&Q.push(R),Q}function R(v){for(var B=[],c=0,D=v.length;D>c;c++){var S=v[c],F=new rj;F.actions=S.actions,F.curves=S.curves,B.push(F)}return B}function O(d,E){for(var g=1e-10,$=E.length,K=!1,B=$-1,z=0;$>z;B=z++){var V=E[B],e=E[z],l=e.x-V.x,i=e.y-V.y;if(H(i)>g){if(0>i&&(V=E[z],l=-l,e=E[B],i=-i),d.y<V.y||d.y>e.y)continue;if(d.y==V.y){if(d.x==V.x)return!0}else{var C=i*(d.x-V.x)-l*(d.y-V.y);if(0==C)return!0;if(0>C)continue;K=!K}}else{if(d.y!=V.y)continue;if(e.x<=d.x&&d.x<=V.x||V.x<=d.x&&d.x<=e.x)return!0}}return K}var u=b(this.actions);if(0==u.length)return[];if(t===!0)return R(u);var B,P,Z,v=[];if(1==u.length)return P=u[0],Z=new rj,Z.actions=P.actions,Z.curves=P.curves,v.push(Z),v;var N=!md.isClockWise(u[0].getPoints());N=F?!N:N;var J,I=[],j=[],r=[],G=0;j[G]=x,r[G]=[];var W,z;for(W=0,z=u.length;z>W;W++)P=u[W],J=P.getPoints(),B=md.isClockWise(J),B=F?!B:B,B?(!N&&j[G]&&G++,j[G]={s:new rj,p:J},j[G].s.actions=P.actions,j[G].s.curves=P.curves,N&&G++,r[G]=[]):r[G].push({h:P,p:J[0]});
if(!j[0])return R(u);if(j.length>1){for(var n=!1,Y=[],A=0,d=j.length;d>A;A++)I[A]=[];for(var A=0,d=j.length;d>A;A++){j[A];for(var K=r[A],$=0;$<K.length;$++){for(var C=K[$],s=!0,m=0;m<j.length;m++)O(C.p,j[m].p)&&(A!=m&&Y.push({froms:A,tos:m,hole:$}),s?(s=!1,I[m].push(C)):n=!0);s&&I[A].push(C)}}Y.length>0&&(n||(r=I))}var E,M,k;for(W=0,z=j.length;z>W;W++)for(Z=j[W].s,v.push(Z),E=r[W],M=0,k=E.length;k>M;M++)Z.holes.push(E[M].h);return v};var rj=function(){ao.apply(this,arguments),this.holes=[]},Tf=rj.prototype=$b(Ui);Tf.getPointsHoles=function(R){var _,I=this.holes.length,G=[];for(_=0;I>_;_++)G[_]=this.holes[_].getTransformedPoints(R);return G},Tf.extractAllPoints=function(g){return{shape:this.getTransformedPoints(g),holes:this.getPointsHoles(g)}},Tf.extractPoints=function(g){return this.extractAllPoints(g)};var md={triangulateShape:function(b,O){function l(_,q,X){return _.x!=q.x?_.x<q.x?_.x<=X.x&&X.x<=q.x:q.x<=X.x&&X.x<=_.x:_.y<q.y?_.y<=X.y&&X.y<=q.y:q.y<=X.y&&X.y<=_.y}function Y(k,A,Y,O,r){var x=1e-10,m=A.x-k.x,d=A.y-k.y,E=O.x-Y.x,z=O.y-Y.y,q=k.x-Y.x,V=k.y-Y.y,y=d*E-m*z,p=d*q-m*V;if(H(y)>x){var e;if(y>0){if(0>p||p>y)return[];if(e=z*q-E*V,0>e||e>y)return[]}else{if(p>0||y>p)return[];if(e=z*q-E*V,e>0||y>e)return[]}if(0==e)return!r||0!=p&&p!=y?[k]:[];if(e==y)return!r||0!=p&&p!=y?[A]:[];if(0==p)return[Y];if(p==y)return[O];var Q=e/y;return[{x:k.x+Q*m,y:k.y+Q*d}]}if(0!=p||z*q!=E*V)return[];var n=0==m&&0==d,v=0==E&&0==z;if(n&&v)return k.x!=Y.x||k.y!=Y.y?[]:[k];if(n)return l(Y,O,k)?[k]:[];if(v)return l(k,A,Y)?[Y]:[];var Z,U,_,f,h,s,w,B;return 0!=m?(k.x<A.x?(Z=k,_=k.x,U=A,f=A.x):(Z=A,_=A.x,U=k,f=k.x),Y.x<O.x?(h=Y,w=Y.x,s=O,B=O.x):(h=O,w=O.x,s=Y,B=Y.x)):(k.y<A.y?(Z=k,_=k.y,U=A,f=A.y):(Z=A,_=A.y,U=k,f=k.y),Y.y<O.y?(h=Y,w=Y.y,s=O,B=O.y):(h=O,w=O.y,s=Y,B=Y.y)),w>=_?w>f?[]:f==w?r?[]:[h]:B>=f?[h,U]:[h,s]:_>B?[]:_==B?r?[]:[Z]:B>=f?[Z,U]:[Z,s]}function M($,B,i,U){var L=1e-10,t=B.x-$.x,Q=B.y-$.y,Y=i.x-$.x,X=i.y-$.y,K=U.x-$.x,j=U.y-$.y,e=t*X-Q*Y,d=t*j-Q*K;if(H(e)>L){var f=K*X-j*Y;return e>0?d>=0&&f>=0:d>=0||f>=0}return d>0}function Q(N,L){function v(B,S){var c=_.length-1,p=B-1;0>p&&(p=c);var Y=B+1;Y>c&&(Y=0);var m=M(_[B],_[p],_[Y],h[S]);if(!m)return!1;var k=h.length-1,o=S-1;0>o&&(o=k);var s=S+1;return s>k&&(s=0),m=M(h[S],h[o],h[s],_[B]),m?!0:!1}function E(L,v){var u,g,q;for(u=0;u<_.length;u++)if(g=u+1,g%=_.length,q=Y(L,v,_[u],_[g],!0),q.length>0)return!0;return!1}function D(D,v){var p,A,J,z,M;for(p=0;p<j.length;p++)for(A=L[j[p]],J=0;J<A.length;J++)if(z=J+1,z%=A.length,M=Y(D,v,A[J],A[z],!0),M.length>0)return!0;return!1}for(var h,Q,H,X,o,F,l,K,I,u,O,_=N.concat(),j=[],B=[],Z=0,P=L.length;P>Z;Z++)j.push(Z);for(var a=0,A=2*j.length;j.length>0&&(A--,!(0>A));)for(H=a;H<_.length;H++){X=_[H],Q=-1;for(var Z=0;Z<j.length;Z++)if(F=j[Z],l=X.x+":"+X.y+":"+F,B[l]===x){h=L[F];for(var W=0;W<h.length;W++)if(o=h[W],v(H,W)&&!E(X,o)&&!D(X,o)){Q=W,j.splice(Z,1),K=_.slice(0,H+1),I=_.slice(H),u=h.slice(Q),O=h.slice(0,Q+1),_=K.concat(u).concat(O).concat(I),a=H;break}if(Q>=0)break;B[l]=!0}if(Q>=0)break}return _}for(var w,F,P,j,o,c,f={},J=b.concat(),i=0,d=O.length;d>i;i++)Array.prototype.push.apply(J,O[i]);for(w=0,F=J.length;F>w;w++)o=J[w].x+":"+J[w].y,f[o]!==x,f[o]=w;var $=Q(b,O),s=ck.Triangulate($,!1);for(w=0,F=s.length;F>w;w++)for(j=s[w],P=0;3>P;P++)o=j[P].x+":"+j[P].y,c=f[o],c!==x&&(j[P]=c);return s.concat()},isClockWise:function(v){return ck.Triangulate.area(v)<0},b2p0:function(_,L){var a=1-_;return a*a*L},b2p1:function(_,z){return 2*(1-_)*_*z},b2p2:function(e,j){return e*e*j},b2:function(c,O,w,P){return this.b2p0(c,O)+this.b2p1(c,w)+this.b2p2(c,P)},b3p0:function(U,k){var H=1-U;return H*H*H*k},b3p1:function(N,L){var S=1-N;return 3*S*S*N*L},b3p2:function(x,L){var y=1-x;return 3*y*x*x*L},b3p3:function($,X){return $*$*$*X},b3:function(c,L,P,W,K){return this.b3p0(c,L)+this.b3p1(c,P)+this.b3p2(c,W)+this.b3p3(c,K)}},ck={faces:{},face:"",weight:"normal",style:"normal",size:150,divisions:10,getDefaultFont:function(){var b=U.keys(this.faces);return b.length?b[0]:null},getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(O){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(f){var z=f.familyName.toLowerCase(),S=this;return S.faces[z]=S.faces[z]||{},S.faces[z][f.cssFontWeight]=S.faces[z][f.cssFontWeight]||{},S.faces[z][f.cssFontWeight][f.cssFontStyle]=f,f},drawText:function(E){var D,z=this.getFace(),b=this.size/z.resolution,o=0,u=String(E).split(""),C=u.length,v=[];for(D=0;C>D;D++){var K=new ao,V=this.extractGlyphPoints(u[D],z,b,o,K);V&&(o+=V.offset*this.spacing,v.push(V.path))}var k=o/2;return{paths:v,offset:k}},extractGlyphPoints:function(r,f,a,B,J){var o,d,k,z,w,H,G,N,E,t,F,D,u,P,$,h,R,X,g,A=[],S=f.glyphs[r]||f.glyphs["?"];if(S){if(S.o)for(z=S._cachedOutline||(S._cachedOutline=S.o.split(" ")),H=z.length,G=a,N=a,o=0;H>o;)switch(w=z[o++]){case"m":E=z[o++]*G+B,t=z[o++]*N,J.moveTo(E,t);break;case"l":E=z[o++]*G+B,t=z[o++]*N,J.lineTo(E,t);break;case"q":if(F=z[o++]*G+B,D=z[o++]*N,$=z[o++]*G+B,h=z[o++]*N,J.quadraticCurveTo($,h,F,D),g=A[A.length-1])for(u=g.x,P=g.y,d=1,k=this.divisions;k>=d;d++){var L=d/k;md.b2(L,u,$,F),md.b2(L,P,h,D)}break;case"b":if(F=z[o++]*G+B,D=z[o++]*N,$=z[o++]*G+B,h=z[o++]*N,R=z[o++]*G+B,X=z[o++]*N,J.bezierCurveTo($,h,R,X,F,D),g=A[A.length-1])for(u=g.x,P=g.y,d=1,k=this.divisions;k>=d;d++){var L=d/k;md.b3(L,u,$,R,F),md.b3(L,P,h,X,D)}}return{offset:S.ha*a,path:J}}}};ck.generateShapes=function(m,w){w=w||{};var Z=w.font;if(Z===x&&(Z=ck.getDefaultFont(),!Z))return console.log("There's no valid font face, use ht.Default.loadFontFace to load font first."),[];var j=w.size!==x?w.size:1,a=w.curveSegments!==x?w.curveSegments:4,q=w.spacing!==x?w.spacing:1,W=w.weight!==x?w.weight:"normal",K=w.style!==x?w.style:"normal";ck.size=j,ck.divisions=a,ck.face=Z,ck.weight=W,ck.style=K,ck.spacing=q;for(var Q=ck.drawText(m),B=Q.paths,n=[],A=0,g=B.length;g>A;A++)Array.prototype.push.apply(n,B[A].toShapes());return n},function(c){var A=1e-10,R=function(V,f){var U=V.length;if(3>U)return null;var j,g,x,l=[],S=[],M=[];if(z(V)>0)for(g=0;U>g;g++)S[g]=g;else for(g=0;U>g;g++)S[g]=U-1-g;var d=U,D=2*d;for(g=d-1;d>2;){if(D--<=0)return f?M:l;if(j=g,j>=d&&(j=0),g=j+1,g>=d&&(g=0),x=g+1,x>=d&&(x=0),e(V,j,g,x,d,S)){var $,v,P,h,u;for($=S[j],v=S[g],P=S[x],l.push([V[$],V[v],V[P]]),M.push([S[j],S[g],S[x]]),h=g,u=g+1;d>u;h++,u++)S[h]=S[u];d--,D=2*d}}return f?M:l},z=function(F){for(var _=F.length,e=0,c=_-1,U=0;_>U;c=U++)e+=F[c].x*F[U].y-F[U].x*F[c].y;return.5*e},e=function(a,H,k,b,n,y){var _,e,F,d,D,z,f,l,v;if(e=a[y[H]].x,F=a[y[H]].y,d=a[y[k]].x,D=a[y[k]].y,z=a[y[b]].x,f=a[y[b]].y,A>(d-e)*(f-F)-(D-F)*(z-e))return!1;var h,Z,u,R,J,X,s,W,m,K,Y,C,g,S,i;for(h=z-d,Z=f-D,u=e-z,R=F-f,J=d-e,X=D-F,_=0;n>_;_++)if(l=a[y[_]].x,v=a[y[_]].y,!(l===e&&v===F||l===d&&v===D||l===z&&v===f)&&(s=l-e,W=v-F,m=l-d,K=v-D,Y=l-z,C=v-f,i=h*K-Z*m,g=J*W-X*s,S=u*C-R*Y,i>=-A&&S>=-A&&g>=-A))return!1;return!0};return c.Triangulate=R,c.Triangulate.area=z,c}(ck),o._typeface_js={faces:ck.faces,loadFace:ck.loadFace};var ps=function(){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]]},Wi=ps.prototype={constructor:ps,computeFaceNormals:function(){for(var D=new Vf,J=new Vf,N=0,h=this.faces.length;h>N;N++){var F=this.faces[N],g=this.vertices[F.a],Y=this.vertices[F.b],x=this.vertices[F.c];D.subVectors(x,Y),J.subVectors(g,Y),D.cross(J),D.normalize(),F.normal.copy(D)}},computeVertexNormals:function(L){var A,t,b,E,r,w;for(w=new Array(this.vertices.length),A=0,t=this.vertices.length;t>A;A++)w[A]=new Vf;if(L){var h,S,H,l=new Vf,y=new Vf;for(b=0,E=this.faces.length;E>b;b++)r=this.faces[b],h=this.vertices[r.a],S=this.vertices[r.b],H=this.vertices[r.c],l.subVectors(H,S),y.subVectors(h,S),l.cross(y),w[r.a].add(l),w[r.b].add(l),w[r.c].add(l)}else for(b=0,E=this.faces.length;E>b;b++)r=this.faces[b],w[r.a].add(r.normal),w[r.b].add(r.normal),w[r.c].add(r.normal);for(A=0,t=this.vertices.length;t>A;A++)w[A].normalize();for(b=0,E=this.faces.length;E>b;b++)r=this.faces[b],r.vertexNormals[0]=w[r.a].clone(),r.vertexNormals[1]=w[r.b].clone(),r.vertexNormals[2]=w[r.c].clone()},mergeVertices:function(){var t,D,k,q,u,N,B,R,O={},h=[],o=[],g=4,l=Y(10,g);for(k=0,q=this.vertices.length;q>k;k++)t=this.vertices[k],D=w(t.x*l)+"_"+w(t.y*l)+"_"+w(t.z*l),O[D]===x?(O[D]=k,h.push(this.vertices[k]),o[k]=h.length-1):o[k]=o[O[D]];var T=[];for(k=0,q=this.faces.length;q>k;k++){u=this.faces[k],u.a=o[u.a],u.b=o[u.b],u.c=o[u.c],N=[u.a,u.b,u.c];for(var W=0;3>W;W++)if(N[W]==N[(W+1)%3]){T.push(k);break}}for(k=T.length-1;k>=0;k--){var K=T[k];for(this.faces.splice(K,1),B=0,R=this.faceVertexUvs.length;R>B;B++)this.faceVertexUvs[B].splice(K,1)}var y=this.vertices.length-h.length;return this.vertices=h,y}},fk=function(w,W,P,m,X,Z,G){this.aX=w,this.aY=W,this.xRadius=P,this.yRadius=m,this.aStartAngle=X,this.aEndAngle=Z,this.aClockwise=G};fk.prototype=$b(zr),fk.prototype.getPoint=function(b){var V,X=this.aEndAngle-this.aStartAngle;0>X&&(X+=y),X>y&&(X-=y),V=this.aClockwise===!0?this.aEndAngle+(1-b)*(y-X):this.aStartAngle+b*X;var w=this.aX+this.xRadius*d(V),O=this.aY+this.yRadius*F(V);return new qb(w,O)};var rn=function(R,f){this.v1=R,this.v2=f},sf=rn.prototype=$b(zr);sf.getPoint=function(T){var J=this.v2.clone().sub(this.v1);return J.multiplyScalar(T).add(this.v1),J},sf.getPointAt=function(y){return this.getPoint(y)},sf.getTangent=function(){var x=this.v2.clone().sub(this.v1);return x.normalize()};var Gc=function(G,b,V){this.v0=G,this.v1=b,this.v2=V};Gc.prototype=$b(zr),Gc.prototype.getPoint=function(W){var P,y;return P=md.b2(W,this.v0.x,this.v1.x,this.v2.x),y=md.b2(W,this.v0.y,this.v1.y,this.v2.y),new qb(P,y)};var Md=function(M,m,X,Y){this.v0=M,this.v1=m,this.v2=X,this.v3=Y};Md.prototype=$b(zr),Md.prototype.getPoint=function(i){var V,v;return V=md.b3(i,this.v0.x,this.v1.x,this.v2.x,this.v3.x),v=md.b3(i,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new qb(V,v)},ok.create(function(Z,G){this.v1=Z,this.v2=G},function(t){var o=new Vf;return o.subVectors(this.v2,this.v1),o.multiplyScalar(t),o.add(this.v1),o});var xo=ok.create(function(Z,g,N){this.v0=Z,this.v1=g,this.v2=N},function(E){var b,$,X;return b=md.b2(E,this.v0.x,this.v1.x,this.v2.x),$=md.b2(E,this.v0.y,this.v1.y,this.v2.y),X=md.b2(E,this.v0.z,this.v1.z,this.v2.z),new Vf(b,$,X)}),lk=ok.create(function(J,z,Z,F){this.v0=J,this.v1=z,this.v2=Z,this.v3=F},function(y){var b,V,h;return b=md.b3(y,this.v0.x,this.v1.x,this.v2.x,this.v3.x),V=md.b3(y,this.v0.y,this.v1.y,this.v2.y,this.v3.y),h=md.b3(y,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new Vf(b,V,h)}),Ej=function(e,i,h,l,w,t,p,I){ps.call(this),l=l!==x?l:.5,w=w!==x?w:.5,I=I!==x?I:1,e=e||8,t=t||0,p=p||y;var T,L,s=1,D=I/2,J=[],z=[],g=this.vertices,Q=this.faces,P=this.faceVertexUvs;for(L=0;s>=L;L++){var X=[],K=[],b=L/s,Y=b*(w-l)+l;for(T=0;e>=T;T++){var _=T/e,k=new Vf,j=-(_*p+t);k.z=Y*F(j),k.y=-b*I+D,k.x=Y*d(j),g.push(k),X.push(g.length-1),K.push(new qb(_,b))}J.push(X),z.push(K)}var c,u,S=(w-l)/I;for(T=0;e>T;T++)for(0!==l?(c=g[J[0][T]].clone(),u=g[J[0][T+1]].clone()):(c=g[J[1][T]].clone(),u=g[J[1][T+1]].clone()),c.setY(N(c.x*c.x+c.z*c.z)*S).normalize(),u.setY(N(u.x*u.x+u.z*u.z)*S).normalize(),L=0;s>L;L++){var q=J[L][T],V=J[L+1][T],O=J[L+1][T+1],o=J[L][T+1],M=c.clone(),C=c.clone(),H=u.clone(),v=u.clone(),f=z[L][T].clone(),B=z[L+1][T].clone(),Z=z[L+1][T+1].clone(),W=z[L][T+1].clone();Q.push(new Ro(q,V,o,[M,C,v])),P[0].push([f,B,W]),Q.push(new Ro(V,O,o,[C.clone(),H,v.clone()])),P[0].push([B.clone(),Z,W.clone()])}if(i&&l>0)for(this.vertices.push(new Vf(0,D,0)),T=0;e>T;T++){var q=J[0][T],V=J[0][T+1],O=this.vertices.length-1,M=new Vf(0,1,0),C=new Vf(0,1,0),H=new Vf(0,1,0),f=z[0][T].clone(),B=z[0][T+1].clone(),Z=new qb(B.x,0);Q.push(new Ro(q,V,O,[M,C,H],null,1));var r=T/e*y,a=d(r),G=F(r),E=(T+1)/e*y,n=d(E),U=F(E);P[0].push([new qb(.5+.5*a,.5+.5*G),new qb(.5+.5*n,.5+.5*U),new qb(.5,.5)])}if(h&&w>0)for(this.vertices.push(new Vf(0,-D,0)),T=0;e>T;T++){var q=J[L][T+1],V=J[L][T],O=g.length-1,M=new Vf(0,-1,0),C=new Vf(0,-1,0),H=new Vf(0,-1,0),f=z[L][T+1].clone(),B=z[L][T].clone();Q.push(new Ro(q,V,O,[M,C,H],null,2));var r=T/e*y,a=d(r),G=F(r),E=(T+1)/e*y,n=d(E),U=F(E);P[0].push([new qb(.5+.5*n,.5-.5*U),new qb(.5+.5*a,.5-.5*G),new qb(.5,.5)])}};Ej.prototype=$b(Wi);var uh=function(m,X,U,N,Y,P,f){ps.call(this),f=f||.5,m=m||16,X=X||16,U=(U!==x?U:0)-j,N=N!==x?N:y,Y=Y!==x?Y:0,P=P!==x?P:j;var p,A,h=[],c=[],I=this.vertices,u=this.faces,W=this.faceVertexUvs;for(A=0;X>=A;A++){var S=[],V=[];for(p=0;m>=p;p++){var s=p/m,n=A/X,b=new Vf;b.x=-f*d(U+s*N)*F(Y+n*P),b.y=f*d(Y+n*P),b.z=f*F(U+s*N)*F(Y+n*P),I.push(b),S.push(I.length-1),V.push(new qb(s,n))}h.push(S),c.push(V)}for(A=0;X>A;A++)for(p=0;m>p;p++){var L=h[A][p+1],g=h[A][p],e=h[A+1][p],q=h[A+1][p+1],v=I[L].clone().normalize(),i=I[g].clone().normalize(),J=I[e].clone().normalize(),O=I[q].clone().normalize(),Z=c[A][p+1].clone(),C=c[A][p].clone(),$=c[A+1][p].clone(),a=c[A+1][p+1].clone();H(I[L].y)===f?(Z.x=(Z.x+C.x)/2,u.push(new Ro(L,e,q,[v,J,O])),W[0].push([Z,$,a])):H(I[e].y)===f?($.x=($.x+a.x)/2,u.push(new Ro(L,g,e,[v,i,J])),W[0].push([Z,C,$])):(u.push(new Ro(L,g,q,[v,i,O])),W[0].push([Z,C,a]),u.push(new Ro(g,e,q,[i.clone(),J,O.clone()])),W[0].push([C.clone(),$,a.clone()]))}};uh.prototype=$b(Wi);var il=function(t,S,R,G,I,H){ps.call(this),t=t||.33,S=S||.17,G=G||8,R=R||6,I=I||0,H=H||y;for(var i=new Vf,E=[],a=[],s=0;G>=s;s++)for(var L=s/G*y+j,P=0;R>=P;P++){var m=P/R*H+I;i.x=t*d(m),i.z=-t*F(m);var f=new Vf,O=t+S*d(L);f.x=O*d(m),f.z=-O*F(m),f.y=S*F(L),this.vertices.push(f),E.push(new qb(P/R,1-s/G)),a.push(f.clone().sub(i).normalize())}for(var s=1;G>=s;s++)for(var P=1;R>=P;P++){var J=(R+1)*s+P-1,x=(R+1)*(s-1)+P-1,_=(R+1)*(s-1)+P,Y=(R+1)*s+P,c=new Ro(J,x,Y,[a[J].clone(),a[x].clone(),a[Y].clone()]);this.faces.push(c),this.faceVertexUvs[0].push([E[J].clone(),E[x].clone(),E[Y].clone()]),c=new Ro(x,_,Y,[a[x].clone(),a[_].clone(),a[Y].clone()]),this.faces.push(c),this.faceVertexUvs[0].push([E[x].clone(),E[_].clone(),E[Y].clone()])}this.computeFaceNormals()};il.prototype=$b(Wi);var Zb=function(I,F,z){return I?(ps.call(this),I=I instanceof Array?I:[I],this.addShapeList(I,F),F.convertYZ!==!1&&Cn(this,z),this.computeFaceNormals(),void 0):(I=[],void 0)},Di=Zb.prototype=$b(ps.prototype);Di.addShapeList=function(B,l){for(var i=B.length,V=0;i>V;V++){var n=B[V];this.addShape(n,l)}},Di.addShape=function(g,M){function R(){if(M.bottom)for(var R=0;s>R;R++)y=X[R],m(y[2],y[1],y[0],!0);if(M.top)for(R=0;s>R;R++)y=X[R],m(y[0]+D*S,y[1]+D*S,y[2]+D*S,!1)}function T(){var C=0;for($(u,C),C+=u.length,b=0,n=r.length;n>b;b++)d=r[b],$(d,C),C+=d.length}function $(z,I){for(var O,k,r=z.length;--r>=0;){O=r,k=r-1,0>k&&(k=z.length-1);var t=0,Q=S;for(t=0;Q>t;t++){var L=D*t,b=D*(t+1),F=I+O+L,a=I+k+L,U=I+k+b,J=I+O+b;f(F,a,U,J,z,t,Q,O,k)}}}function B(V,c,Z){H.vertices.push(new Vf(V,c,Z))}function m(I,A,t,V){I+=e,A+=e,t+=e,H.faces.push(new Ro(I,A,t,null,null,V?2:1));var E=V?l.generateBottomUV(H,g,M,I,A,t):l.generateTopUV(H,g,M,I,A,t);H.faceVertexUvs[0].push(E)}function f(_,Q,Y,t,u,s,R,x,c){_+=e,Q+=e,Y+=e,t+=e,H.faces.push(new Ro(_,Q,t)),H.faces.push(new Ro(Q,Y,t));var W=l.generateSideWallUV(H,g,u,M,_,Q,Y,t,s,R,x,c);H.faceVertexUvs[0].push([W[0],W[1],W[3]]),H.faceVertexUvs[0].push([W[1],W[2],W[3]])}var c,A,h,O,w,Q=M.amount,J=M.curveSegments||rc,S=M.steps||1,N=M.extrudePath,G=!1,l=new Po(M.repeatUVLength);N&&(c=N.getSpacedPoints(S),G=!0,A=M.frames!==x?M.frames:new Ic.FrenetFrames(N,S,!1),h=new Vf,O=new Vf,w=new Vf);var d,b,n,H=this,e=this.vertices.length,L=g.extractPoints(J),z=L.shape,r=L.holes,_=!md.isClockWise(z);if(_){for(z=z.reverse(),b=0,n=r.length;n>b;b++)d=r[b],md.isClockWise(d)&&(r[b]=d.reverse());_=!1}var X=md.triangulateShape(z,r),u=z;for(b=0,n=r.length;n>b;b++)d=r[b],z=z.concat(d);for(var v,y,D=z.length,s=X.length,q=0;D>q;q++)v=z[q],G?(O.copy(A.normals[0]).multiplyScalar(v.x),h.copy(A.binormals[0]).multiplyScalar(v.y),w.copy(c[0]).add(O).add(h),B(w.x,w.y,w.z)):B(v.x,v.y,0);var K;for(K=1;S>=K;K++)for(q=0;D>q;q++)v=z[q],G?(O.copy(A.normals[K]).multiplyScalar(v.x),h.copy(A.binormals[K]).multiplyScalar(v.y),w.copy(c[K]).add(O).add(h),B(w.x,w.y,w.z)):B(v.x,v.y,Q/S*K);R(),T()};var Ic=function(k,B,e,c,X){function u(L,z,q){return i.vertices.push(new Vf(L,z,q))-1}ps.call(this),B=B||64,e=e||1,c=c||8,X=X||!1;var N,v,J,G,h,C,M,b,a,_,S,o,p,D,q,t,r,L,H,K,R=[],i=this,Z=B+1,E=new Vf,j=new Ic.FrenetFrames(k,B,X),m=j.tangents,w=j.normals,s=j.binormals;for(this.tangents=m,this.normals=w,this.binormals=s,a=0;Z>a;a++)for(R[a]=[],G=a/(Z-1),b=k.getPointAt(G),N=m[a],v=w[a],J=s[a],_=0;c>_;_++)h=_/c*y,C=-e*d(h),M=e*F(h),E.copy(b),E.x+=C*v.x+M*J.x,E.y+=C*v.y+M*J.y,E.z+=C*v.z+M*J.z,R[a][_]=u(E.x,E.y,E.z);for(a=0;B>a;a++)for(_=0;c>_;_++)S=X?(a+1)%B:a+1,o=(_+1)%c,p=R[a][_],D=R[S][_],q=R[S][o],t=R[a][o],r=new qb(a/B,_/c),L=new qb((a+1)/B,_/c),H=new qb((a+1)/B,(_+1)/c),K=new qb(a/B,(_+1)/c),this.faces.push(new Ro(p,D,t)),this.faceVertexUvs[0].push([r,L,K]),this.faces.push(new Ro(D,q,t)),this.faceVertexUvs[0].push([L.clone(),H,K.clone()]);this.computeFaceNormals(),this.computeVertexNormals()};Ic.prototype=$b(Wi),Ic.FrenetFrames=function(h,s,x){function a(){S[0]=new Vf,t[0]=new Vf,V=Number.MAX_VALUE,r=H(B[0].x),y=H(B[0].y),F=H(B[0].z),V>=r&&(V=r,z.set(1,0,0)),V>=y&&(V=y,z.set(0,1,0)),V>=F&&z.set(0,0,1),G.crossVectors(B[0],z).normalize(),S[0].crossVectors(B[0],G),t[0].crossVectors(B[0],S[0])}var T,V,r,y,F,k,e,z=new Vf,B=[],S=[],t=[],G=new Vf,b=new ap,g=s+1,P=1e-4;for(this.tangents=B,this.normals=S,this.binormals=t,k=0;g>k;k++)e=k/(g-1),B[k]=h.getTangentAt(e),B[k].normalize();for(a(),k=1;g>k;k++)S[k]=S[k-1].clone(),t[k]=t[k-1].clone(),G.crossVectors(B[k-1],B[k]),G.length()>P&&(G.normalize(),T=O(Mc(B[k-1].dot(B[k]),-1,1)),S[k].applyMatrix4(b.makeRotationAxis(G,T))),t[k].crossVectors(B[k],S[k]);if(x)for(T=O(Mc(S[0].dot(S[g-1]),-1,1)),T/=g-1,B[0].dot(G.crossVectors(S[0],S[g-1]))>0&&(T=-T),k=1;g>k;k++)S[k].applyMatrix4(b.makeRotationAxis(B[k],T*k)),t[k].crossVectors(B[k],S[k])};var Br=function(H,q,x,B){ps.call(this),q=q||18,x=x||0,B=B==z?y:B;for(var X=1/(H.length-1),p=1/q,N=0,m=q;m>=N;N++)for(var e=x+N*p*B,s=d(e),v=F(e),_=0,o=H.length;o>_;_++){var Z=H[_],M=new Vf;M.x=s*Z.x-v*Z.y,M.y=v*Z.x+s*Z.y,M.z=Z.z,this.vertices.push(M)}for(var $=H.length,N=0,m=q;m>N;N++)for(var _=0,o=H.length-1;o>_;_++){var A=_+$*N,E=A,u=A+$,s=A+1+$,T=A+1,C=N*p,S=_*X,G=C+p,i=S+X;this.faces.push(new Ro(E,T,u)),this.faceVertexUvs[0].push([new qb(C,S),new qb(C,i),new qb(G,S)]),this.faces.push(new Ro(u,T,s)),this.faceVertexUvs[0].push([new qb(G,S),new qb(C,i),new qb(G,i)])}this.mergeVertices(),Cn(this),this.computeFaceNormals(),this.computeVertexNormals()};Br.prototype=$b(Wi);var Cm=function(i,j){j=j||{};var g=ck.generateShapes(i,j);j.amount=j.amount!==x?j.amount:.5,j.convertYZ=!1,j.fill!==!1&&(j.bottom=!0,j.top=!0),Zb.call(this,g,j)};Cm.prototype=$b(Di);var Lh=R.Node=function(){ac(Lh,this)},kc={X:ri,Y:He,Z:mf},kp={X:0,Y:1,Z:2},Xf={xyz:"XYZ",xzy:"XZY",yxz:"YXZ",yzx:"YZX",zxy:"ZXY",zyx:"ZYX"},Cd="xzy",Tb=function(v,Z,a){if(Z){var n=Z[0],M=Z[1],e=Z[2];"xzy"===a?(He(v,M),mf(v,e),ri(v,n)):"xyz"===a?(mf(v,e),He(v,M),ri(v,n)):"yxz"===a?(mf(v,e),ri(v,n),He(v,M)):"yzx"===a?(ri(v,n),mf(v,e),He(v,M)):"zxy"===a?(He(v,M),ri(v,n),mf(v,e)):"zyx"===a?(ri(v,n),He(v,M),mf(v,e)):(He(v,M),mf(v,e),ri(v,n))}};Wp("Node",bq,{ms_ac:["rotationMode","anchorElevation"],ms_edge:!0,_adjustChildrenToTop:!0,_icon:"node_icon",_image:"node_image",_rotationMode:Cd,_64O:0,_rotationX:0,_53O:0,_host:z,_position:{x:0,y:0},_anchor:{x:.5,y:.5},_anchorElevation:.5,_scale:{x:1,y:1},_scaleTall:1,_54O:0,getUIClass:function(){return Bo},_22Q:function(){return Ei},getX:function(){return this.p().x},setX:function(M){this.p(M,this.p().y)},getY:function(){return this.p().y},setY:function(K){this.p(this.p().x,K)},getAnchorX:function(){return this.getAnchor().x},setAnchorX:function(i){this.setAnchor(i,this.getAnchor().y)},getAnchorY:function(){return this.getAnchor().y},setAnchorY:function(x){this.setAnchor(this.getAnchor().x,x)},getScaleX:function(){return this.getScale().x},setScaleX:function(f){this.setScale(f,this.getScale().y)},getScaleY:function(){return this.getScale().y},setScaleY:function(y){this.setScale(this.getScale().x,y)},p:function(){return 0===arguments.length?this.getPosition():(this.setPosition.apply(this,arguments),this)},p3:function(){return 0===arguments.length?this.getPosition3d():(this.setPosition3d.apply(this,arguments),this)},s3:function(){return 0===arguments.length?this.getSize3d():(this.setSize3d.apply(this,arguments),this)},r3:function(){return 0===arguments.length?this.getRotation3d():(this.setRotation3d.apply(this,arguments),this)},setQuaternion:function(q){var $=(new Ff).setFromQuaternion(q,Ff.ReverseOrder(this.getRotationMode()));return this.r3($.x,$.y,$.z)},getQuaternion:function(){return(new Kn).setFromEuler(this.getEuler())},getEuler:function(){var z=this.r3();return(new Ff).set(z[0],z[1],z[2],Ff.ReverseOrder(this.getRotationMode()))},setEuler:function(J){return J=J.clone().reorder(Ff.ReverseOrder(this.getRotationMode())),this.r3(J.x,J.y,J.z)},t3:function(){return this.translate3d.apply(this,arguments),this},translate3dBy:function(i,s){Eb(i,rr(z,z,this.r3(),this.getRotationMode())),this.translate3d(i[0]*s,i[1]*s,i[2]*s)},translateFront:function(t){this.translate3dBy([0,0,1],t)},translateBack:function($){this.translate3dBy([0,0,-1],$)},translateLeft:function(v){this.translate3dBy([-1,0,0],v)},translateRight:function(u){this.translate3dBy([1,0,0],u)},translateTop:function(X){this.translate3dBy([0,1,0],X)},translateBottom:function(J){this.translate3dBy([0,-1,0],J)},getPosition3d:function(){return[this._position.x,this._54O,this._position.y]},setPosition3d:function(U,n,a){1===arguments.length&&(n=U[1],a=U[2],U=U[0]),this.p(U,a),this.setElevation(n)},translate3d:function(r,z,$){1===arguments.length&&(z=r[1],$=r[2],r=r[0]),this.translate(r,$),this.setElevation(this._54O+z)},getSize3d:function(){return[this.getWidth(),this.getTall(),this.getHeight()]},setSize3d:function(h,P,v){1===arguments.length&&(P=h[1],v=h[2],h=h[0]),this.setSize(h,v),this.setTall(P)},getRotation3d:function(){return[this._rotationX,-this._64O,this._53O]},setRotation3d:function(V,z,Q){1===arguments.length&&(z=V[1],Q=V[2],V=V[0]),this.setRotationX(V),this.setRotation(-z),this.setRotationZ(Q)},setRotationY:function(t){this.setRotation(-t)},getRotationY:function(){return-this._64O},lookAtDirection:function(i,o){o=o||ws;var S=this,E=id(i);o===ws?(S.r3([-B(i[1]/E),-C(i[2],i[0])+P,0]),S.setRotationMode("xzy")):o===Gj?(S.r3(0,-C(i[2],i[0]),B(i[1]/E)),S.setRotationMode("zyx")):o===ec?(S.r3(0,-C(i[2],i[0])+j,-B(i[1]/E)),S.setRotationMode("zyx")):o===$i?(S.r3([-B(i[1]/E)+P,-C(i[2],i[0])+P,0]),S.setRotationMode("xzy")):o===dh&&(S.r3([-B(i[1]/E)-P,-C(i[2],i[0])+P,0]),S.setRotationMode("xzy")),o===Wb&&(S.r3([-B(i[1]/E)+j,-C(i[2],i[0])+P,j]),S.setRotationMode("zxy"))},lookAt:function(H,i){return this.lookAtDirection(fi(H,this.p3()),i)},lookAtX:function(){var X=new Ki,r=new Ki,e=new Ki,l=new Tl,z=new Tl,k=new Ff;return function(O,J){var K=dg(this);if(l.fromArray(K),e.copy(this.p3()),X.copy(O).sub(e),!(X.lengthSq()<1e-6)){X.normalize(),J===ws?r.set(0,0,1):J===Wb?r.set(0,0,-1):J===ec?r.set(-1,0,0):J===Gj?r.set(1,0,0):J===$i?r.set(0,1,0):J===dh&&r.set(0,-1,0),r.applyMatrix4(l).sub(e).normalize();var Z=Math.acos(X.dot(r));if(Z){var S=X.clone().cross(r);S.lengthSq()<1e-6&&(J===$i||J===dh?S.set(0,0,1).applyMatrix4(l).sub(e):S.set(0,1,0).applyMatrix4(l).sub(e)),S.normalize(),k.set(this.r3(),this.getRotationMode(),!0),l.makeRotationFromEuler(k),z.makeRotationAxis(S,-Z),k.setFromRotationMatrix(z.multiply(l)),this.r3([k.x,k.y,k.z])}}}}(),getHost:function(){return this._host},setHost:function(B){var f=this;if(f!==B&&f._host!==B){var c=f._host;c&&c._removeAttach(f),f._host=B,f._host&&f._host._addAttach(f),f.fp("host",c,B),f.onHostChanged(c,B)}},getAttaches:function(){return this._69O},_addAttach:function(g){var m=this;m._69O||(m._69O=new df),m._69O.add(g),m.fp("attaches",z,g)},_removeAttach:function(B){var F=this;F._69O.remove(B),F._69O.isEmpty()&&delete F._69O,F.fp("attaches",B,z)},getImage:function(){if(this._pendingCheckImageJSON){var W=m.getImage(this._image);W&&(this._pendingCheckImageJSON=!1,this.getParent()instanceof Hq&&this.getParent().checkPendingUpdateInfo())}return this._image},setImage:function(T){var $=this,Z=$._image,D=$.getWidth(),g=$.getHeight();$._image=T,$.fp("image",Z,T)&&(null!=T&&(Vc(T)||yk(T)&&/\.json$/i.test(T))&&(this._pendingCheckImageJSON=!0),$.fp(en,D,$.getWidth()),$.fp(yb,g,$.getHeight()))},getElevation:function(){return this._54O},setElevation:function(G){var r=this;if(!r._50O){r._50O=1;var v=r._54O;r._54O=G,r.fp(Mr,v,G),delete this._50O}},getRotation:function(){return this._64O},setRotation:function(t){var J=this;if(!J._49O){J._49O=1;var W=J._64O;J._64O=t,J.fp(uc,W,t),delete J._49O}},getRotationX:function(){return this._rotationX},setRotationX:function(A){var C=this;if(!C._51O){C._51O=1;var N=C._rotationX;C._rotationX=A,C.fp("rotationX",N,A),delete C._51O}},getRotationZ:function(){return this._53O},setRotationZ:function(W){var q=this;if(!q._52O){q._52O=1;var P=q._53O;q._53O=W,q.fp("rotationZ",P,W),delete q._52O}},getPosition:function(){return this._position},setPosition:function(N,f){var p=this;if(!p._50I){p._50I=1;var o;if(o=2===arguments.length?{x:N,y:f}:N,o.x!==p._position.x||o.y!==p._position.y){var t=p._position;p._position=o,p.fp(db,t,o)}delete p._50I}},translate:function(F,Q){var I=this._position;this.p(I.x+F,I.y+Q)},getWidth:function(){var F=this;if(F._width>=0)return F._width;var b=F.getStyle("shape3d");if(b){var i=qk(b);if(i&&i.rawS3)return i.rawS3[0];if("billboard"===b||"plane"===b){var J=Qd(F.getStyle("shape3d.image"));return J?Uk(J,F):20}}var J=Qd(F._image);return J?Uk(J,F):20},setWidth:function(u){var k=this,_=k._width;k._width=u,k.fp(en,_,u)},getHeight:function(){var t=this;if(t._height>=0)return t._height;var b=t.getStyle("shape3d");if(b){var v=qk(b);if(v&&v.rawS3)return v.rawS3[2];if("plane"===b){var g=Qd(t.getStyle("shape3d.image"));return g?Cf(g,t):20}if("billboard"===b)return 2}var g=Qd(t._image);return g?Cf(g,t):20},setHeight:function(U){var I=this,G=I._height;I._height=U,I.fp(yb,G,U)},getTall:function(){var E=this;if(E._tall>=0)return E._tall;var Y=E.getStyle("shape3d");if(Y){var q=qk(Y);if(q&&q.rawS3)return q.rawS3[1];if("billboard"===Y){var c=Qd(E.getStyle("shape3d.image"));return c?Cf(c,E):20}if("plane"===Y)return 2}return 20},setTall:function(K){var q=this,$=q._tall;q._tall=K,q.fp("tall",$,K)},setSize:function(v,o){var Y=this;2===arguments.length?(Y.setWidth(v),Y.setHeight(o)):(Y.setWidth(v.width),Y.setHeight(v.height))},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},setRect:function(q,Y,B,i,x){var n=this,D=n.getAnchor(),I=n.getScale();arguments.length<=2&&(x=Y,Y=q.y,B=q.width,i=q.height,q=q.x);var t=x&&I.x<0?1-D.x:D.x,X=x&&I.y<0?1-D.y:D.y;n.p(q+B*t,Y+i*X),x&&(B/=Math.abs(I.x),i/=Math.abs(I.y)),n.setWidth(B),n.setHeight(i)},getMatrix:function(){var W=this,l=W._64O,z=W._position,s=W.getScale();return new fc(l,z.x,z.y,s.x,s.y)},getAnchorRect:function(){var p=this,o=p.getWidth(),s=p.getHeight(),B=p.getAnchor();return{x:-o*B.x,y:-s*B.y,width:o,height:s}},toLocal:function(C){return this.getMatrix().tfi(C)},toGlobal:function(r){return this.getMatrix().tf(r)},getAttachPosition:function(){var $=new fc;return function(e,p,j,c){j=j||0,c=c||0;var n=this,t=n.getAnchor(),o=n._64O,R=n._position,u=n.getScale();return $.setFromTransform(o,R.x,R.y).tf({x:j+u.x*n.getWidth()*(e-t.x),y:c+u.y*n.getHeight()*(p-t.y)})}}(),isInRect:function(w){w=this.toLocal(w);var R=this.getWidth(),W=this.getHeight();return w.x+=R*this.getAnchorX(),w.y+=W*this.getAnchorY(),!(w.x<0||w.y<0||w.x>R||w.y>W)},getRect:function(){var c=this,$=c.getWidth(),p=c.getHeight(),o=c.getAnchor(),b={x:-$*o.x,y:-p*o.y,width:$,height:p},E=c.getMatrix();return b=oe([E.tf(b.x,b.y),E.tf(b.x+b.width,b.y),E.tf(b.x+b.width,b.y+b.height),E.tf(b.x,b.y+b.height)])},getAnchorElevation:function(){return this._anchorElevation},getAnchor3d:function(){var h=this,p=h.getAnchor(),n=h._anchorElevation;return{x:p.x,y:n,z:p.y}},setAnchorElevation:function(C){var w=this,R=w._anchorElevation;return R!==C?(w._anchorElevation=C,w.fp("anchorElevation",R,C),!0):!1},setAnchor3d:function(r,J,$,B){var S,Z=this;"number"==typeof r?S={x:r,y:J,z:$}:(S=r.length?{x:r[0],y:r[1],z:r[2]}:r,B=J);var g=Z.getDataModel();g&&g.beginTransaction();var t=Z.getAnchor3d(),y=Z.setAnchor(S.x,S.z);if(Z.setAnchorElevation(S.y)&&(y=!0),y&&B&&!Yd){Z.getAnchor3d();var L=dg(Z),u=Eb([S.x-t.x,S.y-t.y,S.z-t.z],L);Z.p3(u)}return g&&g.endTransaction(),y},getAnchor:function(){var W=this;if(W.hasOwnProperty("_anchor"))return W._anchor;var A=Qd(W._image);return A&&A.anchorX!==x?{x:A.anchorX,y:A.anchorY}:W._anchor},setAnchor:function(q,T,i){var Y,x=this;"number"==typeof q?Y={x:q,y:T}:(Y=q.length?{x:q[0],y:q[1]}:q,i=T);var L=x.getAnchor();if(L.x!==Y.x||L.y!==Y.y){var s=x.getDataModel();if(s&&s.beginTransaction(),x._anchor=Y,x.fp("anchor",L,Y),i&&!Yd){var m=x.getPosition(),e=x.getSize(),f=x.getRotation(),N=x.getScale(),h=-e.width*(L.x-Y.x)*N.x,G=-e.height*(L.y-Y.y)*N.y,_=F(f),o=d(f);x.setPosition(m.x+o*h-_*G,m.y+_*h+o*G)}return s&&s.endTransaction(),!0}return!1},getScale:function(){return this._scale},setScale:function(U,S){var u,E=this;u=2===arguments.length?{x:U,y:S}:U;var k=E.getScale();(k.x!==u.x||k.y!==u.y)&&(E._scale=u,E.fp("scale",k,u))},getScaleTall:function(){return this._scaleTall},getScale3d:function(){var V=this,m=V._scaleTall,g=V.getScale();return[g.x,m,g.y]},getFinalScale3d:function(){var l=this,_=l.s3(),g=l._dynamicScale3d,f=l.getScale3d();return _&&(f[0]*=_[0],f[1]*=_[1],f[2]*=_[2]),g&&(f[0]*=g[0],f[1]*=g[1],f[2]*=g[2]),f},getFinalRotation3d:function(){var m=this;return m._dynamicRotation||m.r3()},setScaleTall:function(X){var E=this,w=E._scaleTall;w!==X&&(E._scaleTall=X,E.fp("scaleTall",w,X))},setScale3d:function(F,V,K){var T,L=this;T="number"==typeof F?{x:F,y:V,z:K}:F.length?{x:F[0],y:F[1],z:F[2]}:F,L.setScaleTall(T.y),L.setScale(T.x,T.z)},getCorners:function(F,L){F==z&&(F=0),L==z&&(L=F);var v=this,b=v.getAnchor(),Y=v.getWidth(),r=v.getHeight(),p=-Y*b.x-F,Z=-r*b.y-L,k=Y+2*F,t=r+2*L,J=v.getMatrix();return[J.tf(p,Z),J.tf(p,Z+t),J.tf(p+k,Z+t),J.tf(p+k,Z)]},getEditControlPoints:function(b,M,m){M==z&&(M=0),m==z&&(m=M);var j=this,C=j.getAnchor(),q=j.getWidth(),t=j.getHeight(),F=-q*C.x-M,i=-t*C.y-m,W=q+2*M,f=t+2*m;if(b)return[{x:F,y:i},{x:F,y:0},{x:F,y:i+f},{x:0,y:i+f},{x:F+W,y:i+f},{x:F+W,y:0},{x:F+W,y:i},{x:0,y:i}];var V=j.getMatrix();return[V.tf(F,i),V.tf(F,0),V.tf(F,i+f),V.tf(0,i+f),V.tf(F+W,i+f),V.tf(F+W,0),V.tf(F+W,i),V.tf(0,i)]},rotateAt:function(e,k,n){var m=this,q=m._position,K=m._64O,O=new fc(K,q.x,q.y).tf(e,k),$=N(e*e+k*k),Q=C(q.y-O.y,q.x-O.x)+n;m.setRotation(K+n),m.p(O.x+$*d(Q),O.y+$*F(Q))},onParentChanged:function(){Lh.superClass.onParentChanged.apply(this,arguments),this._8I()},onPropertyChanged:function(){var $={};return"width|height|position|anchor|rotation|scale|s:layout.h|s:layout.v".split("|").forEach(function(H){$[H]=!0}),function(C){var r=this;Lh.superClass.onPropertyChanged.call(r,C),$[C.property]&&!r._layoutUpdating&&r.updateLayoutParameters(null,C.property),r._69O&&r._69O.each(function(F){F.handleHostPropertyChange(C)}),r._49I&&r._49I.each(function(Q){Q.fp("agentChange",!0,!1)}),"a:layout"===C.property.substring(0,8)&&this.updateAttach()}}(),onHostChanged:function(){this.updateAttach(),this.updateLayoutParameters()},handleHostPropertyChange:function(y){this.updateAttach(y)},onStyleChanged:function(P){Lh.superClass.onStyleChanged.apply(this,arguments),Yg[P]&&this.updateAttach()},updateAttach:function(T){var N=this;return Yd?(N.updateLayoutParameters(),void 0):(N._51I||(N._51I=1,N._71O(T),delete N._51I),void 0)},_71O:function(V){var k,Y,s,j,d,I,L,c,t=this,E=t._host,p=V?V.property:z,T=V?V.oldValue:z,i=V?V.newValue:z;if(E instanceof Lh&&(L=Qd(E.getImage()),L&&L.layoutAttach&&(c=L.layoutAttach)),V&&!Np[p]&&"a:layout"!==p.substring(0,8)||!c||c(E,this))if(E instanceof R.Grid){if(p===Mr)t.setElevation(t._54O+i-T);else if(!V||Lm[p]){if(k=t.s("attach.row.index"),Y=t.s("attach.column.index"),s=E.getCellRect(k,Y),!s)return;
j=t.s("attach.row.span"),d=t.s("attach.column.span"),(1!==j||1!==d)&&(s=Mq(s,E.getCellRect(k+j-1,Y+d-1))),fm(s,t,"attach.padding",1),t.setRect(s)}}else if(E instanceof tj&&(I=t.s("attach.index"))>=0&&(!V||Be[p])){var _=t.s("attach.thickness"),N=E.getScale(),u=Math.max(N.x,N.y);_>0&&t.setHeight(E.getThickness()*_*u);var F=t.s("attach.offset"),w=E.getPoints(),y=w.size();if(y>I){var e=E.getPointsMatrix2d(),g=w.get(I),o=y===I+1?w.get(0):w.get(I+1);g=e.apply(g),o=e.apply(o);var l=[o.x-g.x,o.y-g.y],h=id(l);if(h){t.s("attach.offset.relative")&&(F*=h),t.s("attach.offset.opposite")&&(F=h-F);var f={x:g.x+l[0]/h*F,y:g.y+l[1]/h*F},J=t.s("attach.gap");J&&(t.s("attach.gap.relative")&&(J*=E.getThickness()*u),f=Je(z,f,o,J)),t.p(f),t.setRotation(C(l[1],l[0]))}}}else V&&(p===db?t.translate(i.x-T.x,i.y-T.y):p===Mr?t.setElevation(t._54O+i-T):Fp[p]?t._11Q(E,p,i-T):("anchor"===p||"width"===p||"height"===p||"scale"===p)&&t.layout(E))},_11Q:function(){var p=new R.Math.Euler,G=R.Math.Euler.ReverseOrder,w=new R.Math.Vector2,D=new R.Math.Vector2;return function(s,A,b){var r=this,C=s.p3(),g=s.r3(),j=r.p3(),U=r.r3();if(A===uc&&(A="rotationY",b=-b),(A===uc||"rotationY"===A)&&0===U[0]&&0===U[2]&&0===g[0]&&0===g[2]&&0===j[1]&&0===C[1])return r.setRotation(-U[1]-b),w.set(j[0],j[2]).rotateAround(D.set(C[0],C[2]),-b),r.p(w.x,w.y),void 0;var c=Xf[s.getRotationMode()],Q=c[0],e=c[1],i=c[2],y=kc[Q],l=kc[e],P=kc[i],S=Re();A===uc+Q?(P(S,g[kp[i]]),l(S,g[kp[e]]),y(S,b),l(S,-g[kp[e]]),P(S,-g[kp[i]])):A===uc+e?(P(S,g[kp[i]]),l(S,b),P(S,-g[kp[i]])):A===uc+i&&P(S,b);var v=fi(j,C);Eb(v,S),r.p3(C[0]+v[0],C[1]+v[1],C[2]+v[2]);var R=r.getRotationMode();Tb(S,r.r3(),R),p.setFromRotationMatrix(S,G(R)),r.r3([p.x,p.y,p.z])}}(),isHostOn:function(t){var A=this;if(A._host&&t&&t._69O)for(var C={},z=A._host;z&&z!==A&&!C[z._id];){if(z===t)return!0;C[z._id]=z,z=z._host}return!1},isLoopedHostOn:function(F){return this.isHostOn(F)&&F.isHostOn(this)},getScaledSize:function(){var m=this.getSize(),F=this.getScale();return m.width*=Math.abs(F.x),m.height*=Math.abs(F.y),m},layout:function(Q){if(Q=Q||this.getHost()){var b=this,w=b.s("layout.h")||"center",a=b.s("layout.v")||"center";if("center"!==w||"center"!==a){var n=new R.Math.Vector2,V=Q.getPosition(),m=Q.getAnchor(),S=Q.getScaledSize();b.getPosition();var D,e,d,E,B,t=1,f=1;switch(b._layoutUpdating=!0,w){case"left":n.setX(b._layoutHValue-m.x*S.width);break;case"right":n.setX((1-m.x)*S.width-b._layoutHValue);break;case"leftright":D=S.width-b._layoutHValue[2],d=b.getRotation()-Q.getRotation(),E=Math.abs(Math.sin(d)),B=Math.abs(Math.cos(d)),t+=B*D/b._layoutHValue[3],f+=E*D/b._layoutHValue[4],n.setX(b._layoutHValue[1]+(b._layoutHValue[5]-m.x)*S.width);break;case"center":n.setX((.5-m.x)*S.width-b._layoutHValue);break;case"scale":d=b.getRotation()-Q.getRotation(),E=Math.abs(Math.sin(d)),B=Math.abs(Math.cos(d)),n.setX((.5-m.x)*S.width-b._layoutHValue[1]*S.width/b._layoutHValue[0]),e=S.width/b._layoutHValue[2]-1,t+=B*e,f+=E*e}switch(a){case"top":n.setY(b._layoutVValue-m.y*S.height);break;case"bottom":n.setY((1-m.y)*S.height-b._layoutVValue);break;case"topbottom":d||(d=b.getRotation()-Q.getRotation(),E=Math.abs(Math.sin(d)),B=Math.abs(Math.cos(d))),D=S.height-b._layoutVValue[2],t+=E*D/b._layoutVValue[3],f+=B*D/b._layoutVValue[4],n.setY(b._layoutVValue[1]+(b._layoutVValue[5]-m.y)*S.height);break;case"center":n.setY((.5-m.y)*S.height-b._layoutVValue);break;case"scale":d||(d=b.getRotation()-Q.getRotation(),E=Math.abs(Math.sin(d)),B=Math.abs(Math.cos(d))),n.setY((.5-m.y)*S.height-b._layoutVValue[1]*S.height/b._layoutVValue[0]),e=S.height/b._layoutVValue[2]-1,t+=E*e,f+=B*e}if("leftright"===w||"scale"===w||"topbottom"===a||"scale"===a){var y=this.getScale(),k=Math.abs(y.x),A=Math.abs(y.y);"leftright"===w||"scale"===w?b.setSize(b._layoutHValue[3]*t/k,b._layoutHValue[4]*f/A):b.setSize(b._layoutVValue[3]*t/k,b._layoutVValue[4]*f/A)}n.rotateAround(null,Q.getRotation()),this.setPosition(n.x+V.x,n.y+V.y),b._layoutUpdating=x}}},updateLayoutParameters:function(x,G){if(x=x||this.getHost()){var p=this,m=p.s("layout.h"),J=p.s("layout.v");if(m||J){var l,$,s,C,Z,t,W=new R.Math.Vector2,a=x.getPosition(),S=x.getAnchor(),B=x.getScaledSize(),v=p.getPosition(),Y=p.getScaledSize();switch(W.set(v.x-a.x,v.y-a.y),W.rotateAround(null,-x.getRotation()),m){case"left":p._layoutHValue=W.x+S.x*B.width;break;case"right":p._layoutHValue=-W.x+(1-S.x)*B.width;break;case"center":p._layoutHValue=-W.x+(.5-S.x)*B.width;break;case"leftright":case"scale":"scale"===m?l=-W.x+(.5-S.x)*B.width:($=p.getAnchor(),s=p.getRotation()-x.getRotation(),C=Math.cos(s),Z=Math.sin(s),t=-Math.min(-$.x*C+$.y*Z,-$.x*C-(1-$.y)*Z,(1-$.x)*C+$.y*Z,(1-$.x)*C-(1-$.y)*Z),l=W.x-(t-S.x)*B.width),"position"===G&&"object"==typeof p._layoutHValue?(p._layoutHValue[0]=B.width,p._layoutHValue[1]=l):p._layoutHValue=[B.width,l,B.width,Y.width,Y.height,t]}switch(J){case"top":p._layoutVValue=W.y+S.y*B.height;break;case"bottom":p._layoutVValue=-W.y+(1-S.y)*B.height;break;case"center":p._layoutVValue=-W.y+(.5-S.y)*B.height;break;case"topbottom":case"scale":"scale"===J?l=-W.y+(.5-S.y)*B.height:(s||($=p.getAnchor(),s=p.getRotation()-x.getRotation(),C=Math.cos(s),Z=Math.sin(s)),t=-Math.min(-$.x*Z-$.y*C,-$.x*Z+(1-$.y)*C,(1-$.x)*Z-$.y*C,(1-$.x)*Z+(1-$.y)*C),l=W.y-(t-S.y)*B.height),"position"===G&&"object"==typeof p._layoutVValue?(p._layoutVValue[0]=B.height,p._layoutVValue[1]=l):p._layoutVValue=[B.height,l,B.height,Y.width,Y.height,t]}}}},getSerializableProperties:function(){var h=Lh.superClass.getSerializableProperties.call(this);return ae(h,{image:1,host:1,rotation:1,rotationX:1,rotationZ:1,rotationMode:1,position:1,anchor:1,anchorElevation:1,scale:1,scaleTall:1,_width:1,_height:1,_tall:1,elevation:1}),h}});var Dp=R.Edge=function(C,Z){var a=this;ac(Dp,a),a.setSource(C),a.setTarget(Z)};Wp("Edge",bq,{ms_edge:!0,_icon:"edge_icon",getUIClass:function(){return Pj},_22Q:function(){return Ue},getSource:function(){return this._source},getTarget:function(){return this._target},getSourceAgent:function(){return this._40I},getTargetAgent:function(){return this._41I},canSetSourceTarget:function(Y){if(Y===this)return!1;if(Vm(Y))return!0;for(var F,r,V,y,$,v=[this],W=-1,N=0;N>W;)if(W++,F=v[W],r=F._44I)for(r=r.getArray(),y=0,$=r.length;$>y;y++)if(V=r[y],xr(V)&&!(v.indexOf(V)>=0)){if(V===Y)return!1;v.push(V),N++}return!0},setSource:function(S){var E=this;if(E._source!==S&&E.canSetSourceTarget(S)){var _=E._source;E._source=S,_&&_._16I(E),S&&S._2I(E),E._7I(),E.fp("source",_,S)}},setTarget:function(Z){var v=this;if(v._target!==Z&&v.canSetSourceTarget(Z)){var I=v._target;v._target=Z,I&&I._18I(v),Z&&Z._4I(v),v._7I(),v.fp("target",I,Z)}},isLooped:function(){var d=this;return d._source===d._target&&Vm(d._source)&&Vm(d._target)},onPropertyChanged:function(){var k=this;k._49I&&k._49I.each(function(T){T.fp("agentChange",!0,!1)})},_7I:function(){var Y,t=this,l=ee(t);t._40I!==l&&(Y=this._40I,Y&&Y._15I(t),t._40I=l,l&&l._1I(t),t.fp("sourceAgent",Y,l),zl(Y,t._41I),zl(l,t._41I));var w=Ep(t);t._41I!==w&&(Y=t._41I,Y&&Y._17I(t),t._41I=w,w&&w._3I(t),t.fp("targetAgent",Y,w),zl(Y,t._40I),zl(w,t._40I))},_22I:function(w){this._52I=w,this.fp("edgeGroup",!0,!1)},getEdgeGroup:function(){return this._52I},isEdgeGroupHidden:function(){var B=this;return B._52I&&B._52I.get(0)!==B&&!B.getStyle(Qn)},getEdgeGroupSize:function(){return this._52I?this._52I.size():1},getEdgeGroupIndex:function(){return this._52I?this._52I.indexOf(this):0},isEdgeGroupAgent:function(){var x=this,Y=x._52I;return Y&&!x.getStyle(Qn)&&Y.size()>1&&x===Y.get(0)},toggle:function(){this.beginTransaction();var e=this._52I,Q=!this.s(Qn);e&&e.size()>1&&(e.each(function(y){y.s(Qn,Q)}),e.getSiblings().each(function(k){k!==e&&k.each(function(i){i.fp("edgeGroup",z,k)})})),this.endTransaction()},setStyle:function(O,D){(O===_j||"edge.segments"===O)&&(D=Nf(D)),Dp.superClass.setStyle.call(this,O,D)},onStyleChanged:function(i){Dp.superClass.onStyleChanged.apply(this,arguments),yl[i]&&zl(this._41I,this._40I)},getSerializableProperties:function(){var j=Dp.superClass.getSerializableProperties.call(this);return ae(j,{source:1,target:1}),j}});var Lp=R.Group=function(){ac(Lp,this)};Wp("Group",Lh,{_image:"group_image",_icon:"group_icon",_57O:!1,getUIClass:function(){return ff},onChildAdded:function(){Lp.superClass.onChildAdded.apply(this,arguments),this._81I()},onChildRemoved:function(){Lp.superClass.onChildRemoved.apply(this,arguments),this._81I()},_81I:function(){var w=this;if(!w._54I&&!Yd){var F=w.getChildrenRect();F&&(w._53I=1,w.p(yr(w.s("group.position"),F,w.getSize())),delete w._53I)}},getChildrenRect:function(){var C,u=this;return u.eachChild(function(T){Vm(T)&&(C=Mq(C,u.getChildRect(T)))}),C},getChildRect:function(t){var G;return Vm(t)&&t.s(Ag)&&(wr(t)&&t.isExpanded()&&t.eachChild(function(d){G=Mq(G,t.getChildRect(d))}),!G&&t.getRect&&(G=t.getRect())),G},setPosition:function(p,S){var U=this;if(!U._54I){var e;e=2===arguments.length?{x:p,y:S}:p,Yd||U._53I||(U._54I=1,sd(U._children,e.x-U._position.x,e.y-U._position.y),delete U._54I),Lp.superClass.setPosition.call(this,e)}},toggle:function(){this.setExpanded(!this.isExpanded())},isExpanded:function(){return this._57O},setExpanded:function(x){var N=this;if(N._57O!==x){var F=N._57O;N._57O=x,N.fp("expanded",F,N._57O),N._fireInvalidateDeep(),N._8I()}},_fireInvalidateDeep:function(){this.eachChild(function(w){wr(w)?w._fireInvalidateDeep():w.iv()})},_8I:function(){Lp.superClass._8I.call(this),this.eachChild(function(T){Vm(T)&&T._8I()})},onStyleChanged:function(F){Lp.superClass.onStyleChanged.apply(this,arguments),"group.position"===F&&this._81I()},getSerializableProperties:function(){var G=Lp.superClass.getSerializableProperties.call(this);return G.expanded=1,G}});var rf=R.Block=function(){ac(rf,this),this.s({"shadow.cast":!1,"shadow.receive":!1})};Wp("Block",Lh,{_icon:"block_icon",_clickThroughEnabled:!1,_syncSize:!0,ms_ac:["clickThroughEnabled","syncSize"],getUIClass:function(){return yp},_22Q:function(){return Ai},onChildAdded:function(){rf.superClass.onChildAdded.apply(this,arguments),this.updateFromChildren()},onChildRemoved:function(){rf.superClass.onChildRemoved.apply(this,arguments),this.updateFromChildren()},_getBoundingBox:function(){function q(k,F,j){G.fromArray(dg(F));var B=F.getAnchor3d();k.push((new Ki).set(0-B.x,0-B.y,0-B.z).applyMatrix4(G).applyMatrix4(j)),k.push((new Ki).set(0-B.x,0-B.y,1-B.z).applyMatrix4(G).applyMatrix4(j)),k.push((new Ki).set(0-B.x,1-B.y,0-B.z).applyMatrix4(G).applyMatrix4(j)),k.push((new Ki).set(0-B.x,1-B.y,1-B.z).applyMatrix4(G).applyMatrix4(j)),k.push((new Ki).set(1-B.x,0-B.y,0-B.z).applyMatrix4(G).applyMatrix4(j)),k.push((new Ki).set(1-B.x,0-B.y,1-B.z).applyMatrix4(G).applyMatrix4(j)),k.push((new Ki).set(1-B.x,1-B.y,0-B.z).applyMatrix4(G).applyMatrix4(j)),k.push((new Ki).set(1-B.x,1-B.y,1-B.z).applyMatrix4(G).applyMatrix4(j))}function E(n,m){var c=this.p3(),v=this.r3(),P=Re();$f(P,[-c[0],-c[1],-c[2]]),Tb(P,[-v[0],-v[1],-v[2]],this.getRotationMode()),P=(new Tl).fromArray(P),n.forEach(function(r){Vm(r)&&q(m,r,P)})}var G=new Tl;return function(K,a){if(K instanceof R.Node&&(K=[K]),!K||0===K.length)return z;var a=[];E.call(this,K,a);var H=[1/0,1/0,1/0],W=[-1/0,-1/0,-1/0];return a.forEach(function($){H[0]=Math.min($.x,H[0]),H[1]=Math.min($.y,H[1]),H[2]=Math.min($.z,H[2]),W[0]=Math.max($.x,W[0]),W[1]=Math.max($.y,W[1]),W[2]=Math.max($.z,W[2])}),{min:H,max:W}}}(),updateFromChildren:function(){var p=this;if(!Yd&&!p._updatingToChildren&&p._syncSize&&0!==p.size()&&!p._freezeSyncFromChildren){var i=this._getBoundingBox(p.toChildren().toArray());if(i){p._updatingFromChildren=1;var B=i.min,W=i.max,u=W[0]-B[0],U=W[2]-B[2],Y=W[1]-B[1],S=new Ki(u,Y,U),b=new Ki(1,1,1).divide((new Ki).fromArray(this.getScale3d())).multiply(S);this.s3(Math.abs(b.x),Math.abs(b.y),Math.abs(b.z));var q=this.p3(),l=this.r3(),c=Re();Tb(c,l,this.getRotationMode()),$f(c,q),c=(new Tl).fromArray(c);var I=this.getAnchor3d();return q=new Ki(I).multiply(S).add((new Ki).fromArray(B)).applyMatrix4(c),this.p3([q.x,q.y,q.z]),delete p._updatingFromChildren,void 0;var p}}},setPosition:function(m,_){var K=this;if(!K._updatingToChildren){var z;z=2===arguments.length?{x:m,y:_}:m,Yd||K._updatingFromChildren||(K._updatingToChildren=1,sd(K._children,z.x-K._position.x,z.y-K._position.y),delete K._updatingToChildren),rf.superClass.setPosition.call(this,z)}},setWidth:function(v){return this.setSize(v,this.getHeight())},setHeight:function(Z){return this.setSize(this.getWidth(),Z)},setSize:function(q,l){var o=m.blockMinSize;q=W(q,o),l=W(l,o);var L=this;if(!L._updatingToChildren){2!==arguments.length&&(l=q.height,q=q.width);var Q=L.getWidth(),N=L.getHeight();if(q!==Q&&rf.superClass.setWidth.call(L,q),l!==N&&rf.superClass.setHeight.call(L,l),!Yd&&!L._updatingFromChildren){L._updatingToChildren=1;var E=q/Q,D=l/N;L._adjustChildScaleOrSize(E,D,"size"),delete L._updatingToChildren,L.updateFromChildren()}}},_adjustChildScaleOrSize:function(P,t,Z){var T=this;if(T._syncSize){var A=T.getPosition(),M=T.getRotation();T.getScale(),T.eachChild(function(j){if(Vm(j)){var z=j.getPosition(),W=j.getRotation(),K=j.getWidth(),w=j.getHeight(),U=j.getScale(),V=U.x*K,n=U.y*w,i=new fc(W,z.x,z.y,V,n);i.translate(-A.x,-A.y),i.rotate(-M),W=C(i.b*Math.sign(V),i.a*Math.sign(V)),i.scale(P,t);var I,Y,q,B=d(W);if(Math.abs(B)<.001?(I=F(W),Y=i.b/I,q=-i.c/I):(Y=i.a/B,q=i.d/B),"scale"===Z)j.setScale(Y/K,q/w);else if("size"===Z){var E=Y/U.x,u=q/U.y;j.setScale(Bl(Y)*Math.abs(U.x),Bl(q)*Math.abs(U.y)),j instanceof R.Shape?(j.setWidthForce(Math.max(Math.abs(E),1e-5)),j.setHeightForce(Math.max(Math.abs(u),1e-5))):j.setSize(Math.max(.01,Math.abs(E)),Math.max(.01,Math.abs(u)))}i.rotate(M),i.translate(A.x,A.y),j.setPosition(i.tx,i.ty)}})}},_calcChangeFactor:function(M,n,r,t){var i,d,m,R;return i=H(M),d=H(r),m=i>d?i/d:d/i,i=H(n),d=H(t),R=i>d?i/d:d/i,W(m,R)},setElevation:function(s){var x=this;if(!x._updatingToChildren){var v=x.getElevation(),u=s-v;0!==u&&(Yd||x._updatingFromChildren||(x._updatingToChildren=1,sd(x._children,0,u,0),delete x._updatingToChildren),rf.superClass.setElevation.apply(x,arguments))}},setTall:function(P){var J=this;if(!J._updatingToChildren){P=W(P,m.blockMinSize);var I=J.getTall();if(P!==I&&rf.superClass.setTall.call(J,P),!Yd&&!J._updatingFromChildren){J._updatingToChildren=1;var K=P/I;J._adjustChildTallOrScale(K,"size"),delete J._updatingToChildren,this.updateFromChildren()}}},setScaleTall:function(Y){var n=this;if(!n._updatingToChildren){var W=n.getScaleTall();if(H(Y)<.01&&(Y=.01*(Bl(Y)||Bl(W))),rf.superClass.setScaleTall.call(n,Y),!Yd&&!n._updatingFromChildren){n._updatingToChildren=1;var S=Y/W;n._adjustChildTallOrScale(S,"size"),delete n._updatingToChildren,this.updateFromChildren()}}},_adjustChildTallOrScale:function(A,v){var V=this;if(V._syncSize){var m=V.getElevation();V.eachChild(function(g){if(Vm(g))if("size"===v){var S=g.getTall();0>A&&g.setScaleTall(-1*g.getScaleTall()),g.setTall(Math.max(.01,Math.abs(S*A))),g.setElevation(m+(g.getElevation()-m)*A)}else{var K=g.getScaleTall();g.setScaleTall(K*A)}})}},setAnchor:function(){var B=this;if(!B._updatingToChildren){var W=B.getAnchor();if(rf.superClass.setAnchor.apply(B,arguments),!Yd&&!B._updatingFromChildren&&B._syncSize){B._updatingToChildren=1;var $=B.getAnchor();B.getPosition();var L=B.getSize(),b=B.getScale(),s=B.getRotation(),x=-L.width*b.x*(W.x-$.x),f=-L.height*b.y*(W.y-$.y),c=F(s),D=d(s),z=D*x-c*f,R=c*x+D*f;B.eachChild(function(N){if(Vm(N)){var g=N.getPosition();N.setPosition(g.x-z,g.y-R)}}),delete B._updatingToChildren}}},setAnchorElevation:function(){var D=this;if(!D._updatingToChildren){var N=D.getAnchorElevation();if(rf.superClass.setAnchorElevation.apply(D,arguments),!Yd&&!D._updatingFromChildren&&D._syncSize){D._updatingToChildren=1;var A=D.getAnchorElevation(),I=D.getTall(),T=D.getScaleTall(),F=-I*T*(N-A);D.eachChild(function(W){if(Vm(W)){var I=W.getElevation();W.setElevation(I-F)}}),delete D._updatingToChildren}}},setRotation:function(y){this._updateChildrenRotation3d("rotation",y)},setRotationX:function(k){this._updateChildrenRotation3d("rotationX",k)},setRotationZ:function(d){this._updateChildrenRotation3d("rotationZ",d)},_updateChildrenRotation3d:function(O,y){var M=this;if(!M._updatingToChildren){var m=M[Vr(O)]();if(rf.superClass[Ij(O)].call(M,y),!Yd&&!M._updatingFromChildren){M._updatingToChildren=1;var b=y-m;M.eachChild(function(i){Vm(i)&&i._11Q(M,O,b)}),delete M._updatingToChildren}}},setScale:function(m,x){var n=this;if(!n._updatingToChildren){null==x&&(x=m.y,m=m.x);var Z=n.getScale();if(H(m)<.01&&(m=.01*(Bl(m)||Bl(Z.x))),H(x)<.01&&(x=.01*(Bl(x)||Bl(Z.y))),rf.superClass.setScale.call(n,m,x),!Yd&&!n._updatingFromChildren){n._updatingToChildren=1;var V=m/Z.x,X=x/Z.y;n._adjustChildScaleOrSize(V,X,"size"),delete n._updatingToChildren,n.updateFromChildren()}}},getSerializableProperties:function(){var q=rf.superClass.getSerializableProperties.call(this);return q.clickThroughEnabled=1,q.syncSize=1,q}});var zm=R.Grid=function(){ac(R.Grid,this)};Wp("Grid",Lh,{IRotatable:!1,_icon:"grid_icon",_image:z,getUIClass:function(){return Wq},setRotation:function(){},getCellRect:function(D,P){var f=this,m=f.s("grid.row.count"),E=f.s("grid.column.count");if(0>=m||0>=E||0>D||D>=m||0>P||P>=E)return z;var t,Y,O,n=f.getRect(),N=f.s("grid.row.percents"),g=f.s("grid.column.percents");if(fm(n,f,"grid.border",-1),N&&N._as&&(N=N._as),g&&g._as&&(g=g._as),N&&N.length===m){for(O=0,t=0;D>t;t++)O+=n.height*N[t];n.y+=O,n.height=n.height*N[D]}else n.height=n.height/m,n.y+=n.height*D;if(g&&g.length===E){for(Y=0,t=0;P>t;t++)Y+=n.width*g[t];n.x+=Y,n.width=n.width*g[P]}else n.width=n.width/E,n.x+=n.width*P;return km(n,-f.s("grid.gap")),n}});var uo=R.Text=function(){ac(uo,this),this.setSize(100,50),this.s("text","TEXT")};Wp("Text",Lh,{_icon:"text_icon",_image:"__text__",getUIClass:function(){return wp},setWidth:function(z){z||(z=.001),uo.superClass.setWidth.call(this,z)},setHeight:function(U){U||(U=.001),uo.superClass.setHeight.call(this,U)},toLabel:function(){return this._displayName||this._name||this.s("text")}}),ll("__text__",{width:{value:100,isSafeFunc:!0,func:function(Q){return Q?Q._width:100}},height:{value:50,isSafeFunc:!0,func:function(v){return v?v._height:50}},comps:[{type:"text",relative:!0,rect:[0,0,1,1],text:{func:"style@text"},align:{func:"style@text.align"},vAlign:{func:"style@text.vAlign"},color:{func:"style@text.color"},font:{func:"style@text.font"},shadow:{func:"style@text.shadow"},shadowColor:{func:"style@text.shadow.color"},shadowBlur:{func:"style@text.shadow.blur"},shadowOffsetX:{func:"style@text.shadow.offset.x"},shadowOffsetY:{func:"style@text.shadow.offset.y"},scaleX:{func:"style@text.scale.x"},scaleY:{func:"style@text.scale.y"}}]});var tj=R.Shape=function(){ac(tj,this),this._59O=new df};tj.__de__=ln,Wp("Shape",Lh,{ms_ac:["thickness","closePath"],_icon:"shape_icon",_thickness:10,_closePath:!1,getUIClass:function(){return Nk},_22Q:function(){return Qp},getLength:function(t){return yh(Wd(this._59O,this._58O,t,this._closePath))},getSegments:function(){return this._58O},toSegments:function(){var F=this._58O;return F?new df(F._as.slice(0)):F},setSegments:function(K){var r=this._58O;K=K?Mf(K)?new df(K.slice(0)):new df(K._as.slice(0)):null,(r&&K&&r._as.join(",")!==K._as.join(",")||r!==K)&&(this._58O=K,this.fp("segments",r,K))},getPoints:function(){return this._59O},toPoints:function(){var e=this._59O;return new df(e._as.slice(0))},getPointsMatrix2d:function(){var t=this,b=new rh.Matrix2d,k=t.getPosition(),F=t.getScale(),$=t.getRotation();return b.translate(-k.x,-k.y).scale(F.x,F.y).rotate($).translate(k.x,k.y),b},getPointsMatrix3d:function(){return function(){var N=this,E=new rh.Matrix4,v=E.getElements(),D=N.p3();$f(v,D),Tb(v,N.getFinalRotation3d(),N.getRotationMode());var l=N.getScale3d(),u=N._dynamicScale3d;return u&&(l[0]*=u[0],l[1]*=u[1],l[2]*=u[2]),Pp(v,l),$f(v,te(D)),E}}(),setPoints:function(Q,k){var t=this,U=t._59O;Q=Q?Mf(Q)?new df(Q.slice(0)):new df(Q._as.slice(0)):new df;var M,p,d,W,E,$;k&&(M=t.getPosition(),$=new fc(t.getRotation(),0,0,t.getScale().x,t.getScale().y)),(U&&Q&&U._as.join(",")!==Q._as.join(",")||U!==Q)&&(t._59O=Q,t.fs(),t.fp("points",U,Q)),k&&(p=t.getPosition(),d=p.x-M.x,W=p.y-M.y,E=$.tf(d,W),t.setPosition(p.x-d+E.x,p.y-W+E.y))},addPoint:function(x,D,t){var i=this.toPoints();i.add(x,D),this.setPoints(i,t)},setPoint:function(l,v,A){var g=this.toPoints();g.set(l,v),this.setPoints(g,A)},removePointAt:function(H){var y=this.toPoints();y.removeAt(H),this.setPoints(y)},setWidthForce:function(m){var h=this;if(!h._55I&&!Yd&&h.getWidth()){h._55I=1;var Y=h._position.x,F=m/h.getWidth(),J=h.toPoints(),y=new df;1!==F&&(J.each(function(s){y.add({x:(s.x-Y)*F+Y,y:s.y,e:s.e})}),h.setPoints(y),Vh(h,[F,0,0,1,Y*(1-F),0]),h.fs()),delete h._55I}tj.superClass.setWidth.call(h,m)},setWidth:function(t){return this.setWidthForce(ep>t?ep:t)},setHeightForce:function(Z){var Y=this;if(!Y._55I&&!Yd&&Y.getHeight()){Y._55I=1;var n=Y._position.y,k=Z/Y.getHeight(),C=Y.toPoints(),G=new df;1!==k&&(C.each(function(s){G.add({x:s.x,y:(s.y-n)*k+n,e:s.e})}),Y.setPoints(G),Vh(Y,[1,0,0,k,0,n*(1-k)]),Y.fs()),delete Y._55I}tj.superClass.setHeight.call(Y,Z)},setHeight:function(t){return this.setHeightForce(ep>t?ep:t)},setAnchorElevation:function(x){var _=this;_._55I=!0;var K=_._updatingAnchor3d,w=!Yd&&!K;if(w){var g,S=x,l=_.getAnchorElevation(),y=_.getTall();g=y*(l-S),0!==g&&_.shiftPointsElevation(g)}var E=tj.superClass.setAnchorElevation.apply(_,arguments);return K||delete _._55I,E},getShapeElevation:function(){var V=this,g=V._54O;return g-(V.getTall()||0)*(V._anchorElevation-.5)},setAnchor3d:function(f,D,b,c){var L,k=this;"number"==typeof f?L={x:f,y:D,z:b}:(L=f.length?{x:f[0],y:f[1],z:f[2]}:f,c=D),k._55I=!0,k._updatingAnchor3d=!0;var d=k.getDataModel();if(d&&d.beginTransaction(),!Yd){var g=k.getAnchor3d(),R=k.getSize(),r=k.getTall(),K=R.width*(g.x-L.x),E=R.height*(g.z-L.z),I=r*(g.y-L.y);c||k.shiftPoints(K,E,I);var z=k.p3()}var j=tj.superClass.setAnchor3d.apply(k,arguments);if(!Yd&&c){var v=k.p3();k.shiftPoints(v[0]-z[0]+K,v[2]-z[2]+E,v[1]-z[1]+I)}return d&&d.endTransaction(),delete k._updatingAnchor3d,delete k._55I,j},setAnchor:function(E,Q,X){var J=this;J._55I=!0;var Y=J._updatingAnchor3d,N=!Yd&&!Y;if(N){var n,H,l;"number"==typeof E?l={x:E,y:Q}:(l=E.length?{x:E[0],y:E[1]}:E,X=Q);var S=J.getAnchor(),F=J.getSize();n=F.width*(S.x-l.x),H=F.height*(S.y-l.y),X||J.shiftPoints(n,H);var d=J.getPosition()}var v=tj.superClass.setAnchor.apply(J,arguments);if(N){var z=J.getPosition();X&&J.shiftPoints(z.x-d.x+n,z.y-d.y+H)}return Y||delete J._55I,v},shiftPoints:function(p,h,G){if(p||h||G){var l=this,P=l.getElevation()||0,B=l.toPoints(),c=new df;B.each(function(f){var T=f.e;G&&(T=(T==z?P:T)+G),c.add({x:f.x+p,y:f.y+h,e:T})}),l.setPoints(c),l.fs()}},shiftPointsElevation:function(y){return this.shiftPoints(0,0,y)},setPosition:function(v,z){var U,y=this;if(!y._28Q){if(y._28Q=1,!y._55I&&!Yd){U=2===arguments.length?{x:v,y:z}:v;var G=U.x-y._position.x,l=U.y-y._position.y;if(0===G&&0===l)return delete y._28Q,void 0;y._55I=1,y.shiftPoints(G,l),Vh(y,[1,0,0,1,G,l]),delete y._55I}tj.superClass.setPosition.apply(y,arguments),delete y._28Q}},fs:function(){this.fireShapeChange()},_70I:function(){var U=this;if(2!==U._59O.size())return!1;var a=U._58O;return a?2===a.size()&&1===a.get(0)&&2===a.get(1)?!0:!1:!0},fireShapeChange:function(){var e=this;if(!e._55I&&!Yd){var E=oe(e._59O);E&&(e._55I=1,e.setRect(E),delete e._55I)}e.fp(rp,!1,!0)},getSerializableProperties:function(){var x=tj.superClass.getSerializableProperties.call(this);return x.segments=1,x.points=1,x.thickness=1,x.closePath=1,x}});var sm=R.Points=function(){ac(sm,this)};Wp("Points",Lh,{_22Q:function(){return Ho},setPoints:function($){this.points=$,this._pointsDirty=!0},setPoint:function(D,n){this.points||(this.points=[]),this.points[3*D]=n[0],this.points[3*D+1]=n[1],this.points[3*D+2]=n[2],this._pointsDirty=!0,this.fp("POINTS",!1,!0)},setPointsColor:function(Z){this.colors=Z,this._colorsDirty=!0},setPointColor:function(S,m){this.colors||(this.colors=[]),m?(m=Em(m),this.colors[3*S]=m[0],this.colors[3*S+1]=m[1],this.colors[3*S+2]=m[2]):(this.colors[3*S]=x,this.colors[3*S+1]=x,this.colors[3*S+2]=x),this._colorsDirty=!0,this.fp("COLORS",!1,!0)},setPointsSize:function(s){this.sizes=s,this._sizesDirty=!0},setPointSize:function(D,C){this.sizes||(this.sizes=[]),this.sizes[D]=C?C:x,this._sizesDirty=!0,this.fp("SIZES",!1,!0)},getPointInfo:function(d){var e=3*d,r=this.points;if(!r||r[e]===x||r[e+1]===x||r[e+2]===x)return null;var R=[r[e],r[e+1],r[e+2]],g=this.mat||dg(this),G=[R[0],R[1],R[2]];Eb(G,g);var l=this.colors;return{size:this.sizes&&this.size[d]||this.s("points.size"),color:l&&l[e]?[l[e],l[e+1],l[e+2]]:this.s("points.color"),local:R,world:G}},getSerializableProperties:function(){var X=sm.superClass.getSerializableProperties.call(this);return X.points=1,X.colors=1,X.sizes=1,X}});var kg=R.Polyline=function(){ac(kg,this),this.s({"shape.background":null,"shape.border.width":2})};Wp("Polyline",tj,{_icon:"polyline_icon",_22Q:function(){return mq},getUIClass:function(){return ts},setClosePath:function(){},setTall:function(q){var n=this,N=n.getDataModel();if(N&&N.beginTransaction(),!n._55I&&!n._24Q&&!Yd&&n.getTall()){n._24Q=1;var W=n._54O,E=q/n.getTall();if(1!==E){var d=n.toPoints(),C=new df;d.each(function(l){C.add({x:l.x,y:l.y,e:l.e==z?l.e:(l.e-W)*E+W})}),n.setPoints(C),n.fs()}delete n._24Q}kg.superClass.setTall.call(n,q),N&&N.endTransaction()},setElevation:function(l){var b=this,J=b.getDataModel();if(J&&J.beginTransaction(),!b._55I&&!b._24Q&&!Yd){b._24Q=1;var y=l-b._54O;0!==y&&b.shiftPointsElevation(y),delete b._24Q}kg.superClass.setElevation.apply(b,arguments),J&&J.endTransaction()},fireShapeChange:function(){var e=this,_=e._59O;if(!e._55I&&!e._24Q&&!Yd){var w=_.size();if(w){var c=1,D=_.get(0),i=e._54O;D.e==z&&(D.e=i);for(var L=D.e,v=0;w>c;c++){D=_.get(c),D.e==z&&(D.e=i);var B=g(L,D.e),N=W(L+v,D.e);L=B,v=N-B}e._24Q=1,e.setTall(v),e.setElevation(L+v*e._anchorElevation),delete e._24Q}}kg.superClass.fireShapeChange.apply(e,arguments)}});var mh=R.SubGraph=function(){ac(mh,this)};Wp("SubGraph",Lh,{ISubGraph:1,_image:"subGraph_image",_icon:"subGraph_icon",_8I:function(){mh.superClass._8I.call(this),this.eachChild(function(x){Vm(x)&&x._8I()})}}),m.loadingRefGraph=0;var Hq=R.RefGraph=function(){ac(Hq,this)};Wp("RefGraph",rf,{_icon:"refGraph_icon",getRef:function(){return this._ref},setRef:function(Q){var c=this._ref;this._ref=Q,this.fp("ref",c,Q),this.updateRef()},_21I:function(){Hq.superClass._21I.apply(this,arguments),this.updateRef()},updateRef:function(){var n=this;if(m.loadingRefGraph++,n.clearChildrenFromDataModel(),m.loadingRefGraph--,n._ref&&n._dataModel){n._xhrLoadHandler&&(n._xhrLoadHandler.cancel=!0);var x=Yd,I=n._xhrLoadHandler=function(w){if(w&&n._dataModel){m.loadingRefGraph++;var d=n._pendingUpdateInfo={needToRestore:x};x&&(d.position=n.p(),d.width=n.getWidth(),d.height=n.getHeight(),d.rotation=n.getRotation(),d.anchor=n.getAnchor(),d.scale=n.getScale()),n.p(0,0),n.setAnchor(.5,.5),n.setRotation(0),n.setScale(1,1);var E=m.parse(w),y=n._dataModel.deserialize(E,n,{justDatas:!0});y.each(function(Y){Y._refGraph=n}),n.checkPendingUpdateInfo(),m.loadingRefGraph--,m.handleRefGraphLoaded(n,y,E)}};I.xhrLoadCalled=!1,m.load(n._ref,function(r){I.cancel||(I.xhrLoadCalled?I(r):dr(function(){I(r)}))}),I.xhrLoadCalled=!0}},checkPendingUpdateInfo:function(){var u=this,E=u._pendingUpdateInfo;if(!E)return u.onPendingUpdated&&(m.loadingRefGraph++,u.onPendingUpdated(),m.loadingRefGraph--),void 0;var s=!0;this.eachChild(function(N){(N._pendingCheckImageJSON||N._pendingUpdateInfo)&&(s=!1)}),s&&(m.loadingRefGraph++,u._pendingUpdateInfo=null,u.updateFromChildren(),E.needToRestore&&(u.setSize(E.width,E.height),u.setAnchor(E.anchor),u.setRotation(E.rotation),u.setScale(E.scale),u.p(E.position)),this.getParent()instanceof Hq&&this.getParent().checkPendingUpdateInfo(),u.onPendingUpdated&&u.onPendingUpdated(),m.loadingRefGraph--)},getSerializableProperties:function(){var P=Hq.superClass.getSerializableProperties.call(this);return P.ref=1,P}}),R.EdgeGroup=function(p,$){this._70O=p,this._siblings=$;for(var O,r,F=0,N=p.size(),K=a[Qn];N>F;F++)if(O=p.get(F).getStyle(Qn,!1),O!=z){K=O;break}K==z&&(K=!0);var H=m.edgeGroupAgentFunc;for(H&&(r=H(p),r&&r!==p.get(0)&&(p.remove(r),p.add(r,0))),F=0;N>F;F++)p.get(F).s(Qn,K)},Wp("EdgeGroup",U,{getEdges:function(){return this._70O},size:function(){return this._70O.size()},get:function($){return this._70O.get($)},indexOf:function(D){return this._70O.indexOf(D)},each:function(J,z){this._70O.each(J,z)},getSiblings:function(){return this._siblings},eachSiblingEdge:function(J,x){this._siblings.each(function(v){v._70O.each(J,x)})}});var ti=function(l,G,T){var F=pg[l]={type:l,action:G};if(T)for(var w in T)F[w]=T[w]};ae(m,{setConnectAction:ti,getConnectAction:function(G,W){if(!W){if(!G)return null;W=G.getCurrentConnectActionType()}return pg[W]},doConnectAction:function(v,_,B,M){M=M||v.getCurrentConnectActionType();var b=pg[M];if(!b)return!1;var k=b.action;return k?(_ instanceof Tm.Group?v.sm().getSelection().each(function(p){k.call(null,v,p,B)}):k.call(null,v,_,B),!0):!1},doDeleteConnectionAction:function(g,c,M){M=M||g.getCurrentConnectActionType();var D=pg[M];if(!D||!D.delete)return!1;var q=D.delete.action;return q?(c instanceof Tm.Group?g.sm().getSelection().each(function(Z){q.call(null,g,Z)}):q.call(null,g,c),!0):!1}});var Sl=R.JSONSerializer=function(I,B){this.dm=this._dataModel=I,this._hierarchical=m.forceHierarchicalSerialization?!0:B==z?I.isHierarchicalRendering():B};Wp("JSONSerializer",U,{ms_ac:["hierarchical"],serialize:function(_){return m.stringify(this.toJSON(),_)},toJSON:function(){var V=this,S=V.dm,C=S.getRoots(),R=V.json={v:m.getVersion(),p:{},a:{},d:[]},r=S.getSerializableAttrs();S.getInit()&&(R.init=S.getInit()),S.getName()&&(R.p.name=S.getName()),S.getBackground()&&(R.p.background=S.getBackground()),S.getLayers()&&(R.p.layers=S.getLayers()),S.getEnvmap()&&(R.p.envmap=S.getEnvmap()),R.p.autoAdjustIndex=S.isAutoAdjustIndex(),R.p.hierarchicalRendering=S.isHierarchicalRendering();for(var T in r){var D=S.a(T);D!==x&&V[ve](T,D,R.a)}return ml(R.a)&&delete R.a,V._hierarchical?C.each(V.serializeData,this):S.each(function(y){V.serializeData(y)}),S.fireSerializeEvent({type:"serialize",json:R}),S.getPostProcessingData()&&(R.p.postProcessingData=S.getPostProcessingData()),R},isSerializable:function(){return!0},getProperties:function(l){return l.getSerializableProperties()},getStyles:function(t){return t.getSerializableStyles()},getAttrs:function(r){return r.getSerializableAttrs()},serializeData:function(Y){var l=this;if(l.isSerializable(Y)&&!Y._refGraph){var d,C,r,H,W=lj(Y.getClassName())||Y.getClass(),s=new W,B={c:Y.getClassName(),i:Y.getId(),p:{},s:{},a:{}};l.json.d.push(B),d=l.getProperties(Y);for(C in d)if(/^_/.test(C)){if(r=Y[C],!("_width"!==C&&"_height"!==C||r!=z&&-1!==r)){var F;((Y.s("layout.h")||Y.s("layout.v"))&&Y.getHost()||Y instanceof R.Node&&(F=Y.getParent())&&F instanceof R.Block||Y.s("fullscreen"))&&(r=Y[C]="_width"===C?Y.getWidth():Y.getHeight())}r!==s[C]&&l[ve](C.substr(1),r,B.p)}else H=Vr(C),Y[H]&&(r=Y[H](),r!==s[H]()&&l[ve](C,r,B.p));d=l.getStyles(Y);for(C in d)r=Y.s(C),r!==s.s(C)&&l[ve](C,r,B.s);d=l.getAttrs(Y);for(C in d)r=Y.a(C),r!==s.a(C)&&l[ve](C,r,B.a);ml(B.p)&&delete B.p,ml(B.s)&&delete B.s,ml(B.a)&&delete B.a}l._hierarchical&&Y.getChildren().each(l.serializeData,l)},serializeValue:function(y,O,Z){Id(O)?O={__a:O._as}:O instanceof bq&&(O={__i:O.getId()}),Z[y]=O},deserialize:function(d,U,R){var F=this;return yk(d)&&/.json$/.test(d)?(m.xhrLoad(d,function(I){F.deserializeImpl(I,U,R)}),void 0):F.deserializeImpl(d,U,R)},deserializeImpl:function(r,d,G){var h=this,H=h.dm;H.setDeserializing(!0),G=Rr(G)?{setId:G}:Jc(G)?{finishFunc:G}:G||{},r=h.json=yk(r)?m.parse(r):r,!G.justDatas&&r.a&&r.a.onPreDeserialize&&!G.disableOnPreDeserialize&&r.a.onPreDeserialize(r,H,G.view),H.beginTransaction(),Yd++,h._82I={};var Q=new df,v=new df,W=0,D=r.d.length;if(G.justDatas||(!G.disableInit&&Jc(r.init)&&r.init(H),H.setInit(r.init)),!G.justDatas){for(var k in r.a)H.a(k,h[$e](r.a[k]));
for(var Z in r.p)H[Ij(Z)](r.p[Z])}for(;D>W;W++){var V=r.d[W],E=lj(V.c),f=new E,i=V.i;G.setId&&i!=z&&(f._id=i),h._82I[i]=f,Q.add(f),v.add(V)}for(W=0;D>W;W++)h.deserializeData(Q.get(W),v.get(W));return Q.each(function(A){d&&!A.getParent()&&A.setParent(d),H.add(A)}),G.__innerHandler__&&G.__innerHandler__(r,H,G.view,Q),H.fireSerializeEvent({type:"deserialize",json:r}),Yd--,H.endTransaction(),!G.justDatas&&r.a&&r.a.onPostDeserialize&&!G.disableOnPostDeserialize&&r.a.onPostDeserialize(r,H,G.view,Q),G.finishFunc&&G.finishFunc(r,H,G.view,Q),H.setDeserializing(!1),Q},deserializeData:function(R,f){for(var N in f.p)R[Ij(N)](this[$e](f.p[N]));for(N in f.s)R.s(N,this[$e](f.s[N]));for(N in f.a)R.a(N,this[$e](f.a[N]))},deserializeValue:function(w){if(Vc(w)){var g=w.__i;if(g!=z)return this._82I[g];if(g=w.__a,Mf(g))return new df(g)}return w}}),ae(Ao,{serialize:function(Z,a){return new Sl(this,a).serialize(Z)},toJSON:function(D){return new Sl(this,D).toJSON()},deserialize:function(D,o,R){return new Sl(this).deserialize(D,o,R)}});var Ch=R.OverlappingBox=function(G){this.gv=G,this.boxes={}};Wp("OverlappingBox",U,{clear:function(){var j,P,R=this.boxes;for(j in R)P=R[j],P.length=0},isOverlapping:function(P,e){var O,X,n=this,x=n.boxes,F=x[P];F?(O=F.rects,X=F.length):F=x[P]={rects:O=[],length:X=0};var c,q,e;for(c=0;X>c;c++)if(q=O[c],q.x<e.x+e.w&&q.x+q.w>e.x&&q.y<e.y+e.h&&q.h+q.y>e.y)return!0;return O.length<=X?(O.push(e),F.length++):O[F.length++]=e,!1}}),ae(m,{fetch:function(y,R){var l="GET",O=!1,t=null,d="";R&&(l=R.method||"GET",O=R.sync,d=R.url,t=R.data||null),y.open(l,d,!O),R.responseType?y.responseType=R.responseType:R.overrideMimeType&&y.overrideMimeType&&y.overrideMimeType(R.overrideMimeType),y.send(t)},convertImageSrc:function(v,Y){Y&&"function"==typeof Y||(Y=function(){}),Y(v)}});var dk=R.Request=function(){this._xhr=new XMLHttpRequest,this._onloadFunc=function(){},this._errorFunc=function(){}};Wp("Request",U,{_responseType:null,_overrideMimeType:"text/plain",send:function(p){var G=this._xhr,u=this.onload,H=this.onerror;this.getResponseType()?p.responseType=this.getResponseType():this.getOverrideMimeType()&&(p.overrideMimeType=this.getOverrideMimeType()),G.onload=u,G.onerror=H,m.fetch(G,p)},onload:function(){},onerror:function(){},getResponseType:function(){return this._responseType},setResponseType:function(H){this._responseType=H},getOverrideMimeType:function(){return this._overrideMimeType},setOverrideMimeType:function(q){this._overrideMimeType=q},getResponseText:function(){var I=this._xhr;return I.response||I.responseText}}),ks.GraphView=function(P){var e=this;e._24I={},e._34I=new df,e._25I={},e._56I={},e._view=Ul(1,e),e._canvas=pn(e._view),e.dm(P?P:new Ao),this._coreInteractor=new ms(this),e.setEditable(!1),e.setScrollBarVisible(m.graphViewScrollBarVisible),e._initView()},us("GraphView",U,{ms_v:1,ms_gv:1,ms_bnb:1,ms_tip:1,ms_dm:1,ms_lp:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,_52o:1,_51o:1,ms_ac:[Jo,Hg,Fd,gs,"resettable","editInteractor",nm,"zoomable","pannable","rectSelectable","autoScrollZone",qf,"movableFunc","editableFunc","pointEditableFunc","rectEditableFunc","rotationEditableFunc","anchorEditableFunc","rectSelectBackground","rectSelectBorderColor","editPointSize","editPointBorderColor","editPointBackground","hoverDelay"],_zoomable:m.graphViewZoomable,_resettable:m.graphViewResettable,_pannable:m.graphViewPannable,_rectSelectable:m.graphViewRectSelectable,_autoScrollZone:m.graphViewAutoScrollZone,_rectSelectBackground:m.graphViewRectSelectBackground,_rectSelectBorderColor:m.graphViewRectSelectBorderColor,_editPointSize:m.graphViewEditPointSize,_editPointBorderColor:m.graphViewEditPointBorderColor,_editPointBackground:m.graphViewEditPointBackground,_scrollBarColor:Bi,_scrollBarSize:Pl,_autoHideScrollBar:ce,_autoMakeVisible:yg,_currentActionType:null,getCoreInteractor:function(){return this._coreInteractor},getLayers:function(){return this._dataModel.getLayers()},setLayers:function(n){this._dataModel.setLayers(n)},setEditable:function(r){var W=this,z=W.__interactorMap__;if(!z){var $=ks.XEditInteractor;z=W.__interactorMap__={scrollBar:new ke(W),select:new Sh(W),edit:$?new $(W):new _k(W),text:new Lo(W),move:new Yc(W),"default":new pb(W),touch:new Nj(W,{editable:!1})}}r?(W._uieditable=!0,W.setInteractors([z.scrollBar,z.select,z.edit,z.text,z.move,z.default,z.touch])):(W._uieditable=!1,W.setInteractors([z.scrollBar,z.select,z.move,z.default,z.touch]))},getCanvas:function(){return this._canvas},_33I:function(e){var N=e.getUIClass();return N?new N(this,e):z},getDataUI:function(O){var D=this,h=D._25I[O._id];return h===x&&(h=D._33I(O),D._25I[O._id]=h),h},getNodeRect:function(h){return m.getNodeRect(this,h)},getFullscreenDatas:function(){return this._dataModel.getFullscreenDatas()},getEdgeInfo:function(a){var M=this.getDataUI(a);return M?(M._79o(),M._78o):null},getEdgeSourcePosition:function(V){var m=this,B=m.getDataUI(V),K=B.s,G=B._data._40I;return oo(m,G,K("edge.source.position"),K("edge.source.offset.x"),K("edge.source.offset.y"),K("edge.source.anchor.x"),K("edge.source.anchor.y"))},getEdgeTargetPosition:function(u){var P=this,Q=P.getDataUI(u),d=Q.s,h=Q._data._41I;return oo(P,h,d("edge.target.position"),d("edge.target.offset.x"),d("edge.target.offset.y"),d("edge.target.anchor.x"),d("edge.target.anchor.y"))},invalidateAll:function(A){var s=this;if(A){for(var q in s._25I){var m=s._25I[q];m&&m.dispose()}s._25I={},s._56I={},s._24I={},s._34I.clear(),s.redraw()}else s.dm().each(function(O){s.invalidateData(O)})},invalidateSelection:function(){var o=this;o.sm().each(function(I){o.invalidateData(I)})},invalidateData:function(H){var s=this;s._24I[H._id]=H,s._21Q(H),s.iv()},_21Q:function(d){var u=this,B=u._24I;if(xr(d)&&Xj[d.s(pr)]){var G=d.getSourceAgent();G&&G.getAgentEdges().each(function(E){B[E._id]=E}),G=d.getTargetAgent(),G&&G.getAgentEdges().each(function(F){B[F._id]=F}),u.iv()}},redraw:function(O){var y=this;y._32I||(O?y._34I.add(O):(y._32I=1,y._34I.clear()),y.iv())},each:function(P,l){var k,t,y,u=0,v=this.getLayers(),j=this._dataModel,E=j._datas._as,_=E.length;if(v){for(var b=v.length;b>u;u++)if(y=v[u],Vc(y)&&(y=y.name),j.isHierarchicalRendering()){var K=function(n){return n._layer===y?l?P.call(l,n):P(n):void 0};if(this._dataModel.eachByHierarchical(K)===!1)return}else for(var o=0;_>o;o++)if(k=E[o],k._layer===y&&(t=l?P.call(l,k):P(k),t===!1))return}else if(j.isHierarchicalRendering())this._dataModel.eachByHierarchical(P,null,l);else for(;_>u;u++)if(k=E[u],t=l?P.call(l,k):P(k),t===!1)return},reverseEach:function(p,v){var W,U,D,M,k=this._dataModel,L=k._layers,b=k._datas._as,d=b.length;if(L){for(W=L.length-1;W>=0;W--)if(M=L[W],Vc(M)&&(M=M.name),k.isHierarchicalRendering()){var u=function(f){return f._layer===M?v?p.call(v,f):p(f):void 0};if(k.reverseEachByHierarchical(u)===!1)return}else for(var l=d-1;l>=0;l--)if(U=b[l],U._layer===M&&(D=v?p.call(v,U):p(U),D===!1))return}else if(k.isHierarchicalRendering())k.reverseEachByHierarchical(p,null,v);else for(W=d-1;W>=0;W--)if(U=b[W],D=v?p.call(v,U):p(U),D===!1)return},getViewRect:function(){return this._29I},getContentRect:function(){var K=this,q=K._84I;if(!q){var Z=this.dm().a("width"),p=this.dm().a("height");Z>0&&p>0?K._84I={x:0,y:0,width:Z,height:p}:(K.each(function(Y){K.isVisible(Y)&&(q=Mq(q,K.getDataUIBounds(Y)))}),K._84I=q?q:ni)}return K._84I},getScrollRect:function(){return Mq(this.getContentRect(),this._29I)},makeCenter:function(W,A,S){var B=this;if(!B.getWidth()||!B.getHeight())return S||dr(B.makeCenter,B,[W,A,!0],500),void 0;B.makeVisible(W),B.validate();var G=B.getDataUIBounds(W);if(G){var m=B.getWidth(),z=B.getHeight(),n=G.x+G.width/2,s=G.y+G.height/2,j=-n*B._zoom+m/2,c=-s*B._zoom+z/2;B.setTranslate(j,c,A)}},fitData:function(S,r,g,E,t){var X=this;if(!X.getWidth()||!X.getHeight())return t||dr(X.fitData,X,[S,r,g,E,!0],500),void 0;var O=function(){X.makeVisible(S),X.validate();var D=X.getDataUIBounds(S);D&&(D=qj(D),km(D,g==z?20:g),X.fitRect(D,r,E))};r?m.callWhenLoaded(O):O()},fitContent:function(R,d,$,C){var r=this;if(!r.getWidth()||!r.getHeight())return C||dr(r.fitContent,r,[R,d,$,!0],500),void 0;var u=function(){r.validate();var B=qj(r.getContentRect());km(B,d==z?20:d),r.fitRect(B,R,$)};R?m.callWhenLoaded(u):u()},fitRect:function(F,Q,t){var m=this,p=m.getWidth(),j=m.getHeight(),R=F.x+F.width/2,S=F.y+F.height/2,J=g(p/F.width,j/F.height),x=m._zoom,a=-R*x+p/2,G=-S*x+j/2;0===J||isNaN(J)||(t&&(J=g(1,J)),Q?(m._65I&&(delete m._65I.finishFunc,m._65I.stop(!0)),m._14o&&m._14o.stop(!0),m.setTranslate(a,G,{finishFunc:function(){m.setZoom(J,Q)}})):(m.setTranslate(a,G),m.setZoom(J)))},fitSelection:function(w,y,K){var u=this,Y=u.sm(),q=null;Y.size()&&(Y.each(function(B){var l=u.getDataUIBounds(B);q=q?Mq(l,q):l}),w&&km(q,w),u.fitRect(q,y,K))},toCanvas:function(C,m,e){m=m||this._zoom,this.validateImpl();var R=this,a=R.getContentRect();e&&km(a,e),a.width||(a.width=10),a.height||(a.height=10);var i=pn(),U=a.x*m,d=a.y*m,M=Math.ceil(a.width*m),s=Math.ceil(a.height*m);vl(i,M,s,1);var g=vs(i);return C=C||this._dataModel.getBackground(),C&&em(g,0,0,M,s,C),jm(g,-U,-d),g.scale(m,m),R._42(g),g.restore(),i},toDataURL:function(M,r,E,D){return this.toCanvas(M,E,D).toDataURL(r||"image/png",1)},getClipBounds:function(){return this._74O},_42:function(h,_){var C=this,D=C.dm().getBackground();if(D){var z=C.dm().a("width"),Z=C.dm().a("height");z>0&&Z>0&&em(h,0,0,z,Z,D)}var i=C.__htmlOrderList,M=[];if(C._93db(h,_),C.each(function(u){var e=C.getDataUI(u);if(e){var l=C._56I[u._id],g=e._htmlView;if(l){var U=e._79o();if(g=e._htmlView,R.HtmlNode&&u instanceof R.HtmlNode)e._42(h);else{var O=C.getViewRect(),k=g&&g.layoutHTML;!_||dm(_,U)?(k&&(g.layoutHTML(),e.__outerLayout&&delete e.__outerLayout),e._42(h)):dm(O,U)||!k||e.__outerLayout||(g.layoutHTML(),e.__outerLayout=!0)}}g&&(M.push(g),g.getView&&(g=g.getView()),g.style.display=l?"block":sn)}}),i&&M.length>0){var X=!1;if(i.length!==M.length)X=!0;else for(var K=0;K<M.length;K++)if(M[K]!==i[K]){X=!0;break}X&&(M.forEach(function(D){D.autoAdjustIndex!==!1&&C.appendHTML(D,!0)}),this.__htmlOrderList=M)}else this.__htmlOrderList=M;C._92db(h,_)},validateImpl:function(){this.tryUpdateRootData();var p,Z,b,A,x,N=this,R=N.tx(),i=N.ty(),L=N._zoom,G=N._canvas,J=this.getWidth(),I=this.getHeight(),K=N._29I,O={x:-R/L,y:-i/L,width:J/L,height:I/L},$={},S=N._34I,k=N._24I,V=N._32I,F=N._23I;N._24I={},(J!==G.clientWidth||I!==G.clientHeight)&&(vl(G,J,I),V=1),V||Gp(O,K)||(V=1),N._29I=O,N.each(function(D){Z=D._id;var p=$[Z]=N.isVisible(D);p!==N._56I[Z]&&(k[Z]=D,b=N.getDataUI(k[Z]),b&&b._84o(p),N._84o(D,p))},N);for(Z in k)b=N.getDataUI(k[Z]),b&&(!V&&N._56I[Z]&&(x=b._79o(),x&&S.add(x)),b.invalidate()),N._83I=1;if(N._56I=$,!V)for(Z in k)$[Z]&&(b=N.getDataUI(k[Z]),b&&(x=b._79o(),x&&S.add(x)));if(V?A=O:(S.each(function(R){dm(O,R)&&(A=Mq(A,R))}),A&&(km(A,W(1,1/L)),A.x=h(A.x*L)/L,A.y=h(A.y*L)/L,A.width=v(A.width*L)/L,A.height=v(A.height*L)/L,A=Og(O,A))),N._74O=A,A){p=vs(G);var s=A.x,q=A.y,l=A.width,w=A.height;s=Math.floor((s*L+R)*Gn),q=Math.floor((q*L+i)*Gn),l=Math.ceil(l*L*Gn)+1,w=Math.ceil(w*L*Gn)+1,V||(A.x=(s/Gn-R)/L,A.y=(q/Gn-i)/L,A.width=l/Gn/L,A.height=w/Gn/L),p.beginPath(),p.rect(s,q,l,w),p.clip(),p.clearRect(s,q,l,w),kn(p,R,i,L),N._42(p,A),p.restore(),delete N._74O}if(S.clear(),delete N._32I,F&&J>0&&I>0){var b=N.getDataUI(F);if(b){var x=b._79o(),M=N._29I,C=M.x,D=M.y,m=M.width,c=M.height,L=N._zoom;x&&!dm(x,M)&&(x.x+x.width<C&&N.tx(-x.x*L),x.x>C+m&&N.tx(-(x.x+x.width-m)*L),x.y+x.height<D&&N.ty(-x.y*L),x.y>D+c&&N.ty(-(x.y+x.height-c)*L))}delete N._23I}N._83I&&(delete N._83I,delete N._84I),N._98O(),N.countFrame(),ml(N._24I)||dr(N.iv,N)},isValidGuideLineSource:function(){return!0},tryUpdateRootData:function(){if(!this._rootDataUpdating){this._rootDataUpdating=!0;var z,t=this.getFullscreenDatas();for(var T in t)z=t[T],this.scaleRootData(z);this._rootDataUpdating=!1}},scaleRootData:function(j){var W=j.s("fullscreen");if("uniform"===W||"fill"===W){j.getRotation()&&j.setRotation(0);var y=j.s("fullscreen.gap")||0,m=this.getWidth(),M=this.getHeight();if(m&&M){var w,L,O,$=m-2*y,i=M-2*y,t=j.getAnchor(),k=j.getScaledSize(),F=k.width,Q=k.height,d=j.s("fullscreen.lock");if(d)return"uniform"===W?$/i>F/Q?(w=i/Q,F=Q*$/i):(w=$/F,Q=F*i/$):"v"===d?(w=i/Q,F=$/w,j.getWidth()!==F&&j.setWidth(F)):(w=$/F,Q=i/w,j.getHeight()!==Q&&j.setHeight(Q)),this.setZoom(w),L=y-(j.getX()-t.x*F)*w,O=y-(j.getY()-t.y*Q)*w,L!==this.tx()&&this.tx(L),O!==this.ty()&&this.ty(O),void 0;L=this.tx(),O=this.ty(),w=this._zoom;var h={x:(-L+y)/w,y:(-O+y)/w,width:$/w,height:i/w};if("uniform"===W){var s=F/Q,R=Math.min(h.width,h.height*s),E=R/s;h.x+=.5*(h.width-R),h.y+=.5*(h.height-E),h.width=R,h.height=E}$=h.width/j.getScaleX(),i=h.height/j.getScaleY(),(j.getWidth()!=$||j.getHeight()!==i)&&j.setSize($,i);var A=h.x+t.x*h.width,C=h.y+t.y*h.height,x=j.getPosition();(A!==x.x||C!==x.y)&&j.setPosition(A,C)}}},isScrollBarVisible:function(){return!!this._79O},setScrollBarVisible:function(N){var T=this;N!==T.isScrollBarVisible()&&(N?(tc(T._view,T._79O=Kk()),tc(T._79O,T._27I=Kk()),tc(T._79O,T._28I=Kk())):(Rd(T._79O),delete T._79O,delete T._27I,delete T._28I),T.fp("scrollBarVisible",!N,N))},getDebugTip:function(){return""},showScrollBar:function(){var D=this;D._79O&&(D._85I||(Qf(function(){D._86I()},Cc),D.iv()),D._85I=new Date)},_86I:function(){var X=this;if(X._85I){var E=new Date,g=E.getTime();g-X._85I.getTime()>=Cc?(delete X._85I,X.iv()):Qf(function(){X._86I()},Cc)}},getVScrollBar:function(){return this._27I},getHScrollBar:function(){return this._28I},_98O:function(){var w=this,u=this._27I,k=this._28I;if(w._79O){if(w._autoHideScrollBar&&!w._85I)return u.style.visibility=Ob,k.style.visibility=Ob,void 0;var U=w.getScrollBarColor(),y=w._zoom,A=w.getScrollBarSize(),H=w.getViewRect(),Y=w.getScrollRect(),f=H.height*y,q=Y.height*y,N=H.width*y-A-2,M=f*((H.y-Y.y)*y/q),Z=f*(f/q),$=u.style;q-.5>f?(Cp>Z&&(M=M+Z/2-Cp/2,0>M&&(M=0),M+Cp>f&&(M=f-Cp),Z=Cp),Ln(u,N,M,A,Z),$.visibility=so,$.background=U,$.borderRadius=A/2+Tq):$.visibility=Ob;var W=H.width*y,m=Y.width*y,M=H.height*y-A-2,N=W*((H.x-Y.x)*y/m),d=W*(W/m),$=k.style;m-.5>W?(Cp>d&&(N=N+d/2-Cp/2,0>N&&(N=0),N+Cp>W&&(N=W-Cp),d=Cp),Ln(k,N,M,d,A),$.visibility=so,$.background=U,$.borderRadius=A/2+Tq):$.visibility=Ob}},setDataModel:function(J){var F=this,M=F._dataModel,w=F._selectionModel;M!==J&&(M&&(M.ump(F.handleDataModelPropertyChange,F),M.umm(F.handleDataModelChange,F),M.umd(F.handleDataPropertyChange,F),M.removeIndexChangeListener(F._75O,F),M.removeHierarchyChangeListener(F.handleHierarchyChange,F),w||M.sm().ums(F.handleSelectionChange,F)),F._dataModel=J,J.mp(F.handleDataModelPropertyChange,F),J.mm(F.handleDataModelChange,F),J.md(F.handleDataPropertyChange,F),J.addIndexChangeListener(F._75O,F),J.addHierarchyChangeListener(F.handleHierarchyChange,F),w?w._21I(J):J.sm().ms(F.handleSelectionChange,F),F.invalidateAll(!0),F.fp(Ap,M,J),F.updateBackground())},getLayersInfo:function(){if(this._layersInfo===x){var b=this.getLayers();b?(this._layersInfo={},b.forEach(function(_){var H=Vc(_)?_.name:_;this._layersInfo[H]=_},this)):this._layersInfo=null}return this._layersInfo},calculateEdgePosition:function(L,t,v){var o,M,f=this,b=f.getDataUI(L),k=wk(b),Z=Vl(t,function(M){return _o(k,100*M)},100,.001),q=_o(k,100*Z);if(!v){var D=ip(b),T=new lm(q.x,q.y),j=49/(f._zoom*f._zoom);for(o=0,M=D.length;M>o;o++)if(T.distanceToSquared(D[o])<j)return{index:o,point:D[o],distance:Math.sqrt((D[o].x-t.x)*(D[o].x-t.x)+(D[o].y-t.y)*(D[o].y-t.y))}}return{percent:Z,point:q,distance:Math.sqrt((q.x-t.x)*(q.x-t.x)+(q.y-t.y)*(q.y-t.y))}},calculateAttachPoint:function(){var C=new lm,Q=new lm,d=new lm;return function(k,a){var c=this.getAttachPoints(k);if(!c||!c.length)return null;d.set(a.x,a.y);for(var m,j,l,q,G,s=1/0,o=0,X=c.length;X>o;o++)l=c[o],Q.x=l.x,Q.y=l.y,C.x=l.offsetX||0,C.y=l.offsetY||0,q=oo(this,k,0,C.x,C.y,Q.x,Q.y),j=d.distanceToSquared(q),s>j&&(m=o,s=j,G=q);s=Math.sqrt(s);var $=this.getAttachStyle(k);if("close"===$){var D=k.s("attach.close.threshold")/this._zoom;if(s>D)return null}return{index:m,distance:s,info:c[m],point:G}}}(),getAttachPoints:function(H){var w=H.s("attach.points");if(w)return w;var t=Qd(H._image);return t?Lq(t.attachPoints,H,this)||null:void 0},getAttachStyle:function(Y){var S=Y.s("attach.style");if(S)return S;var P=Qd(Y._image);return P?Lq(P.attachStyle,Y,this)||"close":void 0},updateLayers:function(){this._layersInfo=x,this.invalidateSelection(),this.redraw()},updateBackground:function(){var g=this.dm().a("width"),P=this.dm().a("height");this._canvas.style.background=g>0&&P>0?"":this.dm().getBackground()||""},handleDataModelPropertyChange:function(U){if("background"===U.property){var g=this._canvas.style.background,T=U.newValue||"";this.updateBackground(),this.fp("canvasBackground",g,T),this.redraw()}else"a:width"===U.property||"a:height"===U.property?(this._83I=1,this.updateBackground(),this.redraw()):"layers"===U.property?this.updateLayers():"hierarchicalRendering"===U.property&&this.redraw()},handleDataPropertyChange:function(A){this.dm().isHierarchicalRendering()&&"parent"===A.property&&A.data.hasChildren()&&this.redraw(),this.invalidateData(A.data)},onPropertyChanged:function(U){var M=this,A=U.property;if(M.redraw(),"zoom"===A){var h=M.sm().getSelection();h.size()&&h.each(function(E){E.invalidate()})}else"dataModel"===A&&(M._83I=1);Mb[A]?M.showScrollBar():A===nm&&M.onCurrentSubGraphChanged(U)},onCurrentSubGraphChanged:function(){this.sm().cs(),this.reset()},handleDataModelChange:function(I){var V=this,F=I.kind,_=I.data;if(V._83I=1,"add"===F)V.invalidateData(_),xr(_)&&_.getEdgeGroup()&&_.getEdgeGroup().eachSiblingEdge(V.invalidateData,V);else if(F===gm){V._21Q(_);var c=_._id,N=V._25I[c];if(N){if(V._56I[c]){var M=N._79o();M&&V.redraw(M)}N.dispose(),delete V._25I[c],delete V._24I[c],delete V._56I[c]}_===V._currentSubGraph&&V.setCurrentSubGraph(z)}else F===Zj&&(V.invalidateAll(!0),V.setCurrentSubGraph(z))},_75O:function(p){this.invalidateData(p.data)},handleHierarchyChange:function(M){this.dm().isHierarchicalRendering()&&M.data.hasChildren()&&this.redraw(),this.invalidateData(M.data)},adjustIndex:function(y){var V=this;if(V.isVisible(y)){V.dm().beginTransaction();for(var b=y;b._parent&&V.isVisible(b._parent);)b=b._parent;b&&b!==y&&V._dataModel.adjustIndex(b),V._dataModel.adjustIndex(y),V.dm().endTransaction()}},getImage:function(q){return q.getImage?q.getImage():x},getSelectWidth:function(Z){var n=Qd(this.getImage(Z));return n&&Lq(n.disableSelectedBorder,Z,this)?0:Z.s("select.width")},getSelectColor:function(R){return R.s("select.color")},isSelectable:function(s,j){if(this.isSelected(s))return!0;if(!j&&s.getParent()instanceof rf&&this.isSelectable(s.getParent(),!0)&&s.getParent().isSyncSize())return!1;var E=this.getLayersInfo();if(E){var M=E[s._layer];if(M&&M.selectable===!1)return!1}return s.s("2d.selectable")&&this.sm().isSelectable(s)},isMovable:function(o){var U=this;if(xr(o)&&o.getStyle(pr)!==mm)return!1;var s=this.getLayersInfo();if(s){var v=s[o._layer];if(v&&v.movable===!1)return!1}return o.s("2d.movable")?U._movableFunc?U._movableFunc(o):!0:!1},isEditable:function(Y){var E=this;if(R._uiSerializing)return E._uieditable;if(!E._editInteractor||!E.isSelected(Y))return!1;if(wr(Y)){var I=E.getDataUI(Y);if(!I||I._88I)return!1}if(xr(Y)&&Y.getStyle(pr)!==mm)return!1;var Q=this.getLayersInfo();if(Q){var C=Q[Y._layer];if(C&&C.editable===!1)return!1}return Y.s("2d.editable")?E._editableFunc?E._editableFunc(Y):!0:!1},handleDelete:function(){this._editInteractor&&(this._editInteractor.handleDelete?this._editInteractor.handleDelete():this.removeSelection())},isPointEditable:function(F){return Vm(F)&&0!==F.getRotation()?!1:this._pointEditableFunc?this._pointEditableFunc(F):!0},isRectEditable:function(H){return this._rectEditableFunc?this._rectEditableFunc(H):!0},isAnchorEditable:function(k){return this._anchorEditableFunc?this._anchorEditableFunc(k):!0},isRotationEditable:function(y){return y.setRotation&&y.IRotatable!==!1?this._rotationEditableFunc?this._rotationEditableFunc(y):!0:!1},isSourceTargetEditable:function(){return!0},getRotationPoint:function($){var Y=$.getAnchor(),U=$.getScale(),r=this._zoom,q=hn($.getRotation(),0,-$.getHeight()*U.y*Y.y-(U.y<0?-1:1)*(vd?32:16)/r),A=$.p();return q.x+=A.x,q.y+=A.y,q},getLogicalPoint:function(d){var G=this;return bp(d,G._canvas,G.tx(),G.ty(),G._zoom,G._zoom)},getScreenPoint:function(D,T){var s,U=this;return"object"==typeof D?D.x!==x?(s=D.x,T=D.y):(s=D[0],T=D[1]):s=D,hr(s,T,U._canvas,U.tx(),U.ty(),U._zoom,U._zoom)},getSelectedDataAt:function(B){var i=this;return this.getDataAt(B,function(N){return i.isSelected(N)})},getDataInfoAt:function(D,a,y){var x,H=this.lp(D),J=this.getDataAt(H,a,y);if(J){var Q=this.getDataUI(J);x={data:J,ui:Q,point:H};var r=Q._38o;if(r){var g=r.icons;for(var b in g){var j=g[b],G=r.rects[b];if(G)for(var s=Lq(j.names,J,this),K=s?s.length:0,u=G.rotation,I=K-1;I>=0;I--){var n=s[I],p=G[I];if(Eq(p,H,u))return x.part="icons",x.name=b,x.icon=n,x.rect=p,x.index=I,x.rotation=u,x}}}if(this.isNoteVisible(J)){if(Q.note2Info&&Eq(Q.note2Info.clickRect,H,z,Q.note2Info.scale))return x.part="note2",x;if(Q.noteInfo&&Eq(Q.noteInfo.clickRect,H,z,Q.noteInfo.scale))return x.part="note",x}if(this.isLabelVisible(J)){if(Q.label2Info&&Eq(Q.label2Info.rect,H,Q.label2Info.rotation,Q.label2Info.scale))return x.part="label2",x;if(Q.labelInfo&&Eq(Q.labelInfo.rect,H,Q.labelInfo.rotation,Q.labelInfo.scale))return x.part="label",x}if(J.isInRect&&J.isInRect(H))return x.part="body",x}return x},getDataAt:function(i,a,o){i.target&&(i=this.lp(i));var X,r=this._zoom;return this.reverseEach(function(V){return(a?a(V):this.isSelectable(V))&&this.rectIntersects(V,$q(i.x,i.y,o,r))?(X=V,!1):void 0},this),X},getIconInfoAt:function(t,Z){var l=this;if(t.target&&(t=l.lp(t)),Z||(Z=l.getDataAt(t)),Z){var V=l.getDataUI(Z);if(V&&V._38o){var G,A=V._38o,j=new df;for(G in A.icons)j.add(G);for(var K=j.size()-1;K>=0;K--){G=j.get(K);for(var c=A.rects[G],k=c.rotation,b=c.length-1;b>=0;b--){var s=c[b],q=s.width,W=s.height,D={x:t.x-s.x-q/2,y:t.y-s.y-W/2};k!=z&&(D=hn(-k,D.x,D.y));var s={x:-q/2,y:-W/2,width:q,height:W};if(Eq(s,D))return{key:G,index:b,name:A.icons[G].names[b],rect:c[b],point:t,rotation:k,relativeRect:s,relativePoint:D,data:Z}}}}}return z},getDatasInRect:function(W,j,L){L===x&&(L=1);var S=this,r=new df;return S.reverseEach(function(q){L&&!S.isSelectable(q)||(j?S.rectIntersects(q,W):S.rectContains(q,W))&&r.add(q)}),r},moveSelection:function(T,K){var l=this;l.dm().beginTransaction(),sd(l.sm().toSelection(l.isMovable,l),T,K),l.dm().endTransaction()},moveDatas:function(U,I,m){var d=this;d.dm().beginTransaction(),U instanceof df||(U=new df(U)),sd(U,I,m),d.dm().endTransaction()},getDataUIBounds:function(K){var w=this.getDataUI(K);return w?w._79o():z},drawData:function(x,S,o){var d=this.getDataUI(S);if(d){var J=d._79o();(!o||dm(o,J))&&(d._42(x),S instanceof R.Block&&S.eachChild(function(Q){this.isVisible(Q)&&this.drawData(x,Q,o)},this))}},getBoundsForGroup:function(t){return t.s(Ag)?this.getDataUIBounds(t):z},isPixelPerfect:function(A){return A.s("pixelPerfect")},rectIntersects:function(x,A){this.validate();var I=z;if(this._56I[x._id]){var w=this._25I[x._id];if(w){var b=w._79o();if(Sr(A,b))I=!0;else if((A=Og(A,b))&&(w.rectIntersects&&(I=w.rectIntersects(A)),I==z)){if(!this.isPixelPerfect(x))return!0;var n=A.x,D=A.y,T=A.width,c=A.height,G=this._zoom,u=m.hitMaxArea,e=T*c*G*G;if(e>u){var Z=Math.sqrt(u/e);G*=Z}T*=G,c*=G,2>T&&(T=2),2>c&&(c=2),n*=G,D*=G;var R=Hd(T,c);jm(R,-n,-D),R.scale(G,G),this._drawForChecking=!0,this.drawData(R,x,A),this._drawForChecking=!1;try{for(var B=0,r=R.getImageData(0,0,T,c).data;B<r.length;B+=4)if(0!==r[B+3]){I=!0;break}R.restore()}catch(Q){fn=z,I=!1}}}}return I?!0:!1},rectContains:function(e,Z){if(this._56I[e._id]){var E=this._25I[e._id];if(E)return Sr(Z,E._79o())}return!1},reset:function(){this.setZoom(1),this.setTranslate(0,0)},handleKeyDown:function(I){if(!m.isInput(I.target)){var N=this,j=N._focusData,Q=j&&N._25I[j._id],w=0,J=N._dataModel._datas;if(!(j&&j._enabled&&j._editable&&Q&&Q.onKeyDown&&Q.onKeyDown(I)===!0))if(9===I.keyCode&&(j&&(w=J.indexOf(j),Zh(I)?-1===--w&&(w=0):++w===J.size()&&(w=0)),N._focusData=j=J.get(w),N.sm().setSelection(j)),Rj(I)?N.selectAll():Wh(I)&&N.isResettable()&&N.reset(),N.sm().isEmpty()){if(N._editing)return;var d=N.tx(),k=N.ty(),V=!1,t=Zh()?100:10;sr(I)&&(d-=t,V=!0),Hr(I)&&(k-=t,V=!0),Kf(I)&&(d+=t,V=!0),Fe(I)&&(k+=t,V=!0),V&&N.setTranslate(d,k)}else{Mg(I)&&N.handleDelete(I);var M=Zh()?10:1;sr(I)&&(N.moveSelection(-M,0),N.fi({kind:"moveLeft"})),Hr(I)&&(N.moveSelection(0,-M),N.fi({kind:"moveUp"})),Kf(I)&&(N.moveSelection(M,0),N.fi({kind:"moveRight"})),Fe(I)&&(N.moveSelection(0,M),N.fi({kind:"moveDown"}))}}},handleScroll:function(n,u){if($r(n),this.isZoomable()){if(!this.getEditInteractor()){var B=this.getDataAt(n);if(B){var s=Qd(this.getImage(B));if(s&&Lq(s.scrollable,B,this))return}}var I=this.lp(n);u>0?this.scrollZoomIn(I):0>u&&this.scrollZoomOut(I)}},handlePinch:function(X,A,L){this.isZoomable()&&(Math.abs(A-L)<m.pinchZoomThreshold||(A>L?this.pinchZoomIn(X):this.pinchZoomOut(X)))},checkDoubleClickOnNote:function(C,F){var Y=this,t=Y.lp(C),h=Y.getDataUI(F),j=h.note2Info;return j&&F.s("note2.toggleable")&&Eq(j.clickRect,t)?(F.s(fs,!F.s(fs)),Y.fi({kind:"toggleNote2",event:C,data:F}),!0):(j=h.noteInfo,j&&F.s("note.toggleable")&&Eq(j.clickRect,t)?(F.s(Xo,!F.s(Xo)),Y.fi({kind:"toggleNote",event:C,data:F}),!0):!1)},_84o:function(){},isNoteVisible:function(){return this._zoom>.15},isLabelVisible:function(){return this._zoom>.15},isEditVisible:function(){return this._zoom>.15},autoScroll:function(Y,H){var X=this,L=X.getAutoScrollZone(),V=L/X.getZoom(),m=L/4,D=X._29I,G=X.lp(Y),N={x:X.tx(),y:X.ty()};return G&&L>0&&D&&(G.x-D.x<V?X.translate(m,0):D.x+D.width-G.x<V&&X.translate(-m,0),G.y-D.y<V?X.translate(0,m):D.y+D.height-G.y<V&&X.translate(0,-m)),N.x=X.tx()-N.x,N.y=X.ty()-N.y,H&&(H.x+=N.x,H.y+=N.y),N},getMoveMode:function(i,U){var e=U.s("2d.move.mode");return e?e:hf["88"]?"x":hf["89"]?"y":"xy"},getSerializableProperties:function(){return{scrollBarColor:1,scrollBarSize:1,autoMakeVisible:1,autoHideScrollBar:1,editable:1,resettable:1,pannable:1,rectSelectable:1,autoScrollZone:1,visibleFunc:1,movableFunc:1,editableFunc:1,pointEditableFunc:1,rectEditableFunc:1,anchorEditableFunc:1,rotationEditableFunc:1,rectSelectBackground:1,rectSelectBorderColor:1,editPointSize:1,editPointBorderColor:1,editPointBackground:1,hoverDelay:1,dataModel:1,selectionModel:1,currentSubGraph:1,zoom:1,translateX:1,translateY:1}},serializeProperty:function(x,R,y){var q=this;return"currentSubGraph"===R?{__i:x.getId()}:y.serializeProperty(x,R,q)},deserializeProperty:function(V,k,l){var $=this;if("currentSubGraph"===k){var J=$.dm(),U=J.__idMap;return U[V.__i]}return l.deserializeProperty(V,k,$)},setDefaultCursor:function(T,w){this._defaultCursor=T,w!==!1&&this.setCursor(T)},setCursor:function(I){"default"===I&&(I=this._defaultCursor||I);var p=this.getView().style;p.cursor=I,p.cursor="-webkit-"+I,p.cursor="-moz-"+I},getCurrentConnectActionType:function(){return this._currentActionType},setCurrentConnectActionType:function(y){return y===z||m.getConnectAction(null,y)?(this._currentActionType=y,this.redraw(),!0):!1},getEditStyle:function(n){var A=this.getEditInteractor();return A?A.getStyle(n):x},setEditStyle:function(r,v,L){var Q=this.getEditInteractor();return Q?(Q.setStyle(r,v,L),!0):!1},isConnectActionVisible:function(j){var p=m.getConnectAction(this);if(!p)return!1;var I=p.visible;return Jc(I)&&(I=I(this,j)),I},isInteractive:function(F){if(this._drawForChecking)return!1;var e=Qd(this.getImage(F));return e&&Lq(e.interactive,F,this)?!0:F.s("interactive")},appendHTML:function(v,m){var W=this.getView();if(!(m||v&&v.parentNode!==W))return!1;var e=v.getView&&v.getView();if(!m&&e&&e.parentNode===W)return!1;(v.getView||v.isSelfViewEvent)&&(v=v.getView());var C=this.getEditInteractor();return C&&C._canvas?W.insertBefore(v,C._canvas):this.isScrollBarVisible()?W.insertBefore(v,this.getView().lastChild):tc(W,v),!0},_layoutHTMLImpl:function(Z,F,e){if(arguments.length>1){var A,p=this,$=p._zoom;if(F.getView&&(A=F,F=F.getView()),F.style.position="absolute",e){var f=Z.getRect();Ln(A||F,p.tx()+f.x*$,p.ty()+f.y*$,f.width*$,f.height*$)}else{var X=new de,f=Z.getAnchorRect(),T=Z.getPosition(),z=Z.getScale(),V=F.style;Ln(A||F,f),X.appendTranslate(p.tx(),p.ty()),X.appendScale($,$),X.append(new de(Z.getRotation(),T.x,T.y,z.x,z.y)),gf(V,"transform","matrix("+X.a.toFixed(5)+", "+X.b.toFixed(5)+", "+X.c.toFixed(5)+",\n    "+X.d.toFixed(5)+", "+X.tx.toFixed(5)+", "+X.ty.toFixed(5)+")"),gf(V,"transformOrigin",(-f.x).toFixed(5)+"px "+(-f.y).toFixed(5)+"px"),F.updateAppendMatrix=!0}}else this._layoutHTML&&this._layoutHTML()},getTextEditInfo:function(k){return k instanceof uo?{name:"text",accessType:"s",isMultiline:!1}:void 0},getState:function(n){var C="state",o=n.s(C);if(o)return o;var N=Qd(n._image);return N?Lq(N[C],n,this)||null:void 0},getShape:function(p){return p.getStyle(rp)}}),U.defineProperties(ks.GraphView.prototype,{layoutHTML:{get:function(){return this._layoutHTMLImplBind||(this._layoutHTMLImplBind=this._layoutHTMLImpl.bind(this)),this._layoutHTMLImplBind},set:function(k){this._layoutHTML=k}}});var vi=function(d,N){var M=this;M.gv=d,M.s=function(D){return N.getStyle(D)},M._data=N,M._87I=new df};Ad(vi,U,{_6I:z,ms_icons:1,_84o:function(){},dispose:function(){},isShadowed:function(){return this.s("shadow")||this.gv.isSelected(this._data)&&"shadow"===this.s("select.type")},getSelectWidth:function(){var p=this,$=p.gv.isSelected(p._data);return!$||p.isShadowed()?0:p.gv.getSelectWidth(p._data)},getSelectColor:function(){return this.gv.getSelectColor(this._data)},getBodyColor:function(V){var A=this._data,C=this.gv.getBodyColor(A);return C?C:V?A.getStyle(V):z},_2Q:function(c){return this.s(c)},_1Q:function(V,f,s,U){var n=this.s,G=n("2d.gray"),x=n(f+".dash.color");if(G&&(x=m.toGrayColor(x)),V.strokeStyle=x,V.lineWidth=s,V.stroke(),n(f+".dash.3d")){var J=n(f+".dash.3d.color");If(V,x,G?m.toGrayColor(J):J,s,this.gv._zoom,n(f+".dash.3d.accuracy"))}Rf(V,U)},invalidate:function(){this._6I=z},_79o:function(){var R=this;if(!R._6I){var v=R._data,K=R.gv;R.labelInfo=R.label2Info=R.noteInfo=R.note2Info=R._38o=z,R._87I.clear(),R.interactiveInfo=K.isInteractive(v)?{}:z,R._3O(),R._55O=K.isEditable(v)?{_42O:K.isRectEditable(v),_43O:K.isPointEditable(v),_56O:K.isRotationEditable(v)}:z,R._6I=R._81o()}return R._6I},_3O:function(){},getPosition:function(){return ni},_68o:function(R,$){R&&this._87I.add(gc(R,$))},_81o:function(){var z=this,r=z.s;z._24O(ih,"getLabel"),z._24O(Ar,"getLabel2"),z._26O(up,"getNote"),z._26O(Io,"getNote2"),z._15O(),z._55O&&z._48O();var P;if(z._87I.each(function(H){P=Mq(P,H)}),P){var x=z.isShadowed(),s=r("shadow2"),w=qj(P);s?(w.x+=r("shadow2.offset.x"),w.y+=r("shadow2.offset.y"),km(w,r("shadow2.blur"))):x&&(w.x+=r("shadow.offset.x"),w.y+=r("shadow.offset.y"),km(w,r("shadow.blur"))),P=Mq(P,w)}return z._87I.clear(),P},_42:function(b){var $=this,G=$._data,l=$.gv,g=$.s,e=g("opacity"),Z=this.isShadowed(),p=g("shadow2");if(Z||p){var q=b.shadowOffsetX,o=b.shadowOffsetY,T=b.shadowBlur,C=b.shadowColor,f=l.getZoom(),n=Z?"shadow":"shadow2";b.shadowOffsetX=g(n+".offset.x")*f,b.shadowOffsetY=g(n+".offset.y")*f,b.shadowBlur=g(n+".blur")*f,b.shadowColor=Z?$.getSelectColor():g(n+".color")}if(e!=z){var P=b.globalAlpha;b.globalAlpha=e}$._80o(b),l.isLabelVisible(G)&&((!l._drawForChecking||g("label.selectable"))&&eg(b,$.labelInfo),(!l._drawForChecking||g("label2.selectable"))&&eg(b,$.label2Info)),l.isNoteVisible(G)&&(im(b,$.noteInfo),im(b,$.note2Info)),$._99O(b),e!=z&&(b.globalAlpha=P),(Z||p)&&(b.shadowOffsetX=q,b.shadowOffsetY=o,b.shadowBlur=T,b.shadowColor=C)},_80o:function(){},_47O:function(){},_24O:function(v,O){var T=this,N=T._data,j=T.gv,e=T.s,Y=j[O](N);if(Y!=z){var c=e(v+".scale"),V=e(v+".max"),a=e(v+".position"),P=T[v+"Info"]={label:Y,scale:c,color:j[O+"Color"](N),font:e(v+".font"),opacity:e(v+".opacity"),align:e(v+".align"),rotation:T.getRotation(e(v+".rotation"),!1,a),background:j[O+"Background"](N)},t=di(P,Y);V>0&&V<t.width&&(P.labelWidth=t.width,t.width=V),1!==c&&(t.width*=c,t.height*=c);
var F=T.getPosition(a,e(v+".offset.x"),e(v+".offset.y"),t,e(v+".position.fixed"));if(t.x=F.x-t.width/2,t.y=F.y-t.height/2,T._68o(P.rect=t,P.rotation),1!==c){var L=t.width/c,r=t.height/c;P.rect={x:F.x-L/2,y:F.y-r/2,width:L,height:r}}}},_26O:function(r,C){var K=this,e=K.gv,i=K._data,B=K.s,T=e[C](i);if(T!=z){var G,N,A=B(r+".scale"),H=K[r+"Info"]={note:T,scale:A,data:i,view:e,expanded:B(r+".expanded"),font:B(r+".font"),color:B(r+".color"),opacity:B(r+".opacity"),align:B(r+".align"),icon:B(r+".icon"),backgroundImage:B(r+".backgroundImage"),borderWidth:B(r+".border.width"),borderColor:B(r+".border.color"),background:e[C+"Background"](i)},Q=K.getPosition(B(r+".position"),B(r+".offset.x"),B(r+".offset.y")),k=Q.x,M=Q.y;if(H.expanded){var O,d=B(r+".max"),L=B(r+".backgroundImage");L?(L=Qd(L),O={width:Uk(L,i),height:Cf(L,i)}):O=di(H,T),O.width+=6,O.height+=2,d>0&&d<O.width&&(H.labelWidth=O.width,O.width=d),G=O.width,N=O.height+8,H.clickRect={x:k-G*A/2,y:M-N*A,width:G*A,height:N*A*O.height/N}}else{var s=B(r+".icon");s?(s=Qd(s),G=Uk(s,i),N=Cf(s,i)):(G=12,N=18),H.clickRect={x:k-G*A/2,y:M-N*A,width:G*A,height:N*A}}H.rect={x:k-G/2,y:M-N*A/2-N/2,width:G,height:N};var I=v(H.borderWidth/2)*A;K._68o({x:k-G*A/2-I,y:M-N*A-I,width:G*A+2*I,height:N*A+2*I})}},_48O:function(){},_99O:function(b){var Y=this,j=Y._38o;if(j){var p=Y.gv,c=Y._data,m=j.icons,K=Y.interactiveInfo;K&&(K._38o={});for(var H in m){var C=m[H],y=j.rects[H];if(y){K&&(K._38o[H]=[]);var F=Lq(C.opacity,c,p),n=Lq(C.names,c,p),q=n?n.length:0,A=y.rotation;if(F!=z){var B=b.globalAlpha;b.globalAlpha*=F}for(var l=0;q>l;l++){var X=n[l],P=Qd(X),e=y[l];if(A){var w=e.x+e.width/2,J=e.y+e.height/2;b.save(),jm(b,w,J),Eg(b,A),jm(b,-w,-J)}K&&K._38o[H].push(b.interactiveInfo={compInfos:[],matrix:A?new de(A,w,J).appendTranslate(-w,-J):new de}),Xm(b,P,Lq(C.stretch,c,p),e.x,e.y,e.width,e.height,Y._data,Y.gv),b.interactiveInfo=z,A&&b.restore()}F!=z&&(b.globalAlpha=B)}}}}});var Bo=function(_,G){ac(Bo,this,[_,G])};Ad(Bo,vi,{_checkEmptyRect:!0,_40O:function(c,M){var G=this,R=G.s,B=c.rect;(c.borderColor=G.gv.getBorderColor(G._data))&&(c.borderType=R("border.type"),c.borderWidth=R("border.width"),c.borderPadding=R("border.padding"),M=W(M,c.borderPadding+c.borderWidth/2));var K=G._data.getScale(),O=W(1,W(H(K.x),H(K.y)));if(c.selectWidth=G.getSelectWidth()){var J=G.gv._zoom;c.selectType=R("select.type"),c._97o=G.getSelectColor(),c.selectPadding=R("select.padding"),M=W(M,(c.selectPadding+c.selectWidth/2/J)/O)}M>0&&(M*=O,B=qj(B),km(B,M)),G._68o(B)},_39O:function(E,Y){var u,j=this,C=Y.rect;if(Y.borderWidth>0&&(u=Y.borderPadding,E.strokeStyle=Y.borderColor,E.lineWidth=Y.borderWidth,Wk(E,Y.borderType,{x:C.x-u,y:C.y-u,width:C.width+2*u,height:C.height+2*u}),E.stroke()),Y.selectWidth>0){var L=j.gv._zoom;if(u=Y.selectPadding,E.strokeStyle=Y._97o,E.lineWidth=Y.selectWidth/L,Y.rotation!=z){E.save(),E.translate(Y.position.x,Y.position.y),E.rotate(Y.rotation);var s=j._data,r=s.getWidth(),f=s.getHeight(),b=Y.scale,g=Y.anchor;C={x:b.x*-r*g.x,y:b.y*-f*g.y,width:b.x*r,height:b.y*f}}Wk(E,Y.selectType,{x:C.x-u,y:C.y-u,width:C.width+2*u,height:C.height+2*u}),Y.rotation!=z&&E.restore(),E.stroke()}},dispose:function(){var H=this,q=H._htmlView;Bo.superClass._3O.call(H),q&&(q.onHTMLRemoved&&q.onHTMLRemoved(),Rd(q))},_3O:function(){var M=this,S=M.s,L=M._data,w=M.gv,B=w.getShape(L),R=M.getBodyColor(),v=M._83o=B?{shape:B,_53o:M.getBodyColor("shape.background"),_27Q:Qd(S("shape.repeat.image"),R),shapeGradientPack:S("shape.gradient.pack"),_54o:S("shape.border.width"),_55o:S("shape.border.color"),_56o:S("shape.border.3d"),_57o:S("shape.border.3d.color"),_58o:S("shape.border.3d.accuracy"),shapeGradient:S("shape.gradient"),_59o:S("shape.gradient.color"),_60o:S("shape.border.pattern"),_61o:S("shape.border.cap"),_62o:S("shape.border.join"),shapeForeground:S("shape.foreground"),bodyColor:R,gray:S("2d.gray")}:{img:Qd(w.getImage(L),R),bodyColor:R,gray:S("2d.gray"),stretch:S("image.stretch")};if(bo&&!ah);else{var K,h=v.img;h&&h.renderHTML?(M._htmlInfo&&M._htmlInfo.img!==h&&(M._htmlInfo=z),M._htmlInfo||(M._htmlInfo={img:h,cache:{}}),K=h.renderHTML(L,w,M._htmlInfo.cache)):M._htmlInfo=z,M._htmlView&&M._htmlView!==K&&(M._htmlView.onHTMLRemoved&&M._htmlView.onHTMLRemoved(),Rd(M._htmlView.getView?M._htmlView.getView():M._htmlView)),(M._htmlView=K)&&w.appendHTML(K)&&(K.onHTMLAddedSync&&K.onHTMLAddedSync(),K.onHTMLAdded&&dr(K.onHTMLAdded)),v.rect=L.getRect(),v.position=L.p(),v.scale=L.getScale(),v.anchor=L.getAnchor(),v.rotation=L.getRotation(),B===aq&&(v._63o=S("shape.depth"));var E=0;if(B)E=hp(z,v._54o/2,v._62o),M.s("shape.dash")&&(E=W(E,(M.s("shape.dash.width")||v._54o)/2));else if(h&&h.boundExtend)if(E=Lq(h.boundExtend,L,w),h.boundExtendAbsolute){var r=L.getScale();E/=w._zoom*W(1,W(H(r.x),H(r.y)))}else if(!Lq(h.fitSize,L,w)){var J=Lq(h.width,L,w),f=Lq(h.height,L,w);E*=W(L.getWidth()/J,L.getHeight()/f)}M._40O(v,E);var P=S("clip.percentage");if(1>P&&(0>P&&(P=0),v.clipRect=vo(L.getAnchorRect(),S("clip.direction"),P),v.clipColor=S("clip.color")),B){var N=S("shape.fill.clip.percentage");1>N&&(0>N&&(N=0),v.shapeClipRect=vo(L.getAnchorRect(),S("shape.fill.clip.direction"),N),v.shapeClipColor=S("shape.fill.clip.color"));var I=S("shape.foreground.clip.percentage");1>I&&(0>I&&(I=0),v.shapeForegroundClipRect=vo(L.getAnchorRect(),S("shape.foreground.clip.direction"),I),v.shapeForegroundClipColor=S("shape.foreground.clip.color"))}}},getPosition:function(e,R,w,z){var Y=yr(e,this._83o.rect,z);return Y.x+=R,Y.y+=w,Y},_80o:function(w){var a=this,L=a.s,B=a.gv,R=a._data,N=a._83o,j=N.rect,k=N.position,f=N.rotation,d=N.anchor,T=N.scale,K=N.shape,g=N.clipRect,D=N.clipColor;if(!a._checkEmptyRect||j.width>0&&j.height>0){var y=R.getSize();if(y.x=-y.width*d.x,y.y=-y.height*d.y,w.save(),jm(w,k.x,k.y),Eg(w,f),Hl(w,T.x,T.y),g&&!D&&(w.beginPath(),w.rect(g.x,g.y,g.width,g.height),w.clip()),B._drawForChecking&&N.img&&Lq(N.img.pixelPerfect,R,B)===!1)em(w,y.x,y.y,y.width,y.height,"#888888");else if(a.freeDraw)a.freeDraw(w,y,N);else if(K){var A,Q,c,S,l=N._60o,i=Dh(w,l),q=N._27Q,I=N._54o,_=N.shapeGradientPack,P=N.gray,o=w.lineJoin,h=w.lineCap,E=function(F){return P?m.toGrayColor(F):F};"roundRect"===K?A=L("shape.corner.radius"):"polygon"===K?A=L("shape.polygon.side"):"arc"===K&&(A=L("shape.arc.from"),Q=L("shape.arc.to"),c=L("shape.arc.close"),S=L("shape.arc.oval")),w.lineJoin=N._62o,w.lineCap=N._61o;var t=E(N._53o);if(t||q||_){var G=N.shapeClipRect,Y=N.shapeClipColor;if(G&&(w.save(),Y||(w.beginPath(),w.rect(G.x,G.y,G.width,G.height),w.clip())),Wk(w,K,y,A,Q,c,S),_?nf(w,_):q?Rm(w,q,E(N.bodyColor),null,R,B):Sp(w,t,N.shapeGradient,E(N._59o),y),w.fill(),G){if(Y)w.globalCompositeOperation="multiply",w.fillStyle=Y,w.clip(),w.fillRect(G.x,G.y,G.width,G.height);else{var H=L("shape.fill.clip.gradient");if(H!=z&&H>0){w.globalCompositeOperation="destination-out";var b=Gm(w,G,L("shape.fill.clip.direction"),H);w.fillStyle=b.gradient;var W=b.rect;w.clip(),w.fillRect(W.x,W.y,W.width,W.height)}}w.restore()}_&&w.restore(),w!==i&&Wk(i,K,y,A,Q,c,S)}else Wk(i,K,y,A,Q,c,S);var s=N.shapeForeground;if(s){w.save();var Z=N.shapeForegroundClipRect,U=N.shapeForegroundClipColor;if(Z&&!U&&(w.beginPath(),w.rect(Z.x,Z.y,Z.width,Z.height),w.clip()),Wk(w,K,y,A,Q,c,S),Sp(w,s,L("shape.foreground.gradient"),E(L("shape.foreground.gradient.color")),y),w.fill(),Z)if(U)w.globalCompositeOperation="multiply",w.fillStyle=U,w.clip(),w.fillRect(Z.x,Z.y,Z.width,Z.height);else{var H=L("shape.foreground.clip.gradient");if(H!=z&&H>0){w.globalCompositeOperation="destination-out";var b=Gm(w,Z,L("shape.foreground.clip.direction"),H);w.fillStyle=b.gradient;var W=b.rect;w.clip(),w.fillRect(W.x,W.y,W.width,W.height)}}w.restore()}if(I>0){var r=L("shape.border.width.absolute");r&&(w.save(),w.setTransform(1,0,0,1,0,0)),w.lineWidth=I;var V=E(N._55o);w.strokeStyle=V,w.stroke(),r&&w.restore(),N._56o&&If(w,V,E(N._57o),I,B._zoom,N._58o)}if(Rf(w,l),L("shape.dash")){var C=L("shape.dash.width")||I;if(C>0){l=L("shape.dash.pattern");var i=Dh(w,l,a._2Q("shape.dash.offset"));i!==w&&Wk(i,K,y,A,Q,c,S),a._1Q(w,"shape",C,l)}}Nn(w,t,N._63o,y),w.lineJoin=o,w.lineCap=h}else{var $=a.interactiveInfo;$&&(w.interactiveInfo=$.bodyInfo={compInfos:[],matrix:new de(f,k.x,k.y,T.x,T.y)}),N.gray&&(w.compGray=!0);var n=N.img;n&&n.cacheRule!=z&&(n=Xb(w,n,N.stretch,y.width,y.height,R,B,N.bodyColor)),Xm(w,n,N.stretch,y.x,y.y,y.width,y.height,R,B,N.bodyColor),w.compGray=!1,w.interactiveInfo=z}if(g)if(D)w.globalCompositeOperation="multiply",w.fillStyle=D,w.clip(),w.fillRect(g.x,g.y,g.width,g.height);else{var H=L("clip.gradient");if(H!=z&&H>0){w.globalCompositeOperation="destination-out";var b=Gm(w,g,L("clip.direction"),H);w.fillStyle=b.gradient;var W=b.rect;w.clip(),w.fillRect(W.x,W.y,W.width,W.height)}}w.restore()}a._39O(w,N)},_48O:function(){},_47O:function(){}});var Pj=function(S,j){ac(Pj,this,[S,j])},$m=function(U,M,q,Z){var d=id(U,M);return q=Z?g(q,d):wq(q,d),d?q/=d:q=0,{x:U.x+(M.x-U.x)*q,y:U.y+(M.y-U.y)*q}};Ad(Pj,vi,{_3O:function(){var p,v=this,B=v._data,w=v.gv,L=v.s,r=L(pr),V=B.isLooped(),i=L("edge.width"),X=L("edge.center"),M=L("edge.offset"),H=w.getBorderColor(B),O=H?L("border.width"):0,Z=v.getSelectWidth(),n=B._40I,q=B._41I,A=v._78o=n&&q?{looped:V,type:r,width:i,center:X,color:v.getBodyColor("edge.color"),borderColor:H,borderWidth:O,_97o:Z?v.getSelectColor():z,selectWidth:Z,pattern:L("edge.pattern"),cap:L("edge.cap"),join:L("edge.join"),is3d:L("edge.3d"),_67o:L("edge.3d.color"),_66o:L("edge.3d.accuracy"),gray:L("2d.gray")}:z;if(A){var G=m.getEdgeType(r);if(G){var g=G(B,jh(v,w,B,V,r),w,v._19Q);g.points&&g.points.size()>1?(A.edgeTypeInfo=g,p=oe(A.edgeTypeInfo.points)):g[pf]&&g.rect&&(A.edgeTypeInfo=g,p=g.rect)}else{var I=L("edge.source.anchor.x"),U=L("edge.source.anchor.y"),t=L("edge.target.anchor.x"),o=L("edge.target.anchor.y"),f=bb(w,B,"source"),K=bb(w,B,"target");if(r===mm){var Y=A.points=L(_j)||Bm,s=Y.size();A.segments=L("edge.segments");var l=I!==x||U!==x||xr(n),k=t!==x||o!==x||xr(q);if(!X)if(M)l||(f=$m(f,s?Y.get(0):K,M,s)),k||(K=$m(K,s?Y.get(s-1):f,M,s));else{var Q;l||(Q=ss(f,s?Y.get(0):K,vg(w,n)),Q&&(f={x:Q[0],y:Q[1]})),k||(Q=ss(s?Y.get(s-1):f,K,vg(w,q)),Q&&(K={x:Q[0],y:Q[1]}))}p=Mq(oe(A.points),oe(f,K))}else{var F=jh(v,w,B,V,r);if(v._19Q||(F=-F),V)f=qj(f),f.x=w.getNodeRect(n).x,A.radius=F,p={x:f.x-F,y:f.y-F,width:2*F,height:2*F};else{var e=id(f,K),J=wq(M,e),R={x:J,y:F},T={x:e-J,y:F},d=C(K.y-f.y,K.x-f.x),S=A.mat=new fc(d);if(A.orienAngle=d,A.angle=K.x<f.x?d+j:d,A.rect={x:R.x,y:R.y,width:T.x-R.x,height:0},A.origin=f,R=S.tf(R),R.x+=f.x,R.y+=f.y,T=S.tf(T),T.x+=f.x,T.y+=f.y,X){var N={x:e,y:0};N=S.tf(N),N.x+=f.x,N.y+=f.y,p=oe([f,R,T,N]),A.c1=f,A.c2=N}else p=oe(R,T);f=R,K=T}}A.sourcePoint=f,A.targetPoint=K,B._lastSourcePoint=f,B._lastTargetPoint=K}var $=0;L("edge.dash")&&($=L("edge.dash.width")||i);var D="square"===A.cap?.71:.5;hp(p,W($*D,i*D+O+Z),A.join),v._68o(p)}},getRotation:function(t,Q,g){t=t||0;var n=this._78o;if(n){var i,b=n.angle,B=n.points,e=n.edgeTypeInfo;if(b!=z)return Q?n.orienAngle+t:b+t;if(e&&e[pf])return e.getRotation?e.getRotation(this,t,Q,g):0;if(e&&e.points){var J=e.points;return i=J.size(),Pb[g]?i&&0===i%2?Wm(J.get(i/2-1),J.get(i/2),Q,t):t:Sg[g]?Wm(J.get(0),J.get(1),Q,t):Wm(J.get(i-2),J.get(i-1),Q,t)}if(B)return i=B.size(),Pb[g]?i&&0===i%2?Wm(B.get(i/2-1),B.get(i/2),Q,t):t:Sg[g]?Wm(n.sourcePoint,i?B.get(0):n.targetPoint,Q,t):Wm(i?B.get(i-1):n.sourcePoint,n.targetPoint,Q,t)}return t},getPosition:function(t,U,o,e,W){var A=this._78o;if(A){var V,B=A.type,L=A.points,C=A.edgeTypeInfo,n=A.sourcePoint,M=A.targetPoint;if(!B)return A.looped?{x:n.x-A.radius+U,y:n.y+o}:(W&&n&&M&&(n.x>M.x||n.x===M.x&&n.y>M.y)&&(t=sl[t],o=-o),V=yr(t,A.rect,e),V.x+=U,V.y+=o,V=A.mat.tf(V),V.x+=A.origin.x,V.y+=A.origin.y,V);if(C&&C[pf])return C.getPosition?C.getPosition(this,t,U,o,e,W):{x:(n.x+M.x)/2,y:(n.y+M.y)/2};if(L){var V,y=L.size();if(Pb[t]){if(y){var T=y%2;if(0===T)return Zn(L.get(y/2-1),L.get(y/2),t,U,o,e,W);V=L.get((y-T)/2)}else V={x:(n.x+M.x)/2,y:(n.y+M.y)/2};return V=yr(t,{x:V.x,y:V.y,width:0,height:0},e),V.x+=U,V.y+=o,V}return Sg[t]?Zn(n,y?L.get(0):M,t,U,o,e,W):Zn(y?L.get(y-1):n,M,t,U,o,e,W)}if(C){var P=C.points,y=P.size();if(Pb[t]){var T=y%2;return 0===T?Zn(P.get(y/2-1),P.get(y/2),t,U,o,e,W):(V=P.get((y-T)/2),V=yr(t,{x:V.x,y:V.y,width:0,height:0},e),V.x+=U,V.y+=o,V)}return Sg[t]?Zn(P.get(0),P.get(1),t,U,o,e,W):Zn(P.get(y-2),P.get(y-1),t,U,o,e,W)}}return ni},_42:function(j){this._78o&&Pj.superClass._42.call(this,j)},drawPath:function(P,G){P.beginPath();var A=G.type,i=G.points,q=G.segments,t=G.edgeTypeInfo;if(!A||i){var K=G.sourcePoint,e=K.x,x=K.y,F=G.targetPoint,k=F.x,o=F.y;if(A)if(q){var Q=new df({x:e,y:x});Q.addAll(i),Q.add({x:k,y:o}),ur(P,Q,q)}else P.moveTo(e,x),i.each(function(Z){P.lineTo(Z.x,Z.y)}),P.lineTo(k,o);else G.looped?P.arc(e,x,G.radius,0,y,!0):G.center?(P.moveTo(G.c1.x,G.c1.y),P.lineTo(e,x),P.lineTo(k,o),P.lineTo(G.c2.x,G.c2.y)):(P.moveTo(e,x),P.lineTo(k,o))}else t&&(t.points?ur(P,t.points,t.segments):t[pf]&&t[pf](P,t))},_80o:function(b){var c=this,e=c.s,I=c._78o,K=I.width,N=I.selectWidth,q=I.borderWidth,y=b.lineJoin,P=b.lineCap,d=I.gray,a=I.pattern;b.lineJoin=I.join,b.lineCap=I.cap,c.drawPath(Dh(b,a),I);var X=e("edge.width.absolute");X&&(b.save(),b.setTransform(1,0,0,1,0,0)),N&&(b.strokeStyle=I._97o,b.lineWidth=K+2*(q+N),b.stroke()),q&&(b.strokeStyle=d?m.toGrayColor(I.borderColor):I.borderColor,b.lineWidth=K+2*q,b.stroke());var H=d?m.toGrayColor(I.color):I.color,o=d?m.toGrayColor(I._67o):I._67o;if(b.strokeStyle=H,b.lineWidth=K,b.stroke(),I.is3d&&If(b,H,o,K,c.gv._zoom,I._66o),Rf(b,a),e("edge.dash")){a=e("edge.dash.pattern");var u=Dh(b,a,c._2Q("edge.dash.offset"));u!==b&&c.drawPath(u,I),c._1Q(b,"edge",e("edge.dash.width")||K,a)}X&&b.restore(),b.lineJoin=y,b.lineCap=P},_48O:function(){},_47O:function(){}});var ff=function(X,h){ac(ff,this,[X,h])};Ad(ff,Bo,{_3O:function(){var v,C,B=this,E=B.s,N=B._data,L=B.gv;if(B._88I=z,N.isExpanded()&&N.eachChild(function(M){if(Vm(M)){var c=L.getBoundsForGroup(M);c&&(C||(C=[]),C.push(c),v=Mq(v,c))}}),v){var Q=L.getLabel(N),f=E("group.type"),A=E("group.border.width")||0,w=E("group.border.width.absolute"),r=A/2;w&&(A/=L._zoom),v=Bf(f,C,v),fm(v,N,"group.padding",1),km(v,A);var g=B._88I={type:f,rect:v,_64o:v};if(!f&&Q!=z){var m,V=B.labelInfo={label:Q,color:E("group.title.color"),font:E("group.title.font"),align:E("group.title.align")},Z=di(V,Q),x=Z.width+A,T=Z.height+A,e=E("group.title.align"),o=E("group.title.orientation");if(o===$i||o===dh?(v.height+=A,x>v.width&&(v.width=x)):(o===ec||o===Gj)&&(v.width+=A,x>v.height&&(v.height=x)),m=e===ec?v.x:e===Gj?v.x+v.width-x:v.x+v.width/2-x/2,o===dh)g.titleRect={x:v.x,y:v.y+v.height,width:v.width,height:T},g.rect={x:v.x,y:v.y,width:v.width,height:v.height+T},V.rect={x:m,y:v.y+v.height,width:x,height:T};else if(o===ec){var l=g.titleRect={x:v.x-T,y:v.y,width:T,height:v.height};g.rect={x:v.x-T,y:v.y,width:v.width+T,height:v.height},V.rect={x:l.x+T/2-v.height/2,y:l.y+v.height/2-T/2,width:v.height,height:T},V.rotation=-Math.PI/2}else if(o===Gj){var l=g.titleRect={x:v.x+v.width,y:v.y,width:T,height:v.height};g.rect={x:v.x,y:v.y,width:v.width+T,height:v.height},V.rect={x:l.x+T/2-v.height/2,y:l.y+v.height/2-T/2,width:v.height,height:T},V.rotation=Math.PI/2}else g.titleRect={x:v.x,y:v.y-T,width:v.width,height:T},g.rect={x:v.x,y:v.y-T,width:v.width,height:v.height+T},V.rect={x:m,y:v.y-T-r,width:x,height:T+A}}B._40O(g,E("group.border.width")/2)}else ff.superClass._3O.call(B)},getPosition:function(D,P,Q,Z){var t=this._88I;if(t){var $=yr(D,t.rect,Z);return $.x+=P,$.y+=Q,$}return ff.superClass.getPosition.apply(this,arguments)},_24O:function(f,Z){var a=this._88I;(!a||a.type||"label2"===f)&&ff.superClass._24O.call(this,f,Z)},_80o:function(z){var s=this,f=s._88I;if(f){var D=s._data,T=s.s,$=s.gv,J=f.type,u=f.rect,A=f._64o,v=f.titleRect,G=s.getBodyColor(),H=Qd(T("group.image"),G),S=T("group.image.stretch"),L=s.getBodyColor("group.background"),K=Qd(T("group.repeat.image"),G),j=T("group.gradient.pack"),d=T("group.gradient"),l=T("group.gradient.color"),a=T("group.border.width"),Z=T("group.border.color"),q=T("group.border.pattern"),N=T("group.title.orientation"),F=T("group.depth"),m=T("group.border.radius"),I=T("group.border.join"),E=T("group.border.cap"),B=T("group.border.width.absolute");if(B&&(a/=$._zoom),J){var V=z.lineJoin,o=z.lineCap;if(z.lineJoin=I,z.lineCap=E,H){if(z.save(),Wk(z,J,u,m),z.clip(),Xm(z,H,S,u.x,u.y,u.width,u.height,D,$,G),z.restore(),a>0){var M=Dh(z,q);Wk(M,J,u,m),z.lineWidth=a,z.strokeStyle=Z,z.stroke(),Rf(z,q)}}else{var M=Dh(z,q);L||K||j?(Wk(z,J,u,m),j?nf(z,j):K?Rm(z,K,G,null,D,$):Sp(z,L,d,l,u),z.fill(),j&&z.restore(),z!==M&&Wk(M,J,u,m)):Wk(M,J,u,m),a>0&&(z.lineWidth=a,z.strokeStyle=T("group.border.color"),z.stroke()),Rf(z,q),J===aq&&Nn(z,L,F,u)}z.lineJoin=V,z.lineCap=o}else{var U=T("group.title.background");if((!m||0>m)&&(m=0),H)Xm(z,H,S,A.x,A.y,A.width,A.height,D,$,s.getBodyColor());else if(L||K)if(K?Rm(z,K,G,null,D,$):Sp(z,L,d,l,A),0===a)Wk(z,aq,A),z.fill(),Nn(z,L,F,A);else{switch(z.beginPath(),N){case dh:Ll(z,A.x,A.y,A.width,A.height,m,m,0,0);break;case ec:Ll(z,A.x,A.y,A.width,A.height,0,m,0,m);break;case Gj:Ll(z,A.x,A.y,A.width,A.height,m,0,m,0);break;case $i:Ll(z,A.x,A.y,A.width,A.height,0,0,m,m)}z.fill()}if(v&&U)if(0===a)em(z,v.x,v.y,v.width,v.height,U),Nn(z,U,F,v);else{switch(z.beginPath(),z.fillStyle=U,N){case dh:Ll(z,v.x,v.y,v.width,v.height,0,0,m,m);break;case ec:Ll(z,v.x,v.y,v.width,v.height,m,0,m,0);break;case Gj:Ll(z,v.x,v.y,v.width,v.height,0,m,0,m);break;case $i:Ll(z,v.x,v.y,v.width,v.height,m,m,0,0)}z.fill()}if(a>0){var M=Dh(z,q);if(Wk(M,"roundRect",u,m),z.save(),z.lineWidth=a,z.strokeStyle=Z,z.lineJoin=I,z.lineCap=E,z.closePath(),z.stroke(),v&&T("group.splitLine")){var P=v.x,r=v.y,C=v.width,O=v.height;z.beginPath(),N===dh?(z.moveTo(P,r),z.lineTo(P+C,r)):N===ec?(z.moveTo(P+C,r),z.lineTo(P+C,r+O)):N===Gj?(z.moveTo(P,r),z.lineTo(P,r+O)):(z.moveTo(P,r+O),z.lineTo(P+C,r+O))}z.stroke(),z.restore(),Rf(M,q)}}s._39O(z,f)}else ff.superClass._80o.call(s,z)}});var yp=function(x,L){ac(yp,this,[x,L])};Ad(yp,Bo,{_80o:function(M){this._39O(M,this._83o)}});var Nk=function(w,C){ac(Nk,this,[w,C])};Ad(Nk,Bo,{_3O:function(){var f=this,G=f._data,a=f.s,B=f.gv,v=G.getPoints(),V=B.getBorderColor(G),N=V?a("border.width"):0,I=f.getSelectWidth(),Y=a("shape.border.width"),o=G.getRect(),g=G.getAnchorRect(),t=B.getBodyColor(G),X=f._99o=v.isEmpty()?z:{rect:o,rotation:G.getRotation(),fillRule:a("shape.fill.rule"),scale:G.getScale(),position:G.p(),points:v,segments:G.getSegments(),bodyColor:t,borderColor:V,borderWidth:N,_94o:a("shape.border.3d"),_95o:a("shape.border.3d.color"),_96o:a("shape.border.3d.accuracy"),_97o:I?f.getSelectColor():z,selectWidth:I,_53o:a("shape.background"),_27Q:Qd(a("shape.repeat.image"),t),shapeGradientPack:a("shape.gradient.pack"),_54o:Y,_55o:a("shape.border.color"),shapeGradient:a("shape.gradient"),_59o:a("shape.gradient.color"),_60o:a("shape.border.pattern"),_61o:a("shape.border.cap"),_62o:a("shape.border.join"),shapeForeground:a("shape.foreground"),gray:a("2d.gray")};if(X){g.x+=X.position.x,g.y+=X.position.y,X.gradientRect=g;var y=G.getScale(),Q=W(1,W(H(y.x),H(y.y)));a("shape.dash")&&a("shape.dash.width")>Y&&(Y=a("shape.dash.width"));var l,M=a("shape.border.width.absolute");l=M?(Y+N+I)/f.gv._zoom/Q:Y*("square"===X._61o?.71:.5)+N+I/f.gv._zoom/Q,l&&(l*=Q,o=qj(o),hp(o,l,X._62o)),f._68o(o);var P=a("clip.percentage");1>P&&(0>P&&(P=0),X.clipRect=vo(G.getAnchorRect(),a("clip.direction"),P),X.clipColor=a("clip.color"));var h=a("shape.fill.clip.percentage");1>h&&(0>h&&(h=0),X.shapeClipRect=vo(G.getAnchorRect(),a("shape.fill.clip.direction"),h),X.shapeClipColor=a("shape.fill.clip.color"));var K=a("shape.foreground.clip.percentage");1>K&&(0>K&&(K=0),X.shapeForegroundClipRect=vo(G.getAnchorRect(),a("shape.foreground.clip.direction"),K),X.shapeForegroundClipColor=a("shape.foreground.clip.color"))}},getPosition:function(D,f,V,t){var I=this._99o;if(I){var d=yr(D,I.rect,t);return d.x+=f,d.y+=V,d}return ni},_42:function(r){this._99o&&Nk.superClass._42.call(this,r)},_80o:function(u){var e,Q=this,b=Q.s,L=Q._99o,T=L.position,j=L.scale,S=L.rotation,M=L.borderWidth,B=L.selectWidth/Q.gv._zoom,k=L._27Q,r=L.shapeGradientPack,y=L._54o,n=L.clipRect,l=L.clipColor,O=L.shapeClipRect,X=L.shapeClipColor,t=L.points,Y=L.segments,J=Q._data.isClosePath(),N=L.fillRule,p=L.gray,W=function(o){return p?m.toGrayColor(o):o},I=W(L._53o),U=I||k||r;u.save(),jm(u,T.x,T.y),Eg(u,S),Hl(u,j.x,j.y),n&&!l&&(u.beginPath(),u.rect(n.x,n.y,n.width,n.height),u.clip()),U&&O&&(u.save(),X||(u.beginPath(),u.rect(O.x,O.y,O.width,O.height),u.clip())),jm(u,-T.x,-T.y);var d=L._60o,w=Dh(u,d),a=u.lineJoin,R=u.lineCap;u.lineJoin=L._62o,u.lineCap=L._61o;var c=W(L.bodyColor);if(U){if(ur(u,t,Y,J),r?nf(u,r):k?Rm(u,k,c,null,Q._data,Q.gv):(e=c?c:I,Sp(u,e,L.shapeGradient,W(L._59o),L.gradientRect)),u.fill(N),O){if(X)jm(u,T.x,T.y),u.globalCompositeOperation="multiply",u.fillStyle=X,u.clip(),u.fillRect(O.x,O.y,O.width,O.height);else{var Z=b("shape.fill.clip.gradient");if(Z!=z&&Z>0){jm(u,T.x,T.y),u.globalCompositeOperation="destination-out";var q=Gm(u,O,b("shape.fill.clip.direction"),Z);u.fillStyle=q.gradient;var o=q.rect;u.clip(),u.fillRect(o.x,o.y,o.width,o.height)}}u.restore(),jm(u,-T.x,-T.y)}r&&u.restore(),w!==u&&ur(w,t,Y,J)}else ur(w,t,Y,J);var F=L.shapeForeground;if(F){u.save();var A=L.shapeForegroundClipRect,G=L.shapeForegroundClipColor;if(A&&!G&&(jm(u,T.x,T.y),u.beginPath(),u.rect(A.x,A.y,A.width,A.height),u.clip(),jm(u,-T.x,-T.y)),ur(u,t,Y,J),Sp(u,F,b("shape.foreground.gradient"),W(b("shape.foreground.gradient.color")),L.gradientRect),u.fill(N),A)if(G)jm(u,T.x,T.y),u.globalCompositeOperation="multiply",u.fillStyle=G,u.clip(),u.fillRect(A.x,A.y,A.width,A.height);else{var Z=b("shape.foreground.clip.gradient");if(Z!=z&&Z>0){jm(u,T.x,T.y),u.globalCompositeOperation="destination-out";var q=Gm(u,A,b("shape.foreground.clip.direction"),Z);u.fillStyle=q.gradient;var o=q.rect;u.clip(),u.fillRect(o.x,o.y,o.width,o.height)}}u.restore()}var h=b("shape.border.width.absolute");if(h&&(u.save(),u.setTransform(1,0,0,1,0,0)),B&&(u.strokeStyle=L._97o,u.lineWidth=y+2*(M+B),u.stroke()),M&&(u.strokeStyle=W(L.borderColor),u.lineWidth=y+2*M,u.stroke()),y&&(e=W(L._55o),!I&&c&&(e=c),u.strokeStyle=e,u.lineWidth=y,u.stroke(),L._94o&&If(u,e,W(L._95o),y,Q.gv._zoom,L._96o)),Rf(u,d),b("shape.dash")){var V=b("shape.dash.width")||y;if(V>0){d=b("shape.dash.pattern");var w=Dh(u,d,Q._2Q("shape.dash.offset"));w!==u&&ur(w,t,Y,J),Q._1Q(u,"shape",V,d)}}if(h&&u.restore(),u.lineJoin=a,u.lineCap=R,n)if(l)jm(u,T.x,T.y),u.globalCompositeOperation="multiply",u.fillStyle=l,u.clip(),u.fillRect(n.x,n.y,n.width,n.height);else{var Z=b("clip.gradient");if(Z!=z&&Z>0){jm(u,T.x,T.y),u.globalCompositeOperation="destination-out";var q=Gm(u,n,b("clip.direction"),Z);u.fillStyle=q.gradient;var o=q.rect;u.clip(),u.fillRect(o.x,o.y,o.width,o.height)}}u.restore()},_48O:function(){},_47O:function(){}});var ts=function(a,m){ac(ts,this,[a,m])};Ad(ts,Nk,{getRotation:function(G,R,r){G=G||0;var n=this._data.getPoints(),g=n.size();return g>1?Pb[r]?g&&0===g%2?Wm(n.get(g/2-1),n.get(g/2),R,G):G:Sg[r]?Wm(n.get(0),n.get(1),R,G):Wm(n.get(g-2),n.get(g-1),R,G):G},getPosition:function(d,Q,n,C,L){var V=this._data.getPoints(),G=V.size();if(G>1){if(Pb[d]){var r=G%2;if(0===r)return Zn(V.get(G/2-1),V.get(G/2),d,Q,n,C,L);var f=V.get((G-r)/2),Y={x:f.x,y:f.y,width:0,height:0};return f=yr(d,Y,C),f.x+=Q,f.y+=n,f}return Sg[d]?Zn(V.get(0),V.get(1),d,Q,n,C,L):Zn(V.get(G-2),V.get(G-1),d,Q,n,C,L)}return ni}});var Wq=function(u,l){ac(Wq,this,[u,l])};Ad(Wq,Bo,{_3O:function(){var N=this;Wq.superClass._3O.call(N);var P=N.s,e=N._83o;N._82o=e.img||e.shape?z:{background:N.getBodyColor("grid.background"),depth:P("grid.depth"),rect:e.rect,_88o:P("grid.cell.depth"),cellBorderColor:P("grid.cell.border.color"),_89o:P("grid.row.count"),_90o:P("grid.column.count"),block:P("grid.block"),_91o:P("grid.block.color"),_92o:P("grid.block.padding"),_93o:P("grid.block.width")}},_80o:function(U){var j=this,z=j._82o;if(!z)return Wq.superClass._80o.call(j,U),void 0;var Y,x,l=j._data,u=z.background,e=z.rect,p=z.block,C=z._91o,o=z._92o,w=z._93o,i=z._88o,R=z.cellBorderColor,m=z._89o,J=z._90o;if(u)if(em(U,e.x,e.y,e.width,e.height,u),Nn(U,u,z.depth,e),i)for(Y=0;m>Y;Y++)for(x=0;J>x;x++)e=l.getCellRect(Y,x),e&&Nn(U,u,i,e);else if(R){for(U.beginPath(),Y=0;m>Y;Y++)for(x=0;J>x;x++)e=l.getCellRect(Y,x),e&&U.rect(e.x,e.y,e.width,e.height);U.strokeStyle=R,U.lineWidth=1,U.stroke()}if("h"===p)for(Y=0;m>Y;Y++)e=Mq(l.getCellRect(Y,0),l.getCellRect(Y,J-1)),km(e,o),_q(U,C,e.x,e.y,e.width,e.height,w);else if("v"===p)for(x=0;J>x;x++)e=Mq(l.getCellRect(0,x),l.getCellRect(m-1,x)),km(e,o),_q(U,C,e.x,e.y,e.width,e.height,w);j._39O(U,j._83o)}});var wp=function(l,s){ac(wp,this,[l,s])};Ad(wp,Bo,{_checkEmptyRect:!1,_81o:function(){var a=this._data,T=wp.superClass._81o.call(this),B=a.s("text");if(B!=z){var u,n,o=a.s("text.font"),r=a.s("text.align"),J=a.s("text.vAlign"),y=Yf(o,B),t=y.width,A=y.height,q=a.getAnchor(),N=a.getWidth(),f=a.getHeight();"left"===r?u=-N*q.x:"center"===r?u=-N*q.x+(N-t)/2:"right"===r&&(u=N*(1-q.x)-y.width),"top"===J?n=-f*q.y:"middle"===J?n=-f*q.y+(f-A)/2:"bottom"===J&&(n=f*(1-q.y)-y.height);var Y,Q=a.getMatrix();if(Y=oe([Q.tf(u,n),Q.tf(u+t,n),Q.tf(u+t,n+A),Q.tf(u,n+A)]),T=Mq(T,Y),T&&a.s("text.shadow")){var g=qj(T);g.x+=a.s("text.shadow.offset.x"),g.y+=a.s("text.shadow.offset.y"),km(g,a.s("text.shadow.blur")),T=Mq(T,g)}}return T}});var Ek=ks.Interactor=function(a){this.gv=this._graphView=a};us("Interactor",U,{ms_listener:1,getView:function(){return this.gv.getView()},setUp:function(){this.addListeners()},tearDown:function(){this.removeListeners(),this.clear()},clear:function(){},fi:function(d){this.gv.fi(d)},setCursor:function(B){vd||this.gv.setCursor(B)},startDragging:function(D){var C=this;C._lastClientPoint=sb(D),C._lastLogicalPoint=C.gv.lp(D),np(C,D)},clearDragging:function(){var S=this;S._lastClientPoint=S._lastLogicalPoint=S._logicalPoint=z},autoScroll:function(H){return this.gv.autoScroll(H,this._lastClientPoint)}});var qm=z,xk=function(j){qm.handleWindowTouchMove(j)},Lb=function(N){qm.handleWindowTouchEnd(N),I(o,Jp,xk),I(o,Qq,Lb),qm=z},ji=function(U){qm.handleWindowMouseMove(U)},gr=function(x){qm.handleWindowMouseUp(x),I(o,Gd,ji),I(o,ig,gr),qm=z},Lk=function(X,y){if(X!==qm){var l=Nd(y);qm?l?qm.handleWindowTouchEnd(y):qm.handleWindowMouseUp(y):l?(n(o,Jp,xk),n(o,Qq,Lb)):(n(o,Gd,ji),n(o,ig,gr)),qm=X}},ms=function(g){var h=this;h.gv=g,h._is2d=g instanceof ks.GraphView,h._eventListeners={},["mousedown","mousemove","mouseleave","touchstart","touchmove",Wr,"wheel"].forEach(function(Y){h.addListener(Y)}),h.initImageResource()};Ad(ms,Ek,{enableVR:function(P){var t=this;if(!!t._vrEnable!==P)if(t._vrEnable=P,P)t.gv.vr.mp(t.onVRControllerChange,t);else if(t.gv.vr.ump(t.onVRControllerChange,t),t._vrRayPolyline){var p=t.gv.dm();p.remove(t._vrRayPolyline),p.remove(t._vrRayHitPoint),t._vrRayPolyline=x,t._vrRayHitPoint=x}},onVRControllerChange:function(P){var o=this,c=P.property,g=P.newValue,Q=o.gv.vr.getController(g.id),R=Q.getRay();R&&("gamepad.button.trigger"===c?"down"===g._62O?o.handle_mousedown(R):o.handleWindowMouseUp(R):"gamepad.pose"===c&&(o.handle_mousemove(R),o.handleWindowMouseMove(R)))},drawVRRay:function(g,A,I){var m,s=this,G=s.gv,V=s._vrRayPolyline,d=!1;if(V)m=s._vrRayHitPoint;else{var H=G.dm();s._vrRayPolyline=V=new R.Polyline,s._vrRayHitPoint=m=new R.Node,m.s({shape3d:"billboard","shape3d.transparent":!0,"texture.scale":10,"shape3d.image":"coreInteractorRayHitImage"}),m.setAnchor3d(.5,.5,.499);var D=.2/G.vr.measureOflength;m.s3(D,D,D),V.s("intersect",!1),m.s("intersect",!1),H.add(V),H.add(m),d=!0}if(A){var e=I.world,B=I.worldNormal,_=e.x,z=e.y,f=e.z;V.s("shape.border.color","red"),V.setPoints([{x:g.origin.x,y:g.origin.z,e:g.origin.y},{x:_,y:f,e:z}]),m.s("3d.visible",!0),m.p3(_,z,f),m.lookAtDirection([B.x,B.y,B.z],"front")}else{V.s("shape.border.color","blue");var X=new R.Math.Vector3;X.copy(g.direction).setLength(1e3/s.gv.vr.measureOflength).add(g.origin),V.setPoints([{x:g.origin.x,y:g.origin.z,e:g.origin.y},{x:X.x,y:X.z,e:X.y}]),m.s("3d.visible",!1)}G.fi({kind:"vrRayIntersect",ray:g,data:A,intersect:I,polyline:V,hitNode:m,begin:d})},setPreventEventDefault:function(I,G){var q=this,K=q._eventListeners[I];K?K._prevent=G:q._eventListeners[I]=K={_removal:x,_prevent:G}},removeListener:function(i){var v=this,t=v._eventListeners[i];t&&t._removal&&(t._removal(),t._removal=x)},addListener:function(D){var R=this,Z=R._eventListeners[D];if(Z||(R._eventListeners[D]=Z={_removal:x,_prevent:!0}),!Z||!Z._removal){var C=function(f){Z._prevent&&m.preventDefault(f),R.disabled||("wheel"===D?Vp(R,f):R["handle_"+D](f))};n(R.gv.getView(),D,C),Z._removal=function(){I(R.gv.getView(),D,C)}}},handleWindowTouchMove:function(i){this.handleWindowMouseMove(i)},handleWindowMouseMove:function(h){this.downInfo&&(this.isDragging?this.handleDownInfo("onDrag",h):(this.handleDownInfo("onBeginDrag",h),this.isDragging=!0))},handleWindowTouchEnd:function(H){this.handleWindowMouseUp(H)},handleWindowMouseUp:function(d){if(this.isDragging&&(this.handleDownInfo("onEndDrag",d),this.isDragging=!1),this.downInfo){var r=this.handle("onUp",d);if(r&&r.data===this.downInfo.data){this.handleMissingUp(d);var o=this,A=2===d.button?"onContextMenu":"onClick";if(!o._dbclickTimer)return o._dbclickTimer=Qf(function(){delete o._dbclickTimer,o.handleClick(d,A,r),this.downInfo=z},m.clickDelay),void 0;$g(o._dbclickTimer),delete o._dbclickTimer,A="onDoubleClick",o.handleClick(d,A,r)}else this.handleDownInfo("onUp",d);this.downInfo=z}},handle_mouseleave:function(e){var Q=this,G=Q.gv,c=Q.currentInfo?Q.currentInfo.data:z;if(c){c.s("onLeave")&&c.s("onLeave")(e,c,G),Q.fire("data","onLeave",e,c);var $=Q.currentInfo?Q.currentInfo.hits:z;if($)for(var E in $)Q.handleLeave(e,E);Q.currentInfo=z}},handle_mousewheel:function(s){s.scrollDelta=s.wheelDelta/40,this.handle("onScroll",s)},handle_DOMMouseScroll:function(R){R.scrollDelta=2===R.axis?-R.detail:0,this.handle("onScroll",R)},handle_touchstart:function(r){this.handle_mousedown(r)},handle_touchmove:function(v){this.handle("onMove",v)},handle_mousedown:function(G){this.isDragging&&(this.handleDownInfo("onEndDrag",G),this.isDragging=!1),this.downInfo=this.handle("onDown",G),this.downInfo&&Lk(this,G)},handle_mousemove:function(i){var Y=this,W=Y.gv;Y._hoverTimer&&($g(Y._hoverTimer),delete Y._hoverTimer);var w,h,l,p=Y.handle("onMove",i),R=this.currentInfo?this.currentInfo.data:z,B=this.currentInfo?this.currentInfo.hits:z;if(p&&(h=p.data,l=p.hits,Y._hoverTimer=Qf(function(){$g(Y._hoverTimer),delete Y._hoverTimer,Y.handle("onHover",i,p)},W.getHoverDelay()||m.hoverDelay)),h!==R){if(R&&(R.s("onLeave")&&R.s("onLeave")(i,R,W),this.fire("data","onLeave",i,R)),h&&(h.s("onEnter")&&h.s("onEnter")(i,h,W),this.fire("data","onEnter",i,h)),B)for(w in B)this.handleLeave(i,w);if(l)for(w in l){var H=l[w],o=h._interactPrefix=H.prefix,M=o&&h.a(o+"onEnter")||H.target.onEnter;M&&M.call(H.target,i,h,W,H.point,H.width,H.height),this.fire(H.type,"onEnter",H.event,H.data,H.image,H.comp,H.point,H),h._interactPrefix=null}}else{if(B)for(w in B)l&&l[w]||this.handleLeave(i,w);if(l)for(w in l)if(!B||!B[w]){var H=l[w],o=h._interactPrefix=H.prefix,M=o&&h.a(o+"onEnter")||H.target.onEnter;M&&M.call(H.target,i,h,W,H.point,H.width,H.height),this.fire(H.type,"onEnter",H.event,H.data,H.image,H.comp,H.point,H),h._interactPrefix=null}}this.currentInfo=p},handle:function(w,k,O){var Z,p=this,y=p.gv;if(p._is2d){if(O=O||y.getDataInfoAt(k),!O||!y.isInteractive(O.data))return;if(Z=O.ui.interactiveInfo){var r,B=O.data;if(B.s(w)&&B.s(w)(k,B,y),this.fire("data",w,k,B),"body"===O.part&&Z.bodyInfo)r="body",O.hits=this.handleImage(r,y.getImage(B),w,k,B,O.point,Z.bodyInfo);else if("icons"===O.part&&Z._38o){var u=Z._38o[O.name];u&&u[O.index]&&(r="icons|"+O.name+"|"+O.index,O.hits=this.handleImage(r,O.icon,w,k,B,O.point,u[O.index]))}}return O}var B,C;if(!O)if(k&&k instanceof R.Math.Ray){var z=y.vr.intersectWorld(k);if(B=z.data,C=z.intersect,p.drawVRRay(k,B,C),!B)return;var x=y.getData3dUI(B);if(Z=x.interactiveInfo,!Z)return;
O={data:B,part:C.part,ui:x}}else{if(O=y.getDataInfoAt(k),!O)return;O&&(O={data:O.data,part:O.part})}if(y.isInteractive(O.data)){if(!C){B=O.data;var x=y.getData3dUI(B);if(O.ui=x,Z=x.interactiveInfo,!Z)return O;if(C=y.intersectObject(k,B),!C)return}B.s(w)&&B.s(w)(k,B,y),this.fire("data",w,k,B);var i,j=C.part;return"body"!==j&&(i=B.s(j+".image")||B.s("shape3d."+j+".image")),i||(i=B.s("all.image")||B.s("shape3d.image")),Z="object"==typeof i?Z[i.uuid]:Z[i],Z&&Z.bodyInfo?(O.part="body",O.interactiveInfo=Z,O.point=this._convertUVToPoint(C.uv,Z),O.image=i,O.hits=this.handleImage("body",i,w,k,B,O.point,Z.bodyInfo),O):O}},_handleLeaveOrMissing:function(H,W,p){var o="leave"===H?this.currentInfo:this.downInfo;if(o){var w=o.interactiveInfo||o.ui.interactiveInfo;if(w){var f,B,G=o.data;if(this._is2d){if(B=this.gv.lp(W),"body"===o.part&&w.bodyInfo)f="body","leave"===H?this.handleLeaveImage(p,f,this.gv.getImage(G),W,G,B,w.bodyInfo):this.handleMissingUpImage(f,this.gv.getImage(G),W,G,B,w.bodyInfo);else if("icons"===o.part&&w._38o){var V=w._38o[o.name];V&&V[o.index]&&(f="icons|"+o.name+"|"+o.index,"leave"===H?this.handleLeaveImage(p,f,o.icon,W,G,B,V[o.index]):this.handleMissingUpImage(f,o.icon,W,G,B,V[o.index]))}}else{if(!w.bodyInfo)return;var R=this.gv.intersectObject(W,G);B=R&&R.uv?this._convertUVToPoint(R.uv,w):{x:1/0,y:1/0},"leave"===H?this.handleLeaveImage(p,"body",o.image,W,G,B,w.bodyInfo):this.handleMissingUpImage("body",o.image,W,G,B,w.bodyInfo)}}}},handleClick:function(F,n,r){var b=this,z=this.downInfo;if(z&&r){var U,S=r.interactiveInfo||r.ui.interactiveInfo,o=r.data,X=this.gv;if(o.s(n)&&o.s(n)(F,o,X),b.fire("data",n,F,o),S)if(this._is2d){if(z.part===r.part){var K=X.lp(F);"body"===r.part&&S.bodyInfo&&(U="body",this.handleClickImage(U,X.getImage(o),n,F,o,K,S.bodyInfo,r))}}else{if(!S.bodyInfo)return;var R=X.intersectObject(F,o);if(!R)return;K=this._convertUVToPoint(R.uv,S),this.handleClickImage("body",z.image,n,F,o,K,S.bodyInfo,r)}}},handleDownInfo:function(u,q){if(this.downInfo){var H=this.downInfo,X=this.gv,n=H.interactiveInfo||H.ui.interactiveInfo;if(n){var z,M=H.data;if(M.s(u)&&M.s(u)(q,M,X),this.fire("data",u,q,M),this._is2d){var t=X.lp(q);if("body"===H.part&&n.bodyInfo)z="body",this.handleDownInfoImage(z,X.getImage(M),u,q,M,t,n.bodyInfo);else if("icons"===H.part&&n._38o){var r=n._38o[H.name];r&&r[H.index]&&(z="icons|"+H.name+"|"+H.index,this.handleDownInfoImage(z,H.icon,u,q,M,t,r[H.index]))}}else{if(!n.bodyInfo)return;var D=X.intersectObject(q,M);if(!D)return;t=this._convertUVToPoint(D.uv,n),this.handleDownInfoImage("body",H.image,u,q,M,t,n.bodyInfo)}}}},fire:function(G,f,H,b,k,X,o,r){this.gv.fi({kind:f,type:G,event:H,data:b,image:k,comp:X,view:this.gv,point:o,width:r?r.width:x,height:r?r.height:x})},handleImage:function(f,Z,T,F,z,o,O){var l={};if(Z&&(Z=Qd(Z))){var B=this.gv,w=O.rect,h=this.convertPoint(o,O);h.inRect&&(Z[T]&&Z[T](F,z,B,h,w.width,w.height),this.fire("image",T,F,z,Z,x,h,w),l[f+"|image"]={target:Z,type:"image",image:Z,data:z,event:F,point:h,width:w.width,height:w.height});for(var i=O.compInfos,L=Z,y=i.length-1;y>=0;y--){var E=i[y],p=E.comp;if(h=this.convertPoint(o,E,L,p,B,z),h.inRect){w=E.rect;var D=z._interactPrefix=E.prefix,M=D&&z.a(D+T)||p[T];M&&M.call(p,F,z,B,h,w.width,w.height),this.fire("comp",T,F,z,Z,p,h,w),(Z=w.image)&&(Z[T]&&Z[T](F,z,B,h,w.width,w.height),this.fire("image",T,F,z,Z,x,h,w)),z._interactPrefix=null,l[f+"|"+y]={target:p,type:"comp",comp:p,image:Z,data:z,event:F,point:h,width:w.width,height:w.height,prefix:D},Z&&(l[f+"|"+y+"|image"]={target:Z,type:"image",image:Z,data:z,event:F,point:h,width:w.width,height:w.height,prefix:D})}}}return l},handleLeave:function(x,m){return this._handleLeaveOrMissing("leave",x,m)},handleMissingUp:function(p){return this._handleLeaveOrMissing("missing",p)},handleLeaveImage:function(F,I,_,S,H,o,T){if(_&&(_=Qd(_))){var W=this.gv,Q=T.rect,h=this.convertPoint(o,T);F===I+"|image"&&(_.onLeave&&_.onLeave(S,H,W,h,Q.width,Q.height),this.fire("image","onLeave",S,H,_,x,h,Q));for(var y=T.compInfos,p=_,r=y.length-1;r>=0;r--){var Z=y[r],s=Z.comp;h=this.convertPoint(o,Z,p,s,W,H),Q=Z.rect;var l=H._interactPrefix=Z.prefix;if(F===I+"|"+r){var u=l&&H.a(l+"onLeave")||s.onLeave;u&&u.call(s,S,H,W,h,Q.width,Q.height),this.fire("comp","onLeave",S,H,_,s,h,Q)}(_=Q.image)&&F===I+"|"+r+"|image"&&(_.onLeave&&_.onLeave(S,H,W,h,Q.width,Q.height),this.fire("image","onLeave",S,H,_,x,h,Q)),H._interactPrefix=null}}},handleMissingUpImage:function(Z,N,h,o,n,H){var g="onUp",U=this.downInfo.hits;if(U&&N&&(N=Qd(N))){var R=this.gv,w=H.rect,Y=this.convertPoint(n,H);!Y.inRect&&U[Z+"|image"]&&(N[g]&&N[g](h,o,R,Y,w.width,w.height),this.fire("image",g,h,o,N,x,Y,w));for(var b=H.compInfos,V=N,z=b.length-1;z>=0;z--){var k=b[z],i=k.comp;if(Y=this.convertPoint(n,k,V,i,R,o),!Y.inRect){w=k.rect;var m=o._interactPrefix=k.prefix;if(U[Z+"|"+z]){var T=m&&o.a(m+g)||i[g];T&&T.call(i,h,o,R,Y,w.width,w.height),this.fire("comp",g,h,o,N,i,Y,w)}(N=w.image)&&U[Z+"|"+z+"|image"]&&(N[g]&&N[g](h,o,R,Y,w.width,w.height),this.fire("image",g,h,o,N,x,Y,w)),o._interactPrefix=null}}}},handleDownInfoImage:function(w,M,G,Y,g,X,j){var _=this.downInfo.hits;if(_&&M&&(M=Qd(M))){var F=this.gv,k=j.rect,B=this.convertPoint(X,j);_[w+"|image"]&&(M[G]&&M[G](Y,g,F,B,k.width,k.height),this.fire("image",G,Y,g,M,x,B,k));for(var P=j.compInfos,i=M,f=P.length-1;f>=0;f--){var J=P[f],$=J.comp;B=this.convertPoint(X,J,i,$,F,g),k=J.rect;var A=g._interactPrefix=J.prefix;if(_[w+"|"+f]){var e=A&&g.a(A+G)||$[G];e&&e.call($,Y,g,F,B,k.width,k.height),this.fire("comp",G,Y,g,M,$,B,k)}(M=k.image)&&_[w+"|"+f+"|image"]&&(M[G]&&M[G](Y,g,F,B,k.width,k.height),this.fire("image",G,Y,g,M,x,B,k)),g._interactPrefix=null}}},handleClickImage:function(p,u,h,_,R,v,O,w){var r=this.downInfo.hits,z=w.hits;if(r&&u&&(u=Qd(u))){var L=this.gv,q=O.rect,T=this.convertPoint(v,O);r[p+"|image"]&&(u[h]&&u[h](_,R,L,T,q.width,q.height),this.fire("image",h,_,R,u,x,T,q));for(var H=O.compInfos,S=u,K=H.length-1;K>=0;K--){var N=H[K],i=N.comp;T=this.convertPoint(v,N,S,i,L,R),q=N.rect;var t=R._interactPrefix=N.prefix;if(r[p+"|"+K]&&z[p+"|"+K]){var s=t&&R.a(t+h)||i[h];s&&s.call(i,_,R,L,T,q.width,q.height),this.fire("comp",h,_,R,u,i,T,q)}(u=q.image)&&r[p+"|"+K+"|image"]&&(u[h]&&u[h](_,R,L,T,q.width,q.height),this.fire("image",h,_,R,u,x,T,q)),R._interactPrefix=null}}},initImageResource:function(){m.setImage("coreInteractorRayHitImage",{width:16,height:16,comps:[{type:"oval",background:"rgb(255,0,0)",borderWidth:1,borderColor:"rgb(250,120,120)",opacity:.3,rotation:-1.593,rect:[.73315,.6933,14.5337,14.61341]},{type:"oval",background:"rgb(255,0,0)",borderWidth:1,borderColor:"rgb(250,120,120)",rotation:-1.593,rect:[3.56695,3.75073,8.8661,8.49856]}]})},_convertUVToPoint:function(U,A){if(!U)return{x:1/0,y:1/0};var T=A.bodyInfo.rect,h=U.clone(),b=U.multiply({x:T.width,y:T.height});return b.local=h,b},convertPoint:function(q,Z,Y,L,O,C){var u=Z.rect,t=Z.matrix.applyInverse(q).sub(u),p=t.x>=0&&t.y>=0&&t.x<=u.width&&t.y<=u.height;if(!p)return t;if(L&&Lq(L.pixelPerfect,C,O)){var u,i=1;this._is2d?(i=O.getZoom(),u=$q(q.x,q.y,x,i)):u=$q(q.x,q.y);var H=!1,X=u.x,h=u.y,J=u.width,T=u.height,g=m.hitMaxArea,d=J*T*i*i;if(d>g){var b=Math.sqrt(g/d);i*=b}J*=i,T*=i,2>J&&(J=2),2>T&&(T=2),X*=i,h*=i;var V=Hd(J,T),G=new de(0,-X,-h,i,i);G.append(Z.matrix),O._drawForChecking=!0,L.transform=G,Z.refRect&&Z.refRect.fitSize&&(L.refRect=Z.refRect);var D=Y.comps;Y.comps=[L],rb(V,Y,0,0,J,T,C,self),Y.comps=D,delete L.refRect,delete L.transform,O._drawForChecking=!1;try{for(var E=0,j=V.getImageData(0,0,J,T).data;E<j.length;E+=4)if(0!==j[E+3]){H=!0;break}V.restore()}catch(y){fn=z,H=!1}t.inRect=H}else t.inRect=!0;return t}});var pb=ks.DefaultInteractor=function(N){ac(pb,this,[N])};us("DefaultInteractor",Ek,{handle_mousedown:function(R){$r(R);var w=this,T=w.gv,X=T.getDataAt(R);if(T.setFocus(R)&&!T._editing&&!T._scrolling){cm(R)?T.handleDoubleClick(R,X):T.handleClick(R,X);var Q=ie(R);!Wh()&&!Q&&X&&(T.isMovable(X)||T._39Q(X))||!T.isPannable()||!wn(R)&&!Q||Kb(R)||(w._tx=T.tx(),w._ty=T.ty(),w.startDragging(R))}},handleWindowMouseUp:function(W){var t=this,R=t.gv;R._panning&&(delete R._panning,R.onPanEnded(),t.fi({kind:"endPan",event:W})),delete t._tx,delete t._ty,t.clearDragging()},handle_mousemove:function(y){var d=this,E=d.gv;d._hoverTimer&&($g(d._hoverTimer),delete d._hoverTimer),d._hoverTimer=Qf(function(){d.fi({kind:"hover",event:y}),$g(d._hoverTimer),delete d._hoverTimer},E.getHoverDelay()||m.hoverDelay)},handle_touchmove:function(i){this.handle_mousemove(i)},handleWindowMouseMove:function(d){var y=this,e=y.gv;y.fi({kind:e._panning?"betweenPan":"beginPan",event:d}),e._panning=1;var m=os(e,d,y._lastClientPoint);e.setTranslate(y._tx+m.x,y._ty+m.y)},handle_mousewheel:function(O){this.gv.handleScroll(O,O.wheelDelta)},handle_DOMMouseScroll:function(Z){2===Z.axis&&this.gv.handleScroll(Z,-Z.detail)},handle_keydown:function(W){this.gv.handleKeyDown(W)}});var Sh=ks.SelectInteractor=function(N){ac(Sh,this,[N])};us("SelectInteractor",Ek,{_42:function(){var C=this,c=C.gv,O=c.getZoom(),M=C.mark,G=C.div;G||(G=C.div=Kk(),tc(C.getView(),G));var i={};i.x=M.x*O+c.tx(),i.y=M.y*O+c.ty(),i.width=M.width*O,i.height=M.height*O,Ln(G,i),this.intersects()?(G.style.border="",G.style.background=c.getRectSelectBackground()):(G.style.background="",G.style.border="1px solid "+c.getRectSelectBorderColor())},handle_mousedown:function(r){var u=this,X=u.gv;if(u._57I=z,u.pendingClickThrough=z,!(X._editing||X._scrolling||Wh()||ie(r))){var K=X.getDataAt(r),m=X.sm();K?Kb(r)?m.co(K)?m.rs(K):m.as(K):m.co(K)?K instanceof rf&&K.isClickThroughEnabled()&&wn(r)&&(u.pendingClickThrough=sb(r)):m.ss(K):Kb(r)||!X.isPannable()?wn(r)&&(Kb(r)||m.cs(),X.isRectSelectable()&&(u.startDragging(r),X._77O=1)):wn(r)&&(u._57I=sb(r))}},handle_mouseup:function(s){var I=this,S=I.gv,e=I._57I;if(e&&(id(e,sb(s))<=1&&S.sm().cs(),I._57I=z),I.pendingClickThrough){if(id(I.pendingClickThrough,sb(s))<=1){var A=S.getDataAt(s);if(A instanceof rf&&A.isClickThroughEnabled()){var u=S.getDataAt(s,function(w){var v=w.getParent()===A&&S.isSelectable(w,!0);return v});u&&(s.clickThrough=!0,S.sm().ss(u))}}I.pendingClickThrough=z}},handleWindowMouseUp:function(s){this.clear(s)},handleWindowMouseMove:function(P){var E=this,Z=E.gv;E._logicalPoint=Z.lp(P),E.mark?(E.fi({kind:"betweenRectSelect",event:P}),Z.isPannable()&&E.autoScroll(P),E.redraw()):E.fi({kind:"beginRectSelect",event:P}),E.mark=oe(E._lastLogicalPoint,E._logicalPoint),E.redraw()},intersects:function(){var h=this,B=h._lastLogicalPoint,k=h._logicalPoint;return B.x>k.x||B.y>k.y},clear:function(l){var y=this,i=y.gv,M=y.mark;if(y._57I=z,y.pendingClickThrough=z,y._lastLogicalPoint){if(M){if(0!==M.width&&0!==M.height){var Y=i.getDatasInRect(M,y.intersects());if(!Y.isEmpty()){var h=i.sm(),e=h.toSelection();Y.each(function(X){h.co(X)?e.remove(X):e.add(X)}),h.ss(e)}}Rd(y.div),delete y.div,delete y.mark,y.redraw(),y.fi({kind:"endRectSelect",event:l}),i.onRectSelectEnded()}y.clearDragging(),delete i._77O}},redraw:function(){var G=this;G._draw||(G._draw=1,Qf(function(){G.mark&&G._42(),delete G._draw},16))}});var Yc=ks.MoveInteractor=function(z){ac(Yc,this,[z])};us("MoveInteractor",Ek,{handle_mousedown:function($){var V=this,u=V.gv;if(wn($)&&!u._editing&&!u._scrolling&&!Wh()){var W=u.getSelectedDataAt($);!W||u._39Q(W)&&!u.isMovable(W)?u._focusData=z:(V._data=W,u.handleMouseDown&&u.handleMouseDown($,W),V.startDragging($),u.isMovable(W)&&(u._moving=1))}},handleWindowMouseUp:function(M){var p=this,W=p.gv;W.handleMouseUp&&W.handleMouseUp(M,p._data),p.clear(M)},handleWindowMouseMove:function(w){var A=this,c=A._data,p=A.gv;if((!p._93O||!p._93O(w,c))&&p._moving){A._logicalPoint||A.fi({kind:"prepareMove",event:w});var Y=A._logicalPoint?"betweenMove":"beginMove",g={kind:Y,event:w},J=A._logicalPoint=p.lp(w);"beginMove"!==Y||A._alreadyBeginTransaction||(A._alreadyBeginTransaction=!0,p.getDataModel().beginTransaction());var D=A._calcShift(Y,w),M=D.x,d=D.y,k=A.gv.getMoveMode(w,c);k&&("x"===k?d=0:"y"===k?M=0:"xy"!==k&&(M=d=0)),p.moveSelection(M,d),A._lastLogicalPoint=J,A.autoScroll(w),A.fi(g)}},_calcShift:function(){var W=this,C=W._logicalPoint,B=W._lastLogicalPoint,G=C.x-B.x,$=C.y-B.y;return{x:G,y:$}},clear:function(N){var M=this,I=M.gv;M._lastLogicalPoint&&(M._lastLogicalPoint=M._data=I._moving=z,M._logicalPoint&&(M.fi({kind:"endMove",event:N}),I.onMoveEnded()),M.clearDragging()),M._alreadyBeginTransaction&&(M._alreadyBeginTransaction=!1,I.getDataModel().endTransaction())}});var Lo=ks.TextEditInteractor=function(D){ac(Lo,this,[D]),this.init()};us("TextEditInteractor",Ek,{init:function(){var e=this,o=this.input=G.createElement("input"),R=o.style;o.text="text",R.border="1px solid #d8d8d8",R.position="absolute",R.padding="2px 3px",R.outline="none",R.marginLeft="-90px",R.marginTop="-16px",R.backgroundColor="rgba(255,255,255, 0.9)",R.fontSize="14px",R.width="180px",R.height="32px",R.boxShadow="0 0 13px rgba(16,142,233, 0.5)",R.textAlign="center",R.boxSizing="border-box",n(o,"keyup",function(q){Hk(q)&&e.endTextEdit()}),n(o,"focus",function(){o.select()});var H=this.textarea=G.createElement("textarea"),M=this.wrap=G.createElement("div");M.appendChild(H),R=H.style,R.margin=0,R.padding="4px",R.overflow="hidden",R.boxSizing="border-box",R.position="absolute",R.outline="none",R.backgroundColor="transparent",R.resize="none",R.textAlign="center",R.fontSize="14px",R.border="none",R.borderWidth=0,R.width="100%",R.top="50%",R=M.style,R.boxSizing="border-box",R.margin=0,R.padding=0,R.position="absolute",R.boxShadow="0 0 13px rgba(16,142,233, 0.5)",R.border="1px solid #d8d8d8",R.backgroundColor="rgba(255,255,255, 0.9)",R.width="180px",R.marginLeft="-90px",n(H,"keydown",function(N){return(Zh()||Kb())&&Hk(N)?(e.endTextEdit(),void 0):(e.calculateTextareaHeight(String.fromCharCode(N.keyCode)),void 0)}),n(H,"focus",function(){H.select()});var f=function(t){t.stopPropagation()};n(o,"mousedown",f),n(o,"touchstart",f),n(H,"mousedown",f),n(H,"touchstart",f),e.SIZING_STYLE=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","text-rendering","text-transform","width","text-indent","padding-left","padding-right","border-width","box-sizing"],e.HIDDEN_TEXTAREA_STYLE="visibility:hidden; min-height:0 !important;max-height:none !important;height:0 !important;visibility:hidden !important;overflow:hidden !important;position:absolute !important;z-index:-1000 !important;top:0 !important;right:0 !important",e.handleWindowClick=function(s){var I=e._editingDOM;if(I){var B=I.getBoundingClientRect(),l=sb(s);Eq(B,l)||e.endTextEdit()}}},handle_mousedown:function(j){var x=this,B=x.gv;if(cm(j)&&!B._editing){var A=B.getDataAt(j);if(A){var g=B.getTextEditInfo(A);g&&(this._editInfo=g,this._editTarget=A,B._editing=!0,g.isMultiline?this.handleMultilineEdit():this.handleTextEdit())}}},handleMultilineEdit:function(){var f=this,J=f.gv,s=f._editTarget,q=f.getTargetValue(),U=f.textarea,A=f.wrap;this.hiddenTextarea||this.createHiddenTextarea(),(null===q||q===x)&&(q=""),U.value=q,f._editingDOM=U,J.getView().appendChild(A),this.layoutHTML(A,s),this.calculateTextareaHeight(),Qf(function(){U.focus(),n(o,"mousedown",f.handleWindowClick),n(o,"touchstart",f.handleWindowClick)},10)},handleTextEdit:function(){var d=this,Z=d.gv,p=d._editTarget,s=d.getTargetValue(),r=d.input;(null===s||s===x)&&(s=""),r.value=s,d._editingDOM=r,Z.getView().appendChild(r),this.layoutHTML(r,p),Qf(function(){r.focus(),n(o,"mousedown",d.handleWindowClick),n(o,"touchstart",d.handleWindowClick)},10)},layoutHTML:function(s,_){var M=this.gv,b=M.getZoom();if(_ instanceof R.Node){var m=_.getRect();s.style.left=(m.x+m.width/2)*b+M.tx()+"px",s.style.top=(m.y+m.height/2)*b+M.ty()+"px"}else if(_ instanceof R.Edge){var H=M.getDataUI(_),m=H._6I;s.style.left=(m.x+m.width/2)*b+M.tx()+"px",s.style.top=(m.y+m.height/2)*b+M.ty()+"px"}},endTextEdit:function(){var U=this,M=U._editInfo.isMultiline?U.wrap:U.input,f=U._editInfo.isMultiline?U.textarea:U.input;U.setTargetValue(f.value),U.gv.getView().removeChild(M),U.gv._editing=!1,delete U._editingDOM,I(o,"mousedown",U.handlelick),I(o,"touchstart",U.handleWindowClick)},setTargetValue:function(i){var q=this,E=q._editTarget,G=q._editInfo,T=G.accessType,g=G.name;if(g&&T||(T="p",g="name"),"p"===T){var V=R.Default.setter(g);E[V](i)}else"a"===T?E.a(g,i):E.s(g,i)},getTargetValue:function(){var Q=this,U=Q._editTarget,Z=Q._editInfo,n=Z.accessType,k=Z.name;if(k&&n||(n="p",k="name"),"p"===n){var m=R.Default.getter(k);return U[m]()}return"a"===n?U.a(k):U.s(k)},createHiddenTextarea:function(){this.hiddenTextarea=G.createElement("textarea"),this.hiddenTextarea.setAttribute("style","margin:0; padding:0; position:absolute; overflowY:scroll; resize:none; box-sizing:border-box;"),this.hiddenTextarea.setAttribute("rows","1"),this.gv.getView().appendChild(this.hiddenTextarea)},calculateHTMLStyle:function(c,p){if(p&&this.computedStyleCache)return this.computedStyleCache;var m=this,n=o.getComputedStyle(c),h=n.getPropertyValue("box-sizing")||n.getPropertyValue("-moz-box-sizing")||n.getPropertyValue("-webkit-box-sizing"),s=parseFloat(n.getPropertyValue("padding-bottom"))+parseFloat(n.getPropertyValue("padding-top")),i=parseFloat(n.getPropertyValue("border-bottom-width"))+parseFloat(n.getPropertyValue("border-top-width")),S=m.SIZING_STYLE.map(function(p){return p+":"+n.getPropertyValue(p)}).join(";"),t={sizingStyle:S,paddingSize:s,borderSize:i,boxSizing:h};return p&&(this.computedStyleCache=t),t},calculateTextareaHeight:function(z){z=z||"";var A=this,L=A.textarea,M=A.hiddenTextarea,I=A.wrap,q=32,J=A.calculateHTMLStyle(L,!1),f=J.paddingSize,U=J.borderSize,$=J.boxSizing,i=J.sizingStyle;M.setAttribute("style",i+";"+A.HIDDEN_TEXTAREA_STYLE),M.value=L.value+z;var Y=M.scrollHeight;"border-box"===$?Y+=U:"content-box"===$&&(Y-=f),L.style.height=Y+"px",L.style.marginTop=0-.5*Y+"px",I.style.height=Math.max(Y,q)+"px",I.style.marginTop=Y*-.5+"px"}});var ke=ks.ScrollBarInteractor=function(W){ac(ke,this,[W])};us("ScrollBarInteractor",Ek,{_41o:function(){return this.gv.getViewRect().height<this.gv.getScrollRect().height},_40o:function(){return this.gv.getViewRect().width<this.gv.getScrollRect().width},isV:function(i){var t=this.gv.getViewRect();return this._41o()&&(t.x+t.width-this.gv.lp(i).x)*this.gv.getZoom()<rk},isH:function(t){var W=this.gv.getViewRect();return this._40o()&&(W.y+W.height-this.gv.lp(t).y)*this.gv.getZoom()<rk},handle_mousemove:function(x){this.handle_touchmove(x)},handle_touchmove:function(S){if(!Si&&wn(S)&&this.gv.isScrollBarVisible()){var K=this,G=K.isV(S),y=K.isH(S);(G||y)&&K.gv.showScrollBar(),K.gv._scrolling=G||y}},handleWindowMouseUp:function(V){this.handleWindowTouchEnd(V)},handleWindowTouchEnd:function(n){this._state=this._cp=this._tx=this._ty=this.gv._scrolling=z,this.fi({kind:"endScroll",event:n})},handle_mousedown:function(c){this.handle_touchstart(c)},handle_touchstart:function(N){var l=this;if(l.gv.setFocus(N),$r(N),l.handle_touchmove(N),!(po(N)>1)&&l.gv._scrolling&&l.gv.isScrollBarVisible()){l._cp=sb(N),l._tx=l.gv.tx(),l._ty=l.gv.ty();var J=l.isV(N);l._state=J?"vScroll":"hScroll",np(l,N),l.fi({kind:"beginScroll",event:N})}},handleWindowMouseMove:function(U){this.handleWindowTouchMove(U)},handleWindowTouchMove:function(s){var C=sb(s),m=this.gv.getViewRect(),n=this.gv.getScrollRect();"vScroll"===this._state?this.gv.ty(this._ty+(this._cp.y-C.y)*n.height/m.height):"hScroll"===this._state&&this.gv.tx(this._tx+(this._cp.x-C.x)*n.width/m.width),this.fi({kind:"betweenScroll",event:s})}});var Nj=ks.TouchInteractor=function(H,b){b=b||{},b.selectable===x&&(b.selectable=!0),b.movable===x&&(b.movable=!0),b.pannable===x&&(b.pannable=!0),b.pinchable===x&&(b.pinchable=!0),b.editable===x&&(b.editable=!0),this.params=b,ac(Nj,this,[H])};us("TouchInteractor",Ek,{ms_edit:1,setUp:function(){var B=this;Nj.superClass.setUp.call(B),vd&&B.params.editable&&B.gv.setEditInteractor(B)},tearDown:function(){var I=this;Nj.superClass.tearDown.call(I),vd&&I.params.editable&&I.gv.setEditInteractor(z)},clear:function(h){var k=this,v=k.gv;v._moving&&(k.fi({kind:"endMove",event:h}),delete v._moving,v.onMoveEnded(),v.dm().endTransaction()),v._panning&&(k.fi({kind:"endPan",event:h}),delete v._panning,v.onPanEnded()),v._pinching&&(k.fi({kind:"endPinch",event:h}),delete v._pinching,v.onPinchEnded()),v._editing&&(k._46O(h),k._77I=k._node=k._edge=k._shape=k._rect=k._89I=k._index=v._editing=z),k.pendingClickThrough=k._moving=k._panning=k._pinching=k._editing=k._57I=k._data=k._beginHistory=z,k.clearDragging()},handle_touchstart:function(K){var y=this;if(!y.gv._editing){$r(K),y._57I=z,y.pendingClickThrough=z;var E=y.params,N=y.gv,I=N.sm(),c=N.getDataAt(K),p=po(K);if(1===p){if(cm(K))return N.handleDoubleClick(K,c),void 0;N.handleClick(K,c),c&&(N.handleMouseDown&&N.handleMouseDown(K,c),y._data=c),E.selectable||(c=z),c&&(I.co(c)?c instanceof rf&&c.isClickThroughEnabled()&&(y.pendingClickThrough=sb(K)):I.ss(c),E.editable&&N.isEditable(c)&&y._79I(K,c,!0)?(y._editing=1,y.startDragging(K)):E.movable&&N.isMovable(c)&&(y._moving=1,y.startDragging(K))),c&&N.isMovable(c)||(y._57I=sb(K),E.pannable&&N.isPannable()&&(y._panning=1,y.startDragging(K),y._translate={x:N.tx(),y:N.ty()}))}else if(E.pinchable&&2===p){if(c&&N._39Q(c))return;y._pinching=1,y.startDragging(K);var h=N.getView(),P=N.getZoom(),i=h.getBoundingClientRect(),q=K.touches[0],m=K.touches[1],w={x:(q.clientX+m.clientX)/2-i.left,y:(q.clientY+m.clientY)/2-i.top};w.x-=N.tx(),w.y-=N.ty(),w.x/=P,w.y/=P,y._p=w,y._d=lo(K)}}},handle_touchend:function(O){var t=this,Q=t.gv,f=t._57I,K=t._data;if(f&&(id(f,sb(O))<=1&&!Q.getDataAt(O)&&Q.sm().cs(),t._57I=z),K&&Q.handleMouseUp&&Q.handleMouseUp(O,K),t.pendingClickThrough){if(id(t.pendingClickThrough,sb(O))<=1){var K=Q.getDataAt(O);if(K instanceof rf&&K.isClickThroughEnabled()){var s=Q.getDataAt(O,function(N){var n=N.getParent()===K&&Q.isSelectable(N,!0);return n});s&&(O.clickThrough=!0,Q.sm().ss(s))}}t.pendingClickThrough=z}},handleWindowTouchEnd:function(s){this.clear(s)},handleWindowTouchMove:function(i){var L=this,y=L.gv,N=po(i);if(1===N){var R=sb(i),c=os(y,R,L._lastClientPoint),b=id({x:0,y:0},c);if(L._editing&&(L._beginHistory||(L._beginHistory=1,y.dm().beginTransaction()),y._editing=1,L._78I(i)),L._moving){if(!y._moving&&b<m.touchMoveThreshold)return;L._beginHistory||(L._beginHistory=1,y.dm().beginTransaction()),L.handleMove(i)}else if(L._panning){if(!y._panning&&b<m.touchMoveThreshold)return;y.setTranslate(L._translate.x+c.x,L._translate.y+c.y),L.fi({kind:y._panning?"betweenPan":"beginPan",event:i}),y._panning=1}}else if(2===N&&L._pinching){var x=lo(i);y.handlePinch(L._p,x,L._d),L._d=x,L.fi({kind:y._pinching?"betweenPinch":"beginPinch",event:i}),y._pinching=1}},handleMove:function(e){var _=this,Z=_.gv,u=Z.lp(e);Z._93O&&Z._93O(e,_._data)||(Z.moveSelection(u.x-_._lastLogicalPoint.x,u.y-_._lastLogicalPoint.y),_._lastLogicalPoint=u,_.autoScroll(e),_.fi({kind:Z._moving?"betweenMove":"beginMove",event:e}),Z._moving=1)}});var R=o.ht,Tm=R.graph._editor={Math:R.Math,Guide:{}};Tm.getStyle=function(B){var H,b=Tm.StyleMap;return b&&(H=b[B],H!==x)?H:Tm.DefaultStyleMap[B]},Tm.setStyle=function(o,O){var q=Tm.StyleMap;q||(q=Tm.StyleMap={}),q[o]=O},Tm.inEdit=function(t){return t._inXEdit===!0},Tm.startEdit=function(N){N._inXEdit=!0,Tm.Inject.doInject(N)},Tm._46O=function(M){M._inXEdit=!1,Tm.Inject.undoInject(M)},Tm.toScreenPosition=function(w,O){var b=w.tx(),f=w.ty(),D=w._zoom;return new Tm.Math.Vector2(O.x*D+b,O.y*D+f)},Tm.checkHit=function(p,N,M){return p.distanceTo(N)<M?!0:!1},Tm.toWorldPosition=function(u,Y){var M=u.tx(),w=u.ty(),O=u._zoom;return{x:(Y.x-M)/O,y:(Y.y-w)/O}},Tm.setAntialias=function(I,O){for(var N,F=["imageSmoothingEnabled","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","oImageSmoothingEnabled","msImageSmoothingEnabled"],A=0,K=F.length;K>A&&(N=F[A],!(N in I));A++);I[N],I[N]=O},Tm.getTargetCornersOnScreen=function(K,d){if(!d)return null;var j,g=[];if(Te(d,K)){var q=vg(K,d);j=[{x:q.x,y:q.y},{x:q.x+q.width,y:q.y},{x:q.x+q.width,y:q.y+q.height},{x:q.x,y:q.y+q.height}]}else{if(!d.getCorners)return null;j=d.getCorners()}return j.forEach(function(R){var X=Tm.toScreenPosition(K,R);g.push(X.x,X.y)}),g},Tm.log=function(){};var xm=Tm.Inject={_modules:[]};xm.registAsModule=function(n,J){var z={},h={};for(var S in n){var Q=J.prototype[S];z[S]=Q}n.getBackup=function(o){return z[o]},n.getBackups=function(){return z},h.doInject=function(){for(var $ in n)"getBackup"!==$&&(J.prototype[$]=n[$])},h.undoInject=function(){for(var N in n)"getBackup"!==N&&(J.prototype[N]=z[N])},xm._modules.push(h)},xm.doInject=function(V){for(var H,b=xm._modules,M=0,C=b.length;C>M;M++)H=b[M],H.doInject(V)},xm.undoInject=function(J){for(var k,g=xm._modules,t=0,V=g.length;V>t;t++)k=g[t],k.undoInject(J)};var Ek=R.graph.EditInteractor=function(B){var e=this,L=G.createElement("canvas");L.className="editCanvas",L.style.position="absolute",e._styleMap={},e._canvas=L,e._context=L.getContext("2d"),Ek.superClass.constructor.call(e,B),this._editDetail=!1,Tm.setAntialias(e._context,!1),e._subModules=[new Tm.Anchor(e),new Tm.RotateX(e),new Tm.MoveDummy(e),new Tm.Rect(e),new Tm.Curve(e),new Tm.MoveHelper(e)],e._gridGuide=new Tm.Guide.Grid(e),e._rectGuide=new Tm.Guide.Rect(e),e._hoverGuide=new Tm.Guide.Hover(e)},_k=Ek;R.Default.def(Ek,R.graph.Interactor,{ms_edit:1,ms_fire:1}),U.defineProperties(Ek.prototype,{editDetail:{get:function(){var F=!!this._editDetail;return F},set:function(W){var t=this,e=t._editDetail;e!==W&&(t._editDetail=W,t.gv._editing=W,t.fp("editDetail",e,W),t.fp("pointsEditingMode",e,W),t.fi({kind:W?"beginEditPoints":"endEditPoints"}))}},gvEditing:{get:function(){return this.gv._editing},set:function(N){(!this._editDetail||N)&&(this.gv._editing=N,N||(this.editDetail=!1))}},editing:{get:function(){return this._editing},set:function(r){this._editing=r,this.gvEditing=r}},pointsEditingMode:{get:function(){return this.editDetail},set:function(k){var a=this;a.editDetail!==k&&(k?a._tryEnterEditDetailMode():a._tryQuitEditDetailMode())}},gridEnabled:{get:function(){var P=this._gridEnabled;if(!P)return!1;var t=this.gv;return t?!0:!0},set:function(t){t!==this._gridEnabled&&(this._gridEnabled=t,this._42())}},alignmentGuideEnabled:{get:function(){return this._agEnabled},set:function(F){F!==this._agEnabled&&(this._agEnabled=F,this._42())}},gridGuide:{get:function(){return this._gridGuide}},rectGuide:{get:function(){return this._rectGuide}},hoverGuide:{get:function(){return this._hoverGuide}}}),Ek.prototype.getSubModule=function(J){var B,W,D,a=this._subModules;for(W=0,D=a.length;D>W;W++)if(B=a[W],B.catalog===J)return B},Ek.prototype.invokeSubModule=function(X,A){var d=this,u=d._subModules;if(u)for(var w,c,F,P=Array.prototype.slice.call(arguments,2),C=0,b=u.length;b>C;C++)if(w=u[C],c=w[X],c&&(F=c.apply(w,P),F!=x&&A))return w},Ek.prototype.invokeSubModuleInverse=function(Q,K){var v=this,z=v._subModules;if(z)for(var U,p,F,_=Array.prototype.slice.call(arguments,2),C=z.length-1;C>=0;C--)if(U=z[C],p=U[Q],p&&(F=p.apply(U,_),F!=x&&K))return U},Ek.prototype.setUp=function(){Tm.log("setUp");var T=this,b=T.gv,o=b.getView(),K=T._canvas;Ek.superClass.setUp.call(T),b.setEditInteractor(T),b._79O?o.insertBefore(K,b._79O):o.appendChild(K),Tm.startEdit(b),T.invokeSubModule("setUp"),b.dm().mm(T._onDataModelChanged,T),b.dm().md(T._onDataPropertyChanged,T)},Ek.prototype.tearDown=function(){Tm.log("tearDown");var D=this,z=D.gv,b=z.getView();D._resetCustomCursorStyle(),Ek.superClass.tearDown.call(D),z.dm().umm(D._onDataModelChanged,D),z.dm().umd(D._onDataPropertyChanged,D),z.setEditInteractor(null),b.removeChild(D._canvas),D._drawTimer&&($g(D._drawTimer),D._drawTimer=null),Tm._46O(z),D.invokeSubModule("tearDown")},Ek.prototype._onDataModelChanged=function(j){var u=this;("clear"===j.kind||"remove"===j.kind&&u.editDetail&&j.data===u.getSubModule("Curve").target)&&(u.editDetail=!1,u._42())},Ek.prototype._onDataPropertyChanged=function(J){var I=this;if(I.editDetail){var L=I.getSubModule("Curve"),n=J.data;n===L.target&&(n._writing||L._handleDataChanged(J))}},Ek.prototype.clear=function(){Tm.log("clear")},Ek.prototype.redraw=function(){this._42()},Ek.prototype._42=function(){var W=this;W._drawTimer||(W._drawTimer=Qf(function(){W._drawTimer=null,W.drawImpl()},0))},Ek.prototype.drawImpl=function(){var z;for(z in{_42:!0})break;return function(){var x=this,e=x._canvas,K=x.gv,J=K.getWidth(),p=K.getHeight(),$=x._context,w=R.Default.getInternal(),S=o.devicePixelRatio;(e.width!==J||e.height!==p)&&w.setCanvas(e,J,p,S),$.clearRect(0,0,e.width,e.height);var O=x._getValidSelection();$.save(),$.scale(S,S),x._gridGuide._42(),x.invokeSubModuleInverse(z,!1,$,K,O),x._rectGuide._42(),x._hoverGuide._42(),$.restore()}}(),Ek.prototype._getValidSelection=function(){var M=this,H=M.gv,g=H.sm().getSelection(),r=[];return g.each(function(s){H.isVisible(s)&&H.isEditable(s)&&r.push(s)}),r},Ek.prototype.handle_touchmove=function(A){return this.handle_mousemove(A)},Ek.prototype.handle_mousemove=function(y){if(!R.Default.isDragging()){var Z=this;if((Z.editDetail||!Wh()&&!ie(y))&&!Z.gv._externalEditing)if(Z.gvEditing=!1,Z._checkEdit(y))Z.gvEditing=!0;else{if(!Z.getStyle("hoverGuideVisible"))return;Z.hoverData=Z.gv.getDataAt(y),Z._42()}}},Ek.prototype.handle_touchstart=function(R){return this.handle_mousedown(R)},Ek.prototype.handle_mousedown=function(N){$r(N);var q=this;if((q.editDetail||!Wh()&&!ie(N))&&!q.gv._externalEditing){if(cm(N)&&!N.clickThrough){if(q.editDetail){if(q._tryQuitEditDetailMode(N))return}else if(q._tryEnterEditDetailMode())return;q.gv.dm().beginTransaction();var y=q.invokeSubModule("handleDoubleClick",!0,N);if(q.gv.dm().endTransaction(),y)return}var H=q._checkEdit(N);H&&(q._downPosition=q._getLogicalPoint(N),q.gv.dm().beginTransaction(),H.startEdit(q,N),q.editing=!0)}},Ek.prototype._checkEdit=function($){var u=this,x=u.gv,I=u._getLogicalPoint($),G=u.invokeSubModule("check",!0,x,$,I)||null;return u._editMod=G,G},Ek.prototype.handleWindowTouchMove=function(v){return this.handleWindowMouseMove(v)},Ek.prototype.handleWindowMouseMove=function(L){var v=this,f=v._downPosition;if(f){var i=v._getLogicalPoint(L);if(i.distanceTo(f)<v.getStyle("moveSensitivity"))return;delete v._downPosition}var a=v._editMod;a&&a.handleEdit(v.gv,L)},Ek.prototype._getLogicalPoint=function(L){var g=this,r=R.Default.getLogicalPoint(L,g._canvas);return new Tm.Math.Vector2(r)},Ek.prototype.handleWindowTouchEnd=function(C){return this.handleWindowMouseUp(C)},Ek.prototype.handleWindowMouseUp=function(){var y;for(y in{_46O:!0})break;return function(c){var K=this;K.editing=!1,K.setCursor("default"),K.invokeSubModule(y,!1,c),K._42(),K.gv.dm().endTransaction()}}(),Ek.prototype.handle_mousewheel=function(Z){var k=this;$r(Z),k.invokeSubModule("preHandleScroll",!0)||k.gv.handleScroll(Z,Z.wheelDelta)},Ek.prototype.handleDelete=function(){var M=this;if(!M.editDetail){M.gv.dm().beginTransaction();var x=M.invokeSubModule("handleNormalStateDelete",!0);return M.gv.dm().endTransaction(),x||M.gv.removeSelection(),void 0}M.gv.dm().beginTransaction(),M.invokeSubModule("handleDelete",!0),M.gv.dm().endTransaction(),M._42()},Ek.prototype.handle_keydown=function(w){var u=this;if((w.metaKey||w.ctrlKey)&&u._42(),Wh(w)&&!u.editing)return u.gvEditing=!1,u.setCursor("default"),u._42(),void 0;var v=Hk(w);return u.editDetail?((v||qd(w))&&(u.editDetail=!1,u._42()),u.gv.dm().beginTransaction(),u.invokeSubModule("handle_keydown",!0,w),u.gv.dm().endTransaction(),void 0):(u.gv.dm().beginTransaction(),u.invokeSubModule("handleNormalStateKeyDown",!0,w),u.gv.dm().endTransaction(),v&&u._tryEnterEditDetailMode(),void 0)},Ek.prototype.handle_keyup=function(M){this.gv.dm().beginTransaction(),this.invokeSubModule("handle_keyup",!0,M),this.gv.dm().endTransaction()},Ek.prototype._tryEnterEditDetailMode=function(){var R=this;return!R.editDetail&&R.invokeSubModule("canEnterEditDetailMode",!0)&&1===R._getValidSelection().length?(R.editDetail=!0,R._42(),!0):void 0},Ek.prototype._tryQuitEditDetailMode=function(T){var j=this;return j.editDetail?!T||j.invokeSubModule("canQuitEditDetailMode",!0,T)?(j.editDetail=!1,j._42(),!0):!1:!1
},Ek.prototype.setStyle=function(s,Y,g){var S=this;g?Tm.setStyle(s,Y):S._styleMap[s]=Y,"baseColor"===s&&(Ri=Y),S.fp("styleChanged",null,{key:s,value:Y,base:g}),S._42()},Ek.prototype.getStyle=function(p){var h=this,N=h._styleMap[p];return N!==x?N:Tm.getStyle(p)},Ek.prototype.setCursor=function(v){this._resetCustomCursorStyle(),R.graph.EditInteractor.superClass.setCursor.call(this,v)},Ek.prototype._drawHostGuide=function(d){var R=this,n=R._context,B=R.gv;Tm.Icons.DrawIcon(R,n,Tm.Icons.NodeHoverGuide,d.corners);var g=d.host;if(g){var Y=B.getAttachPoints(g);if(Y&&Y.length)for(var u=0,r=Y.length;r>u;u++){var U=Y[u],q=oo(B,g,0,U.offsetX||0,U.offsetY||0,U.x,U.y);q=Tm.toScreenPosition(B,q),q.isAttach=d.attach===u,Tm.Icons.DrawIcon(R,n,Tm.Icons.AttachPoint,q)}}},Ek.prototype._resetCustomCursorStyle=function(){var W=this;if(W._customStyle){var T=this.gv.getView();T.classList&&T.classList.remove&&T.classList.remove(W._customStyle),W._customStyle=null}},Ek.prototype._setRotateCursor=function(G){var P=this,x=P._cursorFactory;x||(x=P._cursorFactory=new Tm.CursorFactory(P));var r=x.getRotateCursor(G),u=P.gv.getView();P._resetCustomCursorStyle(),P._customStyle=r,u.classList&&u.classList.add&&u.classList.add(r)};var Ml=Tm.Group=function(O){var G=this;G._entities=O,G._64O=0,G._position={x:0,y:0},G._scale={x:1,y:1},G._anchor={x:.5,y:.5},G._anchor2={x:.5,y:.5}};Ml.prototype={},Ml.prototype.constructor=Ml;var ng=null;Ml.findOrCreateGroup=function(i){if(ng&&ng.checkIsMe(i))return ng;var V=new Tm.Group(i);return V.getKeyOb()?(ng=V,V):void 0},Ml.prototype.checkIsMe=function(J){var h=this._entities;if(h.length!==J.length)return!1;var D,F={},_=J.length;for(D=0;_>D;D++)F[J[D]._id]=!0;for(D=0;_>D;D++)if(!F[h[D]._id])return!1;return!0},Ml.prototype.getRotation=function(){return this._64O},Ml.prototype.getPosition=function(){return this._position},Ml.prototype.getAnchor=function(){return this._anchor},Ml.prototype.getWidth=function(){return this._width},Ml.prototype.getScale=function(){return this._scale},Ml.prototype.getSize=function(){return{width:this._width,height:this._height}},Ml.prototype.getHeight=function(){return this._height},Ml.prototype.getKeyOb=function(){for(var e=this._entities,u=e.length-1;u>=0;u--){var D=e[u];if(this.isNode(D))return D}},Ml.prototype.getAnchor2=function(){var y=this,A=y.rotateCenter;if(A)return A;var G=y.getKeyOb();if(!G)return y._anchor;var U=y._anchor2,h=G.getMatrix();return h.tf({x:G.getWidth()*(U.x-G.getAnchor().x),y:G.getHeight()*(U.y-G.getAnchor().y)})},Ml.prototype.setAnchor2=function(J,q){var b=this,S=b.getKeyOb();if(S){var m,U=S.getMatrix();m="number"==typeof J?{x:J,y:q}:J;var u=U.tfi(m);b._anchor2={x:S.getAnchor().x+u.x/S.getWidth(),y:S.getAnchor().y+u.y/S.getHeight()}}},Ml.prototype.setRotation=function(){},Ml.prototype.beginRotate=function(F){this.rotateCenter=F.pos,this.rotateMode=F.groupRotateMode},Ml.prototype.endRotate=function(){delete this.rotateCenter,delete this.rotateMode},Ml.prototype.addRotation=function($,s,H){return"batch"===s?this._addRotationInBatchMode($,H):"block"===s?this._addRotationInBlockMode($,H):void 0},Ml.prototype._addRotationInBlockMode=function(S,Z){var f=this,v=f.rotateCenter||f.getPosition();f._entities.forEach(function(y){if(f.isNode(y)&&(!Z||Z(y))){var K=y.getMatrix();K.translate(-v.x,-v.y),K.rotate(S),K.translate(v.x,v.y);var l=Math.sign(y.getScale().x);y.setRotation(C(K.b*l,K.a*l)),y.setPosition(K.tx,K.ty)}})},Ml.prototype._addRotationInBatchMode=function(w,n){var Z=this,G=Z._anchor2;Z._entities.forEach(function(R){if(Z.isNode(R)&&(!n||n(R))){var u=R.getAnchor(),e=R.getMatrix(),S=e.tf({x:R.getWidth()*(G.x-u.x),y:R.getHeight()*(G.y-u.y)}),t=new Tm.Math.Matrix2d;t.set(e.a,e.b,e.c,e.d,e.tx,e.ty),t.translate(-S.x,-S.y),t.rotate(w),t.translate(S.x,S.y);var P=Math.sign(R.getScale().x);R.setRotation(C(t.b*P,t.a*P)),R.setPosition(t.tx,t.ty)}})},Ml.prototype.setPosition=function(G){var x,I,F,r,P=this,J=P._position,m=G.x-J.x,v=G.y-J.y,S=P._entities;for(I=0,F=S.length;F>I;I++)x=S[I],Vm(x)&&(r=x.getPosition(),x.setPosition(r.x+m,r.y+v));P._position=G},Ml.prototype.setScale=function($,T){var D=this,I=$/D._scale.x,P=T/D._scale.y;D._adjustChildScaleOrSize(I,P,"size"),D._scale={x:$,y:T}},Ml.prototype.getRect=function(){var $=this,r=$._position,J=$._width,H=$._height;return{x:r.x-J/2,y:r.y-H/2,width:J,height:H}},Ml.prototype.setSize=function(G,H){var F=this,G=Math.max(1,G),H=Math.max(1,H),k=G/F._width,z=H/F._height;F._adjustChildScaleOrSize(k,z,"size"),F._width=G,F._height=H},Ml.prototype._adjustChildScaleOrSize=function(K,i,m){var Y,e,S,N,b,c,W,k,h,y,O,D,A,o,r=this,t=r._position,E=r._entities,d=new Tm.Math.Matrix2d;for(e=0,S=E.length;S>e;e++)if(Y=E[e],r.isNode(Y)){if(N=Y.getPosition(),b=Y.getRotation(),c=Y.getWidth(),W=Y.getHeight(),k=Y.getScale(),O=k.x*c,D=k.y*W,d.identity().scale(O,D).rotate(b).translate(N.x,N.y).translate(-t.x,-t.y).rotate(-r._64O),b=C(d.b*Math.sign(O),d.a*Math.sign(O)),d.scale(K,i),h=Math.cos(b),y=Math.sin(b),Math.abs(h)<.001?(A=d.b/y,o=-d.c/y):(A=d.a/h,o=d.d/h),"scale"===m)Y.setScale(A/c,o/W);else if("size"===m){var j=A/k.x,U=o/k.y;Y.setScale(Bl(A)*Math.abs(k.x),Bl(o)*Math.abs(k.y)),Y.setSize(Math.max(.1,Math.abs(j)),Math.max(.1,Math.abs(U)))}d.rotate(r._64O).translate(t.x,t.y),Y.setPosition(d.tx,d.ty)}},Ml.prototype.getMatrix=function(){var a=this,W=a._position,k=R.Default.getInternal(),x=a._scale;return new k.Mat(a._64O,W.x,W.y,x.x,x.y)},Ml.prototype.toGlobal=function(D){return this.getMatrix().tf(D)},Ml.prototype.getCorners=function(){var r=this,P=r._width,J=r._height,S=r._anchor,x=-P*S.x,d=-J*S.y,Z=r.getMatrix();return[Z.tf(x,d),Z.tf(x,d+J),Z.tf(x+P,d+J),Z.tf(x+P,d)]},Ml.prototype.calcInfo=function(){var H,t,G,D,Y,w,O=this,I=[],Q=O._entities,f=O._64O;for(D=0,Y=Q.length;Y>D;D++)w=Q[D],O.isNode(w)&&w.getCorners&&I.push.apply(I,w.getCorners());if(I.length){var V=Math.cos(-f),c=Math.sin(-f),h=1/0,N=-1/0,y=1/0,o=-1/0;for(D=0,Y=I.length;Y>D;D++)G=I[D],H=G.x,t=G.y,G.x=V*H-c*t,G.y=c*H+V*t,h=Math.min(h,G.x),N=Math.max(N,G.x),y=Math.min(y,G.y),o=Math.max(o,G.y);O._width=(N-h)/O._scale.x,O._height=(o-y)/O._scale.y,V=Math.cos(f),c=Math.sin(f);var M=O._anchor;H=h+(N-h)*M.x,t=y+(o-y)*M.y,O._position={x:V*H-c*t,y:c*H+V*t}}},Ml.prototype.isNode=function(m){return Vm(m)?Te(m)?m.size()?!1:!0:!0:!1},Ml.prototype._42=function(f,u,n){var v,x,k,$,P,p,s,J,K=this,D=K._entities,U=K.rotateMode;for("batch"===U&&(J=K.getKeyOb()),v=0,x=D.length;x>v;v++)k=D[v],K.isNode(k)&&(p=k.getRect(),$=Tm.toScreenPosition(n,{x:p.x,y:p.y}),P=Tm.toScreenPosition(n,{x:p.x+p.width,y:p.y+p.height}),s={min:$,max:P},k===J&&(s.isKeyOb=!0),Tm.Icons.DrawIcon(f,u,Tm.Icons.GroupSubEntityRect,s))};var Ne=Tm.CurveActiving=function(J,M){this._curve=J,this._interactor=J._interactor,this.silent=!0;for(var F in M)this[F]=M[F];delete this.silent};Ne.prototype={},Ne.prototype.constructor=Ne,U.defineProperties(Ne.prototype,{point:{get:function(){return this._point},set:function(m){var h=this;h._point=m,h.editingCtrl||h.silent||h._firePointChange()}},pairs:{get:function(){return this._pairs},set:function(n){var F=this;F._pairs=n,F.editingCtrl&&!F.silent&&F._firePointChange()}}}),Ne.prototype._firePointChange=function(){var m=this,K=m.getCurrentEditingPoint(),z=m._interactor;if(!K)return z.fi({kind:"selectPoint"}),void 0;var v=this._curve.target;if(v){var h=Tm.getDataMatrix(v).invert(),B=K.e;K=h.apply(Tm.toWorldPosition(z.gv,K)),K.e=B;var _=m._lastFirePoint;_&&Math.abs(K.x-_.x)<1e-5&&Math.abs(K.y-_.y)<1e-5&&(K.e==x&&_.e==x||Math.abs(K.e-_.e)<1e-5)||(m._lastFirePoint=K,z.fi({kind:"selectPoint",x:K.x,y:K.y,e:K.e}))}},Ne.prototype.dispose=function(){this._interactor.fi({kind:"selectPoint"})},Ne.prototype.getCurrentEditingPoint=function(){var e=this,o=e.editingCtrl;if(o){var p=e.pairs;if(p){var b=p[o.pairId];if(b){var w=b[o.type];if(w)return w}}}return e._point};var eo=Tm.CursorFactory=function(h){var w=this;w._interactor=h,w._rotateCursorStyles={}};eo.prototype={},eo.prototype.constructor=eo,eo.prototype.getRotateCursor=function(V){var A=this;0>V&&(V+=2*Math.PI);var e=A._interactor,E=e.getStyle("rotateCursorSize"),W=e.getStyle("rotateCursorRound"),c=Math.round(180*(V/Math.PI)/W);c*W>=360&&(c=0);var z=A._rotateCursorStyles,t="htCustomRotateStyle_"+E+"_"+W+"_"+c;return z[t]||(A._produceRotateCursor(t,E,W,c),z[t]=!0),t},eo.prototype._produceRotateCursor=function(U,g,D,$){var a=this;a._interactor;var A=a._canvas;A||(A=a._canvas=G.createElement("canvas")),A.width=A.height=g*devicePixelRatio,A.style.width=A.style.height=g+" px";var L=A.getContext("2d");Tm.setAntialias(L,!1),L.scale(devicePixelRatio,devicePixelRatio);var V,o,z,R,M,e=Math.round(g/2),Z=""+e+" "+e+",auto !important;",O=4;V=Math.PI/180*$*D,L.clearRect(0,0,g,g),L.save(),L.scale(g/32,g/32),L.translate(16,15),L.rotate(V+Math.PI/2),L.beginPath(),L.moveTo(-8,0),L.lineTo(-8,O),L.lineTo(-8+O,O),L.moveTo(8,0),L.lineTo(8,O),L.lineTo(8-O,O),L.moveTo(-8,O),L.quadraticCurveTo(0,-6,8,O),L.restore(),L.lineCap="round",L.lineJoin="miter",L.strokeStyle="white",L.lineWidth=4,L.stroke(),L.strokeStyle="black",L.lineWidth=2,L.stroke(),o=JSON.stringify(A.toDataURL()),R="cursor:url("+o+")"+Z,1!==devicePixelRatio&&(z='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+g+'px" height="'+g+'px"><image xlink:href='+o+' width="'+g+'" height="'+g+'"/></svg>',R+="cursor:url(data:image/svg+xml;base64,"+btoa(z)+")"+Z,R+="cursor:-webkit-image-set(url("+o+")"+devicePixelRatio+"x,url("+o+")1x)"+Z),M=G.createElement("style"),M.textContent="body."+U+" *, ."+U+"{"+R+"}",G.head.appendChild(M)};var zm=Tm.Guide.Grid=function(d){var n=this;n._interactor=d,n._alignmentGuideId=0,n._xAlignmentGuide=[],n._yAlignmentGuide=[]};zm.prototype={},zm.prototype.constructor=zm,U.defineProperties(zm.prototype,{gridBlockSize:{get:function(){var v=this;return v._gridBlockSize||v._interactor.getStyle("gridBlockSize")},set:function(V){this._gridBlockSize=V,this._interactor._42()}},gridThickLinesEvery:{get:function(){var G=this;return G._gridThickLinesEvery||G._interactor.getStyle("gridThickLinesEvery")},set:function(A){this._gridThickLinesEvery=A,this._interactor._42()}},gridEnabled:{get:function(){var f=this,a=f._interactor;return a.gridEnabled&&f.isValidGrid()}}}),zm.prototype._42=function(){var j=this,s=j._interactor;j.gridEnabled&&j.drawGrid(),s.alignmentGuideEnabled&&j.drawAlignmentGuide()},zm.prototype.makeMatrix=function(){var v=this,K=v._interactor.getStyle("gridAngle"),I=v._interactor.getStyle("gridRotation"),B=new Tm.Math.Matrix2d,Y=Math.sin(K),G=Math.cos(K);return B.set(1,0,G,Y,0,0),B.rotate(I),B},zm.prototype.isValidGrid=function(){var F=this,t=Math.PI,o=F._interactor,N=o.gv;if(N._zoom<o.getStyle("gridZoomThreshold"))return!1;var J=o.getStyle("gridAngle"),L=Math.abs(180*(J%t/t)),n=1-1e-8;return n>L||L>180-n?!1:!0},zm.prototype.drawAlignmentGuide=function(){var z=this,Y=z._interactor,f=Y.gv,n=Y._canvas,S=Y._context,F=n.width,g=n.height,w=f.tx(),U=f.ty(),t=f._zoom;S.beginPath(),S.strokeStyle=Y.getStyle("gridAlignmentGuideColor"),S.lineWidth=1,z._xAlignmentGuide.forEach(function(i){var j=i.p*t+w;S.moveTo(j,0),S.lineTo(j,g)}),z._yAlignmentGuide.forEach(function(f){var W=f.p*t+U;S.moveTo(0,W),S.lineTo(F,W)}),S.stroke()},zm.prototype.drawGrid=function(){function j(A,y,t,w){var l=Tm.toScreenPosition(G,z.apply({x:A,y:y})),s=Tm.toScreenPosition(G,z.apply({x:t,y:w}));v.moveTo(l.x,l.y),v.lineTo(s.x,s.y)}var M=this,R=M._interactor,P=M.gridBlockSize,U=M.gridThickLinesEvery,h=R.getStyle("gridThickColor"),m=R.getStyle("gridLightColor"),G=R.gv,H=R._canvas,v=R._context,Q=H.width,x=H.height,z=M.makeMatrix(),c=z.applyInverse(Tm.toWorldPosition(G,{x:0,y:0})),q=z.applyInverse(Tm.toWorldPosition(G,{x:Q,y:0})),t=z.applyInverse(Tm.toWorldPosition(G,{x:0,y:x})),X=z.applyInverse(Tm.toWorldPosition(G,{x:Q,y:x})),Z=Math.min(c.x,q.x,t.x,X.x),$=Math.max(c.x,q.x,t.x,X.x),J=Math.min(c.y,q.y,t.y,X.y),b=Math.max(c.y,q.y,t.y,X.y);Q=$-Z,x=b-J;var C=Math.ceil(Z/P),l=Math.floor($/P),B=Math.ceil(J/P),K=Math.floor(b/P);G.tx(),G.ty(),G._zoom;var W,u,i;for(v.save(),v.lineWidth=1,v.beginPath(),v.strokeStyle=h,i=Math.ceil(C/U)*U;l>=i;i+=U)W=i*P,j(W,J,W,b);for(i=Math.ceil(B/U)*U;K>=i;i+=U)u=i*P,j(Z,u,$,u);for(v.stroke(),v.beginPath(),v.strokeStyle=m,i=C;l>=i;i++)0!==i%U&&(W=i*P,j(W,J,W,b));for(i=B;K>=i;i++)0!==i%U&&(u=i*P,j(Z,u,$,u));v.stroke(),v.restore()},zm.prototype.getAlignmentGuides=function(){var e=this;return{x:e._xAlignmentGuide,y:e._yAlignmentGuide}},zm.prototype.addAlignmentGuide=function(T,u,N){var t=this,S="x"===T?t._xAlignmentGuide:t._yAlignmentGuide,N=N?N:++t._alignmentGuideId,I={p:u,id:N};if(S.length){var p=t._findClosestAlignmentGuide(I.p,S);p.dis<0?S.splice(p.index+1,0,I):S.splice(p.index,0,I)}else S.push(I);return t._interactor._42(),N},zm.prototype.findClosest=function(D,u,y){var j=this,_=j._interactor,Z=_.gv;y&&(D=Tm.toWorldPosition(Z,D));var C,K,w,X=1/0,A=1/0,O=D.x,f=D.y;if(j.gridEnabled){var M=j.gridBlockSize,P=j.makeMatrix(),H=P.applyInverse(D);H=P.apply({x:Math.round(H.x/M)*M,y:Math.round(H.y/M)*M}),X=H.x-O,A=H.y-f,w=!0}if(_.alignmentGuideEnabled&&(C=j._findClosestAlignmentGuide(O,j._xAlignmentGuide).dis,K=j._findClosestAlignmentGuide(f,j._yAlignmentGuide).dis,Math.abs(C)<Math.abs(X)&&(X=C,w=!0),Math.abs(K)<Math.abs(A)&&(A=K,w=!0)),w){w=!1;var U=Z._zoom,o=_.getStyle("smartGuideThreshold")/U,c={};if(Math.abs(X)<o&&"y"!==u&&(c.x=y?X*U:X,w=!0),Math.abs(A)<o&&"x"!==u&&(c.y=y?A*U:A,w=!0),w)return c}},zm.prototype._findClosestAlignmentGuide=function(Q,p){if(!p.length)return{dis:1/0};for(var C,u=0,s=p.length-1;s-u>1;)C=Math.floor((u+s)/2),p[C].p<Q?u=C:s=C;var b=p[u].p-Q,U=p[s].p-Q;return Math.abs(b)<=Math.abs(U)?{line:p[u],dis:b,index:u}:{line:p[s],dis:U,index:s}},zm.prototype.removeAllAlignmentGuide=function(b){var V=this;"y"!==b&&(V._xAlignmentGuide=[]),"x"!==b&&(V._yAlignmentGuide=[]),V._interactor._42()},zm.prototype.removeAlignmentGuide=function(V){for(var r,p,M,z=this,U=z._xAlignmentGuide,g=0;2>g;g++)for(U=0===g?z._xAlignmentGuide:z._yAlignmentGuide,r=0,p=U.length;p>r;r++)if(M=U[r],M.id===V)return U.splice(r,1),z._interactor._42(),{axis:0===g?"x":"y",position:M.p};return!1},zm.prototype.adjustAlignmentGuide=function(l,Q){var s=this,O=s.removeAlignmentGuide(l);return O?(s.addAlignmentGuide(O.axis,Q,l),!0):!1};var uj=Tm.Guide.Rect=function(g){var C=this;C._interactor=g};uj.prototype={},uj.prototype.constructor=uj,uj.prototype.gatherRects=function(){var U,q,e,m,A=this,B=A._interactor.gv,H=[],P=[],Z={x:H,y:P},z={},J=B.getDataModel(),o=J.a("width"),T=J.a("height");o&&T&&(U=0,q=0,e=o,m=T,H.push({node:J,type:0,p:U},{node:J,type:1,p:U+e/2},{node:J,type:2,p:U+e}),P.push({node:J,type:0,p:q},{node:J,type:1,p:q+m/2},{node:J,type:2,p:q+m}),z[J._id||0]={x:U,y:q,width:e,height:m}),J.each(function(G){if(Vm(G)&&!B.isSelected(G)&&B.isVisible(G)&&B.isValidGuideLineSource(G)){var u=!1;if(B.sm().getSelection().each(function(E){u||(G.isHostOn(E)?u=!0:G.isDescendantOf(E)&&(u=!0))}),!u){var N=G.getRect();U=N.x,q=N.y,e=N.width,m=N.height,H.push({node:G,type:0,p:U},{node:G,type:1,p:U+e/2},{node:G,type:2,p:U+e}),P.push({node:G,type:0,p:q},{node:G,type:1,p:q+m/2},{node:G,type:2,p:q+m}),z[G._id]=N}}}),H.sort(function(X,P){return X.p-P.p}),P.sort(function(x,X){return x.p-X.p}),A._grid=Z,A._87I=z},uj.prototype.gatherLines=function(a,J,I){var H,T,e,p,N,o,D,S,C,Q,l,y,q=this,W=[q.findClosest({x:a.x,y:a.y},J),q.findClosest({x:a.x+a.w/2,y:a.y+a.h/2},J),q.findClosest({x:a.x+a.w,y:a.y+a.h},J)],c={},x=q._87I;I=I||255;var U,Y;for(q._guideLine=[],H=0;2>H;H++)for(c={},0===H?(p="y",S=a.x,C=S+a.w):(p="x",S=a.y,C=S+a.h),T=0;3>T;T++)N=W[T],N&&isFinite(N[p])&&(U=1<<3*H+T,I&U&&(o=N[p+"Line"],D=o.node,Y=D._id||0,c[Y]||(c[Y]=!0,y=x[Y],"y"===p?(Q=y.x,l=y.x+y.width):(Q=y.y,l=y.y+y.height),e=o.p,q._guideLine.push({type:p,a:S,b:C,c:Q,d:l,p:e,center:1===o.type}))))},uj.prototype._binarySearchClosest=function(y,R){if(!R.length)return{dis:1/0};for(var D,Z=0,H=R.length-1;H-Z>1;)D=Math.floor((Z+H)/2),R[D].p<y?Z=D:H=D;var U=R[Z].p-y,B=R[H].p-y;return Math.abs(U)<=Math.abs(B)?{line:R[Z],dis:U}:{line:R[H],dis:B}},uj.prototype.findClosest=function(E,X,$){var v=this,V=v._interactor,d=V.gv,y=v._grid;$&&(E=Tm.toWorldPosition(d,E));var Y,k=v._binarySearchClosest(E.x,y.x),G=v._binarySearchClosest(E.y,y.y),I=k.dis,b=G.dis,M=d._zoom,D=V.getStyle("smartGuideThreshold")/M,_={};return Math.abs(I)<D&&"y"!==X&&(_.x=$?I*M:I,_.xLine=k.line,Y=!0),Math.abs(b)<D&&"x"!==X&&(_.y=$?b*M:b,_.yLine=G.line,Y=!0),Y?_:void 0},uj.prototype._42=function(){var Z=this,k=Z._guideLine;if(k&&!R.Default.isCtrlDown()){var M=Z._interactor;if(M.getStyle("guideLineVisible")){var W,x,Y,X,y,K,q,h,U,j,$,p,S,o,d,I,B,G=M.gv,w=M._context,V=G.tx(),f=G.ty(),c=G._zoom,L=M.getStyle("guideLineTextSpacing");for(W=0,x=k.length;x>W;W++)Y=k[W],h=Y.type,U=Y.p,j=Y.a,$=Y.b,p=Y.c,S=Y.d,o=Math.min(j,p),d=Math.max($,S),"x"===h?(X=U*c+V,y=o*c+f,K=X,q=d*c+f):(X=o*c+V,y=U*c+f,K=d*c+V,q=y),Tm.Icons.DrawIcon(M,w,Tm.Icons.MoveLineGuide,{rect:[X,y,K,q],center:Y.center}),S>=j&&$>=p||(o=j>S?S:$,d=j>S?j:p,B=d-o,"x"===h?(Y.center2center||(X-=L,K=X),y=o*c+f,q=d*c+f,I=Tm.Icons.MoveLineGuideDistanceV):"y"===h&&(Y.center2center||(y-=L,q=y),X=o*c+V,K=d*c+V,I=Tm.Icons.MoveLineGuideDistanceH),Tm.Icons.DrawIcon(M,w,I,{x0:X,y0:y,x1:K,y1:q,dis:B}))}}},uj.prototype.clear=function(){this._guideLine=null};var Jm=Tm.Guide.Hover=function(r){var H=this;H._interactor=r};Jm.prototype={},Jm.prototype.constructor=Jm,U.defineProperties(Jm.prototype,{}),Jm.prototype._42=function(){var F=this._interactor;if(F.getStyle("hoverGuideVisible")&&!F.gvEditing){var d=F.hoverData,x=F.gv;if(!Vm(d)||x.isSelected(d))return F.hoverData=null,void 0;var g=vg(x,d),z=Tm.toScreenPosition(x,{x:g.x,y:g.y}),O=Tm.toScreenPosition(x,{x:g.x+g.width,y:g.y+g.height});Tm.Icons.DrawIcon(F,F._context,Tm.Icons.HoverDataRect,{min:z,max:O,color:F.getStyle("hoverGuideColor")||F.getStyle("baseColor")})}},Tm.DefaultStyleMap={baseColor:"rgb(51,153,255)",pointSize:[24,9],checkSize:7,rotateCheckSize:10,moveSensitivity:10,moveDummyThreshold:32,moveDummyPosition:[0,0,-16,-16],moveDummyLineExtraShift:[-32,0],moveDummySensitivity:16,keepAspectRatio:!1,rotateRound:Math.PI/2,shiftRotateRound:Math.PI/12,rotateSensitivity:Math.PI/60,rotateAsClock:!1,shiftLineRotateRound:Math.PI/4,anchorMovable:!0,anchorVisible:!0,anchorHideThreshold:25,anchorOutsideVisibleThreshold:.25,anchorRound:.25,anchorSensitivity:.02,smartGuideThreshold:8,curveIntersectSize:5,curvePointIntersectSize:8,edgeHostDetectPerFrame:!0,edgeHostEdgeMaxDistance:12,edgeHostEdgeHighlighColor:"#5d5d5d",edgeHostPointHighlighColor:"red",edgeHostHighlighPeriod:1500,edgeElevationEditable:!1,attachThreshold:25,guideLineVisible:!0,guideLineTextSpacing:0,hoverGuideVisible:!1,hoverGuideColor:null,gridBlockSize:40,gridThickLinesEvery:10,gridThickColor:"#5d5d5d",gridLightColor:"#d0d0d0",gridZoomThreshold:.25,gridAlignmentGuideColor:"#ff0000",gridAngle:Math.PI/2,gridRotation:0,groupRotateModeDefault:"block",groupRotateModeKey:["ctrlKey","metaKey"],rotateCursorSize:32,rotateCursorRound:45,tipTextColor:"#ffffff",tipBackground:"#333333",curveHighlightColor:"#30599e",rectPointBackground:"white",rectPointBorderColor:"#666666",rectPointShadowColor:"rgba(0,0,0,0.35)",shapeCtrlPointBackground:"white",shapeCtrlPointBorderColor:null,shapeCtrlPointHighlightBorder:null,shapeHighlighPointBackground:"#30599e",curveElevationVisible:!0,curveElevationIntersectSize:8,curveElevationGuideShift:[20,0],curveTipVisible:!0,connectGuideVisible:!0,connectGuideShift:[1,.25,8,0],connectGuideIntersectSize:8,connectGuideGarbageIntersectsize:25,connectGuideGarbageShift:[1,1,-48,-48]};var Tr=Tm.Icons={},bk=1e4,Hj=null,Ri=Tm.DefaultStyleMap.baseColor,Fi="rgb(183,232,135)",tb="rgb(255,204,153)",Cr=6;R.Default.setImage("Icons.RectPoint",{width:Cr,height:Cr,comps:[{type:"rect",background:"rgb(247,247,247)",borderWidth:1,borderColor:{func:function(){return Ri}},rect:[0,0,Cr,Cr]}]}),Tr.GroupSubEntityRect={comps:[{type:"shape",points:{func:function(){var q=Tr.GroupSubEntityRect.data;if(!q)return[];var h=q.min,o=q.max;return[h.x,h.y,h.x,o.y,o.x,o.y,o.x,h.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return Tr.GroupSubEntityRect.data.isKeyOb?Ri:Ri}}}]};var Ac=4;Tr.HoverDataRect={comps:[{type:"shape",points:{func:function(){var N=Tr.HoverDataRect.data;if(!N)return[];var S=N.min,_=N.max,R=Ac;return S.x-=R,S.y-=R,_.x+=R,_.y+=R,[S.x,S.y,S.x,_.y,_.x,_.y,_.x,S.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return Tr.HoverDataRect.data.color}},borderCap:"round",borderPattern:[1,4]}]},Tr.Line={comps:[{type:"image",name:"Icons.RectPoint",rect:{func:function(){return[[Tr.Line.data.P1.x,Tr.Line.data.P1.y],Cr,Cr]}}},{type:"image",name:"Icons.RectPoint",rect:{func:function(){return[[Tr.Line.data.P2.x,Tr.Line.data.P2.y],Cr,Cr]}}}]},Tr.NodeHoverGuide={comps:[{type:"shape",points:{func:function(){return Tr.NodeHoverGuide.data}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:"#3399FF"}]},Tr.Rect={comps:[{type:"shape",points:{func:function(){var f=Tr.Rect.data;if(!f)return[];var E=f.LT,B=f.LB,M=f.RB,e=f.RT;return[E.x,E.y,B.x,B.y,M.x,M.y,e.x,e.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return Ri}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Tr.Rect.data.rotation}},rect:{func:function(){return[[Tr.Rect.data.LT.x,Tr.Rect.data.LT.y],Cr,Cr]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Tr.Rect.data.rotation}},rect:{func:function(){return[[Tr.Rect.data.LB.x,Tr.Rect.data.LB.y],Cr,Cr]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Tr.Rect.data.rotation}},rect:{func:function(){return[[Tr.Rect.data.RB.x,Tr.Rect.data.RB.y],Cr,Cr]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Tr.Rect.data.rotation}},rect:{func:function(){return[[Tr.Rect.data.RT.x,Tr.Rect.data.RT.y],Cr,Cr]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Tr.Rect.data.rotation}},visible:{func:function(){return Tr.Rect.data.L?!0:!1}},rect:{func:function(){return[[Tr.Rect.data.L.x,Tr.Rect.data.L.y],Cr,Cr]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Tr.Rect.data.rotation}},visible:{func:function(){return Tr.Rect.data.R?!0:!1}},rect:{func:function(){return[[Tr.Rect.data.R.x,Tr.Rect.data.R.y],Cr,Cr]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Tr.Rect.data.rotation}},visible:{func:function(){return Tr.Rect.data.T?!0:!1}},rect:{func:function(){return[[Tr.Rect.data.T.x,Tr.Rect.data.T.y],Cr,Cr]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Tr.Rect.data.rotation}},visible:{func:function(){return Tr.Rect.data.B?!0:!1}},rect:{func:function(){return[[Tr.Rect.data.B.x,Tr.Rect.data.B.y],Cr,Cr]}}}]};var jn=16;R.Default.setImage("Icons.Anchor",{width:12,height:12,comps:[{type:"shape",borderWidth:1,borderColor:{func:function(){return Ri}},borderCap:"round",shadowColor:"#1ABC9C",points:[.50928,6,11.49072,6,6,6,6,.50928,6,11.49072]},{type:"circle",borderWidth:1,borderColor:{func:function(){return Ri}},shadowColor:"#1ABC9C",rect:[2.84391,2.84391,6.53697,6.53697]}]}),Tr.Anchor={comps:[{type:"image",name:"Icons.Anchor",rect:{func:function(){return[[Tr.Anchor.data.POS.x,Tr.Anchor.data.POS.y],jn,jn]}}}]},Tr.TipShiftX=12,Tr.TipShiftY=12;var ub=[8,28];Tr.TipHelper={comps:[{type:"roundRect",rect:{func:function(){return[Tr.TipHelper.data.helperPos.x,Tr.TipHelper.data.helperPos.y,ub[0]*Tr.TipHelper.data.size,ub[1]]}},background:{func:function(){return Hj.getStyle("tipBackground")}},opacity:.6},{type:"text",text:{func:function(){return Tr.TipHelper.data.text}},rect:{func:function(){return[Tr.TipHelper.data.helperPos.x,Tr.TipHelper.data.helperPos.y,ub[0]*Tr.TipHelper.data.size,ub[1]]}},color:{func:function(){return Hj.getStyle("tipTextColor")}},font:"bold 12px Arial",align:"center"}]};var Sk=7;Tr.ShapePoint={comps:[{type:"circle",visible:{func:function(){return!!Tr.ShapePoint.data.dynamicVisible}},rect:{func:function(){var W=Tr.ShapePoint.data.point,i=Tr.ShapePoint.data.size||Sk;return[W,i+10,i+10]}},background:{func:function(){var R=Date.now(),G=Tr.ShapePoint.data.dynamicPeriod||1500,c=Math.sin(R%G/G*Math.PI);return"rgba(27,124,22,"+.5*c+")"}},borderWidth:0},{type:"circle",rect:{func:function(){var u=Tr.ShapePoint.data.point,d=Tr.ShapePoint.data.size||Sk;return[u,d,d]}},background:{func:function(){var g=Tr.ShapePoint.data.isEnd;return g?"rgba(27,124,222,0.7)":"#ffffff"}},borderWidth:1,borderColor:{func:function(){return Tr.ShapePoint.data.color||Ri}}},{type:"rect",visible:{func:function(){return!!Tr.ShapePoint.data.dynamicVisible}},background:"red",borderWidth:0,rotation:Math.PI/4,borderColor:{func:function(){return Ri}},rect:{func:function(){var f=5;return[Tr.ShapePoint.data.point,f,f]}}}]},Tr.ShapeBgCurve={comps:[{type:"shape",visible:{func:function(){return!!Tr.ShapeBgCurve.data.dynamicVisible}},points:{func:function(){return Tr.ShapeBgCurve.data.P}},segments:{func:function(){return Tr.ShapeBgCurve.data.S}},background:null,borderWidth:6,borderColor:{func:function(){var _=Date.now(),H=Tr.ShapeBgCurve.data.dynamicPeriod||1500,c=Math.sin(_%H/H*Math.PI);return"rgba(27,124,22,"+.3*c+")"}}},{type:"shape",points:{func:function(){return Tr.ShapeBgCurve.data.P}},segments:{func:function(){return Tr.ShapeBgCurve.data.S}},background:null,borderWidth:1,borderColor:{func:function(){return Tr.ShapeBgCurve.data.color||Ri}}}]};var Kc=8;Tr.ShapeHighlighPoint={comps:[{type:"circle",rect:{func:function(){var g=Tr.ShapeHighlighPoint.data;return[[g.x,g.y],Kc,Kc]}},background:{func:function(){return Hj.getStyle("shapeHighlighPointBackground")}},borderWidth:0}]};var In=10;Tr.ShapeHighlighRealPoint={comps:[{type:"circle",rect:{func:function(){var n=Tr.ShapeHighlighRealPoint.data;return[[n.x,n.y],In,In]}},background:"#ffffff",borderWidth:2,borderColor:{func:function(){return Ri}}}]};var as=8;Tr.ShapeHighlighCtrlPoint={comps:[{type:"shape",points:{func:function(){var V=Tr.ShapeHighlighCtrlPoint.data,L=V.x,$=V.y,z=as/2;return[L-z,$-z,L-z,$+z,L+z,$+z,L+z,$-z]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return Hj.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return Hj.getStyle("shapeCtrlPointBorderColor")||Ri}}}]};var we=3;Tr.ShapeHighlightCurve={comps:[{type:"shape",points:{func:function(){return Tr.ShapeHighlightCurve.data}},segments:[1,4],background:null,borderWidth:we,borderColor:{func:function(){return Hj.getStyle("curveHighlightColor")}}}]},Tr.ShapeGuideLine={comps:[{type:"shape",points:{func:function(){return Tr.ShapeGuideLine.data}},background:null,borderWidth:1,borderColor:"rgb(255,204,153)"}]},Tr.MoveLineGuide={comps:[{type:"shape",points:{func:function(){return Tr.MoveLineGuide.data.rect}},background:null,borderWidth:1,borderColor:{func:function(){return Tr.MoveLineGuide.data.center?Fi:tb}}}]};var es=5;Tr.MoveLineGuideDistanceH={comps:[{type:"shape",points:{func:function(){var o=Tr.MoveLineGuideDistanceH.data,n=o.x0,T=o.y0;return[n,T-es,n,T+es]}},rotation:-Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:tb},{type:"shape",points:{func:function(){var L=Tr.MoveLineGuideDistanceH.data,I=L.x1,W=L.y1;return[I,W-es,I,W+es]}},rotation:-Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:tb},{type:"text",text:{func:function(){return Math.round(Tr.MoveLineGuideDistanceH.data.dis)}},rect:{func:function(){var R=Tr.MoveLineGuideDistanceH.data;return[[(R.x0+R.x1)/2,R.y0-10],20,20]}},color:tb,font:"12px Arial",align:"center"}]},Tr.MoveLineGuideDistanceV={comps:[{type:"shape",points:{func:function(){var r=Tr.MoveLineGuideDistanceV.data,K=r.x0,N=r.y0;return[K-es,N,K+es,N]}},rotation:Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:tb},{type:"shape",points:{func:function(){var y=Tr.MoveLineGuideDistanceV.data,T=y.x1,B=y.y1;return[T-es,B,T+es,B]}},rotation:Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:tb},{type:"text",text:{func:function(){return Math.round(Tr.MoveLineGuideDistanceV.data.dis)}},rect:{func:function(){var e=Tr.MoveLineGuideDistanceV.data;return[[e.x0-10,(e.y0+e.y1)/2],20,20]}},color:tb,font:"12px Arial",align:"center"}]},R.Default.setImage("Icons.EdgeElevationGuideImage",{width:16,height:16,comps:[{type:"oval",background:"rgb(255,255,255)",borderWidth:1,borderColor:"rgb(138,138,138)",rect:[.5,.5,15,15]},{type:"shape",borderWidth:2,borderColor:"rgb(44,44,44)",borderCap:"round",points:[4,8,8,4,12,8,8,4,8,13],segments:[1,2,2,1,2]}]}),Tr.EdgeElevationGuide={comps:[{type:"image",name:"Icons.EdgeElevationGuideImage",rect:{func:function(){var F=Tr.EdgeElevationGuide.data,m=F.x,A=F.y,c=Hj.getStyle("curveElevationIntersectSize"),L=Hj.getStyle("curveElevationGuideShift");return m+=L[0],A+=L[1],[m-c,A-c,2*c,2*c]}}}]},R.Default.setImage("Icons.ConnectGuideBgImage",{width:12,height:12,comps:[{type:"shape",background:"#3399ff",fillRule:"evenodd",shadowColor:"#1ABC9C",rotation:3.14159,points:[6.00001,11.99999,6.00001,11.99999,2.6863,11.99999,1e-5,9.30695,1e-5,5.99999,1e-5,5.99999,1e-5,2.68628,2.69305,-1e-5,6.00001,-1e-5,12.00001,-1e-5,11.99998,12.00001,6.00001,11.99999],segments:[1,2,4,2,4,2,2,2]}]}),R.Default.setImage("Icons.ConnectGuideHeaderImage",{width:12,height:12,comps:[{type:"oval",background:"#3399FF",borderColor:"#3399FF",shadowColor:"#1ABC9C",rect:[0,0,12,12]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[4.76,2.56,8.2,5.98,4.76,9.44]}]}),Tr.ConnectGuide={comps:[{type:"image",name:"Icons.ConnectGuideBgImage",rotation:{func:function(){return Tr.ConnectGuide.data.rotation}},rect:{func:function(){var $=Tr.ConnectGuide.data.connect;$.x,$.y;var b=Hj.getStyle("connectGuideIntersectSize");return[[$.x,$.y],2*b,2*b]}}},{type:"image",name:"Icons.ConnectGuideHeaderImage",rect:{func:function(){var L=Tr.ConnectGuide.data.cursorPos||Tr.ConnectGuide.data.connect,M=Hj.getStyle("connectGuideIntersectSize");return[[L.x,L.y],2*M-2,2*M-2]}}},{type:"shape",background:null,borderColor:"#3399ff",borderWidth:2,segments:[1,4],points:{func:function(){var f=Tr.ConnectGuide.data.connect,X=Tr.ConnectGuide.data.cursorPos||f;return[f.x,f.y,f.x+.5*(X.x-f.x),f.y,X.x+.5*(f.x-X.x),X.y,X.x,X.y]}}}]},R.Default.setImage("Icons.ConnectGuideGarbageImage",{width:48,height:48,comps:[{type:"oval",background:"rgba(0,0,0,0.1)",borderColor:"#979797",shadowColor:"#1ABC9C",rect:[0,0,48,48]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[19.84721,19.69091,19.84721,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[24.10371,19.69091,24.10371,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[28.15279,19.69091,28.15279,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[11.23055,15.22377,36.76945,15.189,19.12302,15.17121,20.94722,11.5228,26.41985,11.5228,28.24406,15.17121]},{type:"rect",borderWidth:2,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[15.48702,15.22377,17.02595,21.25344]}]}),R.Default.setImage("Icons.ConnectGuideDeletingImage",{width:56,height:56,comps:[{type:"oval",background:"rgba(232,0,0,0.75)",borderColor:"#979797",shadowColor:"#1ABC9C",rect:[0,0,56,56]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[22.67939,27.69091,22.67939,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[26.93588,27.69091,26.93588,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[30.98497,27.69091,30.98497,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",anchorX:0,anchorY:1,rotation:5.65062,points:[14.06272,23.22377,39.60163,23.189,21.9552,23.17121,23.7794,19.5228,29.25203,19.5228,31.07623,23.17121]},{type:"rect",borderWidth:2,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[18.3192,23.22377,17.02595,21.25344]}]}),Tr.ConnectGuideGarbage={comps:[{type:"image",name:{func:function(){var d=Tr.ConnectGuideGarbage.data.hover;
return d?"Icons.ConnectGuideDeletingImage":"Icons.ConnectGuideGarbageImage"}},rect:{func:function(){var _=Tr.ConnectGuideGarbage.data,G=Hj.getStyle("connectGuideGarbageIntersectsize");return _.hover&&(G+=5),[[_.x,_.y],2*G,2*G]}}}]};var Bp=6;Tr.ShapeActivingCtrl={comps:[{type:"shape",visible:{func:function(){return Tr.ShapeActivingCtrl.data.c1?!0:!1}},points:{func:function(){var K=Tr.ShapeActivingCtrl.data;return[K.point.x,K.point.y,K.c1.x,K.c1.y]}},segments:[1,2],background:null,borderWidth:1,borderColor:{func:function(){return Ri}}},{type:"shape",visible:{func:function(){return Tr.ShapeActivingCtrl.data.c2?!0:!1}},points:{func:function(){var G=Tr.ShapeActivingCtrl.data;return[G.point.x,G.point.y,G.c2.x,G.c2.y]}},segments:[1,2],background:null,borderWidth:1,borderColor:{func:function(){return Ri}}},{type:"shape",visible:{func:function(){return Tr.ShapeActivingCtrl.data.c1?!0:!1}},points:{func:function(){var $=Tr.ShapeActivingCtrl.data.c1,e=$.x,q=$.y,D=Bp/2;return"c1"===Tr.ShapeActivingCtrl.data.hl&&(D+=.5),[e-D,q-D,e-D,q+D,e+D,q+D,e+D,q-D]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return Hj.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return"c1"===Tr.ShapeActivingCtrl.data.hl?Hj.getStyle("shapeCtrlPointHighlightBorder")||Ri:Hj.getStyle("shapeCtrlPointBorderColor")||Ri}}},{type:"shape",visible:{func:function(){return Tr.ShapeActivingCtrl.data.c2?!0:!1}},points:{func:function(){var P=Tr.ShapeActivingCtrl.data.c2,e=P.x,H=P.y,m=Bp/2;return"c2"===Tr.ShapeActivingCtrl.data.hl&&(m+=.5),[e-m,H-m,e-m,H+m,e+m,H+m,e+m,H-m]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return Hj.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return"c2"===Tr.ShapeActivingCtrl.data.hl?Hj.getStyle("shapeCtrlPointHighlightBorder")||Ri:Hj.getStyle("shapeCtrlPointBorderColor")||Ri}}}]},Tr.RoundPoint={comps:[{type:"circle",background:"rgb(247,247,247)",borderWidth:1,borderColor:{func:function(){return Ri}},rect:{func:function(){return[[Tr.RoundPoint.data.x,Tr.RoundPoint.data.y],Cr,Cr]}}}]},Tr.AttachPoint={comps:[{type:"rect",background:{func:function(){return Tr.AttachPoint.data.isAttach?"rgb(51,153,255)":"rgb(247,247,247)"}},borderWidth:1,rotation:Math.PI/4,borderColor:{func:function(){return Ri}},rect:{func:function(){var z=Tr.AttachPoint.data.isAttach?Cr+4:Cr;return[[Tr.AttachPoint.data.x,Tr.AttachPoint.data.y],z,z]}}}]},Tr.SimpleRect={comps:[{type:"rect",background:null,borderWidth:{func:function(){return Tr.SimpleRect.data.borderWidth||1}},borderColor:{func:function(){return Tr.SimpleRect.data.color||Ri}},rect:{func:function(){var u=Tr.SimpleRect.data;return[u.x,u.y,u.width,u.height]}}}]},R.Default.setImage("Icons.MoveDummyImage",{width:32,height:32,boundExtend:12,attachStyle:"close",comps:[{type:"oval",background:"rgb(255,255,255)",borderColor:"#979797",shadow:!0,shadowColor:"rgba(0,0,0,0.25)",shadowOffsetX:0,rect:[0,0,32,32]},{type:"shape",background:"rgb(51,153,255)",pixelPerfect:!0,points:[8.65079,11.90713,9.05502,11.46921,9.70629,11.46921,10.11052,11.90713,10.51476,12.28891,10.51476,12.92895,10.11052,13.34441,8.49359,14.97258,12.2889,14.97258,12.85034,14.97258,13.29949,15.42172,13.29949,15.99439,13.29949,16.57828,12.85034,17.0162,12.2889,17.0162,8.49359,17.0162,10.11052,18.6556,10.51476,19.0486,10.51476,19.7111,10.11052,20.09288,9.70629,20.50834,9.05502,20.50834,8.65079,20.09288,5.32709,16.76917,5.28217,16.71303,4.87794,16.32002,4.87794,15.67998,5.28217,15.26452,8.65079,11.90713,8.65079,11.90713,8.65079,11.90713,13.3444,10.09931,13.3444,10.09931,12.94017,10.50354,12.2889,10.50354,11.88467,10.09931,11.48043,9.69507,11.48043,9.0438,11.88467,8.63957,15.27574,5.25973,15.66874,4.86672,16.32001,4.86672,16.73547,5.25973,16.76917,5.31586,20.10409,8.63957,20.50832,9.0438,20.50832,9.68385,20.10409,10.09931,19.69986,10.49231,19.07105,10.50354,18.64436,10.09931,17.02742,8.45991,17.02742,12.26646,17.02742,12.83912,16.55581,13.31072,15.99438,13.31072,15.43295,13.31072,14.98379,12.83912,14.98379,12.26646,14.96134,8.45991,13.3444,10.09931,13.3444,10.09931,13.3444,10.09931,21.90069,13.33318,21.90069,13.33318,21.49646,12.91771,21.49646,12.27768,21.90069,11.89591,22.31615,11.45798,22.94497,11.45798,23.36043,11.89591,26.72904,15.2533,27.12205,15.66876,27.12205,16.3088,26.72904,16.7018,26.6729,16.75794,23.36043,20.08165,22.94497,20.49711,22.31615,20.49711,21.90069,20.08165,21.49646,19.69987,21.49646,19.03737,21.90069,18.64437,23.51763,17.00498,19.72231,17.00498,19.14965,17.00498,18.71173,16.56705,18.71173,15.98316,18.71173,15.41049,19.14965,14.96135,19.72231,14.96135,23.51763,14.96135,21.90069,13.33318,21.90069,13.33318,21.90069,13.33318,11.88467,23.32675,11.88467,23.32675,11.48043,22.94498,11.48043,22.27125,11.88467,21.88948,12.2889,21.48523,12.94017,21.48523,13.3444,21.88948,14.96134,23.52887,14.98379,19.7111,14.98379,19.14966,15.43295,18.67805,15.99438,18.67805,16.55581,18.67805,17.02742,19.14966,17.02742,19.7111,17.02742,23.52887,18.64436,21.88948,19.07105,21.48523,19.69986,21.48523,20.10409,21.88948,20.50832,22.27125,20.50832,22.94498,20.10409,23.32675,16.76917,26.65045,16.73547,26.72905,16.32001,27.13329,15.66874,27.13329,15.27574,26.72905,11.88467,23.32675,11.88467,23.32675,11.88467,23.32675],segments:[1,4,4,2,2,4,4,2,2,4,4,2,2,4,2,2,2,1,2,4,4,2,4,2,2,4,4,2,2,4,4,2,2,2,2,1,2,4,4,2,4,2,2,4,4,2,2,4,4,2,2,2,2,1,2,4,4,2,2,4,4,2,2,4,4,2,2,4,2,2,2]}]}),Tr.MoveDummy={comps:[{type:"image",name:"Icons.MoveDummyImage",rect:{func:function(){var E=Tr.MoveDummy.data;return[[E.pos.x,E.pos.y],2*E.size,2*E.size]}}}]},Tm.Icons.DrawIcon=function(h,A,i,q){i.width=i.height=bk,i.data=q,Hj=h,R.Default.drawImage(A,i,0,0,bk,bk)},Tm.Icons.MapPoints=function(G,g){for(var b=0,f=G.length;f>b;b++)G[b]/=g},Tm.roundTo=function(z,U,E){var g=Math.abs(z%U);return E>g||E>U-g?U*Math.round(z/U):z},Tm.toFixed=function(C){return Math.round(100*C)/100},Tm.getDataMatrix=function(l){if(l instanceof R.Shape){var F=new R.Math.Matrix2d,Y=l.getPosition();return F.translate(-Y.x,-Y.y).scale(l.getScale().x,l.getScale().y).rotate(l.getRotation()).translate(Y.x,Y.y),F}return l.getMatrix?l.getMatrix():new R.Math.Matrix2d};var kl=Tm.Math.Curve=function(){this._curves=[]};kl.prototype={},kl.prototype.constructor=kl,kl.prototype.createFromHtShape=function(p,z,G){z instanceof R.List&&(z=z.toArray());var W,Z,y,r,n,N,M,E=this,w=null,P=null,K=0,X=Tm.Math.Vector2,b=Tm.Math.CubicBezier,V=function(P){return new X(p[P],p[P+1],G?G[P/2]:x)};for(Z=0,y=z.length;y>Z;Z++){switch(r=z[Z],n=null,r){case 1:P=V(K),w=P,K+=2;break;case 2:W=V(K),K+=2,n=new b(P,P.clone(),W.clone(),W),P=W;break;case 3:N=V(K),W=V(K+2),K+=4,n=new b(P,N.clone().sub(P).multiplyScalar(2/3).add(P),N.clone().sub(W).multiplyScalar(2/3).add(W),W),P=W;break;case 4:N=V(K),M=V(K+2),W=V(K+4),K+=6,n=new b(P,N,M,W),P=W;break;case 5:if(!w)break;n=new b(P,P.clone(),w.clone(),w),P=null,w=null}n&&(n._index=E._curves.length,E._curves.push(n))}},kl.prototype.checkPoint=function(A,t){var T,z,h,Z,G,B=this,l=B._curves;for(T=0,z=l.length;z>T;T++)if(Z=l[T],G=Z.intersectRect(A,t,t),G.length)return h=0,G.forEach(function(k){h+=k.t}),h/=G.length,A=Z.getPointAt(h),A.t=h,{bezier:Z,intersection:A}},kl.prototype.insertKnot=function(g,m){var P=g.insertKnot(m),s=this,w=s._curves;w.splice(g._index,1,P[0],P[1])},kl.prototype._isCloseEnough=function(D,c){return Math.abs(D.x-c.x)<1e-6&&Math.abs(D.y-c.y)<1e-6},kl.prototype._isSamePoint=function(t,v){return t===v},kl.prototype.moveRealPoint=function(k,w){var O=this,t=O._curves,x=w.clone().sub(k);t.forEach(function(W){var n=W._p1;W._p2,W._p3;var S=W._p4;O._isSamePoint(n,k)&&(W._p2.add(x),W._p1=w),O._isSamePoint(S,k)&&(W._p3.add(x),W._p4=w)})},kl.prototype.moveCtrlDueToRealPointMovement=function(v,g){var E=this,u=E._curves,b=function(q){q.add(g),q.e&&g.e&&(q.e+=g.e)};u.forEach(function(W){var x=W._p1;W._p2,W._p3;var d=W._p4;E._isSamePoint(x,v)&&b(W._p2),E._isSamePoint(d,v)&&b(W._p3)})},kl.prototype.moveCtrlPoint=function(v,l,D){var b=v[D];if(b){b.e!==x&&(l.e=b.e);var t=this,Q=t._curves;l.clone().sub(b),Q.forEach(function(n){var f;"c2"===D?f="_p2":"c1"===D&&(f="_p3"),t._isSamePoint(n[f],b)&&(n[f]=l)}),v[D]=l}},kl.prototype.deleteRealPoint=function(Z,D){var z,U,$,t,F,d,j,v=this,T=v._curves,h={},p=[],V=Tm.Math.CubicBezier;for(U=0,$=T.length;$>U;U++)z=T[U],t=z._p1,F=z._p2,d=z._p3,j=z._p4,(h[U]||!v._isSamePoint(t,Z))&&(v._isSamePoint(j,Z)?$>U+1&&v._isSamePoint(T[U+1]._p1,Z)&&(D||p.push(new V(t,F,T[U+1]._p3,T[U+1]._p4))):p.push(z));v._curves=p},kl.prototype.findPairs=function(j,M){var X,w,f,h,U,I,K,b,v=this,C=v._curves,o={},z=[];for(w=0,f=C.length;f>w;w++)X=C[w],h=X._p1,U=X._p2,I=X._p3,K=X._p4,!o[w]&&v._isSamePoint(h,j)&&(M?z.push({point:h,r2:K}):z.push({point:h,c2:U})),v._isSamePoint(K,j)&&(b=M?{point:K,r1:h}:{point:K,c1:I},f>w+1&&v._isSamePoint(C[w+1]._p1,j)&&(M?b.r2=C[w+1]._p4:b.c2=C[w+1]._p2,o[w+1]=!0),z.push(b));return z},kl.prototype.toHtShape=function(){var e=this,t=e._curves,D=[],b=[],S={x:1/0,y:1/0};return t.forEach(function(r){var N=r._p1,w=r._p2,m=r._p3,Q=r._p4;return e._isCloseEnough(N,S)||(D.push(1),b.push(N.clone())),S=Q,e._isCloseEnough(N,w)&&e._isCloseEnough(m,Q)?(D.push(2),b.push(Q.clone()),void 0):(D.push(4),b.push(w.clone(),m.clone(),Q.clone()),void 0)}),{segments:D,points:b}};var nc=Tm.Math.CubicBezier=function(o,t,C,k){var S=this;S._id=Tm.Math.CubicBezier._globalId++,S._p1=o,S._p2=t,S._p3=C,S._p4=k};nc._globalId=1,nc.prototype={},nc.prototype.constructor=nc,nc.prototype.toString=function(){return this._id},nc.prototype.intersectRect=function(A,$,o){var Z=$/2,t=o/2,Q=A.x,d=A.y,L=Tm.Math.Vector2,B=new L(-Z+Q,-t+d),l=new L(Z+Q,t+d),u=new L(l.x,B.y),Y=new L(B.x,l.y),O=this,w=O.intersectLine(B,u),g=O.intersectLine(u,l),z=O.intersectLine(l,Y),V=O.intersectLine(Y,B),E=w.concat(g).concat(z).concat(V);return E},nc.prototype.intersectLine=function(i,k){var K,w,y,q,z,J,e,p,R,N,V,d,G,g=this,Z=i.clone().min(k),B=i.clone().max(k);q=g._p1,z=g._p2,J=g._p3,e=g._p4,K=q.clone().multiplyScalar(-1),w=z.clone().multiplyScalar(3),y=J.clone().multiplyScalar(-3),V=K.add(w).add(y).add(e),K=q.clone().multiplyScalar(3),w=z.clone().multiplyScalar(-6),y=J.clone().multiplyScalar(3),N=K.add(w).add(y),K=q.clone().multiplyScalar(-3),w=z.clone().multiplyScalar(3),R=K.add(w),p=q.clone(),G=new Tm.Math.Vector2(i.y-k.y,k.x-i.x),d=i.x*k.y-k.x*i.y;for(var T=g.getRoots(G.dot(V),G.dot(N),G.dot(R),G.dot(p)+d),h=new Array,m=0,b=T.length;b>m;m++){var $=T[m];if(!(0>$||$>1)){var u=q.clone().lerp(z,$),D=z.clone().lerp(J,$),x=J.clone().lerp(e,$),a=u.lerp(D,$),E=D.lerp(x,$),f=a.lerp(E,$);f.t=$,i.x==k.x?Z.y<=f.y&&f.y<=B.y&&h.push(f):i.y==k.y?Z.x<=f.x&&f.x<=B.x&&h.push(f):f.x>=Z.x&&f.y>=Z.y&&f.x<=B.x&&f.y<=B.y&&h.push(f)}}return h},nc.prototype.solveTForPoint=function(A){var J,c,u,O,b=this;J=b._p1.x-A.x,c=b._p2.x-A.x,u=b._p3.x-A.x,O=b._p4.x-A.x;for(var B=b.getRoots(O-3*u+3*c-J,3*u-6*c+3*J,3*c-3*J,J),p=x,X=1/0,Y=0,o=B.length;o>Y;Y++){var r=B[Y];if(!(0>r||r>1)){var N=b._p1.clone().lerp(b._p2,r),C=b._p2.clone().lerp(b._p3,r),M=b._p3.clone().lerp(b._p4,r),q=N.lerp(C,r),w=C.lerp(M,r),F=q.lerp(w,r);F.t=r;var _=Math.abs(F.y-A.y);X>_&&(X=_,p=F)}}return p},nc.prototype.getPointAt=function(q){var n=this,r=n._p1,Y=n._p2,F=n._p3,B=n._p4,W=r.clone().lerp(Y,q),G=Y.clone().lerp(F,q),i=F.clone().lerp(B,q),m=W.lerp(G,q),s=G.lerp(i,q);return m.lerp(s,q)},nc.prototype.getRoots=function(I,k,L,B){var j,h,K,a,D,U=new Array;if(Math.abs(I)<1e-6){var j=k,h=L/j,K=B/j,a=h*h-4*K;if(a>0){var D=Math.sqrt(a);U.push(.5*(-h+D)),U.push(.5*(-h-D))}else 0==a&&U.push(.5*-h)}k/=I,L/=I,B/=I,j=(3*L-k*k)/3,h=(2*k*k*k-9*L*k+27*B)/27;var R=k/3,O=h*h/4+j*j*j/27,d=h/2;if(Math.abs(O)<=1e-6&&(O=0),O>0){var V,v,D=Math.sqrt(O);V=-d+D,v=V>=0?Math.pow(V,1/3):-Math.pow(-V,1/3),V=-d-D,V>=0?v+=Math.pow(V,1/3):v-=Math.pow(-V,1/3),U.push(v-R)}else if(0>O){var z=Math.sqrt(-j/3),M=Math.atan2(Math.sqrt(-O),-d)/3,g=Math.cos(M),c=Math.sin(M),Z=Math.sqrt(3);U.push(2*z*g-R),U.push(-z*(g+Z*c)-R),U.push(-z*(g-Z*c)-R)}else{var V;V=d>=0?-Math.pow(d,1/3):Math.pow(-d,1/3),U.push(2*V-R),U.push(-V-R)}return U},nc.prototype._70I=function(){var i=this;return i._p1.distanceToSquared(i._p2)<1e-10&&i._p3.distanceToSquared(i._p4)<1e-10},nc.prototype.insertKnot=function(e){var r=this,c=r._p1,M=r._p2,p=r._p3,n=r._p4,l=c.clone().lerp(M,e),t=M.clone().lerp(p,e),G=p.clone().lerp(n,e),i=l.clone().lerp(t,e),E=t.clone().lerp(G,e),z=i.clone().lerp(E,e);return r._70I()?(c.clone().lerp(n,e),[new Tm.Math.CubicBezier(c,c.clone(),z.clone(),z),new Tm.Math.CubicBezier(z,z.clone(),n.clone(),n)]):[new Tm.Math.CubicBezier(c,l,i,z),new Tm.Math.CubicBezier(z,E,G,n)]};var Pj=R.Default.getInternal().ui().EdgeUI,zc={_47O:function(Z){var v=this,w=zc.getBackups()._47O;Tm.inEdit(v.gv)||w.call(v,Z)}};Tm.Inject.registAsModule(zc,Pj);var Bo=R.Default.getInternal().ui().NodeUI,Lj={_47O:function(I){var o=this,$=Lj.getBackups()._47O;Tm.inEdit(o.gv)||$.call(o,I)},getSelectWidth:function(){var c=this,i=c.gv,l=c._data;if(i.isEditable(l)&&Tm.inEdit(i))return 0;var k=Lj.getBackup("getSelectWidth");return k.call(c)}};Tm.Inject.registAsModule(Lj,Bo);var Rk=R.graph.GraphView,So={_editPointSize:function(){var A=R.Default.isTouchable,G=Tm.getStyle("pointSize");return G[A?0:1]}(),isPointEditable:function(u){var k=this;if(Tm.inEdit(k))return k._pointEditableFunc?k._pointEditableFunc(u):!0;var Y=So.getBackup("isPointEditable");Y.call(k,u)},isEditable:function(t){var d,x=this,Z=So.getBackup("isEditable");if(d=t instanceof Tm.Group?!0:Z.call(x,t),!Tm.inEdit(x))return d;if(!(t instanceof R.Edge))return d;if(!t.s("2d.editable"))return!1;var f=x.getEditableFunc();return f?f(t):!0},_42:function(X,u){var z=this,e=So.getBackups()._42;if(e.call(z,X,u),Tm.inEdit(z)){var R=z.getEditInteractor();R.drawImpl()}}};Tm.Inject.registAsModule(So,Rk);var Nk=R.Default.getInternal().ui().ShapeUI,Xq={_47O:function(A){var j=this,C=Xq.getBackups()._47O;Tm.inEdit(j.gv)||C.call(j,A)}};Tm.Inject.registAsModule(Xq,Nk);var pb=R.graph.DefaultInteractor,rg={handle_mousewheel:function(F){var X=this,O=rg.getBackup("handle_mousewheel");Tm.inEdit(X.gv)||O.call(X,F)}};Tm.Inject.registAsModule(rg,pb);var Yc=R.graph.MoveInteractor,Kp={_calcShift:function(G,J){var Q=this,U=Kp.getBackup("_calcShift"),g=Q.gv;if(!Tm.inEdit(g))return U.call(Q,G,J);var A=g.getEditInteractor(),m=A.getSubModule("Move").calcShift(G,J,Q);return m||U.call(Q,G,J)},clear:function(y){var B=this,n=Kp.getBackup("clear");n.call(B,y);var d=B.gv;if(Tm.inEdit(d)){var w=d.getEditInteractor();w.getSubModule("Move").clear(y)}}};Tm.Inject.registAsModule(Kp,Yc);var uj=Tm.Rect=function(z){this.catalog="Rect",this._interactor=z};uj.prototype={},uj.prototype.constructor=uj,uj.prototype.gatherInfo=function(q,I){var s=this;if(1===I.length){var i=I[0];return i instanceof R.Shape&&i._70I()?s.gatherLine(q,i):Te(i,q)?!1:s.gatherSingleTarget(q,i)}return I.length>1?s.gatherMultiTargets(q,I):!1},uj.prototype.gatherSingleTarget=function(S,c){if(c.getCorners){var V,y=this,d=y.info;y.target=c,V=y.screenInfo={};var x=c.getCorners();d.LT=new Tm.Math.Vector2(x[0]),d.LB=new Tm.Math.Vector2(x[1]),d.RB=new Tm.Math.Vector2(x[2]),d.RT=new Tm.Math.Vector2(x[3]),d.T=d.LT.clone().add(d.RT).divideScalar(2),d.B=d.LB.clone().add(d.RB).divideScalar(2),d.L=d.LT.clone().add(d.LB).divideScalar(2),d.R=d.RT.clone().add(d.RB).divideScalar(2);for(var W in d)V[W]=Tm.toScreenPosition(S,d[W]);var r=y._interactor,A=r.getStyle("checkSize"),u=function(E,W,d){var z=W.clone().sub(E).setLength(-A),s=d.clone().sub(E).setLength(-A),l=z.add(s).add(E);return l};return V.rotLT=u(V.LT,V.RT,V.LB),V.rotLB=u(V.LB,V.LT,V.RB),V.rotRB=u(V.RB,V.LB,V.RT),V.rotRT=u(V.RT,V.LT,V.RB),V.rotT=V.rotLT.clone().add(V.rotRT).divideScalar(2),V.rotB=V.rotLB.clone().add(V.rotRB).divideScalar(2),V.rotL=V.rotLT.clone().add(V.rotLB).divideScalar(2),V.rotR=V.rotRT.clone().add(V.rotRB).divideScalar(2),V.rotation=c.getRotation(),y.gatherConnectInfo(),!0}},uj.prototype.gatherConnectInfo=function(){var E=this,j=E.target,U=E._interactor,P=E.screenInfo,q=U.gv;if(q.isConnectActionVisible(j)&&U.getStyle("connectGuideVisible")){var K;j.s&&(K=j.s("connectGuideShift")),K||(K=U.getStyle("connectGuideShift"));var d=j.getAnchor(),r=j.getSize(),k=j.toGlobal({x:r.width*(K[0]-d.x),y:r.height*(K[1]-d.y)});k=Tm.toScreenPosition(q,k),P.P1?k.add(P.P2.clone().sub(P.P1).setLength(K[2])):(k.add(P.RT.clone().sub(P.LT).setLength(K[2])),k.add(P.LB.clone().sub(P.LT).setLength(K[3]))),P.connect=k}},uj.prototype.gatherMultiTargets=function(b,S){var g=Tm.Group.findOrCreateGroup(S);if(!g)return!1;var U=this;return U.editing&&"rotate"!==U.editing.mode||g.calcInfo(),U.gatherSingleTarget(b,g)},uj.prototype.gatherLine=function(O,_){this.target=_;var j=this.screenInfo={},y=_.getPoints(),M=Tm.getDataMatrix(_);return j.P1=Tm.toScreenPosition(O,M.apply(y.get(0))),j.P2=Tm.toScreenPosition(O,M.apply(y.get(1))),this.gatherConnectInfo(),!0},uj.ResizeKeys=["LT","RB","LB","RT","L","R","B","T"],uj.ResizeDirection=[{x:-1,y:-1},{x:1,y:1},{x:-1,y:1},{x:1,y:-1},{x:-1,y:0},{x:1,y:0},{x:0,y:1},{x:0,y:-1}],uj.RotateKeys=["rotLT","rotRB","rotLB","rotRT","rotL","rotR","rotB","rotT"],uj.prototype.check=function(z,F,B){if(R.Default.isLeftButton(F)){var I=this;if(I.editing=null,I.tipInfo=null,I.screenInfo){var w=I.target,x=z.isEditable(w),Q=I.screenInfo;if(x&&Q.connect){var k=I._checkConnect(B);if(k)return k}if(Q.P1)return I._checkLine(B);var H,A,K,Z=null,q=I._interactor,T=q.getStyle("checkSize");if(x&&z.isRectEditable(w))for(A=0;A<Tm.Rect.ResizeKeys.length;A++)if(K=Tm.Rect.ResizeKeys[A],Tm.checkHit(B,Q[K],T)){Z=K,H="resize";break}if(!Z&&x&&z.isRotationEditable(w)&&!q.getStyle("rotateAsClock")){var y=q.getStyle("rotateCheckSize");for(A=0;A<Tm.Rect.RotateKeys.length;A++)if(K=Tm.Rect.RotateKeys[A],Tm.checkHit(B,Q[K],y)){Z=K,H="rotate";break}}if(!Z)return q.setCursor("default"),void 0;if("rotate"===H){var r,p=z.lp(F);if(w instanceof Tm.Group){var N=q.getStyle("groupRotateModeKey");"string"==typeof N&&(N=[N]);for(var a=!1,n=0,h=N.length;h>n;n++)if(F[N[n]]){a=!0;break}var V=q.getStyle("groupRotateModeDefault");r=a?"batch"===V?"block":"batch":V}var j="batch"===r?w.getAnchor2():w.getPosition(),v=Math.atan2(p.y-j.y,p.x-j.x);q._setRotateCursor(v),I.editing={mode:H,key:Z,pos:j,flipY:w.getScale().y<0,rotation:w.getRotation(),hitRot:v},r&&(I.editing.groupRotateMode=r)}else{var $=Tm.Rect.ResizeKeys.indexOf(Z),X=Tm.Rect.ResizeDirection[$],s=Math.cos(w.getRotation()),m=Math.sin(w.getRotation()),i=X.x*Math.sign(w.getScale().x),d=X.y*Math.sign(w.getScale().y),o=Math.atan2(-m*i-s*d,s*i-m*d),c=(Math.round(o/(Math.PI/4))+8)%8,S=["ew-resize","nesw-resize","ns-resize","nwse-resize","ew-resize","nesw-resize","ns-resize","nwse-resize"][c];this._interactor.setCursor(S);var O=w.getWidth(),P=w.getHeight(),t=w.getAnchor();I.editing={mode:H,key:Z,rect:{x:-O*t.x,y:-P*t.y,width:O,height:P},anchor:t,matrix:w.getMatrix()}}return Z}}},uj.prototype._checkLine=function(E){var D=this;D.screenInfo;var q,b=D._interactor.getStyle("checkSize");if(Tm.checkHit(E,D.screenInfo.P1,b))q="P1";else{if(!Tm.checkHit(E,D.screenInfo.P2,b))return this._interactor.setCursor("default"),void 0;q="P2"}return D.editing={mode:"line",key:q},q},uj.prototype._checkConnect=function(Q){var o=this,R=o.screenInfo,x=o._interactor,v=x.getStyle("connectGuideIntersectSize"),e=R.connect,n=Q.x,p=e.x;if(p>n&&v>p-n&&Math.abs(e.y-Q.y)<v||n>=p&&Tm.checkHit(Q,e,v)){var j="connect",X=m.getConnectAction(x.gv);if(o.editing={mode:j},X&&X.delete)if(o.target instanceof Tm.Group){var b=!0;x.gv.sm().getSelection().each(function(y){X.delete.visible.call(null,x.gv,y)||(b=!1)}),o.editing.hasDeleteAction=b}else X.delete.visible.call(null,x.gv,o.target)&&(o.editing.hasDeleteAction=!0);return x.setCursor("default"),j}},uj.prototype._fireEditEvent=function(l,_){var P=this._interactor,b=this.editing;if(b){var i=b.mode;i="rotate"===i?"Rotation":"connect"===i?"Connection":"resize"===i?"Rect":i[0].toUpperCase()+i.slice(1),P.fi({kind:l+"Edit"+i,event:_})}},uj.prototype.startEdit=function(s,L){s.startDragging(L);var l=this;l._interactor.fi({kind:"prepareEdit",event:L});var n=l.editing,d=l.target;if(n){if(l._fireEditEvent("begin",L),"rotate"===n.mode)return n.groupRotateMode&&d.beginRotate(n),void 0;if("connect"!==n.mode)("line"===n.mode||d&&0===d.getRotation())&&(l._inSmartGuide=!0,l._interactor.rectGuide.gatherRects());else if(n.hasDeleteAction){var g=s.gv,M=l._interactor.getStyle("connectGuideGarbageShift");n.garbageInfo={x:g.getWidth()*M[0]+M[2],y:g.getHeight()*M[1]+M[3],size:l._interactor.getStyle("connectGuideGarbageIntersectsize")},s._42()}}},uj.prototype._46O=function(J){var N,e,Y=this,W=Y.editing,Z=Y.target;if(W){if("connect"===W.mode&&!W.canceled&&!W.deleted)try{W.garbageInfo&&W.garbageInfo.hover?m.doDeleteConnectionAction(Y._interactor.gv,Z):m.doConnectAction(Y._interactor.gv,Z,W.target)}catch(V){console.error(V)}e=W.freezeFlag,N=Y.editing.groupRotateMode,Y._fireEditEvent("end",J),Y.editing=null}Y.tipInfo=null,Y._inSmartGuide&&(Y._interactor.rectGuide.clear(),Y._inSmartGuide=!1),N&&Z&&Z.endRotate(),Z instanceof R.Block&&(e===x?delete Z._freezeSyncFromChildren:Z._freezeSyncFromChildren=e,Z.updateFromChildren())},uj.prototype.handleNormalStateDelete=function(){var y=this,b=y.editing;if(b&&"connect"===b.mode&&!b.canceled&&!b.deleted){if(b.garbageInfo){try{m.doDeleteConnectionAction(y._interactor.gv,y.target)}catch(r){console.error(r)}b.garbageInfo=null}return b.cursorPos=null,b.targetCorners=null,b.deleted=!0,y._interactor._42(),!0}},uj.prototype.handleNormalStateKeyDown=function(o){var t=this,b=t.editing;return!b||"connect"!==b.mode||b.canceled||b.deleted?void 0:R.Default.isEsc(o)?(b.cursorPos=null,b.targetCorners=null,b.canceled=!0,t._interactor._42(),!0):void 0},uj.prototype.handleEdit=function(g,C){var b=this,M=b.editing;if(M){var t,E,y,K,x,N=b.target,U=M.key,p=M.mode,w=g.lp(C),h=b._interactor;if("connect"===p){if(M.canceled)return;if(M.deleted)return;M.cursorPos=h._getLogicalPoint(C);var H=M.garbageInfo;return H&&Tm.checkHit(M.cursorPos,H,H.size)?(H.hover=!0,M.target=null,M.targetCorners=null):(H&&(H.hover=!1),M.target=g.getDataAt(w,function(m){return g.isSelectable(m)?Vm(m)?!0:!1:!1})||null,M.targetCorners=Tm.getTargetCornersOnScreen(g,M.target)),h._42(),void 0}if("rotate"===p){var Y,f,o=M.pos,l=Math.atan2(w.y-o.y,w.x-o.x);if(M.groupRotateMode?f=l-M.hitRot:(Y=l-M.hitRot,f=M.rotation+Y),f%=2*Math.PI,0>f&&(f+=2*Math.PI),!R.Default.isCtrlDown(C)){var a,c;Zh(C)?(a=h.getStyle("shiftRotateRound"),c=a/2):(a=h.getStyle("rotateRound"),c=h.getStyle("rotateSensitivity")),f=Tm.roundTo(f,a,c)}M.groupRotateMode?(Y=f-(M.lastRotation||0),0!==Y&&(N.addRotation(Y,M.groupRotateMode,function(Y){return g.isRotationEditable(Y)}),M.lastRotation=f)):N.setRotation(f),h._setRotateCursor(l),f>Math.PI&&(f-=2*Math.PI);var v=180*(f/Math.PI);v=v.toFixed(2),t=""+v+""}else if("resize"===p){var L=M.rect;y=L.x,K=L.y;var D,B=L.width,j=L.height,u=M.anchor,G=M.matrix,W=N.s&&N.s("keepAspectRatio")||h.getStyle("keepAspectRatio");Zh(C)&&(W=!W);var m=b._unionPointMode1,P=b._unionPointMode2;if(b._inSmartGuide&&!R.Default.isCtrlDown(C)&&!W){var z;"L"===U||"R"===U?z="x":("T"===U||"B"===U)&&(z="y"),b._adsorbedToClosest(w,z),x=!0}D=G.tfi(w);var s;"LT"===U?(L=m(D,{x:y+B,y:K+j},B,j,W),s=9):"T"===U?(L=P({x:y,y:D.y},{x:y+B,y:K+j},B,j,W,"v"),s=1):"RT"===U?(L=m(D,{x:y,y:K+j},B,j,W),s=33):"L"===U?(L=P({x:D.x,y:K},{x:y+B,y:K+j},B,j,W,"h"),s=8):"R"===U?(L=P({x:y,y:K},{x:D.x,y:K+j},B,j,W,"h"),s=32):"LB"===U?(L=m(D,{x:y+B,y:K},B,j,W),s=12):"B"===U?(L=P({x:y,y:K},{x:y+B,y:D.y},B,j,W,"v"),s=4):"RB"===U&&(L=m(D,{x:y,y:K},B,j,W),s=36);var Z=G.tf(L.x+L.width*u.x,L.y+L.height*u.y);N instanceof R.Block&&(M.hasOwnProperty("freezeFlag")||(M.freezeFlag=N._freezeSyncFromChildren,N._freezeSyncFromChildren=!0)),N.setPosition(Z),N.setSize(L.width,L.height),x&&(E=N.getRect(),h.rectGuide.gatherLines({node:N,x:E.x,y:E.y,w:E.width,h:E.height},z,s)),t=""+Math.round(L.width)+" * "+Math.round(L.height)}else if("line"===p){if(Zh(C)){var J=N.getPoints(),O="P1"===U?J.get(1):J.get(0),e={x:w.x-O.x,y:w.y-O.y},Q=h.getStyle("shiftLineRotateRound"),$=b._shiftDirList;if(!$||b._shiftRotateRound!==Q){b._shiftRotateRound=Q,b._shiftDirList=$=[];for(var S=0;S<Math.PI;S+=Q)$.push({x:F(S),y:d(S)})}for(var X,r=0,V=0,i=$.length;i>V;V++){var A=$[V],I=A.x*e.x+A.y*e.y;Math.abs(I)>Math.abs(r)&&(r=I,X=A)}w={x:O.x+X.x*r,y:O.y+X.y*r},h.rectGuide.clear()}else b._inSmartGuide&&!R.Default.isCtrlDown(C)&&(b._adsorbedToClosest(w),x=!0);var n=Tm.getDataMatrix(N).applyInverse(w);N.setPoint("P1"===U?0:1,n,!0);var _=N.getPoints(),k=_.get(0),T=_.get(1);y=k.x-T.x,K=k.y-T.y,t=" "+Math.round(Math.sqrt(y*y+K*K))+" ",x&&(E=N.getRect(),h.rectGuide.gatherLines({node:N,x:E.x,y:E.y,w:E.width,h:E.height}))}if(t){var q=R.Default.getLogicalPoint(C,h._canvas);q.x+=Tm.Icons.TipShiftX,q.y+=Tm.Icons.TipShiftY,b.tipInfo={helperPos:q,text:t,size:t.length}}b._fireEditEvent("between",C)}},uj.prototype._unionPointMode1=function(I,y,O,r,_){if(_&&O&&r){var Y=I.x-y.x,D=I.y-y.y;Math.abs(Y*r)<Math.abs(D*O)?(D=Math.sign(D)*Math.abs(Y*r/O),I.y=y.y+D):(Y=Math.sign(Y)*Math.abs(D*O/r),I.x=y.x+Y)}return R.Default.unionPoint(I,y)},uj.prototype._unionPointMode2=function(S,r,F,b,E,Z){var m=R.Default.unionPoint(S,r);if(E&&F&&b){var L;"v"===Z?(L=m.x+m.width/2,m.width=F*m.height/b,m.x=L-m.width/2):(L=m.y+m.height/2,m.height=b*m.width/F,m.y=L-m.height/2)}return m},uj.prototype._adsorbedToClosest=function(u,p){var h=this,s=h._interactor,O=s.rectGuide.findClosest(u,p),y=s.gridGuide.findClosest(u,p),U=1/0,K=1/0;O&&(isFinite(O.x)&&(U=O.x),isFinite(O.y)&&(K=O.y)),y&&(isFinite(y.x)&&Math.abs(y.x)<Math.abs(U)&&(U=y.x),isFinite(y.y)&&Math.abs(y.y)<Math.abs(K)&&(K=y.y)),isFinite(U)&&(u.x+=U),isFinite(K)&&(u.y+=K)},uj.prototype._42=function(T,X,r){var W=this;W.info={},W.screenInfo=null;var g=W._interactor;if(!g.editDetail&&W.gatherInfo(X,r)){var a=W.editing,b=a?a.groupRotateMode:null,j=W.screenInfo;if("block"!==b){if(j.P1?Tm.Icons.DrawIcon(g,T,Tm.Icons.Line,j):Tm.Icons.DrawIcon(g,T,Tm.Icons.Rect,j),j.connect&&(Tm.Icons.DrawIcon(g,T,Tm.Icons.ConnectGuide,{rotation:j.rotation,connect:j.connect,cursorPos:a?a.cursorPos:null}),a)){if(a.targetCorners){for(var u={x:1/0,y:1/0},p={x:-1/0,y:-1/0},M=0,z=a.targetCorners.length;z>M;M+=2)u.x=Math.min(u.x,a.targetCorners[M]),p.x=Math.max(p.x,a.targetCorners[M]),u.y=Math.min(u.y,a.targetCorners[M+1]),p.y=Math.max(p.y,a.targetCorners[M+1]);Tm.Icons.DrawIcon(g,T,Tm.Icons.HoverDataRect,{min:u,max:p,color:g.getStyle("hoverGuideColor")||g.getStyle("baseColor")})}a.garbageInfo&&Tm.Icons.DrawIcon(g,T,Tm.Icons.ConnectGuideGarbage,a.garbageInfo)}W.tipInfo&&Tm.Icons.DrawIcon(g,T,Tm.Icons.TipHelper,W.tipInfo)}W.target instanceof Tm.Group&&W.target._42(g,T,X)}};var zg=Tm.Anchor=function(X){this.catalog="Anchor",this._interactor=X};zg.prototype={},zg.prototype.constructor=zg,zg.prototype.gatherInfo=function(P,Q){var c=this;if(1===Q.length){var m=Q[0];if(!m.getAnchor)return;if(m instanceof R.Shape&&m._70I())return;if(Te(m,P))return;return c.gatherSingleTarget(P,Q[0])}return Q.length>1?c.gatherMultiTargets(P,Q):!1},zg.prototype.gatherSingleTarget=function(l,s){var q=this;return q.info.POS=s.getPosition(),q.screenInfo.POS=Tm.toScreenPosition(l,q.info.POS),q.target=s,!0},zg.prototype.gatherMultiTargets=function(P,b){var i=this,Q=Tm.Group.findOrCreateGroup(b);return Q?(i.screenInfo.POS=Tm.toScreenPosition(P,Q.getAnchor2()),i.target=Q,!0):!1},zg.prototype.isVisible=function(){var M=this,D=M._interactor;if(D.getStyle("anchorVisible")===!1)return!1;var d=M.target;if(d){if(this.editing)return!0;var T=d.getAnchor(),Y=D.getStyle("anchorOutsideVisibleThreshold");if(T.x<-Y||T.x>1+Y||T.y<-Y||T.y>1+Y)return!0;var S=d.getSize(),k=d.getScale(),O=Math.min(Math.abs(S.width*k.x),Math.abs(S.height*k.y));if(O*D.gv._zoom<D.getStyle("anchorHideThreshold"))return!1}return!0},zg.prototype.check=function(X,j,r){if(R.Default.isLeftButton(j)){var o=this,I=o._interactor;if(o.isVisible()&&I.getStyle("anchorMovable")!==!1){o.editing=null,o.tipInfo=null;var x=o.target;if(x&&X.isAnchorEditable(x)&&X.isEditable(x)){var u;if(o.screenInfo&&(u=o.screenInfo.POS)&&Tm.checkHit(r,new Tm.Math.Vector2(u),I.getStyle("checkSize"))){if(x instanceof Tm.Group)return o.editing={},!0;var $=x.getWidth(),L=x.getHeight(),k=x.getAnchor();return o.editing={rect:{x:-$*k.x,y:-L*k.y,width:$,height:L},anchor:k,matrix:x.getMatrix()},!0}}}}},zg.prototype.startEdit=function(v,Z){v.startDragging(Z),v.fi({kind:"beginEditAnchor",event:Z})},zg.prototype._46O=function(l){var I=this;I.editing&&(I.editing=null,I._interactor.fi({kind:"endEditAnchor",event:l})),I.tipInfo=null},zg.prototype.handleEdit=function(o,$){var I=this,F=I.target;if(F){var P=I.editing;if(P){var m=o.lp($),p=I._interactor;if(F instanceof Tm.Group)return F.setAnchor2(m),p._42(),void 0;var C=P.matrix,D=C.tfi(m),H=P.rect,O=(D.x-H.x)/H.width,Q=(D.y-H.y)/H.height;if(!R.Default.isCtrlDown($)){var j=p.getStyle("anchorRound"),V=p.getStyle("anchorSensitivity");O=Tm.roundTo(O,j,V),Q=Tm.roundTo(Q,j,V)}F.setAnchor(O,Q,!0);var S=R.Default.getLogicalPoint($,p._canvas);S.x+=Tm.Icons.TipShiftX,S.y+=Tm.Icons.TipShiftY;var G=""+O.toFixed(2)+", "+Q.toFixed(2);I.tipInfo={helperPos:S,text:G,size:G.length},p.fi({kind:"betweenEditAnchor",event:$})}}},zg.prototype._42=function(R,Y,x){var H=this;H.info={},H.screenInfo={};var V=H._interactor;V.editDetail||H.gatherInfo(Y,x)&&H.isVisible()&&(Tm.Icons.DrawIcon(V,R,Tm.Icons.Anchor,H.screenInfo),H.tipInfo&&Tm.Icons.DrawIcon(V,R,Tm.Icons.TipHelper,H.tipInfo))};var Fh=Tm.MoveDummy=function(v){this.catalog="MoveDummy",this._interactor=v};Fh.prototype={},Fh.prototype.constructor=Fh,Fh.prototype.gatherInfo=function(){var N=this,O=this._interactor.getSubModule("Rect");if(O){var z=O.screenInfo;if(z){var q=N._interactor,c=N.getMovableTarget(O.target);if(c){var j=q.getStyle("moveDummyThreshold");if(j!==!1){var m=z.LT||z.P1,C=z.RT||z.P2,L=z.LB||m;if(m){var e=z.P1,$=Math.min(m.distanceTo(L),m.distanceTo(C));if(!(j!==!0&&$>j)){var J=q.getStyle("moveDummyPosition"),T=C.clone().sub(m),G=L.clone().sub(m),t=J[2],h=J[3];if(e){var S=q.getStyle("moveDummyLineExtraShift");S&&(t+=S[0],h+=S[1])}var p=m.clone().add(T.clone().multiplyScalar(J[0])).add(T.setLength(t)).add(G.clone().multiplyScalar(J[1])).add(G.setLength(h));return N.screenInfo.pos=p,N.screenInfo.size=q.getStyle("moveDummySensitivity"),!0}}}}}}},Fh.prototype.getMovableTarget=function(r){var e=this._interactor.gv;if(Vm(r)){if(e.isMovable(r))return r}else if(r instanceof Tm.Group)for(var O=r._entities,S=O.length-1;S>=0;S--){var o=O[S];if(Vm(o)&&e.isMovable(o))return o}return null},Fh.prototype.getMoveInteractor=function(){for(var j,u,c,S=this._interactor.gv,y=S.getInteractors(),j=0,u=y.length;u>j;j++)if(c=y.get(j),c instanceof Yc)return c},Fh.prototype.startEdit=function(x,r){x.startDragging(r);var h=this.getMoveInteractor();if(h){var s=this.selectedTarget,Z=x.gv;Z._moving=1,h._data=s,Z.handleMouseDown&&Z.handleMouseDown(r,s)}},Fh.prototype._46O=function(Y){var o=this,m=o.getMoveInteractor();m&&(m.handleWindowMouseUp(Y),o.selectedTarget=null)},Fh.prototype.handleEdit=function(X,B){var J=this.getMoveInteractor();J&&J.handleWindowMouseMove(B)},Fh.prototype.check=function(N,D,G){if(this.selectedTarget=null,R.Default.isLeftButton(D)&&!N._scrolling&&!Wh()){var u=this;if(u.screenInfo){var m=u.screenInfo.pos;if(m&&!(G.distanceTo(m)>u.screenInfo.size)){var V=u._interactor;return u.selectedTarget=u.getMovableTarget(V.getSubModule("Rect").target),V.setCursor("default"),!0}}}},Fh.prototype._42=function(C,x,d){var X=this;X.screenInfo={};var o=X._interactor;o.editDetail||X.gatherInfo(x,d)&&(!o.editing||X.selectedTarget)&&Tm.Icons.DrawIcon(o,C,Tm.Icons.MoveDummy,X.screenInfo)};var ug=Tm.RotateX=function(P){this.catalog="RotateX",this._interactor=P};ug.prototype={},ug.prototype.constructor=ug,ug.prototype.gatherInfo=function(E,F){var q=this;if(1===F.length){var k=F[0];return k instanceof R.Shape&&k._70I()||Te(k,E)?!1:q.gatherSingleTarget(E,k)}return F.length>1?q.gatherMultiTargets(E,F):!1},ug.prototype.gatherSingleTarget=function(){var I=new R.Math.Vector2,g=new R.Math.Vector2,q=new R.Math.Vector2,M=new R.Math.Vector2,L=function(o,E){var H=o.x-E.x,Z=o.y-E.y;return H*H+Z*Z
};return function(Y,K){if(K.getCorners){var x=this,E=K.getCorners(),n=15,C=K.getPosition();I.copy(E[0]),q.copy(E[1]),M.copy(E[3]),g.copy(I).add(M).divideScalar(2).add(I.sub(q).setLength(n/Y.getZoom()));var r=Math.max(L(C,E[0]),L(C,E[1]),L(C,E[2]),L(C,E[3]));return x.info.POS=g.clone(),x.screenInfo.POS=Tm.toScreenPosition(Y,x.info.POS),x.screenInfo.LEN=Math.sqrt(r)*Y.getZoom()+n,x.screenInfo.CENTER=Tm.toScreenPosition(Y,C),x.target=K,!0}}}(),ug.prototype.gatherMultiTargets=function(S,X){var y=this,P=Tm.Group.findOrCreateGroup(X);if(!P)return!1;var y=this;return y.gatherSingleTarget(S,P)},ug.prototype.isVisible=function(){var i=this._interactor;if(!i.getStyle("rotateAsClock"))return!1;var G=this.target;if(!G)return!0;var f=i.gv;return f.isEditable(G)&&f.isRotationEditable(G)?!0:!1},ug.prototype.check=function(j,G,k){var m=this,K=m._checkImpl(j,G,k);return(K||m._clockPainted)&&m._interactor._42(),K},ug.prototype._checkImpl=function(r,Q,$){if(R.Default.isLeftButton(Q)){var v=this;v.editing=null,v.tipInfo=null;var m;if(v.screenInfo&&(m=v.screenInfo.POS)&&v.isVisible()){var g=v._interactor;if(Tm.checkHit($,m,g.getStyle("checkSize"))){var z=v.target,S=r.lp(Q),X=z.getPosition(),x=Math.atan2(S.y-X.y,S.x-X.x);return g._setRotateCursor(x),v.editing={pos:X,rotation:z.getRotation(),hitRot:x,groupRotateMode:"block",screenInfo:{CENTER:v.screenInfo.CENTER,LEN:v.screenInfo.LEN}},!0}}}},ug.prototype.startEdit=function(S,Z){S.startDragging(Z),S.fi({kind:"beginEditRotation",event:Z}),this.target instanceof Tm.Group&&this.target.beginRotate(this.editing)},ug.prototype._46O=function(y){var r=this;r.editing&&(r.editing=null,r._interactor.fi({kind:"endEditRotation",event:y})),r.target instanceof Tm.Group&&r.target.endRotate(),r.tipInfo=null},ug.prototype.handleEdit=function(E,Q){var n=this,Y=n.editing;if(Y){var W,c,x=n.target,I=E.lp(Q),v=n._interactor,p=Y.pos,h=Math.atan2(I.y-p.y,I.x-p.x),a=x instanceof Tm.Group;if(a?c=h-Y.hitRot:(W=h-Y.hitRot,c=Y.rotation+W),c%=2*Math.PI,0>c&&(c+=2*Math.PI),!R.Default.isCtrlDown(Q)){var J,M;Zh(Q)?(J=v.getStyle("shiftRotateRound"),M=J/2):(J=v.getStyle("rotateRound"),M=v.getStyle("rotateSensitivity")),c=Tm.roundTo(c,J,M)}a?(W=c-(Y.lastRotation||0),0!==W&&(x.addRotation(W,Y.groupRotateMode,function(t){return E.isRotationEditable(t)}),Y.lastRotation=c)):x.setRotation(c),v._setRotateCursor(h),c>Math.PI&&(c-=2*Math.PI);var s=180*(c/Math.PI),l=""+s.toFixed(2)+"",H=R.Default.getLogicalPoint(Q,v._canvas);H.x+=Tm.Icons.TipShiftX,H.y+=Tm.Icons.TipShiftY,n.tipInfo={helperPos:H,text:l,size:l.length},v.fi({kind:"betweenEditRotation",event:Q})}},ug.prototype._42=function(U,R,h){var p=this;p._clockPainted=!1,p.info={},p.screenInfo={};var d=p._interactor;d.editDetail||p.gatherInfo(R,h)&&p.isVisible()&&(Tm.Icons.DrawIcon(d,U,Tm.Icons.RoundPoint,p.screenInfo.POS),p.tipInfo&&Tm.Icons.DrawIcon(d,U,Tm.Icons.TipHelper,p.tipInfo),p.editing&&p.drawClock(U))},ug.prototype.drawClock=function(Q){Q.save();var U=this;U._clockPainted=!0;var L=U.editing||{},$=L.screenInfo||U.screenInfo,H=$.LEN,r=H+8,u=H+18;Q.save(),Q.translate($.CENTER.x,$.CENTER.y),Q.beginPath(),Q.strokeStyle="rgb(150, 150, 150)";for(var q,B,i,s,m,K=0;360>K;K++)q=K*Math.PI/180,0===K%5&&(B=d(q)*H,i=F(q)*H,s=d(q)*r,m=F(q)*r,Q.moveTo(B,i),Q.lineTo(s,m)),0===K%45&&(B=d(q)*H,i=F(q)*H,s=d(q)*u,m=F(q)*u,Q.moveTo(B,i),Q.lineTo(s,m));Q.stroke(),Q.rotate(-P);var y=L.lastRotation||U.target.getRotation();Q.beginPath(),Q.fillStyle="rgba(255, 0, 0, 0.1)",Q.strokeStyle="rgb(157, 157, 157)",Q.moveTo(0,0),Q.arc(0,0,u,0,y,!1),Q.fill(),Q.beginPath(),Q.moveTo(0+u,0),Q.arc(0,0,u,0,y,!1),Q.stroke(),Q.restore()};var kl=Tm.Curve=function(o){this.catalog="Curve",this._interactor=o};kl.prototype={},kl.prototype.constructor=kl,U.defineProperties(kl.prototype,{activing:{get:function(){return this._activing},set:function(O){var E=this;if(O)E._activing=new Tm.CurveActiving(this,O),E._activing._firePointChange();else{var Q=E._activing;Q&&Q.dispose(),E._activing=null}}}}),kl.PointType={Mirrored:0,Straight:1,Disconnected:2,Asymmetric:3},kl.prototype.setUp=function(){var T=this,u=T._interactor;u&&u.gv.mp(T._onGraphviewPropertyChanged,T)},kl.prototype._onGraphviewPropertyChanged=function(j){("zoom"===j.property||"translateX"===j.property||"translateY"===j.property)&&this._handleDataChanged()},kl.prototype.tearDown=function(){var C=this,O=C._interactor;O&&O.gv.ump(C._onGraphviewPropertyChanged,C)},kl.prototype.canEnterEditDetailMode=function(){var x=this,g=x._interactor,X=g._getValidSelection();if(1===X.length){var B=X[0],o=B instanceof R.Edge;if(B instanceof R.Shape||o){if(o){var f=B.s("edge.type");if(f&&"points"!==f)return}var c=g.gv;if(c.isPointEditable(B)&&c.isEditable(B))return x.target=B,!0}}},kl.prototype.canQuitEditDetailMode=function(C){var n=this,l=n._interactor._getLogicalPoint(C);return n._checkEditRealPoint(l)?void 0:n._interactor.gv.getDataAt(C)!==n.target?!0:void 0},kl.prototype.preHandleScroll=function(){var W=this.editing;return W&&W.inEdit?!0:void 0},kl.prototype.getCurrentSelectintStatus=function(){var I=this;if(I.activing&&!I.activing.selections){if(I.activing.status!=x)return I.activing.status;var A=function(A){var j=I.activing.status;I.activing.status=A,I._interactor.fp("shapePointStatus",j,A)},S=Tm.Curve.PointType,P=I.activing.point,W=I.activing.pairs;if(!W||1!==W.length)return A(S.Mirrored);var C=W[0],b=C.c1&&C.c1.isNearEnough(P),Y=C.c2&&C.c2.isNearEnough(P);if(!C.c1||!C.c2)return b||Y?A(S.Straight):A(S.Disconnected);if(b&&Y)return A(S.Straight);if(b||Y)return A(S.Asymmetric);var n=C.c1.clone().sub(P),R=C.c2.clone().sub(P);return Math.abs(n.x*R.y-n.y*R.x)>1e-5||n.x*R.x>0?A(S.Disconnected):Math.abs(n.length()-R.length())>1e-5?A(S.Asymmetric):A(S.Mirrored)}},kl.prototype.handle_keydown=function(P){var T=this;if(T._interactor.editDetail){var r=Tm.Curve.PointType;"1"===P.key?T._setCurrentSelectionStatus(r.Straight):"2"===P.key?T._setCurrentSelectionStatus(r.Mirrored):"3"===P.key?T._setCurrentSelectionStatus(r.Disconnected):"4"===P.key&&T._setCurrentSelectionStatus(r.Asymmetric)}},kl.prototype.setCurrentSelectionStatus=function(a){var F=this,m=F._interactor;if(m){var G=m.gv;G.dm().beginTransaction(),this._setCurrentSelectionStatus(a),G.dm().endTransaction()}},kl.prototype._setCurrentSelectionStatus=function(R){var A=this,G=A.activing;if(G){var K=A.getCurrentSelectintStatus();if(null!==K&&K!==R){G.status=R;var b=A.activing.point,d=A.activing.pairs;if(d&&1===d.length){var p=d[0],u=A.screenInfo.curve,_=Tm.Curve.PointType,o=A._interactor,w=function(){A._writeToHt(),o.fp("shapePointStatus",K,R),A.check(o.gv,null,new Tm.Math.Vector2(o._lastLogicalPoint))};if(R===_.Straight)return u.moveCtrlPoint(p,b,"c1"),u.moveCtrlPoint(p,b,"c2"),w(),void 0;if(K===_.Straight){var h=u.findPairs(b,!0),l=h[0],r=l.r1||b,X=l.r2||b,I=X.clone().sub(r).multiplyScalar(.25);return u.moveCtrlPoint(p,b.clone().sub(I),"c1"),u.moveCtrlPoint(p,b.clone().add(I),"c2"),w(),void 0}var n=p.c1,t=p.c2;if(n&&t){if(R===_.Mirrored)return u.moveCtrlPoint(p,b.clone().multiplyScalar(2).sub(t),"c1"),w(),void 0;if(R===_.Asymmetric&&K===_.Disconnected){var j=n.clone().sub(b).length(),I=b.clone().sub(t).setLength(j).add(b);return u.moveCtrlPoint(p,I,"c1"),w(),void 0}}G._firePointChange(),o.fp("shapePointStatus",K,R),A.check(o.gv,null,new Tm.Math.Vector2(o._lastLogicalPoint))}}}},kl.prototype._handleDataChanged=function(){var v="s:edge.points,s:edge.segments,points,segments,shape,position,rotation,scale".split(",");return function(f){var V=this;if(V.screenInfo&&V.target){if(f&&v.indexOf(f.property)<0)return;var G=V._interactor;V.gatherSingleTarget(G.gv,V.target,!0),V.check(G.gv,null,new Tm.Math.Vector2(G._lastLogicalPoint)),G._42()}}}(),kl.prototype.gatherSingleTarget=function(o,s,H){var h,j,N=this;N.screenInfo&&N.screenInfo.curve&&(j=N.screenInfo.curve._curves);var b=N.editing;h=b?N.screenInfo:N.screenInfo={};var q,y,A=s instanceof R.Edge;A?(q=s.s("edge.segments"),y=s.s("edge.points")||new R.List):(q=s._58O,y=s._59O),h.S=q;var $,X=h.P=[],C=Tm.getDataMatrix(s);if(s instanceof R.Polyline||s instanceof R.Edge&&N._interactor.getStyle("edgeElevationEditable"))$=s.getElevation&&s.getElevation()||0,h.E=[];else{var Y=!1;y.each(function(R){R.e!==x&&(Y=!0)}),Y&&(h.E=[])}if(y.each(function(r){h.E&&h.E.push(r.e!=x?r.e:$),r=C.apply(r);var D=Tm.toScreenPosition(o,r);X.push(D.x,D.y)}),A){var m=X.length,P=Tm.toScreenPosition(o,s._lastSourcePoint||(m?{x:X[0],y:X[1]}:{x:0,y:0})),M=Tm.toScreenPosition(o,s._lastTargetPoint||(m?{x:X[m-2],y:X[m-1]}:{x:0,y:0}));X.splice(0,0,P.x,P.y),X.push(M.x,M.y),h.E&&(h.E.splice(0,0,"head"),h.E.push("tail"))}if(!h.S||!h.S.size()){h.S=new R.List,h.S.add(1);for(var k=0;k<X.length/2-1;k++)h.S.add(2)}if((!b||H)&&N.convertToCubicBezier(j),N.activing&&(H||!N.editing||"realPoint"===N.editing.type)){var T=h.curve.findPairs(N.activing.point);N.activing.pairs=T}},kl.prototype._convertToNewPoint=function(Y,M,i,a){var l,d,D;for(l=0,d=M.length;d>l;l++){if(D=M[l],D._p1.isNearEnough(Y)&&(!a||a.indexOf(D._p1)<0))return D._p1;if(D._p4.isNearEnough(Y)&&(!a||a.indexOf(D._p4)<0))return D._p4}if(i)for(l=0,d=Math.min(i.length,d);d>l;l++){if(D=i[l],D._p1===Y&&(!a||a.indexOf(M[l]._p1)<0))return M[l]._p1;if(D._p4===Y&&(!a||a.indexOf(M[l]._p4)<0))return M[l]._p4}},kl.prototype.convertToCubicBezier=function(H){var T,O,I=this,D=new Tm.Math.Curve,r=I.screenInfo;if(D.createFromHtShape(r.P,r.S,r.E),r.curve=D,I.activing){var P=D._curves;T=I.activing.point,O=I._convertToNewPoint(T,P,H);var E=[];if(O&&(I.activing.point=O,E.push(O)),I.activing.selections){var d=-1,F=I.activing.selections;F.forEach(function(m){d++,O=I._convertToNewPoint(m,P,H,E),O&&(F[d]=O,E.push(O))})}}},kl.prototype.check=function(c,d,i){if(!d||wn(d)||ie(d)){var L=this;if(L._interactor.setCursor("default"),L.editing=null,L.highlight=null,L.tipInfo=null,L.edgeEditResult=null,L.screenInfo){if(Wh()||d&&ie(d))return L._interactor._42(),!0;if(L._checkEditCtrlPoint(i))return L._interactor._42(),!0;if(L._checkEditRealPoint(i))return L._interactor._42(),!0;if(L._checkEditElevation(i))return L._interactor._42(),!0;var z=L.screenInfo.curve,N=z.checkPoint(i,L._interactor.getStyle("curveIntersectSize"));if(N){var r=L.highlight={};r.type="insertKnot",r.bezier=N.bezier,r.point=N.intersection}return L._interactor._42(),!0}}},kl.prototype._checkEditRealPoint=function(t){var q,p,M,$,J,f,l=this,r=l.screenInfo.curve._curves,e=l._interactor.getStyle("curvePointIntersectSize"),S=1/0;for(e*=e,M=0,$=r.length;$>M;M++)q=r[M],J=q._p1,f=t.distanceToSquared(J),S>f&&(S=f,p=J),J=q._p4,f=t.distanceToSquared(J),S>f&&(S=f,p=J);if(S>e)return!1;var O=l.highlight={};return O.type="changeRealPoint",O.point=p,l.editing={type:"realPoint",point:p,shiftGuide:{point:p.clone(),dir:"x",limit:0}},l._interactor.setCursor("crosshair"),!0},kl.prototype._checkEditElevation=function(Y){var G=this;if(!G._interactor.getStyle("curveElevationVisible"))return!1;var T=G.target;if(T instanceof R.Edge&&!G._interactor.getStyle("edgeElevationEditable"))return!1;var p=G.activing;if(!p)return!1;var $=p.getCurrentEditingPoint();if(!$)return!1;var M=G._interactor,k=M.getStyle("curveElevationGuideShift"),u=M.getStyle("curveElevationIntersectSize"),Z=Y.distanceToSquared({x:$.x+k[0],y:$.y+k[1]});if(!(Z>u*u)){var j=G.highlight={};j.type="elevation";var F=new Tm.Math.Vector2(Y.x,Y.y,$.e);return G.editing={type:"elevation",startPoint:F},G._interactor.setCursor("crosshair"),!0}},kl.prototype._checkEditCtrlPoint=function(x){var p=this;if(p.activing&&!p.activing.selections){var b=p.getCurrentSelectintStatus();if(b!==Tm.Curve.PointType.Straight){var t=p.activing.pairs;if(t){var G=p._interactor.getStyle("curvePointIntersectSize");G*=G;var F,V,L,J,r,R,u,s,z,P=1/0;for(u=0,z=t.length;z>u;u++)for(J=t[u],s=0;2>s;s++)r=0===s?"c1":"c2",J[r]&&(R=x.distanceToSquared(J[r]),P>R&&(P=R,F=J,V=u,L=r));if(P>G)return!1;p.activing.hlpair=F,p.activing.hltype=L;var o=p.highlight={};return o.type="changeCtrlPoint",o.point=F[L],p.editing={type:"ctrlPoint",pair:F,pairId:V,ctrlType:L,direction:F[L].clone().sub(p.activing.point).normalize()},p._interactor.setCursor("crosshair"),!0}}}},kl.prototype.startEdit=function(e,v){e.startDragging(v);var x=this;x.highlight&&"insertKnot"===x.highlight.type&&(x.insertKnot(),x.gatherSingleTarget(x._interactor.gv,x.target),x.activing=null,x._checkEditRealPoint(x._interactor._getLogicalPoint(v)));var U=x._activing;if(U){var o=x.editing?x.editing.type:null;"ctrlPoint"===o?U.editingCtrl={pairId:x.editing.pairId,type:U.hltype}:"realPoint"===o&&(U.editingCtrl=!1)}var $=x.highlight,L=R.Default.isCtrlDown(v);if(!$||Wh()||ie(v)){var i=x._interactor.gv;if(!i.setFocus(v)||i._scrolling)return;return L?x._multiSelect={startPoint:i.lp(v)}:i.isPannable()&&(wn(v)||ie(v))&&(x._pan={tx:i.tx(),ty:i.ty()},e.fi({kind:"beginPan",event:v})),void 0}if("changeRealPoint"===$.type){var b,c=x.activing?x.activing.point:null,j=x.activing?x.activing.selections:null;if(L&&x.activing)c===$.point?(j?(x.activing={point:j[0]},j.length>1&&(j.splice(0,1),x.activing.selections=j)):x.activing=null,x.editing=null):j&&(b=j.indexOf($.point))>=0?(j.length>1?j.splice(b,1):delete x.activing.selections,x.editing=null):j?(j.push(c),x.activing={point:$.point,selections:j}):x.activing={point:$.point,selections:[c]};else if(j)c===$.point||((b=j.indexOf($.point))>=0?(j.splice(b,1,c),x.activing={point:$.point,selections:j}):x.activing={point:$.point});else{var m;c===$.point&&(m=x.activing.status),x.activing={point:$.point},m&&(x.activing.status=m)}e.fi({kind:"beginEditPoint",event:v})}},kl.prototype.insertKnot=function(){var Z=this,i=Z.highlight,I=Z.screenInfo.curve;I.insertKnot(i.bezier,i.point.t),Z._writeToHt()},kl.prototype._writeToHt=function(){var r,U,S=this,b=S.screenInfo.curve,T=b.toHtShape(),$=T.points,t=[],O=T.segments,K=S._interactor.gv;K.dm().beginTransaction();var q,Q,L=S.target,E=L instanceof R.Edge,e=Tm.getDataMatrix(L).invert();Q=L instanceof R.Polyline||L instanceof R.Edge&&S._interactor.getStyle("edgeElevationEditable"),Q&&(q=L.getElevation&&L.getElevation()||0);for(var s=0,Z=$.length;Z>s;s++)r=$[s],U=Tm.toWorldPosition(K,r),U=e.apply(U),isFinite(r.e)&&r.e!==q&&(U.e=r.e),t.push(U);if(L._writing=!0,E){L.s("edge.type","points"),L.setStyle("edge.segments",O),L.setStyle("edge.points",t.slice(1,t.length-1)),L.setStyle("edge.source.offset.x",0),L.setStyle("edge.source.offset.y",0),L.setStyle("edge.target.offset.x",0),L.setStyle("edge.target.offset.y",0);var W=S._nextChangeEdgeHost;delete S._nextChangeEdgeHost,W&&("source"===W.type?L.setSource(W.host):L.setTarget(W.host)),S._writeEdgeHostAnchor("source",t[0]),S._writeEdgeHostAnchor("target",t[t.length-1])}else t.length?(L.setSegments(O),L.setPoints(t,!0)):L.removeFromDataModel();K.dm().endTransaction(),delete L._writing},kl.prototype._writeEdgeHostAnchor=function(E,O){var D=this,q=D.target,e=D._calcHostAnchor(q,E,O);e.index!==x?(q.setStyle("edge."+E+".index",e.index),q.setStyle("edge."+E+".percent",x),q.setStyle("edge."+E+".anchor.x",x),q.setStyle("edge."+E+".anchor.y",x)):e.percent!==x?(q.setStyle("edge."+E+".percent",e.percent),q.setStyle("edge."+E+".index",x),q.setStyle("edge."+E+".anchor.x",x),q.setStyle("edge."+E+".anchor.y",x)):(q.s("edge."+E+".anchor.x",e.x),q.s("edge."+E+".anchor.y",e.y),e.offsetX||e.offsetY?(q.s("edge."+E+".offset.x",e.offsetX),q.s("edge."+E+".offset.y",e.offsetY)):(q.s("edge."+E+".offset.x",0),q.s("edge."+E+".offset.y",0)))},kl.prototype._calcHostAnchor=function(r,I,u,V){V||(V="source"===I?r.getSource():r.getTarget());var o=this._interactor.gv,Z=o.calculateAttachPoint(V,u);if(Z)return Z.info;if(xr(V)){var w=o.calculateEdgePosition(V,u);return w}var b=V.getRotation(),x=V.getAnchor();Te(V,o)&&(b=0);var c=V.getScale();if(b||c.x<0||c.y<0){var y=V.getMatrix(),m=y.tfi(u),U=V.getSize();return{x:m.x/U.width+x.x,y:m.y/U.height+x.y}}var W=vg(o,V),v={x:(u.x-W.x)/W.width,y:(u.y-W.y)/W.height};return v},kl.prototype._handlePanning=function(A){var G=this,o=G._pan;if(o){o.started=!0;var L=G._interactor,m=L.gv,f=L._lastClientPoint,D=sb(A),H=os(m,D,f);m.setTranslate(o.tx+H.x,o.ty+H.y),G.gatherSingleTarget(L.gv,G.target),L._42(),L.fi({kind:"betweenPan",event:A})}},kl.prototype.handleEdit=function(t,k){var T=this,m=T.editing;if(T._pan)return T._handlePanning(k),void 0;if(T._multiSelect)return T._multiSelect.endPoint=t.lp(k),T._interactor.redraw(),void 0;if(m){m.inEdit=!0;var U,C,X,W=T._interactor._getLogicalPoint(k),O=R.Default.isCtrlDown(k),p=R.Default.isShiftDown(k),v=m.type,b=T.activing;if(T._guideInfo=null,"ctrlPoint"===v&&p){var u=T.editing.direction.clone();U=b.point;var y=u.dot(W.clone().sub(U));W=u.setLength(y).add(U)}else if("ctrlPoint"===v||"realPoint"===v){var u;if("realPoint"===v&&p){var q=T.editing.shiftGuide;C=q.point;var F=Math.abs(W.x-C.x),j=Math.abs(W.y-C.y);F>j&&F>q.limit&&"y"===q.dir&&(q.dir="x"),j>F&&j>q.limit&&"x"===q.dir&&(q.dir="y"),u=q.dir,"x"===u?(W.y=C.y,q.limit=Math.max(q.limit,F)):"y"===u&&(W.x=C.x,q.limit=Math.max(q.limit,j))}var Z=T._isEditEdgeSourceTarget();if(Z){var H=T._editEdgeSourceTarget(Z,W,O);H&&(T.edgeEditResult=H,X=H.tipText)}else if(!O){var Y=T._guidingToEdit(W,u),M="realPoint"===v?T._interactor.gridGuide.findClosest(W,u,!0):null,s=1/0,n=1/0;M&&(M.x&&(s=M.x),M.y&&(n=M.y));var K=!1;Y&&(Y.xList&&(Math.abs(Y.x)<=Math.abs(s)?(K=!0,s=Y.x):delete Y.xList),Y.yList&&(Math.abs(Y.y)<=Math.abs(n)?(K=!0,n=Y.y):delete Y.yList),K&&(T._guideInfo=Y)),isFinite(s)&&(W.x+=s),isFinite(n)&&(W.y+=n),K&&(Y.v=W)}}var S=T.screenInfo.curve;if("realPoint"===m.type){U=m.point,U.e!==x&&(W.e=U.e),S.moveRealPoint(U,W),m.point=W,T.highlight.point=W;var l=b.status,N=b.selections;if(T.activing={point:W,status:l},N){var A=W.clone().sub(U),e=0;N.forEach(function(y){var c=y.clone().add(A);S.moveRealPoint(y,c),N[e++]=c}),T.activing.selections=N}}else if("ctrlPoint"===m.type){var c=b.pairs,D=c[m.pairId];S.moveCtrlPoint(D,W,m.ctrlType);var $=b.status,a=Tm.Curve.PointType;if(($===a.Mirrored||$===a.Asymmetric)&&D.c1&&D.c2){var U=new Tm.Math.Vector2(b.point),w="c1"===m.ctrlType?"c2":"c1";if($===Tm.Curve.PointType.Mirrored)S.moveCtrlPoint(D,U.clone().multiplyScalar(2).sub(W),w);else if($===a.Asymmetric){var y=D[w].clone().sub(U).length(),d=U.clone().sub(D[m.ctrlType]).setLength(y).add(U);isNaN(d.x)||S.moveCtrlPoint(D,d,w)}}b._firePointChange()}else if("elevation"===m.type){C=m.startPoint;var z=C.e+(C.y-W.y)/t._zoom;T._setCurrentPointImpl("e",z),b._firePointChange(),X="E: "+Tm.toFixed(z)}var V=R.Default.getLogicalPoint(k,T._interactor._canvas);if(V.x+=Tm.Icons.TipShiftX,V.y+=Tm.Icons.TipShiftY,!X){var B=Tm.toWorldPosition(t,W);X=""+Tm.toFixed(B.x)+", "+Tm.toFixed(B.y)}T.tipInfo={helperPos:V,text:X,size:X.length},T._writeToHt(),T._interactor.fi({kind:"betweenEditPoint",event:k})}},kl.prototype._setCurrentPointImpl=function(X,h){var Q=this,S=Q._activing;if(!S)return!1;var j=Q.target;if(!j)return!1;var K=S.getCurrentEditingPoint();if(!K)return!1;var $=S.editingCtrl;if(!$)var b=K.clone();if("e"===X)K.e=h;else{var k;if("x"===X||"y"===X){var p=S._lastFirePoint;k="x"===X?{x:h,y:p?p.y:0}:{x:p?p.x:0,y:h}}else"object"==typeof X?(k=X,X.e!==x&&(K.e=X.e)):(k={x:arguments[0],y:arguments[1]},arguments[2]!==x&&(K.e=arguments[2]));var u=Tm.getDataMatrix(j);k=Tm.toScreenPosition(Q._interactor.gv,u.apply(k)),K.x=k.x,K.y=k.y}if(!$){var I=b.multiplyScalar(-1).add(K);K.e&&b.e&&(I.e=K.e-b.e);var w=Q.screenInfo.curve;w.moveCtrlDueToRealPointMovement(K,I);var P=S.selections;if(P){var E=0;P.forEach(function(D){var n=D.clone().add(I);isFinite(I.e)&&(n.e=(isFinite(D.e)?D.e:j.getElevation()||0)+I.e),w.moveRealPoint(D,n),P[E++]=n}),S.selections=P}}return!0},kl.prototype.setCurrentPoint=function(m,O){return this._setCurrentPointImpl(m,O)?(this._writeToHt(),!0):!1},kl.prototype._isEditEdgeSourceTarget=function(){var E=this,l=E.target;if(!(l instanceof R.Edge))return!1;var s=E.editing.point,H=E.screenInfo.curve._curves;return s===H[0]._p1?"source":s===H[H.length-1]._p4?"target":!1},kl.prototype._editEdgeSourceTarget=function(o,a,E){var G,w=this,A=w.target;if(G="source"===o?A.getSource():A.getTarget()){var v,k=w._interactor.gv,Q=Tm.toWorldPosition(k,a),t=w._calcHostAnchor(A,o,Q,G);if(v=t.index!==x||t.percent!==x?t.distance*k.getZoom()>w._interactor.getStyle("edgeHostEdgeMaxDistance"):w._interactor.getStyle("edgeHostDetectPerFrame")?!0:t.x<0||t.x>1||t.y<0||t.y>1?!0:!1){var L=k.getDataAt(Q,function(D){return k.isSelectable(D)?k.isSourceTargetEditable(A,D,o)?A.canSetSourceTarget(D,o)?!0:!1:!1:!1});if(L){var J=w._calcHostAnchor(A,o,Q,L);G=L,w._nextChangeEdgeHost={type:o,host:L},t=J}}var l,F,T;if(E||t.x===x)(t.percent!==x||t.index!==x)&&(F=t.point);else{var K=w._interactor.getStyle("anchorRound"),z=w._interactor.getStyle("anchorSensitivity");l=k.calculateAttachPoint(G,Q),l?t=l.info:(t.x=Tm.roundTo(t.x,K,z),t.y=Tm.roundTo(t.y,K,z)),F=oo(k,G,0,t.offsetX||0,t.offsetY||0,t.x,t.y)}F&&(T=Tm.toScreenPosition(k,F),a.x=T.x,a.y=T.y),w._edgeHostGuideInfo={corners:Tm.getTargetCornersOnScreen(k,G),attach:l?l.index:-1,host:G};var $;return t.percent!==x?$="percent: "+t.percent.toFixed(2):t.index!==x?$="index: "+t.index:($=""+t.x.toFixed(2)+", "+t.y.toFixed(2),(t.offsetX||t.offsetY)&&($+=" offset: "+t.offsetX.toFixed(2)+", "+t.offsetY.toFixed(2))),{host:G,anchor:t,tipText:$}}},kl.prototype._guidingToEdit=function(z,v){var q,I,$=this;if(q=$.screenInfo.curve){I=q._curves;var M,Q,m,w,k,_,y,o,f=1/0,G=1/0,H=[];for($.editing&&"realPoint"===$.editing.type&&(o=$.editing.point),k=0,_=2*I.length;_>k;k++)y=I[Math.floor(k/2)][k%2?"_p4":"_p1"],H.indexOf(y)>=0||(H.push(y),o&&o===y||(m=y.x-z.x,w=y.y-z.y,Math.abs(m)<Math.abs(f)?(f=m,M=[y]):m===f&&M.push(y),Math.abs(w)<Math.abs(G)?(G=w,Q=[y]):w===G&&Q.push(y)));var X=$._interactor.getStyle("smartGuideThreshold");if((Math.abs(f)>X||"y"===v)&&(M=null),(Math.abs(G)>X||"x"===v)&&(Q=null),M||Q){var n=!1,N={};if(M&&(n=!0,N.xList=M,N.x=f),Q&&(n=!0,N.yList=Q,N.y=G),n)return N}}},kl.prototype._46O=function(U){var K=this;K.editing&&(K.editing=null,K._interactor.fi({kind:"endEditPoint",event:U})),K._guideInfo=null,K._edgeHostGuideInfo=null,K._pan&&(K._pan=null,K._interactor.fi({kind:"endPan",event:U})),K._multiSelect&&(K._handleMultiSelect(K._multiSelect),K._multiSelect=null),K.tipInfo=null,K.edgeEditResult=null},kl.prototype._handleMultiSelect=function(D){if(D.startPoint&&D.endPoint){var d,X,z,F,k,b=this,e=b._interactor,W=e.gv,H=Tm.toScreenPosition(W,D.startPoint),_=Tm.toScreenPosition(W,D.endPoint),Y=R.Default.unionPoint(H,_),q=b.screenInfo.curve._curves,p=[],O=function(J){J.x>=Y.x&&J.y>=Y.y&&J.x<=Y.x+Y.width&&J.y<=Y.y+Y.height&&p.indexOf(J)<0&&p.push(J)};for(d=0,X=q.length;X>d;d++)k=q[d],O(k._p1),O(k._p4);if(p.length){var j=b.activing||{},h=j.selections||[];for(j.point&&h.push(j.point),d=0,X=h.length;X>d;d++)z=h[d],F=p.indexOf(z),F>=0?p[F]=x:p.push(z);var v=p;for(p=[],d=0,X=v.length;X>d;d++)v[d]&&p.push(v[d]);X=p.length,0===X?b.activing=null:1===X?b.activing={point:p[0]}:(z=p[X-1],b.activing={point:z,selections:p.splice(0,X-1)}),e.redraw()}}},kl.prototype._canDeletePoint=function(y,P){var n=this.target;if(!(n instanceof R.Edge))return!0;var l=y._curves[0],J=y._curves[y._curves.length-1];return l._p1===P||J._p4===P?!1:!0},kl.prototype.handleDelete=function(){var D=this;if(D.activing&&D.screenInfo){var S=R.Default.isShiftDown(),Y=D.screenInfo.curve;D._canDeletePoint(Y,D.activing.point)&&Y.deleteRealPoint(D.activing.point,S),D.activing.selections&&D.activing.selections.forEach(function(d){D._canDeletePoint(Y,d)&&Y.deleteRealPoint(d,S)}),D.activing=null,delete D.editing,delete D.tipInfo,delete D.edgeEditResult,delete D._pan,delete D._multiSelect,D._writeToHt(),D._interactor.fp("deleteShapePoint",!1,!0)}},kl.prototype.handleDoubleClick=function(W){var p=this,U=p._interactor._getLogicalPoint(W);if(p.screenInfo&&p._checkEditRealPoint(U)){var e=p.getCurrentSelectintStatus(),k=Tm.Curve.PointType;return e=e===k.Mirrored?k.Straight:k.Mirrored,p._setCurrentSelectionStatus(e),p._interactor._42(),!0}},kl.prototype._drawHighlight=function(I){var Y=this,N=Y.highlight;if(N){var d=N.bezier,v=Y._interactor;d&&Tm.Icons.DrawIcon(v,I,Tm.Icons.ShapeHighlightCurve,[d._p1.x,d._p1.y,d._p2.x,d._p2.y,d._p3.x,d._p3.y,d._p4.x,d._p4.y]);var z=N.point;z&&"insertKnot"===N.type&&Tm.Icons.DrawIcon(v,I,Tm.Icons.ShapeHighlighPoint,z)}},kl.prototype._drawGuide=function(g){var j=this,C=j._guideInfo;if(C){var T,r,f,u,a=C.v;for(T=0;2>T;T++)if(u=0===T?C.xList:C.yList)for(r=0,f=u.length;f>r;r++)Tm.Icons.DrawIcon(j._interactor,g,Tm.Icons.ShapeGuideLine,[a.x,a.y,u[r].x,u[r].y])}},kl.prototype._drawCurrentPoint=function(A){var c=this;if(c.activing){var g=c.activing,L=c.getCurrentSelectintStatus(),e=c._interactor;if(L!==Tm.Curve.PointType.Straight){var z=g.pairs;g.hlpair,g.hltype;var T=g.selections,D=g.editingCtrl;if(z&&!T){var U,O,H;for(O=0,H=z.length;H>O;O++)U=z[O],D&&O===D.pairId&&U[D.type]?Tm.Icons.DrawIcon(e,A,Tm.Icons.ShapeActivingCtrl,{point:U.point,c1:U.c1,c2:U.c2,hl:D.type}):Tm.Icons.DrawIcon(e,A,Tm.Icons.ShapeActivingCtrl,U)}}Tm.Icons.DrawIcon(e,A,Tm.Icons.ShapeHighlighRealPoint,c.activing.point),T&&T.forEach(function(J){Tm.Icons.DrawIcon(e,A,Tm.Icons.ShapeHighlighRealPoint,J)})}},kl.prototype.clear=function(){var C=this;C.editing=null,C._guideInfo=null,C.activing=null,C.highlight=null},kl.prototype._42=function(P){var h=this;h.info={},h.editing||(h.screenInfo=null);var X=h._interactor;if(!X.editDetail)return h.clear(),void 0;var p=X.gv;if(!h.target||!p.isSelected(h.target)||!p.isVisible(h.target))return X.editDetail=!1,h.clear(),void 0;if(h.gatherSingleTarget(p,h.target),Tm.Icons.DrawIcon(X,P,Tm.Icons.ShapeBgCurve,h.screenInfo),h._interactor.getStyle("curveElevationVisible")&&(h.target instanceof R.Polyline||h.target instanceof R.Edge&&h._interactor.getStyle("edgeElevationEditable"))&&h.activing){var M=h.activing.getCurrentEditingPoint();M&&"string"!=typeof M.e&&Tm.Icons.DrawIcon(X,P,Tm.Icons.EdgeElevationGuide,M)}if(h._drawHighlight(P),h._drawCurrentPoint(P),h._getRealPoint().forEach(function(B){Tm.Icons.DrawIcon(X,P,Tm.Icons.ShapePoint,B)}),h._drawGuide(P),h.tipInfo&&h._interactor.getStyle("curveTipVisible")&&Tm.Icons.DrawIcon(X,P,Tm.Icons.TipHelper,h.tipInfo),h._edgeHostGuideInfo&&X._drawHostGuide(h._edgeHostGuideInfo),h.edgeEditResult&&h._drawEdgeHostHighlight(P,h.edgeEditResult.host,h.edgeEditResult.anchor),h._multiSelect&&h._multiSelect.endPoint){var t=R.Default.unionPoint(Tm.toScreenPosition(p,h._multiSelect.startPoint),Tm.toScreenPosition(p,h._multiSelect.endPoint));t.color=p.getRectSelectBorderColor(),P.save(),P.setTransform(1,0,0,1,0,0);var J=o.devicePixelRatio,V=t.borderWidth=Math.round(J);V/=2,t.x=Math.round(t.x*J)+V,t.y=Math.round(t.y*J)+V,t.width=Math.round(t.width*J),t.height=Math.round(t.height*J),Tm.Icons.DrawIcon(X,P,Tm.Icons.SimpleRect,t),P.restore()}},kl.prototype._drawEdgeHostHighlight=function(y,F,W){this.drawEdgeHostHighlight(y,F,W),this._interactor.redraw()},kl.prototype.drawEdgeHostHighlight=function(t,v,V){if(xr(v)){var $,r,_,k,Q=this,i=Q._interactor,S=i.gv,C=S.getDataUI(v),z=Um(C),K=[];for(_=0,k=z.points.length;k>_;_++)r=Tm.toScreenPosition(S,z.points.get(_)),K.push(r.x,r.y);z.segments&&($=z.segments.toArray());var J=i.getStyle("edgeHostHighlighPeriod"),s=i.getStyle("edgeHostEdgeHighlighColor");Tm.Icons.DrawIcon(i,t,Tm.Icons.ShapeBgCurve,{P:K,S:$,color:s,dynamicVisible:V.index===x,dynamicPeriod:J}),s=i.getStyle("edgeHostPointHighlighColor");var b=ip(C);for(_=0,k=b.length;k>_;_++){var I=b[_],Y=Tm.toScreenPosition(S,I);Tm.Icons.DrawIcon(i,t,Tm.Icons.ShapePoint,{point:{x:Y.x,y:Y.y},color:s,size:12,dynamicVisible:_===V.index,dynamicPeriod:J})}}},kl.prototype._getRealPoint=function(){var n,J=this.screenInfo,j=J.P,P=J.S,L=-1,t=[],y=-1,A=P.length;return P.each(function(r){y++;var $=1;if(3===r)$=2;else if(4===r)$=3;else if(5===r)return;L+=$,n=y+1>=A?!0:1===P.get(y+1)?!0:!1,t.push({point:{x:j[2*L],y:j[2*L+1]},segmentIndex:y,pointIndex:L,isEnd:n})}),t},kl.prototype.getEditingPointsInfo=function(W){var F=this,l=F.activing;if(!l)return!1;var N=l.point;if(!N)return!1;var o=this._getRealPoint(),Q=[{screen:N}];l.selections&&l.selections.forEach(function(h){Q.push({screen:h})});var X,U,w=o.length;return Q.forEach(function($){for(X=0;w>X;X++)if(U=o[X],$.screen.isNearEnough(U.point)){$.segmentIndex=U.segmentIndex,$.pointIndex=U.pointIndex,$.point=F.target.getPoints().get(U.pointIndex);break}}),W&&Q.sort(function(V,Q){return V.segmentIndex-Q.segmentIndex}),Q};var Cj=Tm.MoveHelper=function(V){var a=this;a.catalog="Move",a._interactor=V};Cj.prototype={},Cj.prototype.constructor=Cj,Cj.prototype.calcShift=function(F,j,t){var N,X,U=this,E=U._interactor.gv,H=E.lp(j);if("beginMove"===F&&U._gatherGridInfo(t._lastLogicalPoint||H),N=U._target){var K=N.downPosition;if(K){var V=U._interactor.getStyle("moveSensitivity")/E._zoom;if(K.distanceTo(H)<V)return{x:0,y:0};delete N.downPosition}var b;X=R.Default.isShiftDown(j),X&&(H=U._dealShiftDown(H),b=N.shiftGuide.dir);var C,w=N.rawPos={x:N.pos.x+H.x-N.lp.x,y:N.pos.y+H.y-N.lp.y};if(R.Default.isCtrlDown(j)){if(C=U._calcShiftByAddon(),U._target.node instanceof Tm.Group){var f=U._target.node;f._position.x+=C.x,f._position.y+=C.y}return C}var g=U._interactor.rectGuide;if(N.node instanceof R.Data&&N.node.s("2d.attachable")){var J=U._calcAttachNodeShift(N.node,w);if(g.clear(),J)return J}for(var Q,D=N.x+w.x,p=N.y+w.y,S={x:D,y:p},I={x:D+N.w/2,y:p+N.h/2},O={x:D+N.w,y:p+N.h},M=U._interactor.gridGuide,x=[g.findClosest(S,b),g.findClosest(I,b),g.findClosest(O,b),M.findClosest(S,b),M.findClosest(I,b),M.findClosest(O,b)],r=1/0,A=1/0,q=0,T=x.length;T>q;q++)Q=x[q],Q&&(D=Q.x,p=Q.y,isFinite(D)&&Math.abs(D)<Math.abs(r)&&(r=D),isFinite(p)&&Math.abs(p)<Math.abs(A)&&(A=p));if(isFinite(r)||(r=0),isFinite(A)||(A=0),C=U._calcShiftByAddon(r,A),U._target.node instanceof Tm.Group){var f=U._target.node;f._position.x+=C.x,f._position.y+=C.y}var c=N.node;if(!Te(c,E)){var G=w.x+r,P=w.y+A;U._interactor.rectGuide.gatherLines({node:c,x:N.x+G,y:N.y+P,w:N.w,h:N.h},b)}return C}},Cj.prototype._calcShiftByAddon=function(C,x){var c=this._target,h=c.rawPos,q=c.node.getPosition();return C=C||0,x=x||0,{x:h.x-q.x+C,y:h.y-q.y+x}},Cj.prototype._dealShiftDown=function(_){var i=this,u=i._target.shiftGuide,O=i._target.lp,c=Math.abs(_.x-O.x),T=Math.abs(_.y-O.y);c>T&&c>u.limit&&"y"===u.dir&&(u.dir="x"),T>c&&T>u.limit&&"x"===u.dir&&(u.dir="y");var N=u.dir;return"x"===N?(_.y=O.y,u.limit=Math.max(u.limit,c)):"y"===N&&(_.x=O.x,u.limit=Math.max(u.limit,T)),_},Cj.prototype._isAttachableLineShape=function(n){if(!n.getSegments)return!1;var Z=n.getSegments();if(!Z)return!0;Z instanceof R.List&&(Z=Z.getArray());for(var e=1,F=Z.length;F>e;e++)if(2!==Z[e])return!1;return!0},Cj.prototype._calcAttachNodeShift=function(){var c=new lm,T=new lm,E=new lm,j=new lm;return function(L,n){var P=this._interactor.gv,i=L.getHost(),t=P.getDataAt(n,function(p){return p.s("2d.hostable")?!0:!1});if(t&&i!==t&&L.setHost(t),!t)return this._edgeHostGuideInfo=null,L.setHost(null);var R=this._edgeHostGuideInfo={corners:Tm.getTargetCornersOnScreen(P,t),host:t,attach:-1};if(this._isAttachableLineShape(t)){for(var Z,g,u,y,_,A,f=t.getPoints(),M=f.size(),w=t.getPointsMatrix2d(),X=1/0,Y=0;M>Y&&(Y!==M-1||t.isClosePath());Y++)0!==Y?T.copy(E):w.apply(f.get(Y),T),w.apply(Y===M-1?f.get(0):f.get(Y+1),E),c.copy(n).sub(T),j.copy(E).sub(T),Z=j.length(),j.divideScalar(Z),g=c.dot(j),0>g?g=0:g>Z&&(g=Z),j.multiplyScalar(g).add(T),u=c.copy(n).sub(j).lengthSq(),X>u&&(X=u,A=Y,y=g,_=Z);return Math.sqrt(X)*P.getZoom()>this._interactor.getStyle("attachThreshold")?(L.s({"attach.index":-1}),L.setHost(null),void 0):(L.s("attach.offset.opposite")&&(y=_-y),L.s({"attach.index":A,"attach.offset":L.s("attach.offset.relative")?y/_:y}),{x:0,y:0})}var W=P.calculateAttachPoint(t,n);if(W){var h=W.point;return R.attach=W.index,this._calcShiftByAddon(h.x-n.x,h.y-n.y)}}}(),Cj.prototype._gatherGridInfo=function(p){var O,d=this,y=d._interactor,t=y._getValidSelection();if(t.length){if(1===t.length){if(O=t[0],!O.getRect)return d._target=null,void 0}else if(O=Tm.Group.findOrCreateGroup(t),!O)return d._target=null,void 0}else{var t=y.gv.sm().getSelection();if(t.length&&(O=t.get(0),!O.getRect))return d._target=null,void 0}if(O){var z=O.getPosition(),R=O.getRect();
d._target={node:O,x:R.x-z.x,y:R.y-z.y,w:R.width,h:R.height,lp:{x:p.x,y:p.y},pos:{x:z.x,y:z.y},shiftGuide:{dir:"x",limit:0},downPosition:new Tm.Math.Vector2(p)},y.rectGuide.gatherRects()}},Cj.prototype.clear=function(){var j=this;j._edgeHostGuideInfo=null,j._interactor.rectGuide.clear(),j._interactor._42()},Cj.prototype._42=function(){var F=this._edgeHostGuideInfo;F&&this._interactor._drawHostGuide(F)};var bi=U.freeze({DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,HALF_FLOAT_OES:36193,DOUBLE:5130,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047}),Dq=function(){function D(l,t){var Q=x;return function(){return Q||(Q=l.getExtension(t)),Q}}function c(h,_){_==x&&(_={}),_.version=g&&(h instanceof WebGL2RenderingContext||U.prototype.toString.call(h)===w)?2:1,_.extensions=function(){for(var j={},u=h.getSupportedExtensions(),G=u.length;G--;)j[name]=D(h,u[G]);return j}();for(var F=U.keys(N),C=0,G=F.length;G>C;++C){var M=F[C];_[M]=h.getParameter(N[M])}if(_.version>1){F=U.keys(Z);for(var C=0,G=F.length;G>C;++C){var M=F[C];_[M]=h.getParameter(Z[M])}}return _}var g="undefined"!=typeof WebGL2RenderingContext,w="[object WebGL2RenderingContext]",N={aliasedLineWidthRange:bi.ALIASED_LINE_WIDTH_RANGE,aliasedPointSizeRange:bi.ALIASED_POINT_SIZE_RANGE,maxCombinedTextureImageUnits:bi.MAX_COMBINED_TEXTURE_IMAGE_UNITS,maxCubeMapTextureSize:bi.MAX_CUBE_MAP_TEXTURE_SIZE,maxFragmentUniformVectors:bi.MAX_FRAGMENT_UNIFORM_VECTORS,maxRenderBufferSize:bi.MAX_RENDERBUFFER_SIZE,maxTextureImageUnits:bi.MAX_TEXTURE_IMAGE_UNITS,maxTextureSize:bi.MAX_TEXTURE_SIZE,maxVaryingVectors:bi.MAX_VARYING_VECTORS,maxVertexAttribs:bi.MAX_VERTEX_ATTRIBS,maxVertexTextureImageUnits:bi.MAX_VERTEX_TEXTURE_IMAGE_UNITS,maxVertexUniformVectors:bi.MAX_VERTEX_UNIFORM_VECTORS,maxViewportDIMs:bi.MAX_VIEWPORT_DIMS},Z={max3DTextureSize:bi.MAX_3D_TEXTURE_SIZE,maxArrayTextureLayers:bi.MAX_ARRAY_TEXTURE_LAYERS,maxColorAttachments:bi.MAX_COLOR_ATTACHMENTS,maxCombinedFragmentUniformComponents:bi.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS,maxCombinedUniformBlocks:bi.MAX_COMBINED_UNIFORM_BLOCKS,maxCombinedVertexUniformComponents:bi.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS,maxDrawBuffers:bi.MAX_DRAW_BUFFERS,maxElementIndex:bi.MAX_ELEMENT_INDEX,maxElementsIndices:bi.MAX_ELEMENTS_INDICES,maxElementsVertices:bi.MAX_ELEMENTS_VERTICES,maxFragmentInpuComponents:bi.MAX_FRAGMENT_INPUT_COMPONENTS,maxFragmentUniformBlocks:bi.MAX_FRAGMENT_UNIFORM_BLOCKS,maxFragmentUniformComponents:bi.MAX_FRAGMENT_UNIFORM_COMPONENTS,maxProgramTexelOffset:bi.MAX_PROGRAM_TEXEL_OFFSET,maxSamples:bi.MAX_SAMPLES,maxTextureLODBias:bi.MAX_TEXTURE_LOD_BIAS,maxTransformFeedbackInterleavedComponents:bi.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS,maxTransformFeedbackSeparateAttribs:bi.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS,maxTransformFeedbackSeparateComponents:bi.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS,maxUniformBlockSize:bi.MAX_UNIFORM_BLOCK_SIZE,maxUniformBufferBindings:bi.MAX_UNIFORM_BUFFER_BINDINGS,maxVaryingComponents:bi.MAX_VARYING_COMPONENTS,maxVertexOutputComponents:bi.MAX_VERTEX_OUTPUT_COMPONENTS,maxVertexUniformBlocks:bi.MAX_VERTEX_UNIFORM_BLOCKS,maxVertexUniformComponents:bi.MAX_VERTEX_UNIFORM_COMPONENTS,minProgramTexelOffset:bi.MIN_PROGRAM_TEXEL_OFFSET};return{"for":function(g){var u=g._info;return u||(g._info=u=c(g,u)),u}}}(),Mm=function(){function J(x,b,q){return{def:x,getter:q?function(s){var H=Dq.for(s);return H.version>1?s.getParameter(b):x}:function(F){return F.getParameter(b)},setter:q?function(f,w){var S=Dq.for(f);S.version>1&&f.pixelStorei(b,w)}:function(F,c){F.pixelStorei(b,c)}}}function D(B){return"string"==typeof B?Em(B):B.r!==x?(F[0]=B.r,F[1]=B.g,F[2]=B.b,F[3]=B.a,F):B.red!==x?(F[0]=B.red,F[1]=B.green,F[2]=B.blue,F[3]=B.alpha,F):B}function t(j){return i(j)?Array.prototype.slice.call(j,0):j}function y(z,A,n){this.gl=A,this._record=n||{},this._branches={},this._leafSync={},this._struct=z;for(var x=z.children,y=x.length;y--;){var D=x[y],S=D.name;D.isLeaf?(this._leafSync[S]=!1,this._record[S]=t(D.desc.def)):this._record[S]={}}}function Q(f){function o(Z,z){y.call(this,f,Z,z);for(var P=w.length;P--;){var m=w[P];this._branches[m._name]=new m._type(Z,this._record[m._name])}}function W(R,k){function W(i,P){for(var v=N,e=!1;v--;)i[v]!==P[v]&&(i[v]=P[v],e=!0);return e}var u=R.name,h=i(R.desc.def),N=h&&R.desc.def.length;if(R.isLeaf){var C=R.desc.setter,x=R.desc.parse;U.defineProperty(k,u,{configurable:!1,enumerable:!0,get:function(){return this._record[u]},set:h?function(f){x&&(f=x(f)),(W(this._record[u],f)||!this._leafSync[u])&&(C(this.gl,this._record[u]),this._leafSync[u]=!0)}:function(T){this._record[u]===T&&this._leafSync[u]||(C(this.gl,T),this._record[u]=T,this._leafSync[u]=!0)}})}else w.push({_name:u,_type:Q(R)}),U.defineProperty(k,u,{configurable:!1,enumerable:!0,get:function(){return this._branches[u]},set:function(X){this._branches[u].apply(X)}})}var w=[];return $(o,y),f.forEach(W,o.prototype),o}var F="undefined"!=typeof Float32Array&&new Float32Array(4),q={viewport:{def:[0,0,0/0,0/0],getter:function(K){return K.getParameter(K.VIEWPORT)},setter:function(Y,d){var S=d[2]!==d[2]?Y.drawingBufferWidth-d[0]:d[2],r=d[3]!==d[3]?Y.drawingBufferHeight-d[1]:d[3];Y.viewport(d[0],d[1],S,r)}},dither:{def:!1,getter:function(K){return K.isEnabled(K.DITHER)},setter:function(y,X){X?y.enable(y.DITHER):y.disable(y.DITHER)}},rasterizerDiscard:{def:!1,getter:function(B){var h=Dq.for(B);return h.version>1&&B.isEnabled(B.RASTERIZER_DISCARD)},setter:function(s,$){var y=Dq.for(s);1!==y.version&&($?s.enable(s.RASTERIZER_DISCARD):s.disable(s.RASTERIZER_DISCARD))}},lineWidth:{def:1,getter:function(M){return M.lineWidth?M.getParameter(M.LINE_WIDTH):1},setter:function(M,D){M.lineWidth&&M.lineWidth(D)}},color:{clear:{def:[0,0,0,0],getter:function(x){return x.getParameter(x.COLOR_CLEAR_VALUE)},setter:function(m,M){m.clearColor(M[0],M[1],M[2],M[3])},parse:D},mask:{def:[!0,!0,!0,!0],getter:function(i){return i.getParameter(i.COLOR_WRITEMASK)},setter:function(S,B){S.colorMask(B[0],B[1],B[2],B[3])}}},blend:{enabled:{def:!1,getter:function(e){return e.isEnabled(e.BLEND)},setter:function(H,l){l?H.enable(H.BLEND):H.disable(H.BLEND)}},color:{def:[0,0,0,0],getter:function(u){return u.getParameter(u.BLEND_COLOR)},setter:function(Q,q){Q.blendColor(q[0],q[1],q[2],q[3])},parse:D},equation:{def:[bi.FUNC_ADD,bi.FUNC_ADD],getter:function(j){return[j.getParameter(j.BLEND_EQUATION_RGB),j.getParameter(j.BLEND_EQUATION_ALPHA)]},setter:function(O,E){O.blendEquationSeparate(E[0],E[1])},parse:function(P){var q=P.length;return q>1?P:1===q?(F[1]=F[0]=P[0],F):(F[1]=F[0]=P,F)}},func:{def:[bi.ONE,bi.ZERO,bi.ONE,bi.ZERO],getter:function(l){return[l.getParameter(l.BLEND_SRC_RGB),l.getParameter(l.BLEND_DST_RGB),l.getParameter(l.BLEND_SRC_ALPHA),l.getParameter(l.BLEND_DST_ALPHA)]},setter:function(k,v){k.blendFuncSeparate(v[0],v[1],v[2],v[3])},parse:function(A){var v=A.length;return v>3?A:(F[2]=F[0]=A[0],F[3]=F[1]=A[1],F)}}},cullFace:{enabled:{def:!1,getter:function(R){return R.isEnabled(R.CULL_FACE)},setter:function(P,H){H?P.enable(P.CULL_FACE):P.disable(P.CULL_FACE)}},mode:{def:bi.BACK,getter:function(u){return u.getParameter(u.CULL_FACE_MODE)},setter:function(F,N){F.cullFace(N)}},frontFace:{def:bi.CCW,getter:function(p){return p.getParameter(p.FRONT_FACE)},setter:function(K,w){K.frontFace(w)}}},scissor:{enabled:{def:!1,getter:function(G){return G.isEnabled(G.SCISSOR_TEST)},setter:function(q,A){A?q.enable(q.SCISSOR_TEST):q.disable(q.SCISSOR_TEST)}},box:{def:[0,0,0/0,0/0],getter:function(X){return X.getParameter(X.SCISSOR_BOX)},setter:function(M,S){var C=S[2]!==S[2]?M.drawingBufferWidth-S[0]:S[2],x=S[3]!==S[3]?M.drawingBufferHeight-S[1]:S[3];M.scissor(S[0],S[1],C,x)}}},depth:{enabled:{def:!1,getter:function(i){return i.isEnabled(i.DEPTH_TEST)},setter:function(Q,A){A?Q.enable(Q.DEPTH_TEST):Q.disable(Q.DEPTH_TEST)}},clear:{def:1,getter:function(G){return G.getParameter(G.DEPTH_CLEAR_VALUE)},setter:function(c,F){c.clearDepth(F)}},mask:{def:!0,getter:function(D){return D.getParameter(D.DEPTH_WRITEMASK)},setter:function(n,d){n.depthMask(d)}},range:{def:[-1,1],getter:function(N){return N.getParameter(N.DEPTH_RANGE)},setter:function(q,n){q.depthRange(n[0],n[1])}},func:{def:bi.LESS,getter:function(v){return v.getParameter(v.DEPTH_FUNC)},setter:function(M,K){M.depthFunc(K)}}},stencil:{enabled:{def:!1,getter:function(p){return p.isEnabled(p.STENCIL_TEST)},setter:function(D,C){C?D.enable(D.STENCIL_TEST):D.disable(D.STENCIL_TEST)}},clear:{def:0,getter:function(j){return j.getParameter(j.STENCIL_CLEAR_VALUE)},setter:function(A,t){A.clearStencil(t)}},frontMask:{def:255,getter:function(t){return t.getParameter(t.STENCIL_WRITEMASK)},setter:function(f,u){f.stencilMaskSeparate(f.FRONT,u)}},frontOp:{def:[bi.KEEP,bi.KEEP,bi.KEEP],getter:function(K){return[K.getParameter(K.STENCIL_FAIL),K.getParameter(K.STENCIL_PASS_DEPTH_FAIL),K.getParameter(K.STENCIL_PASS_DEPTH_PASS)]},setter:function(x,Q){x.stencilOpSeparate(x.FRONT,Q[0],Q[1],Q[2])}},frontFunc:{def:[bi.ALWAYS,0,255],getter:function(Q){return[Q.getParameter(Q.STENCIL_FUNC),Q.getParameter(Q.STENCIL_REF),Q.getParameter(Q.STENCIL_VALUE_MASK)]},setter:function(P,p){P.stencilFuncSeparate(P.FRONT,p[0],p[1],p[2])}},backMask:{def:255,getter:function(u){return u.getParameter(u.STENCIL_BACK_WRITEMASK)},setter:function(D,i){D.stencilMaskSeparate(D.BACK,i)}},backOp:{def:[bi.KEEP,bi.KEEP,bi.KEEP],getter:function(V){return[V.getParameter(V.STENCIL_BACK_FAIL),V.getParameter(V.STENCIL_BACK_PASS_DEPTH_FAIL),V.getParameter(V.STENCIL_BACK_PASS_DEPTH_PASS)]},setter:function(V,$){V.stencilOpSeparate(V.BACK,$[0],$[1],$[2])}},backFunc:{def:[bi.ALWAYS,0,255],getter:function(f){return[f.getParameter(f.STENCIL_BACK_FUNC),f.getParameter(f.STENCIL_BACK_REF),f.getParameter(f.STENCIL_BACK_VALUE_MASK)]},setter:function(V,Y){V.stencilFuncSeparate(V.BACK,Y[0],Y[1],Y[2])}}},hint:{generateMipmap:{def:bi.DONT_CARE,getter:function(G){return G.getParameter(G.GENERATE_MIPMAP_HINT)},setter:function(f,w){f.hint(f.GENERATE_MIPMAP_HINT,w)}},fragmentShaderDerivative:{def:bi.DONT_CARE,getter:function(j){var X=Dq.for(j);return 1!==X.version||X.extensions.OES_standard_derivatives?j.getParameter(bi.FRAGMENT_SHADER_DERIVATIVE_HINT):bi.DONT_CARE},setter:function(u,Y){var M=Dq.for(u);return M.version>1||M.extensions.OES_standard_derivatives?(u.hint(bi.FRAGMENT_SHADER_DERIVATIVE_HINT,Y),void 0):void 0}}},pixelStore:{packAlignment:J(4,bi.PACK_ALIGNMENT,!1),unpackAlignment:J(4,bi.UNPACK_ALIGNMENT,!1),unpackFlipY:J(!1,bi.UNPACK_FLIP_Y_WEBGL,!1),unpackPremultiplyAlpha:J(!1,bi.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),unpackColorspaceConversion:J(bi.BROWSER_DEFAULT_WEBGL,bi.UNPACK_COLORSPACE_CONVERSION_WEBGL,!1),packRowLength:J(0,bi.PACK_ROW_LENGTH,!0),packSkipPixels:J(0,bi.PACK_SKIP_PIXELS,!0),packSkipRows:J(0,bi.PACK_SKIP_ROWS,!0),unpackRowLength:J(0,bi.UNPACK_ROW_LENGTH,!0),unpackImageHeight:J(0,bi.UNPACK_IMAGE_HEIGHT,!0),unpackSkipPixels:J(0,bi.UNPACK_SKIP_PIXELS,!0),unpackSkipRows:J(0,bi.UNPACK_SKIP_ROWS,!0),unpackSkipImages:J(0,bi.UNPACK_SKIP_IMAGES,!0)},polygonOffset:{enabled:{def:!1,getter:function(Q){return Q.isEnabled(Q.POLYGON_OFFSET_FILL)},setter:function(S,y){y?S.enable(S.POLYGON_OFFSET_FILL):S.disable(S.POLYGON_OFFSET_FILL)}},value:{def:[0,0],getter:function(O){return[O.getParameter(O.POLYGON_OFFSET_FACTOR),O.getParameter(O.POLYGON_OFFSET_UNITS)]},setter:function(J,N){J.polygonOffset(N[0],N[1])}}},sampleCoverage:{enabled:{def:!1,getter:function(A){return A.isEnabled(A.SAMPLE_COVERAGE)},setter:function(r,e){e?r.enable(r.SAMPLE_COVERAGE):r.disable(r.SAMPLE_COVERAGE)}},alpha:{def:!1,getter:function(u){return u.isEnabled(u.SAMPLE_ALPHA_TO_COVERAGE)},setter:function(n,i){i?n.enable(n.SAMPLE_ALPHA_TO_COVERAGE):n.disable(n.SAMPLE_ALPHA_TO_COVERAGE)}},value:{def:[1,!1],getter:function(I){return[I.getParameter(I.SAMPLE_COVERAGE_VALUE),I.getParameter(I.SAMPLE_COVERAGE_INVERT)]},setter:function(S,d){S.sampleCoverage(d[0],d[1])}}}},B=Lr.create(q,function(h){return"def"in h});y.prototype.reset=function(){for(var p=this._struct.children,F=p.length;F--;){var U=p[F],J=U.name;U.isLeaf?this[J]=U.desc.def:this._branches[J].reset()}},y.prototype.save=function(N){N==x&&(N={});for(var Y=this._struct.children,$=Y.length;$--;){var W=Y[$],a=W.name;if(W.isLeaf)N[a]=t(this._record[a]);else{var F=N[a];F==x&&(N[a]=F={}),this._branches[a].save(F)}}return N},y.prototype.sync=function(E,F){for(var l=this._struct.children,C=l.length;C--;){var s=l[C],x=s.name;s.isLeaf?(F||!this._leafSync[x])&&(E?(this._record[x]=s.desc.getter(this.gl),this._leafSync[x]=!0):(s.desc.setter(this.gl,this._record[x]),this._leafSync[x]=!0)):this._branches[x].sync(E,F)}},y.prototype.syncLoss=function(){for(var i=this._struct.children,e=i.length;e--;){var c=i[e];c.isLeaf?this._leafSync[c.name]=!1:this._branches[c.name].syncLoss()}},y.prototype.apply=function(s){for(var Y=this._struct.children,y=Y.length;y--;){var K=Y[y],m=K.name;m in s&&(K.isLeaf?this[m]=s[m]:this._branches[m].apply(s[m]))}},y.prototype.append=function(t){var C=this._struct.childMap;for(var S in t){var M=C[S];M&&(M.isLeaf?this[S]=t[S]:this._branches[S].append(t[S]))}};var w=Q(B);return function(c){var y=c._state;return y||(c._state=y=new w(c)),y}}(),zk=function(){function A(L,V,v,g){if(L){var q=L.length;if(q!=x)for(var p=0;g>p;++p)V[v+p]=L[p];else L.toArray&&L.toArray(V,v)}else for(var p=0;g>p;++p)V[v+p]=0}function g(X,C,p){var M=X[0];if(0>=M||M>0)return X;var B=C*p,H=j[B];if(H==x&&(j[B]=new Float32Array(B)),0!==C){A(M,H,0,p);for(var m=1,s=0;m!==C;++m)s+=p,A(X[m],H,s,p)}return H}function B(R,a){R.uniform1f(this.addr,a)}function R(T,i){T.uniform1fv(this.addr,i)}function O(F,y){if(y.x!=x)F.uniform2f(this.addr,y.x,y.y);else{var g=j[2];g.set(y,0),F.uniform2fv(this.addr,g)}}function l(j,W){j.uniform2fv(this.addr,g(W,this.size,2))}function m(Z,k){if(k.x!=x)Z.uniform3f(this.addr,k.x,k.y,k.z);else if(k.r!=x)Z.uniform3f(this.addr,k.r,k.g,k.b);else if(k.red!=x)Z.uniform3f(this.addr,k.red,k.green,k.blue);else{var D=j[3];D.set(k,0),Z.uniform3fv(this.addr,D)}}function N(j,J){j.uniform3fv(this.addr,g(J,this.size,3))}function c(q,o){if("string"==typeof o&&(o=Em(o)),o.x!=x)q.uniform4f(this.addr,o.x,o.y,o.z,o.w);else if(o.r!=x)q.uniform4f(this.addr,o.r,o.g,o.b,o.a);else if(o.red!=x)q.uniform4f(this.addr,o.red,o.green,o.blue,o.alpha);else{var U=j[4];U.set(o,0),q.uniform4fv(this.addr,U)}}function h(A,X){A.uniform4fv(this.addr,g(X,this.size,4))}function t(Q,v){Q.uniform1i(this.addr,v)}function D(l,p){l.uniform1iv(this.addr,p)}function s(g,I){g.uniform2iv(this.addr,I)}function a(A,P){A.uniform3iv(this.addr,P)}function Y(k,r){k.uniform4iv(this.addr,r)}function K(K,b){K.uniform1i(this.addr,G[b?1:0])}function H(O,g){var u=j[4];u.set(g,0),O.uniformMatrix2fv(this.addr,!1,u)}function E(W,T){W.uniformMatrix2fv(this.addr,!1,g(T,this.size,4))}function Z(s,_){var E=j[9];E.set(_,0),s.uniformMatrix3fv(this.addr,!1,E)}function P(J,k){J.uniformMatrix3fv(this.addr,!1,g(k,this.size,9))}function T(u,C){var U=j[16];U.set(C,0),u.uniformMatrix4fv(this.addr,!1,U)}function e(h,d){h.uniformMatrix4fv(this.addr,!1,g(d,this.size,16))}function _(Y,G){Y.uniform1i(this.addr,this.slots[0]),Y.activeTexture(Y.TEXTURE0+this.slots[0]),Y.bindTexture(Y.TEXTURE_2D,G||Y._emptyTexture)}function n(Z,y){Z.uniform1iv(this.addr,this.slots);for(var g=this.slots.length;g--;)Z.activeTexture(Z.TEXTURE0+this.slots[g]),Z.bindTexture(Z.TEXTURE_2D,y[g]||Z._emptyTexture)}function Q(W,x){W.uniform1i(this.addr,this.slots[0]),W.activeTexture(W.TEXTURE0+this.slots[0]),W.bindTexture(W.TEXTURE_CUBE_MAP,x||W._emptyCubeTexture)}function q(f,u){f.uniform1iv(this.addr,this.slots);for(var D=this.slots.length;D--;)f.activeTexture(f.TEXTURE0+this.slots[D]),f.bindTexture(f.TEXTURE_CUBE_MAP,u[D]||f._emptyCubeTexture)}function S(p,y,u){r[p]=[y,u]}function F(S,a,c){switch(S.type){case 35678:case 35680:if("uSampler"===c)return[0];if("uBlendSampler"===c)return[1];for(var Y=S.size,I=new Int32Array(Y),z=0;Y>z;++z)I[z]=a.usedTextureSlot++;return I}return x}function u(o,J,n,M,B){this.name=o,this.addr=J,this.size=M?n.size:0,this.activeInfo=n,this.setter=r[n.type][M?1:0],this.slots=F(n,B,o),Uj(this)}function I(H,F,G,q){var n=H.name,B=n.length;for(f.lastIndex=0;;){var g=f.exec(n),h=f.lastIndex,Z=g[1],w="]"===g[2],e=g[3];if(w&&(Z=0|Z),e===x||"["===e&&h+2===B){G[Z]=new u(Z,F,H,e!==x,q);break}var X=G[Z];X==x&&(G[Z]=X={}),G=X}}function i(e,r,x){this.gl=r,this._program=x,this._leaves={},this._branches={},this._struct=e}function w(P){function Z(f,R){i.call(this,P,f,R);for(var u=j.length;u--;){var J=j[u];this._branches[J._name]=new J._type(f,R)}}function r(B,f){var P=B.name;if(B.isLeaf){var N=L("d.setter(this.gl, v);",["v"],["d"],[B.desc]);U.defineProperty(f,P,{configurable:!1,enumerable:!0,get:function(){return N},set:N})}else j.push({_name:P,_type:w(B)}),U.defineProperty(f,P,{configurable:!1,enumerable:!0,get:function(){return this._branches[P]},set:function(M){this._branches[P].apply(M)}})}var j=[];return $(Z,i),P.forEach(r,Z.prototype),Z}function y(T,D){for(var c=T.getProgramParameter(D,T.ACTIVE_UNIFORMS),M={},f={usedTextureSlot:2};c--;){var p=T.getActiveUniform(D,c),R=p.name,e=T.getUniformLocation(D,R);I(p,e,M,f)}var E=Lr.create(M,function(T){return"addr"in T}),N=w(E);return U.defineProperty(N.prototype,"textureCount",{configurable:!1,enumerable:!1,writable:!1,value:f.usedTextureSlot}),new N(T,D)}var j=[];if("function"==typeof Float32Array)for(var X=1;17>X;++X)j[X]=new Float32Array(X);var G=new Int32Array([0,1]),r=[];S(bi.FLOAT,B,R),S(bi.FLOAT_VEC2,O,l),S(bi.FLOAT_VEC3,m,N),S(bi.FLOAT_VEC4,c,h),S(bi.INT,t,D),S(bi.INT_VEC2,s,s),S(bi.INT_VEC3,a,a),S(bi.INT_VEC4,Y,Y),S(bi.BOOL,K,D),S(bi.BOOL_VEC2,s,s),S(bi.BOOL_VEC3,a,a),S(bi.BOOL_VEC4,Y,Y),S(bi.FLOAT_MAT2,H,E),S(bi.FLOAT_MAT3,Z,P),S(bi.FLOAT_MAT4,T,e),S(bi.SAMPLER_2D,_,n),S(bi.SAMPLER_CUBE,Q,q);var f=/([\w\d_]+)(\])?(\[|\.)?/g;return i.prototype.apply=function(B){for(var j=this._struct.children,f=j.length;f--;){var W=j[f],I=W.name;I in B&&(W.isLeaf?this[I]=B[I]:this._branches[I].apply(B[I]))}},i.prototype.append=function(B){var $=this._struct.childMap;for(var E in B){var i=$[E];i&&(i.isLeaf?this[E]=B[E]:this._branches[E].append(B[E]))}},function(V,T){var Z=T._uniforms;return Z||(T._uniforms=Z=y(V,T)),Z}}(),Oq=function(){function M(A,C,k){C.vertexAttrib1f(A.addr,k)}function I(A,_,g){if(g.x!=x)_.vertexAttrib2f(A.addr,g.x,g.y);else{var $=s[2];$.set(g,0),_.vertexAttrib2fv(A.addr,$)}}function r(c,V,o){if(o.x!=x)V.vertexAttrib3f(c.addr,o.x,o.y,o.z);else if(o.r!=x)V.vertexAttrib3f(c.addr,o.r,o.g,o.b);else if(o.red!=x)V.vertexAttrib3f(c.addr,o.red,o.green,o.blue);else{var g=s[3];g.set(o,0),V.vertexAttrib3fv(c.addr,g)}}function Z(F,P,z){if("string"==typeof z&&(z=Em(z)),z.x!=x)P.vertexAttrib4f(F.addr,z.x,z.y,z.z,z.w);else if(z.r!=x)P.vertexAttrib4f(F.addr,z.r,z.g,z.b,z.a);else if(z.red!=x)P.vertexAttrib4f(F.addr,z.red,z.green,z.blue,z.alpha);else{var w=s[4];w.set(z,0),P.vertexAttrib4fv(F.addr,w)
}}function S(s,V,F){F=F.el||F;for(var T=0,v=0;2>T;++T)V.vertexAttrib2f(s.addr,F[v++],F[v++])}function C(M,f,u){u=u.el||u;for(var A=0,h=0;3>A;++A)f.vertexAttrib3f(M.addr,u[h++],u[h++],u[h++])}function o(r,m,v){v=v.el||v;for(var f=0,Q=0;4>f;++f)m.vertexAttrib4f(r.addr,v[Q++],v[Q++],v[Q++],v[Q++])}function G(B,U,Y,k,d,g,M){U.bindBuffer(U.ARRAY_BUFFER,Y),U.vertexAttribPointer(B.addr,1,k||U.FLOAT,!!d,g||0,M||0),U.bindBuffer(U.ARRAY_BUFFER,null)}function W(o,H,a,E,j,y,B){H.bindBuffer(H.ARRAY_BUFFER,a),H.vertexAttribPointer(o.addr,2,E||H.FLOAT,!!j,y||0,B||0),H.bindBuffer(H.ARRAY_BUFFER,null)}function J(b,u,A,z,T,P,J){u.bindBuffer(u.ARRAY_BUFFER,A),u.vertexAttribPointer(b.addr,3,z||u.FLOAT,!!T,P||0,J||0),u.bindBuffer(u.ARRAY_BUFFER,null)}function q(g,p,B,i,P,I,X){p.bindBuffer(p.ARRAY_BUFFER,B),p.vertexAttribPointer(g.addr,4,i||p.FLOAT,!!P,I||0,X||0),p.bindBuffer(p.ARRAY_BUFFER,null)}function d(V,B,K,g,N,m,P){var m=m||4,P=P||0;B.bindBuffer(B.ARRAY_BUFFER,K),B.vertexAttribPointer(V.addr,2,g||B.FLOAT,!!N,m,P),B.vertexAttribPointer(V.addr+1,2,g||B.FLOAT,!!N,m,P+2),B.bindBuffer(B.ARRAY_BUFFER,null)}function j(p,Q,G,X,K,H,d){var H=H||9,d=d||0;Q.bindBuffer(Q.ARRAY_BUFFER,G),Q.vertexAttribPointer(p.addr,3,X||Q.FLOAT,!!K,H,d),Q.vertexAttribPointer(p.addr+1,3,X||Q.FLOAT,!!K,H,d+3),Q.vertexAttribPointer(p.addr+2,3,X||Q.FLOAT,!!K,H,d+6),Q.bindBuffer(Q.ARRAY_BUFFER,null)}function t(j,n,O,$,h,X,v){var X=X||16,v=v||0;n.bindBuffer(n.ARRAY_BUFFER,O),n.vertexAttribPointer(j.addr,4,$||n.FLOAT,!!h,X,v),n.vertexAttribPointer(j.addr+1,4,$||n.FLOAT,!!h,X,v+4),n.vertexAttribPointer(j.addr+2,4,$||n.FLOAT,!!h,X,v+8),n.vertexAttribPointer(j.addr+3,4,$||n.FLOAT,!!h,X,v+12),n.bindBuffer(n.ARRAY_BUFFER,null)}function a(b,K,d){T[b]=function(e,h,H,M,u,r){this.addr==x||this.addr<0||(h==x||h===!1?e.disableVertexAttribArray(this.addr):Lc(h)===A?(e.enableVertexAttribArray(this.addr),d(this,e,h,H,M,u,r)):(e.disableVertexAttribArray(this.addr),K(this,e,h)))}}function B(U,O,W){this.name=U,this.addr=O,this.activeInfo=W,this.setter=T[W.type],Uj(this)}function w(G,t,S){this.gl=t,this.program=S,this._branches={},this._struct=G}function k(E){function m(y,C){w.call(this,E,y,C);for(var d=R.length;d--;){var z=R[d];this._branches[z._name]=new z._type(y,C)}}function I(n,h){var l=n.name;if(n.isLeaf){var V=L("d.setter(this.gl, v);",["v"],["d"],[n.desc]);U.defineProperty(h,l,{configurable:!1,enumerable:!0,get:function(){return V},set:V})}else R.push({_name:l,_type:k(n)}),U.defineProperty(h,l,{configurable:!1,enumerable:!0,get:function(){return this._branches[l]},set:function(V){this._branches[l].apply(V)}})}var R=[];return $(m,w),E.forEach(I,m.prototype),m}function P(a,F){for(var g=a.getProgramParameter(F,a.ACTIVE_ATTRIBUTES),C={};g--;){var P=a.getActiveAttrib(F,g),U=P.name,v=a.getAttribLocation(F,U);C[U]=new B(U,v,P)}var S=Lr.create(C,function(B){return"addr"in B}),j=k(S);return new j(a,F)}var s=[];if(Float32Array)for(var Y=1;17>Y;++Y)s[Y]=new Float32Array(Y);var T=[],A="undefined"!=typeof WebGLBuffer&&WebGLBuffer.prototype;return a(bi.FLOAT,M,G),a(bi.FLOAT_VEC2,I,W),a(bi.FLOAT_VEC3,r,J),a(bi.FLOAT_VEC4,Z,q),a(bi.FLOAT_MAT2,S,d),a(bi.FLOAT_MAT3,C,j),a(bi.FLOAT_MAT4,o,t),w.prototype.disable=function(){for(var Z=this._struct.children,h=Z.length;h--;){var P=Z[h],R=P.name;P.isLeaf?this.gl.disableVertexAttribArray(P.desc.addr):this._branches[R].disable()}},w.prototype.apply=function(K){for(var e=this._struct.children,i=e.length;i--;){var l=e[i],d=l.name;d in K&&(l.isLeaf?this[d]=K[d]:this._branches[d].apply(K[d]))}},w.prototype.append=function(_){var m=this._struct.childMap;for(var y in _){var N=m[y];N&&(N.isLeaf?this[y]=_[y]:this._branches[y].append(_[y]))}},function(R,O){var u=O._attribs;return u||(O._attribs=u=P(R,O)),u}}(),$c=function(p){var D=this;U.defineProperties(this,{gl:{configurable:!1,enumerable:!1,value:p,writable:!1},glState:{configurable:!1,enumerable:!1,value:Mm(p),writable:!1}}),D._currProgram=x,D._currUniforms=x,D._currAttribs=x,D._sync=!0};U.defineProperties($c.prototype,{program:{configurable:!1,enumerable:!1,get:function(){return this._currProgram},set:function(V){var K=this;K._sync&&V===K._currProgram||(K.gl.useProgram(V),K._currProgram=V,K._currUniforms=zk(K.gl,V),K._currAttribs=Oq(K.gl,V),K._sync=!0)}},uniforms:{configurable:!1,enumerable:!1,get:function(){var V=this;return V._currProgram&&!V._sync&&(V.gl.useProgram(V._currProgram),V._sync=!0),V._currUniforms},set:function(K){var U=this;U._currUniforms&&(U._currProgram&&!U._sync&&(U.gl.useProgram(U._currProgram),this._sync=!0),U._currUniforms.apply(K))}},attribs:{configurable:!1,enumerable:!1,get:function(){var d=this;return d._currProgram&&!d._sync&&(d.gl.useProgram(d._currProgram),d._sync=!0),d._currAttribs},set:function(d){var F=this;F._currUniforms&&(F._currProgram&&!F._sync&&(F.gl.useProgram(F._currProgram),this._sync=!0),F._currAttribs.apply(d))}}}),$c.prototype.useProgram=function(e){var L=this;L._sync&&e===L._currProgram||(L.gl.useProgram(e),L._currProgram=e,L._currUniforms=zk(L.gl,e),L._currAttribs=Oq(L.gl,e),L._sync=!0)},$c.prototype.directState=function(){return this.glState},$c.prototype.directUniforms=function(){return this._currUniforms},$c.prototype.directAttribs=function(){return this._currAttribs},$c.prototype.syncLoss=function(){this._sync=!1,this.glState.syncLoss()},$c.for=function(O){var u=O._renderState;return u||(O._renderState=u=new $c(O)),u};var _d="directional",hq="point",eh="spot",yo="light.color",Bd={},Wc=function(r,M){yk(M)&&Hm.test(M)?Me(r,M):Vc(M)&&M.modelType?Nl(r,M):M===x?delete wm[r]:wm[r]=M},um=function(P){return P},qk=function(D){D=m.convertShape3dModelName(D);var A;if(Vc(D)){if(D.modelType){if(D.uuid){if(A=wm[D.uuid])return A}else D.uuid=R.Math.generateUUID();return A===x&&(gi&&gi[D.uuid]||Nl(D.uuid,D)),x}return D}return A=wm[D],D&&A===x&&Hm.test(D)&&(gi&&gi[D]||Me(D,D)),A},jq=function(s,a){s.frameStack?s.frameStack.push(a):s.frameStack=[a],s.bindFramebuffer(s.FRAMEBUFFER,a)},Hc=function(P){var C=P.frameStack;if(C){if(C.pop(),C.length)return P.bindFramebuffer(P.FRAMEBUFFER,C[C.length-1]),void 0;P.frameStack=null}P.bindFramebuffer(P.FRAMEBUFFER,null)};ae(m,{graph3dViewAttributes:z,graph3dViewFirstPersonMode:!1,graph3dViewMouseRoamable:!0,graph3dViewMoveStep:15,graph3dViewRotateStep:j/60,graph3dViewBlockSelectable:!0,graph3dViewEditHelperDisabled:!1,graph3dViewPannable:!0,graph3dViewRotatable:!0,graph3dViewWalkable:!0,graph3dViewResettable:!0,graph3dViewZoomable:!0,graph3dViewRectSelectable:!0,graph3dViewRectSelectBackground:Nm,graph3dViewGridVisible:!1,graph3dViewGridSize:50,graph3dViewGridGap:50,graph3dViewGridColor:[.4,.75,.85,1],graph3dViewMaxPhi:j,graph3dViewMinPhi:0,graph3dViewOriginAxisVisible:!1,graph3dViewCenterAxisVisible:!1,graph3dViewAxisXColor:[1,0,0,1],graph3dViewAxisYColor:[0,1,0,1],graph3dViewAxisZColor:[0,0,1,1],graph3dViewEditSizeColor:[1,1,0,1],graph3dViewOrtho:!1,graph3dViewOrthoWidth:2e3,graph3dViewFovy:j/4,graph3dViewNear:10,graph3dViewFar:1e4,graph3dViewEye:[0,300,1e3],graph3dViewCenter:[0,0,0],graph3dViewUp:[0,1,-1e-7],graph3dViewHeadlightRange:0,graph3dViewHeadlightColor:[1,1,1,1],graph3dViewHeadlightIntensity:1,graph3dViewHeadlightDisabled:!1,graph3dViewHeadlightAmbientIntensity:.7,graph3dViewFogDisabled:!0,graph3dViewFogColor:"white",graph3dViewFogNear:1,graph3dViewFogFar:2e3,graph3dViewPickerResolution:.5,graph3dViewDashDisabled:!0,graph3dViewBatchBlendDisabled:!0,graph3dViewBatchBrightnessDisabled:!0,graph3dViewBatchColorDisabled:!1,graph3dMaxVectorCacheTime:50,setShape3dModel:Wc,getShape3dModel:qk,convertShape3dModelName:um,getShape3dModelMap:function(){return wm},getCachedShape3dModelMap:function(){return Ng},createMatrix:function(N,a){Mf(N)||(N=[N]);for(var r=N.length-1;r>=0;r--){var M=N[r];a=rr(M.mat,M.s3,M.r3,M.rotationMode,M.t3,a)}return a},transformVec:function(i,f){return Eb(i,f)},glBindFrame:jq,glUnbindFrame:Hc,createBoxModel:function(){return{vs:oq,ns:Of,uv:wg,is:Zq}},createRoundRectModel:function(C,v){return sg.roundRect(C,v)},createStarModel:function(b,F){return sg.star(b,F)},createRectModel:function(J,k){return sg.rect(J,k)},createTriangleModel:function(u,f){return sg.triangle(u,f)},createRightTriangleModel:function(A,$){return sg.rightTriangle(A,$)},createParallelogramModel:function(p,v){return sg.parallelogram(p,v)},createTrapezoidModel:function(R,i){return sg.trapezoid(R,i)},createSmoothSphereModel:function(i,V,t,Z,$,g,h){return tr(new uh(i,V,t,Z,$,g,h))},createSphereModel:function(o,j,L,I,v,G,p){return o?Fl(o,j,L,I,v,G,p):m.createSmoothSphereModel()},createSmoothConeModel:function(M,a,m,Y,g){return Xi(M,a,m,Y,g)},createConeModel:function(T,Z,$,Y,R,V){return T?Ni(T,Z,$,Y,R,V):Xi(V)},createSmoothCylinderModel:function(O,N,z,o,y,l,L,_){return tr(new Ej(O,N,z,o,y,l,L,_))},createCylinderModel:function(M,D,h,N,r,j,L,K){return M?Mk(M,D,h,N,r,j,L,K):ud(j,L)},createSmoothTorusModel:function(C,w,N,L,E,v){return tr(new il(C,w,N,L,E,v))},createTorusModel:function(Z,c,q,h,u,Q,C,R){return Z?of(Z,c,q,h,u,Q,C,R):kr(Q,C)},createExtrusionModel:function(v,i,S,B,T,X,L,P){return kb(v,i,S,B,T,X,L,P)},createSmoothRingModel:function(V,w,D,W,e,m){for(var M=[],A=0;A<V.length-1;A+=2)M.push({x:V[A],y:V[A+1]});for(V=Wd(M,w,D)[0],M=[],A=0;A<V.length;A++){var z=V[A];M.push(new Vf(z.x,0,z.y))}return tr(new Br(M,m,W,e))},createTextGeometry:function(A,k){return tr(new Cm(A,k))},loadFontFace:function(H,C){m.xhrLoad(H,function(G){if(!G)return C();var T;try{T=JSON.parse(G)}catch(K){T=JSON.parse(G.substring(65,G.length-2))}ck.loadFace(T),C&&C(T.familyName.toLowerCase())},C?null:{sync:!0})},createRingModel:function(c,M,X,H,N,u,$,h,A,i){for(var C=[],s=0;s<c.length-1;s+=2)C.push({x:c[s],y:c[s+1]});u=u||m.shapeSide,$=$||0,h=h||u;var x,Y,Z,L,R,O,w,G,n,U,s,W,T,q,V,Q,K,y,b=[],a=[],E=A?[]:z,r=A?[]:z,j=i?[]:z,l=i?[]:z,p=H?[]:z,P=H?[]:z,g=N?[]:z,f=N?[]:z,c=Wd(C,M,X),v=yh(c),D=0,t=2*Math.PI/u;return c.forEach(function(c){if(Z=c.length,Z>1){if(L=c[0],H)for(O=L.x,G=L.y,s=$;h>s;s++)W=s+1,T=s*t,q=W*t,V=d(T),Q=F(T),K=d(q),y=F(q),p.push(V*O,G,-Q*O,K*O,G,-y*O,0,G,0),P.push(.5-.5*V,.5-.5*Q,.5-.5*K,.5-.5*y,.5,.5);for(U=0;Z>U;U++){for(R=c[U],O=L.x,w=R.x,G=L.y,n=R.y,x=D/v,D+=id(L,R),Y=D/v,s=$;h>s;s++)W=s+1,T=s*t,q=W*t,V=d(T),Q=F(T),K=d(q),y=F(q),b.push(V*w,n,-Q*w,K*w,n,-y*w,V*O,G,-Q*O,K*w,n,-y*w,K*O,G,-y*O,V*O,G,-Q*O),a.push(s/u,Y,W/u,Y,s/u,x,W/u,Y,W/u,x,s/u,x),A&&s===$&&(E.push(0,G,0,0,n,0,V*w,n,-Q*w,V*w,n,-Q*w,V*O,G,-Q*O,0,G,0),r.push(0,.5-G,0,.5-n,2*w,.5-n,2*w,.5-n,2*O,.5-G,0,.5-G)),i&&W===h&&(j.push(0,G,0,K*w,n,-y*w,0,n,0,K*w,n,-y*w,0,G,0,K*O,G,-y*O),l.push(1,.5-G,1-2*w,.5-n,1,.5-n,1-2*w,.5-n,1,.5-G,1-2*O,.5-G));L=R}if(N)for(O=L.x,G=L.y,s=$;h>s;s++)W=s+1,T=s*t,q=W*t,V=d(T),Q=F(T),K=d(q),y=F(q),g.push(K*O,G,-y*O,V*O,G,-Q*O,0,G,0),f.push(.5-.5*K,.5+.5*y,.5-.5*V,.5+.5*Q,.5,.5)}}),{vs:b,uv:a,bottom_vs:g,bottom_uv:f,top_vs:p,top_uv:P,from_vs:E,from_uv:r,to_vs:j,to_uv:l}}},!0),ae(a,{"3d.move.mode":x,"3d.selectable":!0,"3d.visible":!0,"3d.movable":!0,"3d.editable":!0,"3d.clip.direction":null,"3d.clip.percentage":1,"3d.reflectable":!0,"shape.border.gradient.color":x,"edge.gradient.color":x,"edge.source.t3":x,"edge.target.t3":x,"light.type":hq,"light.center":[0,0,0],"light.color":[1,1,1,1],"light.disabled":!1,"light.angle":j/4,"light.range":0,"light.exponent":1,"light.intensity":1,"wf.visible":!1,"wf.width":1,"wf.color":Hb,"wf.short":!1,"wf.mat":x,"wf.geometry":!1,"wf.loadQuadWireframe":!1,"wf.combineTriangle":!0,batch:x,"transparent.mask":!1,brightness:x,"select.brightness":.7,"repeat.uv.length":x,"shadow.cast":!0,"shadow.receive":!0,"shadow.quality":"high","shadow.intensity":.3,"shadow.bias":-.005,"shadow.radius":.1,"shadow.type":"hard","shadow.degree.x":30,"shadow.degree.z":-10,envmap:0,renderTextureSamples:4,alphaTest:.4,autorotate:!1,fixSizeOnScreen:!1,alwaysOnTop:!1,"texture.cache":!1,"hide.overlapping.group":x,"vector.dynamic":!1,"vector.dynamic.maxsize":2048,"texture.scale":1,"geometry.cache":!1,"highlight.mode":!1,"highlight.visible":!0,"highlight.width":.8,"highlight.color":"rgba(190, 210, 250, 1)","color.empty":[0,0,0,0],"label.face":ws,"label.t3":x,"label.r3":x,"label.texture.scale":2,"label.rotationMode":Cd,"label.light":!1,"label.blend":x,"label.reverse.flip":!1,"label.reverse.color":fb,"label.reverse.cull":!1,"label.transparent":!1,"label.autorotate":!1,"label2.face":ws,"label2.t3":x,"label2.r3":x,"label2.texture.scale":2,"label2.rotationMode":Cd,"label2.light":!1,"label2.blend":x,"label2.reverse.flip":!1,"label2.reverse.color":fb,"label2.reverse.cull":!1,"label2.transparent":!1,"label2.autorotate":!1,"note.face":ws,"note.t3":x,"note.r3":x,"note.texture.scale":2,"note.rotationMode":Cd,"note.light":!1,"note.blend":x,"note.reverse.flip":!1,"note.reverse.color":fb,"note.reverse.cull":!1,"note.transparent":!1,"note.autorotate":!1,"note2.face":ws,"note2.t3":x,"note2.r3":x,"note2.texture.scale":2,"note2.rotationMode":Cd,"note2.light":!1,"note2.blend":x,"note2.reverse.flip":!1,"note2.reverse.color":fb,"note2.reverse.cull":!1,"note2.transparent":!1,"note2.autorotate":!1,shape3d:x,"shape3d.color":Xd,"shape3d.top.color":x,"shape3d.bottom.color":x,"shape3d.from.color":x,"shape3d.to.color":x,"shape3d.image":x,"shape3d.top.image":x,"shape3d.bottom.image":x,"shape3d.from.image":x,"shape3d.to.image":x,"shape3d.light":!0,"shape3d.side":0,"shape3d.side.from":x,"shape3d.side.to":x,"shape3d.smooth":x,"shape3d.visible":!0,"shape3d.from.visible":!0,"shape3d.to.visible":!0,"shape3d.top.visible":!0,"shape3d.bottom.visible":!0,"shape3d.torus.radius":.17,"shape3d.resolution":0,"shape3d.blend":x,"shape3d.opacity":x,"shape3d.reverse.flip":!1,"shape3d.reverse.color":fb,"shape3d.reverse.cull":!1,"shape3d.transparent":!1,"shape3d.uv.offset":x,"shape3d.uv.scale":x,"shape3d.top.uv.offset":x,"shape3d.top.uv.scale":x,"shape3d.bottom.uv.offset":x,"shape3d.bottom.uv.scale":x,"shape3d.from.uv.offset":x,"shape3d.from.uv.scale":x,"shape3d.to.uv.offset":x,"shape3d.to.uv.scale":x,"shape3d.top.cap":x,"shape3d.bottom.cap":x,"shape3d.start.angle":0,"shape3d.sweep.angle":y,"shape3d.point.epsilon":1e-6,"shape3d.discard.selectable":!0,"shape3d.top.discard.selectable":!0,"shape3d.bottom.discard.selectable":!0,"shape3d.from.discard.selectable":!0,"shape3d.to.discard.selectable":!0,"shape3d.scaleable":!0,"shape3d.autorotate":!1,"shape3d.fixSizeOnScreen":!1,"shape3d.image.cache":!1,"shape3d.alwaysOnTop":!1,"shape3d.vector.dynamic":!1,"shape3d.texture.scale":1,"shape3d.reflector":!1,"shape3d.reflector.color":"rgb(128,128,128)","shape3d.reflector.background":null,"shape3d.reflector.clip":.003,"texture.mipmap.max":x,"texture.filter":x,"texture.filter.min":x,"texture.filter.mag":x,"points.image":x,"points.color":"white","points.transparent":!1,"points.size":20,"points.opacity":1,"csg.cull.color":x,"all.light":!0,"all.visible":!0,"all.color":Xd,"all.image":x,"all.blend":x,"all.opacity":x,"all.reverse.flip":!1,"all.reverse.color":fb,"all.reverse.cull":!1,"all.transparent":!1,"all.uv":x,"all.uv.offset":x,"all.uv.scale":x,"all.discard.selectable":!0,mat:x,"left.mat":x,"right.mat":x,"top.mat":x,"bottom.mat":x,"front.mat":x,"back.mat":x,"edge.source.anchor.elevation":x,"edge.target.anchor.elevation":x},!0);var cj,tf=!1,Iq=[0,0,0,0],Ko=function(i){return i instanceof ro},$k=function(B){return[B.x,B.e||0,B.y]},Zi=function(A,V,k){for(var V=Em(V),d=V[0],l=V[1],z=V[2];k--;)A.push(d,l,z)},Jq=function(I,P,Q){for(var P=Em(P),N=P[0],d=P[1],T=P[2],g=P[3];Q--;)I.push(N,d,T,g)},vm=function(D,d,V){if(d)for(var T,n,C,A=d[0],N=d[1],G=d[2],M=d[4],b=d[5],q=d[6],E=d[8],Q=d[9],c=d[10],P=d[12],X=d[13],o=d[14],J=V.length,O=0,O=0;J>O;O+=3)T=V[O],n=V[O+1],C=V[O+2],D.push(A*T+M*n+E*C+P,N*T+b*n+Q*C+X,G*T+q*n+c*C+o);else Pr(D,V)},xi=function(b,E){var n=E.s("light.intensity"),$=Em(E.s(yo)),L=$[0],M=$[1],r=$[2];1!==n&&(L*=n,M*=n,r*=n),b.push(L,M,r,E.s("light.disabled")?1:0)},sp=function(C,E){var T=$c.for(E),p=T.directUniforms();p.uHeadlightRange=C._headlightRange,p.uHeadlightAmbientIntensity=C._headlightAmbientIntensity;var f=C._headlightIntensity,z=Em(C._headlightColor);1!==f&&(z=[z[0]*f,z[1]*f,z[2]*f]),p.uHeadlightColor=[z[0],z[1],z[2],C._headlightDisabled?1:0];var q=C._59O,M=C._spots,x=C._dirs;if(q.length){var I=[],Q=[],F=[];q.forEach(function(u){xi(I,u),Pr(Q,C._transformPointToViewSpace(u.p3())),F.push(u.s("light.range"))}),p.uPointColor=I,p.uPointRange=F,p.uPointPosition=Q}if(M.length){var L=[],P=[],A=[],s=[],o=[],X=[];M.forEach(function(n){xi(L,n),Pr(P,C._transformPointToViewSpace(n.p3())),Pr(o,C._transformDirectionToViewSpace(n.p3(),n.s("light.center"))),A.push(n.s("light.range")),s.push(d(n.s("light.angle")/2)),X.push(n.s("light.exponent"))}),p.uSpotColor=L,p.uSpotRange=A,p.uSpotAngle=s,p.uSpotExponent=X,p.uSpotPosition=P,p.uSpotDirection=o}if(x.length){var j=[],J=[];x.forEach(function(S){xi(j,S),Pr(J,C._transformDirectionToViewSpace(S.p3()))}),p.uDirColor=j,p.uDirDirection=J}},Bn=function(I){return Math.max(m.graph3dViewMinPhi+ep,Math.min(m.graph3dViewMaxPhi-ep,I))},hi=function(){return.05+u()/2},yf=function(g,S,_,F){var D,Q=g.getEye();return g.isOrtho()?(D=fi(g.getCenter(),Q),D[0]+=F[0],D[1]+=F[1],D[2]+=F[2]):D=Q,am(S,_,F,D)},am=function(Q,P,D,l){var T=cl(Q,P),r=fi(l,D,!0),b=cl(r,P);if(H(b)<ep)return z;var v=(T-cl(D,P))/b;return[D[0]+r[0]*v,D[1]+r[1]*v,D[2]+r[2]*v]},xl=function(m,S){return{x:2*m.x-S.x,y:2*m.y-S.y}},Je=function(l,Y,t,D){var E,s;if(!l)return E=C(Y.y-t.y,t.x-Y.x),{x:Y.x+D*F(E),y:Y.y+D*d(E)};if(!t)return E=C(l.y-Y.y,Y.x-l.x),{x:Y.x+D*F(E),y:Y.y+D*d(E)};var h=fi([l.x,l.y,0],[Y.x,Y.y,0],!0),g=fi([t.x,t.y,0],[Y.x,Y.y,0],!0),k=-(h[0]+g[0])/2,u=-(h[1]+g[1])/2,I=N(k*k+u*u);if(ep>I)return E=C(l.y-Y.y,Y.x-l.x),{x:Y.x+D*F(E),y:Y.y+D*d(E)};var M=l.x-Y.x,i=l.y-Y.y,v=t.x-Y.x,V=t.y-Y.y,y=N(M*M+i*i),m=N(v*v+V*V);E=O(cl(h,g))/2,s=h[1]*g[0]-h[0]*g[1]>0?-1:1,k/=I,u/=I;var r=D/F(E),p=W(y,m)/d(E);I=Math.min(r,p);var Z={x:Y.x+s*I*k,y:Y.y+s*I*u};return t.b&&r>m/d(E)&&(Z.adjust=!0),Z},qr=function(D){var A=D[1],M=D[2],G=D[3],k=D[6],f=D[7],J=D[11];D[1]=D[4],D[2]=D[8],D[3]=D[12],D[4]=A,D[6]=D[9],D[7]=D[13],D[8]=M,D[9]=k,D[11]=D[14],D[12]=G,D[13]=f,D[14]=J},Nh=function(s){var D=s[0],n=s[1],I=s[2],h=s[3],T=s[4],q=s[5],b=s[6],E=s[7],v=s[8],r=s[9],K=s[10],U=s[11],L=s[12],G=s[13],X=s[14],Q=s[15],V=D*q-n*T,$=D*b-I*T,H=D*E-h*T,p=n*b-I*q,O=n*E-h*q,w=I*E-h*b,i=v*G-r*L,f=v*X-K*L,N=v*Q-U*L,Y=r*X-K*G,x=r*Q-U*G,o=K*Q-U*X,u=V*o-$*x+H*Y+p*N-O*f+w*i;return u?(u=1/u,s[0]=(q*o-b*x+E*Y)*u,s[1]=(I*x-n*o-h*Y)*u,s[2]=(G*w-X*O+Q*p)*u,s[3]=(K*O-r*w-U*p)*u,s[4]=(b*N-T*o-E*f)*u,s[5]=(D*o-I*N+h*f)*u,s[6]=(X*H-L*w-Q*$)*u,s[7]=(v*w-K*H+U*$)*u,s[8]=(T*x-q*N+E*i)*u,s[9]=(n*N-D*x-h*i)*u,s[10]=(L*O-G*H+Q*V)*u,s[11]=(r*H-v*O-U*V)*u,s[12]=(q*f-T*Y-b*i)*u,s[13]=(D*Y-n*f+I*i)*u,s[14]=(G*$-L*p-X*V)*u,s[15]=(v*p-r*$+K*V)*u,void 0):z},$f=function(w,q){if(q){var S=q[0],A=q[1],R=q[2];w[12]=w[0]*S+w[4]*A+w[8]*R+w[12],w[13]=w[1]*S+w[5]*A+w[9]*R+w[13],w[14]=w[2]*S+w[6]*A+w[10]*R+w[14],w[15]=w[3]*S+w[7]*A+w[11]*R+w[15]}},Pp=function(v,d){if(d){var p=d[0],D=d[1],X=d[2];v[0]=v[0]*p,v[1]=v[1]*p,v[2]=v[2]*p,v[3]=v[3]*p,v[4]=v[4]*D,v[5]=v[5]*D,v[6]=v[6]*D,v[7]=v[7]*D,v[8]=v[8]*X,v[9]=v[9]*X,v[10]=v[10]*X,v[11]=v[11]*X}},Tk=function(P,f,n){var k=f[0],N=f[1],s=f[2],m=f[3],v=f[4],w=f[5],D=f[6],z=f[7],F=f[8],d=f[9],A=f[10],q=f[11],C=f[12],Y=f[13],c=f[14],o=f[15],B=n[0],J=n[1],r=n[2],O=n[3];return P[0]=B*k+J*v+r*F+O*C,P[1]=B*N+J*w+r*d+O*Y,P[2]=B*s+J*D+r*A+O*c,P[3]=B*m+J*z+r*q+O*o,B=n[4],J=n[5],r=n[6],O=n[7],P[4]=B*k+J*v+r*F+O*C,P[5]=B*N+J*w+r*d+O*Y,P[6]=B*s+J*D+r*A+O*c,P[7]=B*m+J*z+r*q+O*o,B=n[8],J=n[9],r=n[10],O=n[11],P[8]=B*k+J*v+r*F+O*C,P[9]=B*N+J*w+r*d+O*Y,P[10]=B*s+J*D+r*A+O*c,P[11]=B*m+J*z+r*q+O*o,B=n[12],J=n[13],r=n[14],O=n[15],P[12]=B*k+J*v+r*F+O*C,P[13]=B*N+J*w+r*d+O*Y,P[14]=B*s+J*D+r*A+O*c,P[15]=B*m+J*z+r*q+O*o,P},Hp=function(D,z,t,x){var O,g,P,J,q,X,h,U,Y,Q,K=z[0],R=z[1],G=z[2],u=x[0],w=x[1],l=x[2],k=t[0],y=t[1],Z=t[2];return H(K-k)<ep&&H(R-y)<ep&&H(G-Z)<ep?Xh(D):(h=K-k,U=R-y,Y=G-Z,Q=1/N(h*h+U*U+Y*Y),h*=Q,U*=Q,Y*=Q,O=w*Y-l*U,g=l*h-u*Y,P=u*U-w*h,Q=N(O*O+g*g+P*P),Q?(Q=1/Q,O*=Q,g*=Q,P*=Q):(O=0,g=0,P=0),J=U*P-Y*g,q=Y*O-h*P,X=h*g-U*O,Q=N(J*J+q*q+X*X),Q?(Q=1/Q,J*=Q,q*=Q,X*=Q):(J=0,q=0,X=0),D[0]=O,D[1]=J,D[2]=h,D[3]=0,D[4]=g,D[5]=q,D[6]=U,D[7]=0,D[8]=P,D[9]=X,D[10]=Y,D[11]=0,D[12]=-(O*K+g*R+P*G),D[13]=-(J*K+q*R+X*G),D[14]=-(h*K+U*R+Y*G),D[15]=1,D)},Bk=function($,U,Y,g,y){var S=1/_(U/2),s=1/(g-y);return $[0]=S/Y,$[1]=0,$[2]=0,$[3]=0,$[4]=0,$[5]=S,$[6]=0,$[7]=0,$[8]=0,$[9]=0,$[10]=(y+g)*s,$[11]=-1,$[12]=0,$[13]=0,$[14]=2*y*g*s,$[15]=0,$},yi=function(e,O,h,j,t,s,R){var k=1/(O-h),D=1/(j-t),F=1/(s-R);return e[0]=-2*k,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*D,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*F,e[11]=0,e[12]=(O+h)*k,e[13]=(t+j)*D,e[14]=(R+s)*F,e[15]=1,e},Uo=function($,I){var N=I[0],y=I[1],d=I[2],Y=I[3],Z=N*N+y*y+d*d+Y*Y,T=Z?1/Z:0;return $[0]=-N*T,$[1]=-y*T,$[2]=-d*T,$[3]=Y*T,$},jl=function(I,g){var G=g[0]+g[5]+g[10],T=0;return G>0?(T=2*Math.sqrt(G+1),I[3]=.25*T,I[0]=(g[6]-g[9])/T,I[1]=(g[8]-g[2])/T,I[2]=(g[1]-g[4])/T):g[0]>g[5]&g[0]>g[10]?(T=2*Math.sqrt(1+g[0]-g[5]-g[10]),I[3]=(g[6]-g[9])/T,I[0]=.25*T,I[1]=(g[1]+g[4])/T,I[2]=(g[8]+g[2])/T):g[5]>g[10]?(T=2*Math.sqrt(1+g[5]-g[0]-g[10]),I[3]=(g[8]-g[2])/T,I[0]=(g[1]+g[4])/T,I[1]=.25*T,I[2]=(g[6]+g[9])/T):(T=2*Math.sqrt(1+g[10]-g[0]-g[5]),I[3]=(g[1]-g[4])/T,I[0]=(g[8]+g[2])/T,I[1]=(g[6]+g[9])/T,I[2]=.25*T),I},qi=function(B,G,U){var N=G[0],s=G[1],V=G[2],A=G[3],M=N+N,Y=s+s,P=V+V,Z=N*M,d=N*Y,f=N*P,y=s*Y,x=s*P,r=V*P,C=A*M,h=A*Y,a=A*P;return B[0]=1-(y+r),B[1]=d+a,B[2]=f-h,B[3]=0,B[4]=d-a,B[5]=1-(Z+r),B[6]=x+C,B[7]=0,B[8]=f+h,B[9]=x-C,B[10]=1-(Z+y),B[11]=0,B[12]=U[0],B[13]=U[1],B[14]=U[2],B[15]=1,B},Zd=function(r,J){if(r.vr.enable){var z=r.vr.getViewMatrix(J);if(z)return z}return Hp(J?J:Re(),r._eye,r._center,r._up)},Cb=function(Q,y){if(Q.vr.enable){var W=Q.vr.getProjectMatrix();if(W)return W}if(!y&&Q._computedProjectMatrix)return ls(Q._computedProjectMatrix);var n=Q.getAspect(),Z=Q._near,A=Q._far,U=Re();if(Q._ortho){var $=Q._orthoWidth/2,a=$/n;yi(U,-$,$,-a,a,Z,A)}else Bk(U,Q._fovy,n,Z,A);return U},oc=function(e,E){if(!e)return z;var W=0,l=1,C=2,P=[],y=0,R=e.length,n=R/3;if(E){for(;R>y;y++)P[y]=0;for(y=0;y<E.length;y+=3){var i=[],j=[],X=[];i[W]=e[3*E[y+1]+W]-e[3*E[y]+W],i[l]=e[3*E[y+1]+l]-e[3*E[y]+l],i[C]=e[3*E[y+1]+C]-e[3*E[y]+C],j[W]=e[3*E[y+2]+W]-e[3*E[y+1]+W],j[l]=e[3*E[y+2]+l]-e[3*E[y+1]+l],j[C]=e[3*E[y+2]+C]-e[3*E[y+1]+C],X[W]=i[l]*j[C]-i[C]*j[l],X[l]=i[C]*j[W]-i[W]*j[C],X[C]=i[W]*j[l]-i[l]*j[W];for(var H=0;3>H;H++)P[3*E[y+H]+W]+=X[W],P[3*E[y+H]+l]+=X[l],P[3*E[y+H]+C]+=X[C]}}else for(y=0;n>y;y+=3){var i=[],j=[],X=[];i[W]=e[3*(y+1)+W]-e[3*y+W],i[l]=e[3*(y+1)+l]-e[3*y+l],i[C]=e[3*(y+1)+C]-e[3*y+C],j[W]=e[3*(y+2)+W]-e[3*(y+1)+W],j[l]=e[3*(y+2)+l]-e[3*(y+1)+l],j[C]=e[3*(y+2)+C]-e[3*(y+1)+C],X[W]=i[l]*j[C]-i[C]*j[l],X[l]=i[C]*j[W]-i[W]*j[C],X[C]=i[W]*j[l]-i[l]*j[W];for(var H=0;3>H;H++)P[3*(y+H)+W]=X[W],P[3*(y+H)+l]=X[l],P[3*(y+H)+C]=X[C]}for(y=0;R>y;y+=3){var I=[];I[W]=P[y+W],I[l]=P[y+l],I[C]=P[y+C];var u=N(I[W]*I[W]+I[l]*I[l]+I[C]*I[C]);0===u&&(u=ep),I[W]=I[W]/u,I[l]=I[l]/u,I[C]=I[C]/u,P[y+W]=I[W],P[y+l]=I[l],P[y+C]=I[C]}return new Gg(P)},Fj=function(K,U,h,_){if(h||(h=K.createTexture()),U){var B=K.TEXTURE_2D,n=K.REPEAT,k=K.CLAMP_TO_EDGE,G=K.TEXTURE_MIN_FILTER;_=_||is;var M=_.minFilter||_.filter||K.LINEAR,w=_.magFilter||_.filter||K.LINEAR;K.activeTexture(K.TEXTURE0),xp(K,h),K.texImage2D(B,0,K.RGBA,K.RGBA,K.UNSIGNED_BYTE,U),je(K,K.TEXTURE_MAG_FILTER,w);var C=U.naturalWidth||U.width,Q=U.naturalHeight||U.height;rh.isPOT(C)&&rh.isPOT(Q)&&!U.clampToEdge?(je(K,K.TEXTURE_WRAP_S,n),je(K,K.TEXTURE_WRAP_T,n),je(K,G,M===K.NEAREST?K.NEAREST_MIPMAP_NEAREST:K.LINEAR_MIPMAP_LINEAR),_.mipmapMaxLevel!==x&&je(K,K.TEXTURE_MAX_LEVEL,_.mipmapMaxLevel),K.generateMipmap(B)):(je(K,K.TEXTURE_WRAP_S,k),je(K,K.TEXTURE_WRAP_T,k),je(K,G,M)),xp(K,z)}return h},Qh=function(s,V){var n=new Uint8Array(4);return V=V||s.createTexture(),s.activeTexture(s.TEXTURE0),xp(s,V),je(s,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,n),V},ge=function(E,P){var C=new Uint8Array(4);return P=P||E.createTexture(),E.activeTexture(E.TEXTURE0),E.bindTexture(E.TEXTURE_CUBE_MAP,P),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_MAG_FILTER,E.LINEAR),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_MIN_FILTER,E.LINEAR),E.texImage2D(E.TEXTURE_CUBE_MAP_POSITIVE_X+0,0,E.RGBA,1,1,0,E.RGBA,E.UNSIGNED_BYTE,C),E.texImage2D(E.TEXTURE_CUBE_MAP_POSITIVE_X+1,0,E.RGBA,1,1,0,E.RGBA,E.UNSIGNED_BYTE,C),E.texImage2D(E.TEXTURE_CUBE_MAP_POSITIVE_X+2,0,E.RGBA,1,1,0,E.RGBA,E.UNSIGNED_BYTE,C),E.texImage2D(E.TEXTURE_CUBE_MAP_POSITIVE_X+3,0,E.RGBA,1,1,0,E.RGBA,E.UNSIGNED_BYTE,C),E.texImage2D(E.TEXTURE_CUBE_MAP_POSITIVE_X+4,0,E.RGBA,1,1,0,E.RGBA,E.UNSIGNED_BYTE,C),E.texImage2D(E.TEXTURE_CUBE_MAP_POSITIVE_X+5,0,E.RGBA,1,1,0,E.RGBA,E.UNSIGNED_BYTE,C),P},jb=function(r){r._26I&&r._prg&&(r._26I.deleteProgram(r._prg),r._prg=z)},cb=function(l,m,i,s){var D=l.createShader(i);return l.shaderSource(D,s),l.compileShader(D),l.attachShader(m,D),D},Rn=function(L){return L.createBuffer()},xp=function(z,t){z.bindTexture(z.TEXTURE_2D,t)},je=function(Z,c,t){Z.texParameteri(Z.TEXTURE_2D,c,t)},Fq=function(O,u){var R=$c.for(O).directState();R.polygonOffset.enable=!0,R.polygonOffset.value=u},lc=function(A){var k=$c.for(A).directState();k.polygonOffset.enable=!1},cq=function(G,C){if(C){var L=$c.for(G).directState();L.color.clear=Em(C)}},qq=function(i){var J=$c.for(i),N=J.directUniforms(),F=J.directAttribs();N.uFix=!0,F.aNormal=!1},ch=function(H){var W=$c.for(H),x=W.directUniforms();W.directAttribs(),x.uFix=!1},Le=function(G,T,Y,v,B,y,C,L){var f=$c.for(G),b=f.directState(),_=f.directUniforms();G._picking||(Y?(_.uBlend=!0,_.uBlendColor=Y):_.uBlend=!1,_.uLight=v==z?!0:v,pk(B)&&1!==B&&(_.uPartOpacity=B),_.uReverseFlip=y==z?!1:y,_.uFixPickReverseColor=C||fb),b.cullFace.enabled=L?!0:!1},af=function(w){if(!w._picking){var I=$c.for(w),P=I.directUniforms();P.uPartOpacity=1}},jp=function(){var j=[0,0,1,1];return function(Z,p,m,n,X,l,R,K,C){var o=$c.for(Z),c=o.directUniforms(),_=o.directAttribs();return m?(c.uTexture=!0,c.uDiscardSelectable=Rr(n)?n:!0,_.aUv=Ql(Z,X,l,z,2),C?(c.uBlendTexture=!0,c.uBlendSampler=C):(c.uBlendTexture=!1,c.uBlendSampler=Z._emptyBlendTexture),c.uSampler=m,R?(j[0]=R[0],j[1]=R[1]):(j[0]=0,j[1]=0),K?(j[2]=K[0],j[3]=K[1]):(j[2]=1,j[3]=1),c.uOffsetScale=j,void 0):(c.uSampler=Z._emptyTexture,c.uBlendSampler=Z._emptyBlendTexture,void 0)}}(),Dc=function(p,d,e){var B=$c.for(p),V=B.directUniforms(),K=B.directAttribs();p.activeTexture(p.TEXTURE0),xp(p,z),p.activeTexture(p.TEXTURE1),xp(p,z),e&&(K.aUv=!1,V.uTexture=!1,V.uSampler=p._emptyTexture,V.uBlendTexture=!1,V.uBlendSampler=p._emptyBlendTexture)},cc=function($,x,W,_,q,i){var g=$c.for($),A=g.directUniforms(),F=g.directAttribs();!W||Nb||tm||$.lineWidth(W),_&&!$._picking&&(A.uFixPickReverseColor=_),q&&(F.aPosition=Ql($,q,i,z))},Yi=function(u,V,W,l){cj&&(l=u[cj]),u.drawArrays(l==z?u.TRIANGLES:l,V,W);var X=u._renderInfo;X&&(X.calls++,X.vertices+=W,(l==z||l===u.TRIANGLES)&&(X.faces+=W/3),l===u.LINES&&(X.lines+=W/2),l===u.POINTS&&(X.points+=W))},Vj=function(m,V,b,k,G){cj&&(k=m[cj]),m.drawElements(k==z?m.TRIANGLES:k,b,G==z?m.UNSIGNED_SHORT:G,V==z?0:2*V);var O=m._renderInfo;O&&(O.calls++,O.vertices+=b,(k==z||k===m.TRIANGLES)&&(O.faces+=b/3),k===m.LINES&&(O.lines+=b/2),k===m.POINTS&&(O.points+=b))},Pg=function(g,Y,F){var h=g.ARRAY_BUFFER;return g.bindBuffer(h,Y),F&&g.bufferData(h,F,g.STATIC_DRAW),Y},Ql=function(G,q,k,P,a){return k?ed(G,G.ARRAY_BUFFER,q,k):Pg(G,q,k,P,a)},Gr=function(c,F,$){var h=c.ELEMENT_ARRAY_BUFFER;c.bindBuffer(h,F),$&&c.bufferData(h,$,c.STATIC_DRAW)},Wf=function(V,i,e){ed(V,V.ELEMENT_ARRAY_BUFFER,i,e)},ed=function(U,y,a,o){var Z=o._bufId;Z||(Z=o._bufId=R.Math.generateIncreasingID());var a,d=U._bufPool;return(a=d[Z])&&a._buf?U.bindBuffer(y,a._buf):(a=d[Z]={_buf:Rn(U)},U.bindBuffer(y,a._buf),U.bufferData(y,o,U.STATIC_DRAW)),a._fid=U._renderInfo.frame,a._buf},fq=function(i,f){f!=z&&f>=0&&i.enableVertexAttribArray(f)},br=function(a,Q){Q!=z&&Q>=0&&a.disableVertexAttribArray(Q)},Qj=function(X,K){var F=X.getGL();X._prg;var M=$c.for(F),H=M.directUniforms();M.directAttribs(),X._7O=X._8O.pop(),K&&(H.uMVMatrix=X._7O,X._6O=K,H.uNMatrix=K)},bl=function(j,X){return X||(X=Re()),Pd(X,j),Nh(X),qr(X),X},Ld=function(K,L){var W=K.getGL(),l=K._7O,E=$c.for(W),X=E.directUniforms();L?(K._8O.push(ls(l)),X.uMMatrix=L,Tk(l,l,L),K._7O=l):X.uMMatrix=_r,X.uMVMatrix=l,X.uNMatrix=bl(l,K._6O)},tg={body:0,label:1,label2:2,note:3,note2:4},Dd=10,fp=function(o,R,F,I,r,s){var a;if(F){var f=I._pickId;f||(f=I._pickId=R._pickIdUsed=R._pickIdUsed+Dd);var j=f+tg[r];R[j]||(R[j]={data:I,part:r}),a=pe(j)}else a=Iq;if(!s){var k=$c.for(o),B=k.directUniforms();B.uFixPickReverseColor=a}return a},er=function(d,D,v){"target"!==v&&(v="source");var U="target"===v?D.getTargetAgent():D.getSourceAgent(),n="edge."+v+".";if(Vm(U)){var t=D.s(n+"anchor.x"),S=D.s(n+"anchor.elevation"),k=D.s(n+"anchor.y"),N=dg(U,d.getMat(U)),M=U.getAnchor3d();return Eb([(t===x?.5:t)-M.x,(S===x?.5:S)-M.y,(k===x?.5:k)-M.z],N)}var c=D.s(n+"index"),Q=d.getData3dUI(U);if(!Q.info||!Q.info.list)return!1;if(c>=0){var K,F,y,R,f,P=Q.info._lastPointsSegments,H=P.points,C=P.segments,E=-1,h=-1;for(y=0,R=C?C.length:H.length;R>y;y++){if(F=C?C.get(y):1,3===F)f=2;else if(4===F)f=3;else{if(5===F)continue;f=1}if(E+=f,h++,h===c){K=H.get(E);break}}return K||(K=H.get(H.length-1)),[K.x,K.e||0,K.y]}var p=D.s(n+"percent")||.5;if(p=Math.max(0,Math.min(p,1)),!Q||!Q.getCache)return!1;var u=Q.getCache(),R=u[u.length-1].length,P=d.getLineOffset(U,p*R),I=P.point;return[I.x,I.y,I.z]},wo=function(){var k={center:function(W,$,G,C,l){var n=-$[1]/2,N={x:-$[0]/2,y:n,width:$[0],height:$[1]},z=yr(W,N,G);return[z.x+C,-z.y-l,hi()]},front:function(n,h,F,R,i){var C=-h[1]/2,r={x:-h[0]/2,y:C,width:h[0],height:h[1]},c=yr(n,r,F);return[c.x+R,-c.y-i,h[2]/2+hi()]},back:function(H,C,x,h,g){var p=-C[0]/2,G=-C[1]/2,E={x:p,y:G,width:C[0],height:C[1]},B=yr(H,E,x);return[-B.x-h,-B.y-g,-C[2]/2-hi()]},left:function(o,V,B,Q,J){var c=-V[1]/2,M={x:-V[2]/2,y:c,width:V[2],height:V[1]},p=yr(o,M,B);return[-V[0]/2-hi(),-p.y-J,p.x+Q]},right:function(Y,X,K,o,O){var r=-X[2]/2,I=-X[1]/2,J={x:r,y:I,width:X[2],height:X[1]},H=yr(Y,J,K);return[X[0]/2+hi(),-H.y-O,-H.x-o]},top:function(K,N,C,U,h){var l={x:-N[0]/2,y:-N[2]/2,width:N[0],height:N[2]},Z=yr(K,l,C);return[Z.x+U,N[1]/2+hi(),Z.y+h]},bottom:function(e,m,h,K,a){var _=-m[2]/2,w={x:-m[0]/2,y:_,width:m[0],height:m[2]},H=yr(e,w,h);return[H.x+K,-m[1]/2-hi(),-H.y-a]}};return function(T,P,r,y,L,G){return k[y](T,P,r,L||0,G||0)}}(),el=function(Y,s,O,$,J,o,T,e,d,N){if(J&&(s[0]+=J[0],s[1]+=J[1],s[2]+=J[2]),$f(Y,O),e){var D=Re();if(Tb(D,d,N),Eb(s,D),$f(Y,s),Y.auto=e,Y.pos=Eb([0,0,0],Y),o){var F=Y.mat2=Re();Tb(F,o,T)}}else Tb(Y,d,N),$f(Y,s),$===ec?He(Y,-P):$===Gj?He(Y,P):$===$i?ri(Y,-P):$===dh?ri(Y,P):$===Wb&&He(Y,j),Tb(Y,o,T);return Y},Zk=function(P,v){var I=v.auto,e=v.mat2,Z=P.gv;if(I){var C,i=Re(),h=[0,0,0,0];C="string"==typeof I?[I.indexOf("x")<0?Z._eye[0]:Z._center[0],I.indexOf("y")<0?Z._eye[1]:Z._center[1],I.indexOf("z")<0?Z._eye[2]:Z._center[2]]:Z._eye,jl(h,Hp(Re(),C,Z._center,Z._up)),qi(i,Uo(h,h),v.pos),e&&Tk(i,i,e),Ld(Z,i)}else Ld(Z,v)},yd=function(l,_,m,M,i){var G=l.s,f=l.gv,a=f.getGL(),J=f._prg,p=f._buffer,H=f._1O,L=$c.for(a),B=L.directAttribs();Fj(a,fn,H),Zk(l,m),Le(a,J,G(_+".blend"),G(_+".light"),G(_+".opacity"),G(_+".reverse.flip"),G(_+".reverse.color"),G(_+".reverse.cull")),jp(a,J,H,i,p.uv,zh),B.aPosition=Ql(a,p.vs,M,z),B.aNormal=Ql(a,p.ns,ei,z),Wf(a,p.is,jo),Vj(a,0,jo.length),Dc(a,J,H),af(a,J),Qj(f)},bf=function(P,b,t){var k=P.gv,Q=P.data,h=P[b]={blend:k.getBodyColor(Q)||k.getFaceBlend(Q,b),light:k.getFaceLight(Q,b),color:k.getFaceColor(Q,b),opacity:k.getFaceOpacity(Q,b),transparent:k.getFaceTransparent(Q,b),reverseFlip:k.getFaceReverseFlip(Q,b),reverseColor:k.getFaceReverseColor(Q,b),reverseCull:k.getFaceReverseCull(Q,b),texture:k.getFaceImage(Q,b),blendTexture:k.getFaceBlendImage(Q,b),discardSelectable:k.getFaceDiscardSelectable(Q,b)};if("csg"!==b){h.uv=k.getFaceUv(Q,b)||t&&t[b+"Uv"],h.uvScale=k.getFaceUvScale(Q,b)||t&&t[b+"UvScale"],h.uvOffset=k.getFaceUvOffset(Q,b)||t&&t[b+"UvOffset"];var D=k.getFaceMat(Q,b);if(D){var z=dg(Q,D);Q.appendAnchorMatrix3d(z),h.mat=z
}}return h},wf=function(u,x,H,e,l){var O=u[e];if(O){if(!l(O.transparent))return;var y=u.data,E=u.gv,r=E._buffer,i=E.getTexture(O.texture,y,e),d=E.getTexture(O.blendTexture,y),$=$c.for(x),P=$.directUniforms(),w=$.directAttribs();jp(x,H,i,O.discardSelectable,r.uv,O.tuv,O.uvOffset,O.uvScale,d),Le(x,H,O.blend,O.light,O.opacity,O.reverseFlip,O.reverseColor,O.reverseCull),O.cs&&!E._batchColorDisabled?(P.uBatchColor=!0,w.aBatchColor=Ql(x,r.batchColor,O.cs,H.aBatchColor,4)):P.uDiffuse=O.color||a["color.empty"],w.aPosition=Ql(x,r.vs,O.vs,z),w.aNormal=Ql(x,r.ns,O.ns,z),Yi(x,0,O.vs.length/3),O.cs&&!E._batchColorDisabled&&(P.uBatchColor=!1,br(x,H.aBatchColor)),af(x,H),Dc(x,H,i)}},Ti=function(W,v,P,A,O,$){var G,f,g,q,M,Y,t,Q,J,o,i,h=[A-v,O-P],l=W?W.length:0;for(g=0;l>g;g++){for(q=2,G=W[g],M=G[0],Y=G[1];q+1<G.length;){if(t=G[q],Q=G[q+1],f=lq(v,P,A,O,M,Y,t,Q,!0)){J=[t-M,Q-Y],o=id(J),J[0]/=o,J[1]/=o,o=cl(h,J),o=o>0?$:-$,i=[J[0]*o,J[1]*o];break}M=t,Y=Q,q+=2}if(i)break}if(i)for(A=v+i[0],O=P+i[1],g=0;l>g;g++)for(q=2,G=W[g],M=G[0],Y=G[1];q+1<G.length;){if(t=G[q],Q=G[q+1],f=lq(v,P,A,O,M,Y,t,Q,!0))return[0,0];M=t,Y=Q,q+=2}return i?i:[A-v,O-P]},Ab=R.graph3d={},bg=function(q,W,M){Ad(t+".graph3d."+q,W,M)},yj="~<yfusfw!+!yjsubNQv!>!opjujtpQ`mh!gjeof$!<*1/2!-opjujtpQb)5dfw!+!yjsubNNv!+!yjsubNxpebit!>!esppDxpebit!QBNXPEBIT`FTV!gfegj$!!gjeof$!~<fdobutjEfojMb!>!fdobutjEfojMw|*itbEv)gj!ITBE!gfegj$!!gjeof$!~<ttfouihjsCidubCb!>!ttfouihjsCidubCw|*ttfouihjsCidubCv)gj!TTFOUIHJSCIDUBC!gfegj$!!gjeof$!~<eofmCidubCb!>!eofmCidubCw|*eofmCidubCv)gj!EOFMCIDUBC!gfegj$!!gjeof$!~<spmpDidubCb!>!spmpDidubCw|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!~<wVb!>!wVs|*fsvuyfUeofmCv)gj~<x{/fmbdTuftggPv!+!wVb!,!zy/fmbdTuftggPv!>!wVw|*fsvuyfUv)gj<*opjujtpQb)4dfw!>!opjujtpQw~<**1/2!-opjujtpQb)5dfw!+!yjsubNNv)4dfw!>!emspXw<*yfusfw)4dfw!>!yfusfWw<**1/2!-mbnspOb)5dfw!+!yjsubNOv)4dfw!>!mbnspOw|*ldjQva!%%!yjGva)gj<*1/2!-opjujtpQb)5dfw!+!yjsubNWNv!>!yfusfw!5dfw|!*ejpw)ojbn!ejpw!gjeof$!<esppDxpebit!5dfw!hojzsbw<yjsubNxpebit!5ubn!nspgjov!QBNXPEBIT`FTV!gfegj$!!gjeof$!<fdobutjEfojMw!ubpmg!hojzsbw<fdobutjEfojMb!ubpmg!fuvcjsuub<itbEv!mppc!nspgjov!ITBE!gfegj$!!gjeof$!<^UPQT`YBN]opjudfsjEupqTv!4dfw!nspgjov<^UPQT`YBN]opjujtpQupqTv!4dfw!nspgjov<^UPQT`YBN]spmpDupqTv!5dfw!nspgjov!1!?!UPQT`YBN!gj$!!gjeof$!<^UOJPQ`YBN]opjujtpQuojpQv!4dfw!nspgjov<^UOJPQ`YBN]spmpDuojpQv!5dfw!nspgjov!1!?!UOJPQ`YBN!gj$!!gjeof$!<^SJE`YBN]opjudfsjEsjEv!4dfw!nspgjov<^SJE`YBN]spmpDsjEv!5dfw!nspgjov!1!?!SJE`YBN!gj$!!gjeof$!<eofmCidubCw!4dfw!hojzsbw<eofmCidubCb!4dfw!fuvcjsuub<eofmCidubCv!mppc!nspgjov!EOFMCIDUBC!gfegj$!!gjeof$!<ttfouihjsCidubCw!ubpmg!hojzsbw<ttfouihjsCidubCb!ubpmg!fuvcjsuub<ttfouihjsCidubCv!mppc!nspgjov!TTFOUIHJSCIDUBC!gfegj$!!gjeof$!<spmpDidubCw!5dfw!hojzsbw<spmpDidubCb!5dfw!fuvcjsuub<spmpDidubCv!mppc!nspgjov!SPMPDIDUBC!gfegj$!<opjujtpQw!4dfw!hojzsbw<emspXw!4dfw!hojzsbw<yfusfWw!4dfw!hojzsbw<mbnspOw!4dfw!hojzsbw<yjGv!mppc!nspgjov<ldjQv!mppc!nspgjov<yjsubNxfjWv!5ubn!nspgjov<yjsubNOv!5ubn!nspgjov<yjsubNQv!5ubn!nspgjov<yjsubNNv!5ubn!nspgjov<yjsubNWNv!5ubn!nspgjov<opjujtpQb!4dfw!fuvcjsuub<mbnspOb!4dfw!fuvcjsuub<wVs!3dfw!hojzsbw<wVw!3dfw!hojzsbw<wVb!3dfw!fuvcjsuub<fmbdTuftggPv!5dfw!nspgjov<fsvuyfUeofmCv!mppc!nspgjov<fsvuyfUv!mppc!nspgjov!YJGFSQ^#CBRBEJxTT87hJFI,,bX1XrIwcn3UM{ZeZ,M6HEN6nLxe2Z72s2:3johr6foKrpqwxNKYkdbJ2CN[mBbf[wXU,T0oGuSEd190ohLZkEn8IuCe[OHoWeKz:Sf,VS7xdSLw23W1YJLU:jdv2{hiDbhDzNNEh9tp3xsuEp94Sl4c3wRzqwShMDRhCLRjCDEBOH5BBVRBCFRE4cJTHrTDH1BNgHJN",qe="~~<eJ!>!spmpDhbsG`mh~<spmpDsfmqnbTwv!>+!eJ<*wVs!-sfmqnbTeofmCv)E3fsvuyfu!>!spmpDsfmqnbTwv!5dfw|!*fsvuyfUeofmCv)!gj!!gjeof$!~<ttfouihjsCidubCw!>+!chs/eJ!!!|*ttfouihjsCidubCv)gj!TTFOUIHJSCIDUBC!gfegj$!~<ttfouihjsCv!>+!chs/eJ!!!|*1/2!>a!ttfouihjsCv)gj~~<zujdbqPusbQv!>+!b/eJ!!!|*1/2!>a!zujdbqPusbQv)gj~!gjeof$!~<zujwjudfmgfSv!+!{zy/spmpDwof!>,!chs/eJ<*!spmpDwof!)sbfojMpUmfyfUqbNwof!>!spmpDwof<*!*!{z/dfWudfmgfs!-y/dfWudfmgfs)4dfw!-qbNwoFv!)fcvDfsvuyfu!>!spmpDwof!5dfw<*!mbnspOemspx!-yfusfWpUbsfnbd!)udfmgfs!>!dfWudfmgfs!4dfw<*!yjsubNxfjWv!-O!)opjudfsjEnspgtobsUftsfwoj!>!mbnspOemspx!4dfw<*!opjujtpQbsfnbDv!.!emspXw!)f{jmbnspo!>!yfusfWpUbsfnbd!4dfw|*qbNwoFftVv)!gj!QBNWOF`FTV!gfegj$!!gjeof$!<*spudbGhpg!-*x/eJ!-chs/spmpDhpGv)5dfw!-eJ)yjn!>!eJ<*iuqfe!-sbGhpGv!-sbfOhpGv)qfutiuppnt!>!spudbGhpg!ubpmg<x/esppDhbsG`mh0{/esppDhbsG`mh!>!iuqfe!ubpmg!HPG!gfegj$!!gjeof$!~~~~<chs/^j]spmpDupqTv!+!udfggFupqt!+!fhobSm!+!*1/1!-*mbnspOm.!-O)upe)ybn!>,!chs/eJ<*1/1!-*^j]uofopqyFupqTv!-udfggFupqt)xpq)ybn!>!udfggFupqt|*^j]fmhoBupqTv!?!udfggFupqt)gj<*mbnspOm!-^j]opjudfsjEupqTv)upe!>!udfggFupqt!ubpmg<*spudfWm)f{jmbnspo!>!mbnspOm!4dfw|*1/1!?!fhobSm)!gj~<*1/2!-*^j]fhobSupqTv!0!*spudfWm)iuhofm))ojn!.!1/2!>!fhobSm|*1/1!?!^j]fhobSupqTv)!gj<1/2!>!fhobSm!ubpmg<^j]opjujtpQupqTv!.!yfusfWw!>!spudfWm!4dfw|*1/1!>>!x/^j]spmpDupqTv)gj|!*,,j!<UPQT`YBN!=!j!<1>j!uoj)spg!1!?!UPQT`YBN!gj$!!gjeof$!~~~<chs/^j]spmpDuojpQv!+!fhobSm!+!*1/1!-**spudfWm)f{jmbnspo.!-O)upe)ybn!>,!chs/eJ|*1/1!?!fhobSm)!gj~<*1/2!-*^j]fhobSuojpQv!0!*spudfWm)iuhofm))ojn!.!1/2!>!fhobSm|*1/1!?!^j]fhobSuojpQv)!gj<1/2!>!fhobSm!ubpmg<^j]opjujtpQuojpQv!.!yfusfWw!>!spudfWm!4dfw|*1/1!>>!x/^j]spmpDuojpQv)gj|!*,,j!<UOJPQ`YBN!=!j!<1>j!uoj)spg!1!?!UOJPQ`YBN!gj$!!gjeof$!~~<chs/^j]spmpDsjEv!+!*1/1!-**^j]opjudfsjEsjEv)f{jmbnspo.!-O)upe)ybn!>,!chs/eJ|*1/1!>>!x/^j]spmpDsjEv)gj|!*,,j!<SJE`YBN!=!j!<1>j!uoj)spg!1!?!SJE`YBN!gj$!~<chs/spmpDuihjmebfIv!+!nsfUusfcnbm!>+!chs/eJ!gjeof$!~<fvmbWxpebit!+!zujtofuoJxpebit!.!1/2!>+!nsfUusfcnbm!~!!<osvufs!<esbdtje!!|!*1/1!>>!fvmbWxpebit!%%!mmvDxpebit)!gj<*esppDxpebit!-tvjebSxpebit!-tbjCxpebit!-f{jTxpebit!-qbNxpebit!)xpebiTufh!.!1/2!>!fvmbWxpebit!ubpmg|!*fwjfdfSxpebit)!gj!QBNXPEBIT`FTV!gfegj$!~<*1/2!-fhobSuihjmebfIv0*yfusfWw)iuhofm)ojn!.!1/2!!>+!nsfUusfcnbm|*1/1!?!fhobSuihjmebfIv)gj<*1/1!-zujtofuoJuofjcnBuihjmebfIv!,!*zujtofuoJuofjcnBuihjmebfIv!.!1/2)!+!*M.!-O)upe)ybn!>!nsfUusfcnbm!ubpmg|*1/1!>>!x/spmpDuihjmebfIv)gj|*uihjMv)gj~!gjeof$!~<spmpDeofmCv!>+!eJ|*eofmCv)gj!ftmf$!~<spmpDeofmCv!>+!eJ|*eofmCv)gj!ftmf~<eofmCidubCw!>+!chs/eJ|*eofmCidubCv)gj!EOFMCIDUBC!gfegj$!~~<esbdtje|*1/1!>>!x/eJ)gj!gjeof$!<ftvggjEv!>!eJ!ftmf$!~<ftvggjEv!>!eJ|ftmf~<spmpDidubCw!>!eJ|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|ftmf~<spmpDwv!>!eJ|*fsvuyfUv)gj|!ftmf~<spmpDftsfwfSldjQyjGv!>!eJ|*qjmGftsfwfSva!%%!ldbCtj)gj~<fvsu!>!ldbCtj<O.!>!O|*1/1!=!*O!-F)upe)gj<ftmbg!>!ldbCtj!mppc<F.!>!M!4dfw!gjeof$!<*yfusfWw.)f{jmbnspo!>!F!4dfw!ftmf$!<*2!-1!-1)4dfw!>!F!4dfw!DJIQBSHPIUSP!gfegj$!<*mbnspOw)f{jmbnspo!>!O!4dfw|!ftmf~!gjeof$!~~<ftvggjEv!>!eJ|ftmf~<esbdtje|*1/1!>>!x/ftvggjEv)gj|!*!fdobutjEitbEv!?!*!fdobutjEqbHitbEv!-fdobutjEfojMw!)epn!%%!itbEv)!gj!ITBE!gfegj$!!gjeof$!<spmpDftsfwfSldjQyjGv!>!eJ!ftmf$!~<spmpDftsfwfSldjQyjGv!>!eJ|ftmf~<spmpDidubCw!>!eJ|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|*yjGv)gj<eJ!5dfw|ftmf~~!<esbdtje!|!*1/1!>>!b/spmpDhbsG`mh)!gj!gjeof$!<spmpDftsfwfSldjQyjGv!>!spmpDhbsG`mh!ftmf$!~<spmpDftsfwfSldjQyjGv!>!spmpDhbsG`mh|ftmf~<spmpDidubCw!>!spmpDhbsG`mh|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|*ldjQv)gj~~!<esbdtje!|!**sje!-*uofdsfQqjmDv)4dfw)upe!?!*opjujtpQw!-sje)upe)!gj~!<1/2.!>!{/sje!|!*8!=!opjudfsjEqjmDv)!gj!ftmf~!<1/2!>!{/sje!|!*7!=!opjudfsjEqjmDv)!gj!ftmf~!<1/2.!>!z/sje!|!*6!=!opjudfsjEqjmDv)!gj!ftmf~!<1/2!>!z/sje!|!*5!=!opjudfsjEqjmDv)!gj!ftmf~!<1/2.!>!y/sje!|!*4!=!opjudfsjEqjmDv)!gj!ftmf~!<1/2!>!y/sje!|!*3!=!opjudfsjEqjmDv)!gj<*1/1!-1/1!-1/1)4dfw!>!sje!4dfw|!*1!?!opjudfsjEqjmDv)!gj~~~!<esbdtje!|!*utfUbiqmBv!>=!b/spmpDwv)!gj!!!!|!ftmf~~!<esbdtje!|!*1/1!>>!b/spmpDwv)!gj!!!!|!*uofsbqtobsUv)!gj<*wVw!-sfmqnbTv)E3fsvuyfu!>!spmpDwv|**fmcbudfmfTesbdtjEv!%%!ldjQv)a!%%!fsvuyfUv)gj<spmpDwv!5dfw|!*ejpw)ojbn!ejpw~<*!{zy/*!yjsubn!+!*!1/1!-sje!)5dfw!)!)f{jmbnspo!osvufs|!*!yjsubn!5ubn!oj!-sje!4dfw!oj!)opjudfsjEnspgtobsUftsfwoj!4dfw~!<*!*!SPUDBG`BNNBH!)ubpmg!-fvmbw!)sbfojMpUbnnbH!osvufs!|!*!fvmbw!5dfw!)sbfojMpUmfyfUqbNwof!5dfw~<*!x/fvmbw!-*!*!spudbGbnnbh!)4dfw!-{zy/fvmbw!)xpq!)5dfw!osvufs|!*!spudbGbnnbh!ubpmg!oj!-fvmbw!5dfw!oj!)sbfojMpUbnnbH!5dfw<1/3!>!SPUDBG`BNNBH!ubpmg!utopd!gjeof$!~!!!!!!!!gjeof$!!!!!!!!!!!!<*!qe!-*!z/f{jTmfyfu!-E4ec!)WVpUfcvd!-qbNxpebit!)fsbqnpDE3fsvuyfu!osvufs!!!!!!!!!!!!!!!!ftmf$!!!!!!!!!!!!<*!1/:!0!1/2!)!+!*!!!!!!!!!!!!!!!!*!qe!-*!z/f{jTmfyfu!-yyz/uftggp!,!E4ec!)WVpUfcvd!-qbNxpebit!)fsbqnpDE3fsvuyfu!!!!!!!!!!!!!!!!!!!!,!*!qe!-*!z/f{jTmfyfu!-yyy/uftggp!,!E4ec!)WVpUfcvd!-qbNxpebit!)fsbqnpDE3fsvuyfu!!!!!!!!!!!!!!!!!!!!,!*!qe!-*!z/f{jTmfyfu!-zyz/uftggp!,!E4ec!)WVpUfcvd!-qbNxpebit!)fsbqnpDE3fsvuyfu!!!!!!!!!!!!!!!!!!!!,!*!qe!-*!z/f{jTmfyfu!-zyy/uftggp!,!E4ec!)WVpUfcvd!-qbNxpebit!)fsbqnpDE3fsvuyfu!!!!!!!!!!!!!!!!!!!!,!*!qe!-*!z/f{jTmfyfu!-E4ec!)WVpUfcvd!-qbNxpebit!)fsbqnpDE3fsvuyfu!!!!!!!!!!!!!!!!!!!!,!*!qe!-*!z/f{jTmfyfu!-yzz/uftggp!,!E4ec!)WVpUfcvd!-qbNxpebit!)fsbqnpDE3fsvuyfu!!!!!!!!!!!!!!!!!!!!,!*!qe!-*!z/f{jTmfyfu!-yzy/uftggp!,!E4ec!)WVpUfcvd!-qbNxpebit!)fsbqnpDE3fsvuyfu!!!!!!!!!!!!!!!!!!!!,!*!qe!-*!z/f{jTmfyfu!-zzz/uftggp!,!E4ec!)WVpUfcvd!-qbNxpebit!)fsbqnpDE3fsvuyfu!!!!!!!!!!!!!!!!!!!!,!*!qe!-*!z/f{jTmfyfu!-zzy/uftggp!,!E4ec!)WVpUfcvd!-qbNxpebit!)fsbqnpDE3fsvuyfu!!!!!!!!!!!!!!!!!!!!)!osvufs!!!!!!!!!!!!!!!!<z/f{jTmfyfu!+!tvjebSxpebit!+!*!2!-2!.!)3dfw!>!uftggp!3dfw!!!!!!!!!!!!!!!!*!UGPT`GDQ`FQZU`QBNXPEBIT!)efojgfe!}}!*!GDQ`FQZU`QBNXPEBIT!)efojgfe!gj$!!!!!!!!!!!!<*!opjujtpQpUuihjm!)f{jmbnspo!>!E4ec!4dfw!!!!!!!!!!!!<tbjCxpebit!>,!qe!!!!!!!!<*!sbfObsfnbDxpebit!.!sbGbsfnbDxpebit!)!0!*!sbfObsfnbDxpebit!.!*!opjujtpQpUuihjm!)iuhofm!)!>!qe!ubpmg!!!!!!!!!!!!<{zy/esppDxpebit!>!opjujtpQpUuihjm!4dfw!!!!!!!!!!!!<*!*!1/3!-1/5!)3dfw!+!f{jTqbNxpebit!)!0!*!1/2!)3dfw!>!f{jTmfyfu!3dfw!!!!!!!!!!!!|!*!sbGbsfnbDxpebit!ubpmg!-sbfObsfnbDxpebit!ubpmg!-esppDxpebit!5dfw!-tvjebSxpebit!ubpmg!-tbjCxpebit!ubpmg!-f{jTqbNxpebit!3dfw!-qbNxpebit!E3sfmqnbt!)xpebiTuojpQufh!ubpmg!!!!!!!!~!!!!!!!!<*!68/1!-684/1!)3dfw!,!sbobmq!+!*!63/1!-632/1!)3dfw!osvufs!!!!!!!!!!!!~!!!!!!!!!!!!<1/3!.!Zohjt!+!{/w!>!z/sbobmq!!!!!!!!!!!!!!!!<1/3!,!Zohjt!+!1/3!,!y/w!>!y/sbobmq!!!!!!!!!!!!!!!!<*!z/w!)ohjt!>!Zohjt!ubpmg!!!!!!!!!!!!!!!!|!*!foPutpnmb!>?!z/Wtcb!)!gj!ftmf!~!!!!!!!!!!!!<Yohjt!+!1/3!,!Yohjt!+!{/w!>!y/sbobmq!!!!!!!!!!!!!!!!<*!y/w!)ohjt!>!Yohjt!ubpmg!!!!!!!!!!!!!!!!|!*!foPutpnmb!>?!y/Wtcb!)!gj!ftmf!~!!!!!!!!!!!!<y/w!.!1/5!>!y/sbobmq!!!!!!!!!!!!!!!!!!!!*!1/1!?!{/w!)!gj!!!!!!!!!!!!!!!!|!*!foPutpnmb!>?!{/Wtcb!)!gj!!!!!!!!!!!!<mfyfUButpnmb!.!1/2!>!foPutpnmb!ubpmg!!!!!!!!!!!!<Zf{jTmfyfu!+!6/2!>!mfyfUButpnmb!ubpmg!!!!!!!!!!!!<zy/w!>!sbobmq!3dfw!!!!!!!!!!!!<*!Zf{jTmfyfu!+!1/3!.!1/2!)!+!fcvDpUfmbdt!>+!w!!!!!!!!!!!!<fcvDpUfmbdt!>+!Wtcb!!!!!!!!!!!!<*!*!{/Wtcb!-z/Wtcb!)ybn!-y/Wtcb!)ybn!0!1/2!>!fcvDpUfmbdt!ubpmg!!!!!!!!!!!!<*!w!)tcb!>!Wtcb!4dfw!!!!!!!!!!!!|!*!Zf{jTmfyfu!ubpmg!-w!4dfw!)WVpUfcvd!3dfw!!!!!!!!~!!!!!!!!<xpebit!osvufs!!!!!!!!!!!!~!!!!!!!!!!!!gjeof$!!!!!!!!!!!!<*!{/esppDxpebit!-zy/esppDxpebit!-qbNxpebit!)fsbqnpDE3fsvuyfu!>!xpebit!!!!!!!!!!!!!!!!ftmf$!!!!!!!!!!!!<*!1/:!0!1/2!)!+!*!!!!!!!!!!!!!!!!*!{/esppDxpebit!-*!2ze!-2ye!)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit!)qsfMxpebiTE3fsvuyfu!!!!!!!!!!!!!!!!!!!!,!*!{/esppDxpebit!-*!2ze!-1/1!)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit!)qsfMxpebiTE3fsvuyfu!!!!!!!!!!!!!!!!!!!!,!*!{/esppDxpebit!-*!2ze!-1ye!)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit!)qsfMxpebiTE3fsvuyfu!!!!!!!!!!!!!!!!!!!!,!*!{/esppDxpebit!-*!1/1!-2ye!)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit!)qsfMxpebiTE3fsvuyfu!!!!!!!!!!!!!!!!!!!!,!*!{/esppDxpebit!-zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit!)qsfMxpebiTE3fsvuyfu!!!!!!!!!!!!!!!!!!!!,!*!{/esppDxpebit!-*!1/1!-1ye!)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit!)qsfMxpebiTE3fsvuyfu!!!!!!!!!!!!!!!!!!!!,!*!{/esppDxpebit!-*!1ze!-2ye!)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit!)qsfMxpebiTE3fsvuyfu!!!!!!!!!!!!!!!!!!!!,!*!{/esppDxpebit!-*!1ze!-1/1!)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit!)qsfMxpebiTE3fsvuyfu!!!!!!!!!!!!!!!!!!!!,!*!{/esppDxpebit!-*!1ze!-1ye!)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit!)qsfMxpebiTE3fsvuyfu!!!!!!!!!!!!!!!!!!!!)!>!xpebit!!!!!!!!!!!!!!!!<tvjebSxpebit!+!z/f{jTmfyfu!,!>!2ze!ubpmg!!!!!!!!!!!!!!!!<tvjebSxpebit!+!y/f{jTmfyfu!,!>!2ye!ubpmg!!!!!!!!!!!!!!!!<tvjebSxpebit!+!z/f{jTmfyfu!.!>!1ze!ubpmg!!!!!!!!!!!!!!!!<tvjebSxpebit!+!y/f{jTmfyfu!.!>!1ye!ubpmg!!!!!!!!!!!!!!!!<f{jTqbNxpebit!0!*!1/2!)3dfw!>!f{jTmfyfu!3dfw!!!!!!!!!!!!!!!!*!UGPT`GDQ`FQZU`QBNXPEBIT!)efojgfe!gjmf$!!!!!!!!!!!!<*!1/:!0!1/2!)!+!*!!!!!!!!!!!!!!!!*!{/esppDxpebit!-*!2ze!-2ye!)3dfw!,!zy/esppDxpebit!-qbNxpebit!)fsbqnpDE3fsvuyfu!!!!!!!!!!!!!!!!!!!!,!*!{/esppDxpebit!-*!2ze!-1/1!)3dfw!,!zy/esppDxpebit!-qbNxpebit!)fsbqnpDE3fsvuyfu!!!!!!!!!!!!!!!!!!!!,!*!{/esppDxpebit!-*!2ze!-1ye!)3dfw!,!zy/esppDxpebit!-qbNxpebit!)fsbqnpDE3fsvuyfu!!!!!!!!!!!!!!!!!!!!,!*!{/esppDxpebit!-*!1/1!-2ye!)3dfw!,!zy/esppDxpebit!-qbNxpebit!)fsbqnpDE3fsvuyfu!!!!!!!!!!!!!!!!!!!!,!*!{/esppDxpebit!-zy/esppDxpebit!-qbNxpebit!)fsbqnpDE3fsvuyfu!!!!!!!!!!!!!!!!!!!!,!*!{/esppDxpebit!-*!1/1!-1ye!)3dfw!,!zy/esppDxpebit!-qbNxpebit!)fsbqnpDE3fsvuyfu!!!!!!!!!!!!!!!!!!!!,!*!{/esppDxpebit!-*!1ze!-2ye!)3dfw!,!zy/esppDxpebit!-qbNxpebit!)fsbqnpDE3fsvuyfu!!!!!!!!!!!!!!!!!!!!,!*!{/esppDxpebit!-*!1ze!-1/1!)3dfw!,!zy/esppDxpebit!-qbNxpebit!)fsbqnpDE3fsvuyfu!!!!!!!!!!!!!!!!!!!!,!*!{/esppDxpebit!-*!1ze!-1ye!)3dfw!,!zy/esppDxpebit!-qbNxpebit!)fsbqnpDE3fsvuyfu!!!!!!!!!!!!!!!!!!!!)!>!xpebit!!!!!!!!!!!!!!!!<tvjebSxpebit!+!z/f{jTmfyfu!,!>!2ze!ubpmg!!!!!!!!!!!!!!!!<tvjebSxpebit!+!y/f{jTmfyfu!,!>!2ye!ubpmg!!!!!!!!!!!!!!!!<tvjebSxpebit!+!z/f{jTmfyfu!.!>!1ze!ubpmg!!!!!!!!!!!!!!!!<tvjebSxpebit!+!y/f{jTmfyfu!.!>!1ye!ubpmg!!!!!!!!!!!!!!!!<f{jTqbNxpebit!0!*!1/2!)3dfw!>!f{jTmfyfu!3dfw!!!!!!!!!!!!!!!!*!GDQ`FQZU`QBNXPEBIT!)efojgfe!gj$!!!!!!!!!!!!|!*!utfUnvutvsg!)!gj!!!!!!!!!!!!<*!dfWutfUnvutvsg!)mmb!>!utfUnvutvsg!mppc!!!!!!!!!!!!<*!1/2!>=!{/esppDxpebit!-nvutvsGoj!)3dfwc!>!dfWutfUnvutvsg!3dfwc!!!!!!!!!!!!<*!dfWnvutvsGoj!)mmb!>!nvutvsGoj!mppc!!!!!!!!!!!!<*!1/2!>=!z/esppDxpebit!-1/1!>?!z/esppDxpebit!-1/2!>=!y/esppDxpebit!-1/1!>?!y/esppDxpebit!)!5dfwc!>!dfWnvutvsGoj!5dfwc!!!!!!!!!!!!<tbjCxpebit!>,!{/esppDxpebit!!!!!!!!!!!!<x/esppDxpebit!>0!{zy/esppDxpebit!!!!!!!!!!!!<1/2!>!xpebit!ubpmg!!!!!!!!!!!!|!*!esppDxpebit!5dfw!-tvjebSxpebit!ubpmg!-tbjCxpebit!ubpmg!-f{jTqbNxpebit!3dfw!-qbNxpebit!E3sfmqnbt!)xpebiTufh!ubpmg!!!!!!!!~!!!!!!!!<d!osvufs!!!!!!!!!!!!<*!y/g!-c!-b!)yjn!>!d!ubpmg!!!!!!!!!!!!<*!z/g!-us!-cs!)yjn!>!c!ubpmg!!!!!!!!!!!!<*!z/g!-um!-cm!)yjn!>!b!ubpmg!!!!!!!!!!!!<*!6/1!,!f{jt!+!wv!)udbsg!>!g!3dfw!!!!!!!!!!!!<*!fsbqnpd!-zz/uftggp!+!f{jTmfyfu!,!WVejpsuofd!-tiuqfe!)fsbqnpDE3fsvuyfu!>!us!ubpmg!!!!!!!!!!!!<*!fsbqnpd!-yz/uftggp!+!f{jTmfyfu!,!WVejpsuofd!-tiuqfe!)fsbqnpDE3fsvuyfu!>!cs!ubpmg!!!!!!!!!!!!<*!fsbqnpd!-zy/uftggp!+!f{jTmfyfu!,!WVejpsuofd!-tiuqfe!)fsbqnpDE3fsvuyfu!>!um!ubpmg!!!!!!!!!!!!<*!fsbqnpd!-yy/uftggp!+!f{jTmfyfu!,!WVejpsuofd!-tiuqfe!)fsbqnpDE3fsvuyfu!>!cm!ubpmg!!!!!!!!!!!!<f{jt!0!*!6/1!,!f{jt!+!wv!)sppmg!>!WVejpsuofd!3dfw!!!!!!!!!!!!<f{jt!0!*!1/2!)3dfw!>!f{jTmfyfu!3dfw!!!!!!!!!!!!<*!1/2!-1/1!)3dfw!>!uftggp!3dfw!utopd!!!!!!!!!!!!|!*!fsbqnpd!ubpmg!-wv!3dfw!-f{jt!3dfw!-tiuqfe!E3sfmqnbt!)qsfMxpebiTE3fsvuyfu!ubpmg!!!!!!!!~!!!!!!!!<*!*!*!wv!-tiuqfe!)E3fsvuyfu!)iuqfEpUBCHSldbqov!-fsbqnpd!)qfut!osvufs!!!!!!!!!!!!|!*!fsbqnpd!ubpmg!-wv!3dfw!-tiuqfe!E3sfmqnbt!)fsbqnpDE3fsvuyfu!ubpmg!!!!!!!!~!!!!!!!!<*!tspudbGldbqoV!-w!)upe!osvufs|!*!w!5dfw!oj!utopd!)iuqfEpUBCHSldbqov!ubpmg!!!!!!!!<*!/2!-tspudbGldbQ!)5dfw!0!fmbdtoxpEldbqoV!>!tspudbGldbqoV!5dfw!utopd!!!!!!!!<*!/763!!-/763!+!/763!-/763!+!/763!+!/763!)4dfw!>!tspudbGldbQ!4dfw!utopd!!!!!!!!<*2!hojevmdyf)!opjudbsg!?.!2//1!00!</763!0!/663!>!fmbdtoxpEldbqoV!ubpmg!utopd!!!!!!!!<*2!hojevmdoj)!2//1!?.!opjudbsg!00!</663!0!/763!>!fmbdtqVldbQ!ubpmg!utopd!!!!!!!!<esppDxpebit!5dfw!hojzsbw<fwjfdfSxpebit!mppc!nspgjov<tvjebSxpebit!ubpmg!nspgjov<tbjCxpebit!ubpmg!nspgjov<zujtofuoJxpebit!ubpmg!nspgjov<f{jTxpebit!3dfw!nspgjov<qbNxpebit!E3sfmqnbt!nspgjov<mmvDxpebit!mppc!nspgjov!QBNXPEBIT`FTV!gfegj$!!gjeof$!<fdobutjEfojMw!ubpmg!hojzsbw<fdobutjEqbHitbEv!ubpmg!nspgjov<fdobutjEitbEv!ubpmg!nspgjov<itbEv!mppc!nspgjov!ITBE!gfegj$!!gjeof$!<sbGhpGv!ubpmg!nspgjov<sbfOhpGv!ubpmg!nspgjov<spmpDhpGv!5dfw!nspgjov!HPG!gfegj$!!gjeof$!<^UPQT`YBN]opjudfsjEupqTv!4dfw!nspgjov<^UPQT`YBN]opjujtpQupqTv!4dfw!nspgjov<^UPQT`YBN]fhobSupqTv!ubpmg!nspgjov<^UPQT`YBN]fmhoBupqTv!ubpmg!nspgjov<^UPQT`YBN]uofopqyFupqTv!ubpmg!nspgjov<^UPQT`YBN]spmpDupqTv!5dfw!nspgjov!1!?!UPQT`YBN!gj$!!gjeof$!<^UOJPQ`YBN]opjujtpQuojpQv!4dfw!nspgjov<^UOJPQ`YBN]fhobSuojpQv!ubpmg!nspgjov<^UOJPQ`YBN]spmpDuojpQv!5dfw!nspgjov!1!?!UOJPQ`YBN!gj$!!gjeof$!<^SJE`YBN]opjudfsjEsjEv!4dfw!nspgjov<^SJE`YBN]spmpDsjEv!5dfw!nspgjov!1!?!SJE`YBN!gj$!!gjeof$!<eofmCidubCw!4dfw!hojzsbw<eofmCidubCv!mppc!nspgjov!EOFMCIDUBC!gfegj$!!gjeof$!<ttfouihjsCidubCw!ubpmg!hojzsbw<ttfouihjsCidubCv!mppc!nspgjov!TTFOUIHJSCIDUBC!gfegj$!!gjeof$!<spmpDidubCw!5dfw!hojzsbw<spmpDidubCv!mppc!nspgjov!SPMPDIDUBC!gfegj$!<spmpDuihjmebfIv!5dfw!nspgjov<zujtofuoJuofjcnBuihjmebfIv!ubpmg!nspgjov<fhobSuihjmebfIv!ubpmg!nspgjov<emspXw!4dfw!hojzsbw<opjujtpQbsfnbDv!4dfw!nspgjov<yjsubNxfjWv!5ubn!nspgjov!gjeof$!<zujwjudfmgfSv!ubpmg!nspgjov<qbNwoFv!fcvDsfmqnbt!nspgjov<qbNwoFftVv!mppc!nspgjov!QBNWOF`FTV!gfegj$!<opjujtpQw!4dfw!hojzsbw<yfusfWw!4dfw!hojzsbw<mbnspOw!4dfw!hojzsbw<ftvggjEv!5dfw!nspgjov<zujdbqPusbQv!ubpmg!nspgjov<ttfouihjsCv!ubpmg!nspgjov<uihjMv!mppc!nspgjov<spmpDeofmCv!5dfw!nspgjov<eofmCv!mppc!nspgjov<uofdsfQqjmDv!ubpmg!nspgjov<opjudfsjEqjmDv!uoj!nspgjov<wVs!3dfw!hojzsbw<sfmqnbTeofmCv!E3sfmqnbt!nspgjov<sfmqnbTv!E3sfmqnbt!nspgjov<wVw!3dfw!hojzsbw<fsvuyfUeofmCv!mppc!nspgjov<fsvuyfUv!mppc!nspgjov<uofsbqtobsUv!mppc!nspgjov<utfUbiqmBv!ubpmg!nspgjov<spmpDftsfwfSldjQyjGv!5dfw!nspgjov<qjmGftsfwfSv!mppc!nspgjov<ldjQv!mppc!nspgjov<yjGv!mppc!nspgjov<fmcbudfmfTesbdtjEv!mppc!nspgjov!YJGFSQ!gjeof$!!gjeof$!!<ubpmg!qnvjefn!opjtjdfsq!!ftmf$!!<ubpmg!qihji!opjtjdfsq!!IHJI`OPJTJDFSQ`UOFNHBSG`MH!gfegj$!!TF`MH!gfegj$!";ae(m,{setBatchInfo:function(n,v){wb[n]=v},getBatchInfo:function(O){return wb[O]},getBatchInfoMap:function(){return wb},setBatchInfoMap:function(G){wb=G}},!0);var kq=[1,1,1],Kr=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],vc=[1,0,0,0,0,1,0,1,1,1,1,0],ob=[-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5],Jl=[.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5],kj=[.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5],Bs=[.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5],gj=[.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5],Ke=[-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5],Td=function(D,E){var $=D._40Q;$.each(function(b){b.ivBatch(E)})},Ub=function(c,i,C){var b=C._id,D=i[b];if(D){var o=D.batch,f=c[o],U=f.ds,k=D.index;if(f.invalidate=!0,delete i[b],U.splice(k,1),Gh(U))return delete c[o],void 0;for(var m=D.begin,$=D.size,X=3*m,B=3*$,L=4*m,R=4*$,j=f.vs,I=f.ps,H=f.uv,T=f.cs,Q=f.bs,d=f.rs,s=f.ns,g=f.ls;k<U.length;k++)D=i[U[k]._id],D.index--,D.begin-=$;j.splice(X,B),I.splice(L,R),H&&H.splice(2*m,2*$),T&&T.splice(L,R),Q&&Q.splice(X,B),d&&d.splice(m,$),s&&s.splice(X,B),g&&g.splice(m,$)}},ef=function(B,H,V,d){if(!d)return z;var y=H[d];if(!y){var j=wb[d]||is,O=j.image?[]:z;y=H[d]={vs:[],ns:[],uv:O,cs:O?z:j.color?z:[],bs:j.blend?[]:z,ps:[],rs:j.brightness?[]:z,ds:[]}}return y.invalidate=!0,B[V._id]={index:y.ds.length,begin:y.vs.length/3,batch:d},y.ds.push(V),y},Ur=function($,V){return V!=z&&1!==V?[$[0]*V,$[1]*V,$[2]*V,$[3]]:$},Ye=function(){var E;return function(a,J,H){var Z=a.getData3dUI(J),B=Z.shapeModel;if(B||(B=Dg(Z)),B||!Z.shapeName){var Q,K=J.s("wf.combineTriangle");if(H.geometry){if(!B&&(J instanceof R.Node&&!(J instanceof R.Shape)?(E||(E={vs:oq,is:Zq,uv:wg}),B=E):B=[Z.left,Z.front,Z.right,Z.back,Z.top,Z.bottom],!B))return x;if(K?(K=0|Math.min(3,Math.max(1,isNaN(K)?1:K)),Q=hc[K-1](B)):Q=sh(B),!Q||0===Q.length)return}else Q=H.short?wj:Ah;var S=a.getBrightness(J),M=Em(H.color||"white"),X=M[3]<1,y=Math.ceil(H.width)||1,s=(X?"T":"O")+y,c=J.getRenderLayer(),D=a._40Q.get(c),C=D.wireframeIndexMap,f=D.wireframeModelMap,v=f[s];v||(v=f[s]={vs:[],cs:[],ps:[],ds:[],T:X,W:y}),v.invalidate=!0;var N=v.vs,g=v.cs,A=v.ds,w=C[J._id]={index:A.length,begin:N.length/3,batch:s};A.push(J);var h=Z.mat;J instanceof R.Edge||!(!h||!H.geometry&&J instanceof R.Shape)||(h=dg(J,H.mat),J.appendAnchorMatrix3d(h)),vm(N,h,Q);var m=w.size=N.length/3-w.begin;Jq(g,Ur(M,S),m)}}}(),Qi=function(t,J,Q,x,X,Y,Z,c,a){var h=t.getBrightness(J);h==z&&(h=1);var o=Ur(Em(x),h),A=o[3]<1;Y=Math.ceil(Y)||1;var M=(A?"T":"O")+Y;if(Z){var U=Z[0],R=(Z[1]||U)+U;M+="-"+U+"-"+R,a&&(M+="-"+wc(a)+"-"+h,a=Ur(Em(a),h))}var D=J.getRenderLayer(),N=t._40Q.get(D),j=N.polylineIndexMap,y=N.polylineModelMap,d=y[M];d||(d=y[M]={vs:[],cs:[],ps:[],ds:[],ls:Z?[]:z,T:A,W:Y},Z&&(d.D=U,d.G=R,d.A=a)),d.invalidate=!0;var p,P=d.vs,$=d.cs,W=d.ds,g=d.ls,e=j[J._id]={index:W.length,begin:P.length/3,batch:M};W.push(J),Pr(P,Q);var S,B=e.size=P.length/3-e.begin,n=Q.length,_=0,w=[];if(Z||X)for(p=0;n>p;p+=6)S=id([Q[p],Q[p+1],Q[p+2]],[Q[p+3],Q[p+4],Q[p+5]]),w.push(S),_+=S;if(_&&X){var r,f=Ur(Em(X),h),T=[f[0]-o[0],f[1]-o[1],f[2]-o[2],f[3]-o[3]],s=0;for(p=0;n>p;p+=6)r=s/_,Jq($,[o[0]+T[0]*r,o[1]+T[1]*r,o[2]+T[2]*r,o[3]+T[3]*r],1),s+=w[p/6],r=s/_,Jq($,[o[0]+T[0]*r,o[1]+T[1]*r,o[2]+T[2]*r,o[3]+T[3]*r],1)}else Jq($,o,B);if(Z)for(s=c||0,p=0;n>p;p+=6)g.push(s),s+=w[p/6],g.push(s)},Co=function(g,n,h){if(n){var S=4*n.begin,C=h[n.batch].ps;if(C[S]!==g[0]||C[S+1]!==g[1]||C[S+2]!==g[2]||C[S+3]!==g[3]){for(var s=0;s<n.size;s++)C[S++]=g[0],C[S++]=g[1],C[S++]=g[2],C[S++]=g[3];C._invalidateThisFrame=!0}}},Dl=function(O,f){var p=f+["32"],x=O[f],S=O[p];x?S&&S.length===x.length?(S.set(x),S._bufId=null):O[p]=new Gg(x):delete O[p]},Vn=function(s,$,K,b,n,i,X,d,p){if(Mf(K))K.forEach(function(Q){Vn(s,$,Q,b,n,i,X,d,p)});else if(yk(K))Vn(s,$,Dg(b,K),b,n,i,X,d,p);else if(Vc(K)){var l,G=Lq(K.mat,$,s),z=Lq(K.s3,$,s),Z=Lq(K.t3,$,s),c=Lq(K.r3,$,s);if((z||c||Z||G)&&(l=rr(G,z,c,Lq(K.rotationMode,$,s),Z),i.push(l)),K.shape3d)Vn(s,$,K.shape3d,b,n,i,X,d,K);else{var q=b.s;p=p||is;var u=i[0],o=i.length,y=q("shape3d.color",K.color,p.color);if(n||(n=q("shape3d.blend",K.blend,p.blend)),o>1){u=ls(u);for(var O=1;o>O;O++)Tk(u,u,i[O])}K.vs&&q(pq,K.visible,p.visible)&&_l(u,X,d,K.vs,K.uv,K.is,n,y),K.top_vs&&q(on,K.topVisible,p.topVisible)&&_l(u,X,d,K.top_vs,K.top_uv,K.top_is,n,q("shape3d.top.color",K.topColor,p.topColor)||y),K.bottom_vs&&q(_e,K.bottomVisible,p.bottomVisible)&&_l(u,X,d,K.bottom_vs,K.bottom_uv,K.bottom_is,n,q("shape3d.bottom.color",K.bottomColor,p.bottomColor)||y),K.from_vs&&q(hj,K.fromVisible,p.fromVisible)&&_l(u,X,d,K.from_vs,K.from_uv,K.from_is,n,q("shape3d.from.color",K.fromColor,p.fromColor)||y),K.to_vs&&q(Zm,K.toVisible,p.toVisible)&&_l(u,X,d,K.to_vs,K.to_uv,K.to_is,n,q("shape3d.to.color",K.toColor,p.toColor)||y)}l&&i.pop()}},_l=function(V,a,F,S,C,k,c,N){var p,Q=a.cs,w=a.uv,y=a.bs;if(k){p=k.length;for(var R=0;p>R;R++){var i=k[R];vm(F,V,[S[3*i],S[3*i+1],S[3*i+2]]),w&&Pr(w,[C[2*i],C[2*i+1]])}}else p=S.length/3,vm(F,V,S),w&&Pr(w,C);Q&&Jq(Q,N,p),y&&(c?Zi(y,c,p):Pr(y,kq,p))},ir=function(Y,G,U,c){var K=[];c?Vn(Y.gv,Y.data,c,Y,Y.getBodyColor(),[G],U,K):(Wn(Y,ec,G,U,K),Wn(Y,Gj,G,U,K),Wn(Y,ws,G,U,K),Wn(Y,Wb,G,U,K),Wn(Y,$i,G,U,K),Wn(Y,dh,G,U,K),Wn(Y,"csg",G,U,K)),K.length&&(Pr(U.vs,K),Pr(U.ns,oc(K)))},Wn=function(Q,d,l,I,J){var v=Q[d];if(v){var _=v.tuv;if(_){var c,M,r,t,u=v.uvScale,f=v.uvOffset;if(u)for(c=_.length,M=u[0],r=u[1],t=0;c>t;t+=2)_[t]*=M,_[t+1]*=r;if(f)for(c=_.length,M=f[0],r=f[1],t=0;c>t;t+=2)_[t]+=M,_[t+1]+=r}_l(l,I,J,v.vs,_,z,v.blend,v.color)}},dc=function(N,p,f,_,y,R,$,G){var j,P=f.cs,s=f.uv,X=f.bs;if(N.getFaceVisible(p,R)){var Q=N.getFaceMat(p,R);if(Q&&(y=dg(p,Q)),vm($,y,G),P&&Jq(P,N.getFaceColor(p,R),6),s){var n=N.getFaceUv(p,R)||_[R+"Uv"],x=N.getFaceUvScale(p,R)||_[R+"UvScale"],D=N.getFaceUvOffset(p,R)||_[R+"UvOffset"];n=n?[n[6],n[7],n[0],n[1],n[2],n[3],n[2],n[3],n[4],n[5],n[6],n[7]]:vc;var e=n[0],v=n[1],S=n[2],w=n[3],J=n[4],M=n[5],c=n[6],B=n[7],b=n[8],u=n[9],W=n[10],a=n[11];if(x){var t=x[0],z=x[1];e*=t,v*=z,S*=t,w*=z,J*=t,M*=z,c*=t,B*=z,b*=t,u*=z,W*=t,a*=z}if(D){var U=D[0],l=D[1];e+=U,v+=l,S+=U,w+=l,J+=U,M+=l,c+=U,B+=l,b+=U,u+=l,W+=U,a+=l}s.push(e,v,S,w,J,M,c,B,b,u,W,a)}X&&(j=N.getBodyColor(p)||N.getFaceBlend(p,R),j?Zi(X,j,6):Pr(X,kq,6))}},To=function(H,q,g,j){var g=H._picking?H.pickColorMap:null,Y=H.getGL(),p=H._prg,U=H._buffer;if(!ml(q)){Ld(H,Kr),qq(Y,p);for(var y in q){var R=q[y];if(!(j&&!R.T||!j&&R.T)){R.invalidate?(R.invalidate=!1,Dl(R,"vs"),Dl(R,"cs"),Dl(R,"ls"),Dl(R,"ps")):g&&R.ps&&R.ps._invalidateThisFrame&&(R.ps._invalidateThisFrame=!1,Dl(R,"ps"));var K=R.vs32,h=g?R.ps32:R.cs32;cc(Y,p,R.W,z,U.vs,K);var F=$c.for(Y),Z=F.directUniforms(),c=F.directAttribs(),l=R.D,v=!H._dashDisabled&&l;Z.uAlphaTest=a.alphaTest,v&&(Z.uDash=!0,Z.uDashDistance=l,Z.uDashGapDistance=R.G,Z.uDiffuse=R.A||a["color.empty"],c.aLineDistance=Ql(Y,U.lineDistance,R.ls32,z,1));var e=!H._batchColorDisabled;e?(Z.uBatchColor=!0,c.aBatchColor=Ql(Y,U.batchColor,h,z,4)):(Z.uBatchColor=!1,c.aBatchColor=!1),jp(Y),Yi(Y,0,K.length/3,Y.LINES),Dc(Y),e&&(Z.uBatchColor=!1,c.aBatchColor=!1),v&&(Z.uDash=!1,c.aLineDistance=!1)}}ch(Y,p),Qj(H)}},gl=function(v,Y,G,D,y){var Q,C,o,$,M,L,n,w,U,R,i,G=v._picking?v.pickColorMap:null,c=v.getGL(),P=v._prg,K=$c.for(c),V=K.directUniforms(),d=K.directAttribs(),Z=v._buffer;if(!ml(Y)&&!v.drawFilter){Ld(v,Kr);for(Q in Y)if(C=wb[Q]||is,C.visible!==!1&&!(D&&!C.transparent||!D&&C.transparent||v.isReflecting(c)&&C.reflectable===!1)){var t=C.renderLayerMask;if(t==z&&(t=ui),y==z&&(y=ui),hd(y,t)&&(o=Y[Q],G||!C.transparentMask)){var X=D&&C.autoSort===!0&&(v._33Q||o.invalidate);if(o.invalidate?(o.invalidate=!1,Dl(o,"vs"),Dl(o,"ns"),Dl(o,"cs"),Dl(o,"rs"),Dl(o,"ps"),Dl(o,"bs"),Dl(o,"uv")):G&&o.ps&&o.ps._invalidateThisFrame&&(o.ps._invalidateThisFrame=!1,Dl(o,"ps")),M=o.vs32,L=G?o.ps32:o.cs32,U=o.uv32,n=o.bs32,w=o.rs32,i=M.length/3,X){var s=wi(M,v.getEye(),v);s?(o.is=s.is,o.elementTypeUint=s.useUint32):(o.is=null,o.elementTypeUint=null)}if(i){$=C.light,R=v.getTexture(C.image),Le(c,P,z,C.light,C.opacity,C.reverseFlip,C.reverseColor,C.reverseCull),L?v._batchColorDisabled?(V.uBatchColor=!1,d.aBatchColor=!1):(V.uBatchColor=!0,d.aBatchColor=Ql(c,Z.batchColor,L,z,4)):(V.uBatchColor=!1,V.uDiffuse=C.color||a["color.empty"]);var m=C.alphaTest;V.uAlphaTest=m===x?a.alphaTest:m,C.envmap!==x?(V.uUseEnvMap=!0,V.uReflectivity=C.envmap):(V.uUseEnvMap=!1,V.uReflectivity=0);var j=n&&!v._batchBlendDisabled;j&&(V.uBatchBlend=!0,d.aBatchBlend=Ql(c,Z.batchBlend,n,z));var e=w&&!v._batchBrightnessDisabled;e&&(V.uBatchBrightness=!0,d.aBatchBrightness=Ql(c,Z.batchBrightness,w,z,1)),U?jp(c,P,R,C.discardSelectable,Z.uv,U,C.uvOffset,C.uvScale):jp(c),d.aPosition=Ql(c,Z.vs,M,z),d.aNormal=Ql(c,Z.ns,o.ns32,z),o.is?(Gr(c,Z.is,o.is),Vj(c,0,i,null,o.elementTypeUint?c.UNSIGNED_INT:null)):Yi(c,0,i),U?Dc(c,P,R):Dc(c),L&&!v._batchColorDisabled&&(V.uBatchColor=!1,d.aBatchColor=!1),j&&(V.uBatchBlend=!1,d.aBatchBlend=!1),e&&(V.uBatchBrightness=!1,d.aBatchBrightness=!1),af(c,P)}}}Qj(v)}},wi=function(n,z,y){var H=n.length/3,t=H>65535,f=y._glCapabilities.elementTypeUint&&t;if(!f&&t)return null;for(var E=new Array(H),v=H/3,s=new Array(v),j=0;v>j;j++)s[j]=j;s.sort(function(O,A){var Z=9*O,m=[(n[Z]+n[Z+3]+2*n[Z+6])/4,(n[Z+1]+n[Z+4]+2*n[Z+7])/4,(n[Z+2]+n[Z+5]+2*n[Z+8])/4];Z=9*A;var t=[(n[Z]+n[Z+3]+2*n[Z+6])/4,(n[Z+1]+n[Z+4]+2*n[Z+7])/4,(n[Z+2]+n[Z+5]+2*n[Z+8])/4],B=id(z,m)-id(z,t);return B>0?-1:0>B?1:0});for(var j=0;v>j;j++){var R=3*j,_=3*s[j];E[R]=_,E[R+1]=_+1,E[R+2]=_+2}return{useUint32:f,is:f?new Uint32Array(E):new hg(E)}},Qr={obj:function(L,f){var i={mat:L.mat,s3:L.s3,r3:L.r3,rotationMode:L.rotationMode,t3:L.t3,cube:L.cube==z?!0:L.cube,center:L.center==z?!0:L.center,ignoreMtls:L.ignoreMtls,ignoreTransparent:L.ignoreTransparent,ignoreColor:L.ignoreColor,ignoreImage:L.ignoreImage,ignoreNormal:L.ignoreNormal,prefix:L.prefix,flipY:L.flipY,flipFace:L.flipFace,reverseFlipMtls:L.reverseFlipMtls,finishFunc:function(n,B){if(n){var B=[];for(var D in n){var K=n[D];B.rawS3=K.rawS3,K.center&&(B.center=K.center),B.push(K),L.eachModel&&L.eachModel(D,K)}B.json=L,f(B)}else f()}};m.loadObj(L.obj,L.mtl,i)}};m.getModelTypeHandlers=function(){return Qr},m.setModelTypeHandler=function(M,Q){Qr[M]=Q},m.getModelTypeHandler=function(Z){return Qr[Z]},m.handleModelLoaded=function(){},m.handleUnfoundModel=function(){};var gi=z,$p=z,Xn=function(Y){gi&&!Y._loadingModelView_&&($p||($p={}),$p[Y._loadingModelView_=Hf()]=Y)},Me=function(t,d){gi||(gi={});var h=gi[t];if(h){if(h.url===d)return;h.request.onload=_h,h.request.onerror=_h}var q=new dk;if(gi[t]={request:q,url:d},d=m.beforeLoadURL(d),d.data){var G=m.parse(d.data);Nl(t,G,d)}else{q.onload=function(){if(200===this.status||0===this.status){delete gi[t];var j=m.parse(q.getResponseText());Nl(t,j,d)}else Vk(t,m.handleUnfoundModel(t,d)||z)},q.onerror=function(){Vk(t,m.handleUnfoundModel(t,d)||z)};var a={};a.url=encodeURI(d),a.sync=!1,q.send(a)}},Nl=function(I,k,i){var U=k.modelType;if(!U)return Vk(I,k),m.handleModelLoaded(I,k),void 0;var C=m.getModelTypeHandler(U);if(C){if(gi||(gi={}),gi[I])return;gi[I]=!0;var M=function(U){U?(Vk(I,U),m.handleModelLoaded(I,U)):Vk(I,m.handleUnfoundModel(I,i,k)||z)};C(k,M)}else Vk(I,m.handleUnfoundModel(I,i,k)||z)},Vk=function(A,e){if(delete gi[A],yk(e)&&Hm.test(e))return Me(A,e),void 0;if(wm[A]=e,ml(gi)&&(gi=z,$p)){for(var Y in $p){var N=$p[Y];N.invalidateAll&&N.invalidateAll(x,"modelLoaded",A),N.redraw&&N.redraw(),N.iv(),delete N._loadingModelView_}$p=z}if(e&&$p)for(var Y in $p){var N=$p[Y];N.invalidateAll&&N.invalidateAll(x,"modelLoading",A),N.redraw&&N.redraw(),N.iv()}},zh=new Gg([0,0,0,1,1,1,1,0]),ei=new Gg([0,0,1,0,0,1,0,0,1,0,0,1]),jo=new hg([0,1,2,2,3,0]),oq=new Gg([-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5]),Zq=new hg([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),wg=new Gg([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]),Of=oc(oq,Zq),Ak=(new Gg([-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5]),new hg([0,1,2,3,0,7,5,4,6,7,5,3,2,4,6,1]),[ec,ws,Gj,Wb,$i,dh]),Ah=[-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5],wj=[-.5,.5,.5,-.4,.5,.5,-.5,.5,.5,-.5,.4,.5,-.5,.5,.5,-.5,.5,.4,.5,.5,.5,.4,.5,.5,.5,.5,.5,.5,.4,.5,.5,.5,.5,.5,.5,.4,-.5,-.5,.5,-.4,-.5,.5,-.5,-.5,.5,-.5,-.4,.5,-.5,-.5,.5,-.5,-.5,.4,.5,-.5,.5,.4,-.5,.5,.5,-.5,.5,.5,-.4,.5,.5,-.5,.5,.5,-.5,.4,-.5,.5,-.5,-.4,.5,-.5,-.5,.5,-.5,-.5,.4,-.5,-.5,.5,-.5,-.5,.5,-.4,.5,.5,-.5,.4,.5,-.5,.5,.5,-.5,.5,.4,-.5,.5,.5,-.5,.5,.5,-.4,-.5,-.5,-.5,-.4,-.5,-.5,-.5,-.5,-.5,-.5,-.4,-.5,-.5,-.5,-.5,-.5,-.5,-.4,.5,-.5,-.5,.4,-.5,-.5,.5,-.5,-.5,.5,-.4,-.5,.5,-.5,-.5,.5,-.5,-.4],Fl=function(w,I,i,b,m,R,E){R=R||16,w=w||16,I=I||0,i=i||w;var J,h,X,z,x,S,c,q,D,g=.5,T=[],t=[],K=y/w,M=j/R;for(J=0;R>J;J++)for(S=J+1,z=J*M,D=S*M,h=I;i>h;h++)c=h+1,X=h*K,q=c*K,T.push(g*F(z)*d(X),g*d(z),-g*F(z)*F(X),g*F(D)*d(q),g*d(D),-g*F(D)*F(q),g*F(z)*d(q),g*d(z),-g*F(z)*F(q),g*F(z)*d(X),g*d(z),-g*F(z)*F(X),g*F(D)*d(X),g*d(D),-g*F(D)*F(X),g*F(D)*d(q),g*d(D),-g*F(D)*F(q)),t.push(h/w,J/R,c/w,S/R,c/w,J/R,h/w,J/R,h/w,S/R,c/w,S/R);if(E){var Y=[];for(J=0,x=T.length;x>J;J+=3)Y.push(2*T[J],2*T[J+1],2*T[J+2])}if(b){var O=[],n=[];for(X=I*K,J=0;R>J;J++)S=J+1,z=J*M,D=S*M,O.push(0,0,0,g*F(D)*d(X),g*d(D),-g*F(D)*F(X),g*F(z)*d(X),g*d(z),-g*F(z)*F(X)),n.push(0,.5,I/w,S/R,I/w,J/R)}if(m){var Q=[],p=[];for(X=i*K,J=0;R>J;J++)S=J+1,z=J*M,D=S*M,Q.push(0,0,0,g*F(z)*d(X),g*d(z),-g*F(z)*F(X),g*F(D)*d(X),g*d(D),-g*F(D)*F(X)),p.push(1,.5,i/w,J/R,i/w,S/R)}var o={vs:T,uv:t,from_vs:O,from_uv:n,to_vs:Q,to_uv:p};return E&&(o.ns=Y),o},kr=function(X,C,D){X=X||.17,C=C||12,D=D||18,0>X?X=0:X>.25&&(X=.25);var W,w,I,$,A,c,r,x=.5,U=[],e=[],K=[],J=y/D,Z=y/C,q=x-X;
for(w=0;C>=w;w++)for($=-j+w*Z,c=d($),A=F($),W=0;D>=W;W++)I=W*J,r=q+X*c,U.push(d(I)*r,A*X,-F(I)*r),e.push(W/D,1-w/C);for(w=0;C>w;w++){var m=w*(D+1),G=(w+1)*(D+1);for(W=0;D>W;W++)K.push(m+W,G+W+1,G+W,m+W,m+W+1,G+W+1)}return{vs:U,uv:e,is:K}},of=function(n,h,o,C,l,e,i,z){i=i||12,n=n||18,h=h||0,o=o||n,e=e||.17,0>e?e=0:e>.25&&(e=.25);var R,V,D,P,Q,$,k,J,X,m,B=.5,M=[],t=[],u=y/n,r=y/i,s=B-e,L=z?[]:x;for(D=0;i>D;D++)for(P=D+1,k=-j+D*r,J=-j+P*r,R=h;o>R;R++)V=R+1,Q=R*u,$=V*u,X=s+e*d(k),m=s+e*d(J),M.push(d(Q)*X,F(k)*e,-F(Q)*X,d($)*X,F(k)*e,-F($)*X,d($)*m,F(J)*e,-F($)*m,d(Q)*X,F(k)*e,-F(Q)*X,d($)*m,F(J)*e,-F($)*m,d(Q)*m,F(J)*e,-F(Q)*m),t.push(R/n,1-D/i,V/n,1-D/i,V/n,1-P/i,R/n,1-D/i,V/n,1-P/i,R/n,1-P/i),z&&L.push(d(Q)*d(k),F(k),-F(Q)*d(k),d($)*d(k),F(k),-F($)*d(k),d($)*d(J),F(J),-F($)*d(J),d(Q)*d(k),F(k),-F(Q)*d(k),d($)*d(J),F(J),-F($)*d(J),d(Q)*d(J),F(J),-F(Q)*d(J));if(C){var W=[],g=[];for(D=0;i>D;D++)P=D+1,k=-j+D*r,J=-j+P*r,Q=h*u,X=s+e*d(k),m=s+e*d(J),W.push(d(Q)*X,F(k)*e,-F(Q)*X,d(Q)*m,F(J)*e,-F(Q)*m,d(Q)*s,0,-F(Q)*s),g.push(.5+.5*d(k),.5-.5*F(k),.5+.5*d(J),.5-.5*F(J),.5,.5)}if(l){var U=[],K=[];for(D=0;i>D;D++)P=D+1,k=-j+D*r,J=-j+P*r,Q=o*u,X=s+e*d(k),m=s+e*d(J),U.push(d(Q)*X,F(k)*e,-F(Q)*X,d(Q)*s,0,-F(Q)*s,d(Q)*m,F(J)*e,-F(Q)*m),K.push(.5-.5*d(k),.5-.5*F(k),.5,.5,.5-.5*d(J),.5-.5*F(J))}var c={vs:M,uv:t,from_vs:W,from_uv:g,to_vs:U,to_uv:K};return z&&(c.ns=L),c},ud=function(H,I){for(var a,m,D,J=.5,g=16,h=[],T=[],P=[],x=y/g,e=0;g>=e;e++)a=e*x,m=d(a)*J,D=F(a)*J,h.push(m,-J,D,m,J,D),T.push(1-e/g,1,1-e/g,0);for(e=0;g>e;e++)P.push(2*e,2*e+1,2*e+3,2*e,2*e+3,2*e+2);if(I){var L=[],X=[],B=[];for(L.push(0,-J,0),X.push(.5,.5),e=0;g>=e;e++)a=e*x,m=d(a),D=F(a),L.push(m*J,-J,-D*J),X.push(.5+.5*m,.5+.5*D);for(e=0;g>e;e++)B.push(0,e+2,e+1)}if(H){var t=[],G=[],o=[];for(t.push(0,J,0),G.push(.5,.5),e=0;g>=e;e++)a=e*x,m=d(a),D=F(a),t.push(m*J,J,-D*J),G.push(.5+.5*m,.5-.5*D);for(e=0;g>e;e++)o.push(0,e+1,e+2)}return{vs:h,uv:T,is:P,bottom_vs:L,bottom_uv:X,bottom_is:B,top_vs:t,top_uv:G,top_is:o}},Mk=function(z,B,S,a,A,I,L,O){z=z||12,B=B||0,S=S||z;for(var e,j,v,i,R,K,H,w,m,Y=.5,T=[],p=[],M=y/z,P=B;S>P;P++)e=P+1,j=P*M,v=e*M,i=d(j)*Y,R=F(j)*Y,K=d(v)*Y,H=F(v)*Y,T.push(i,-Y,-R,K,-Y,-H,i,Y,-R,K,-Y,-H,K,Y,-H,i,Y,-R),p.push(P/z,1,e/z,1,P/z,0,e/z,1,e/z,0,P/z,0);if(O){var l=[];for(P=0,m=T.length;m>P;P+=3)l.push(2*T[P],0,2*T[P+2])}if(L){var Q=[],x=[];for(P=B;S>P;P++)j=M*P,v=M*(P+1),i=d(j),R=F(j),K=d(v),H=F(v),Q.push(i*Y,-Y,-R*Y,0,-Y,0,K*Y,-Y,-H*Y),x.push(.5+.5*i,.5+.5*R,.5,.5,.5+.5*K,.5+.5*H)}if(I){var W=[],$=[];for(P=B;S>P;P++)j=M*P,v=M*(P+1),i=d(j),R=F(j),K=d(v),H=F(v),W.push(i*Y,Y,-R*Y,K*Y,Y,-H*Y,0,Y,0),$.push(.5+.5*i,.5-.5*R,.5+.5*K,.5-.5*H,.5,.5)}if(a){var D=[],f=[];j=M*B,i=d(j)*Y,R=F(j)*Y,w=B/z,D.push(0,Y,0,0,-Y,0,i,-Y,-R,i,-Y,-R,i,Y,-R,0,Y,0),f.push(0,0,0,1,w,1,w,1,w,0,0,0)}if(A){var C=[],J=[];j=M*S,i=d(j)*Y,R=F(j)*Y,w=S/z,C.push(0,-Y,0,0,Y,0,i,Y,-R,i,Y,-R,i,-Y,-R,0,-Y,0),J.push(1,1,1,0,w,0,w,0,w,1,1,1)}var E={vs:T,uv:p,bottom_vs:Q,bottom_uv:x,top_vs:W,top_uv:$,from_vs:D,from_uv:f,to_vs:C,to_uv:J};return O&&(E.ns=l),E},Xi=function(f,v,G,X,Z){v=v||18,G=G||0,X=X==z?y:X,Z=Z==z?.5:Z;for(var $,T,P,D,p,c,I=[0,.5,.75,.875,.9375],m=[],r=[],q=[],x=X/v,o=0;o<I.length;o++){var R=0===o%2?0:.5;for($=0;v>=$;$++)T=($+R)*x+G,P=1-I[o],m.push(d(T)*Z*P,-Z+2*I[o]*Z,-F(T)*Z*P),r.push(($+R)/v,P)}for(o=0;o<I.length-1;o++){var L=o*(v+1),k=(o+1)*(v+1);for($=0;v>$;$++)q.push(L+$,k+$+1,k+$,L+$,L+$+1,k+$+1)}for(c=m.length/3-(v+1),$=0;v>$;$++)m.push(0,Z,0),r.push(($+.5)/v,0);for($=0;v>$;$++)q.push(c+$,c+$+1,c+(v+1)+$);if(f){var n=[],j=[],U=[];for(n.push(0,-Z,0),j.push(.5,.5),$=0;v>=$;$++)T=$*x+G,D=d(T),p=F(T),n.push(D*Z,-Z,-p*Z),j.push(.5+.5*D,.5+.5*p);for($=0;v>$;$++)U.push(0,$+2,$+1)}return{vs:m,uv:r,is:q,bottom_vs:n,bottom_uv:j,bottom_is:U}},Ni=function($,e,D,k,h,V){$=$||16,e=e||0,D=D||$;for(var x=.5,O=[],s=[],z=y/$,n=e;D>n;n++){var i=n+1,j=z*n,K=z*i;O.push(d(j)*x,-x,-F(j)*x,d(K)*x,-x,-F(K)*x,0,x,0),s.push(n/$,1,i/$,1,(n+i)/2/$,0)}if(V){var Z=[],r=[];for(n=e;D>n;n++){j=z*n,K=z*(n+1);var S=d(j),A=F(j),G=d(K),f=F(K);Z.push(S*x,-x,-A*x,0,-x,0,G*x,-x,-f*x),r.push(.5+.5*S,.5+.5*A,.5,.5,.5+.5*G,.5+.5*f)}}if(k){var c=[],P=[];j=z*e,c.push(0,x,0,0,-x,0,d(j)*x,-x,-F(j)*x),P.push(0,0,0,1,e/$,1)}if(h){var Q=[],u=[];j=z*D,Q.push(0,-x,0,0,x,0,d(j)*x,-x,-F(j)*x),u.push(1,1,1,0,D/$,1)}return{vs:O,uv:s,bottom_vs:Z,bottom_uv:r,from_vs:c,from_uv:P,to_vs:Q,to_uv:u}},kb=function(M,v,E,s,U,y,F,f){for(var i=[],D=0;D<M.length-1;D+=2)i.push({x:M[D],y:M[D+1]});return Bh(i,v,E,s,U,y,F,f,!1)},sg={roundRect:function(z,u){return kb([.5,.4,.5,.442,.471,.471,.442,.5,.4,.5,-.4,.5,-.442,.5,-.471,.471,-.5,.442,-.5,.4,-.5,-.4,-.5,-.442,-.471,-.471,-.442,-.5,-.4,-.5,.4,-.5,.442,-.5,.471,-.471,.5,-.442,.5,-.4,.5,.4],[1,3,3,2,3,3,2,3,3,2,3,3,2],z,u,3)},star:function(W,Z){return kb([.193,.079,.333,.5,0,.233,-.333,.5,-.194,.079,-.5,-.167,-.112,-.167,0,-.5,.111,-.167,.5,-.167],[1,2,2,2,2,2,2,2,2,2,5],W,Z)},rect:function(c,b){return kb([.5,-.5,.5,.5,-.5,.5,-.5,-.5],[1,2,2,2,5],c,b)},billboard:function(){return{vs:[-.5,.5,0,-.5,-.5,0,.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0],uv:[0,0,0,1,1,0,1,0,0,1,1,1],ns:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1]}},plane:function(){return{vs:[-.5,0,-.5,-.5,0,.5,.5,0,-.5,.5,0,-.5,-.5,0,.5,.5,0,.5],uv:[0,0,0,1,1,0,1,0,0,1,1,1],ns:[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0]}},triangle:function(Z,L){return kb([0,-.5,.5,.5,-.5,.5],[1,2,2,5],Z,L)},rightTriangle:function(M,c){return kb([.5,.5,-.5,.5,-.5,-.5],[1,2,2,5],M,c)},parallelogram:function(y,q){return kb([.5,-.5,.25,.5,-.5,.5,-.25,-.5],[1,2,2,2,5],y,q)},trapezoid:function(e,w){return kb([.25,-.5,.5,.5,-.5,.5,-.25,-.5],[1,2,2,2,5],e,w)}},pi={sphere:1,cylinder:1,cone:1,torus:1},rq={torus:1,sphere:1},cp=ae(qj(sg),{cylinder:1}),ik=ae(qj(sg),{cylinder:1,cone:1}),yc=function(l,g,P){var y,W=Lq(l.anchor3d,P,g),N=Lq(l.mat,P,g),r=Lq(l.s3,P,g),X=Lq(l.t3,P,g),p=Lq(l.r3,P,g),q=r||p||X||N;if(W||q){y=ls(g._6O);var k=q?rr(N,r,p,Lq(l.rotationMode,P,g),X):Re();W&&$f(k,[.5-W[0],.5-W[1],.5-W[2]]),Ld(g,k)}return y},qn=function(F,d,h,B,U,$,Y){if(Mf(h))h.forEach(function(E){qn(F,d,E,B,U,$,Y)});else if(yk(h))qn(F,d,Dg(B,h),B,U,$,Y);else if(Vc(h))if(h.shape3d){var t=yc(h,F,d);qn(F,d,h.shape3d,B,U,$,h),t&&Qj(F,t)}else nh(F,d,h,B.s,U,$,Y)},nh=function(q,_,M,Z,E,W,R){if(R=R||is,!W||W(Z("shape3d.transparent",M.transparent,R.transparent))){var m=yc(M,q,_);if(Dn(M)){var b=q.getData3dUI(_);b.dispatchBoundingBoxChanged()}var k=q._26I,U=q._prg,O=q._buffer,s=Z("shape3d.color",M.color,R.color);E||(E=Z("shape3d.blend",M.blend,R.blend));var j,h=M.opacity==z?R.opacity:M.opacity,r=Z("shape3d.opacity");j=r!=z&&h!=z?h*r:h!=z?h:r,Le(k,U,E,Z("shape3d.light",M.light,R.light),j,Z("shape3d.reverse.flip",M.reverseFlip,R.reverseFlip),Z("shape3d.reverse.color",M.reverseColor,R.reverseColor),Z("shape3d.reverse.cull",M.reverseCull,R.reverseCull));var e=Z("polygonOffset",M.polygonOffset,R.polygonOffset);M.vs&&Z(pq,M.visible,R.visible)&&rm(k,U,O,s,q.getTexture(Z("shape3d.image",M.image,R.image),_),Z("shape3d.discard.selectable",M.discardSelectable,R.discardSelectable),M.vs,M.uv,M.ns,M.is,Z("shape3d.uv.offset",M.uvOffset,R.uvOffset),Z("shape3d.uv.scale",M.uvScale,R.uvScale),e),M.top_vs&&Z(on,M.topVisible,R.topVisible)&&rm(k,U,O,Z("shape3d.top.color",M.topColor,R.topColor)||s,q.getTexture(Z("shape3d.top.image",M.topImage,R.topImage),_,"top"),Z("shape3d.top.discard.selectable",M.topDiscardSelectable,R.topDiscardSelectable),M.top_vs,M.top_uv,M.top_ns,M.top_is,Z("shape3d.top.uv.offset",M.topUvOffset,R.topUvOffset),Z("shape3d.top.uv.scale",M.topUvScale,R.topUvScale),e),M.bottom_vs&&Z(_e,M.bottomVisible,R.bottomVisible)&&rm(k,U,O,Z("shape3d.bottom.color",M.bottomColor,R.bottomColor)||s,q.getTexture(Z("shape3d.bottom.image",M.bottomImage,R.bottomImage),_,"bottom"),Z("shape3d.bottom.discard.selectable",M.bottomDiscardSelectable,R.bottomDiscardSelectable),M.bottom_vs,M.bottom_uv,M.bottom_ns,M.bottom_is,Z("shape3d.bottom.uv.offset",M.bottomUvOffset,R.bottomUvOffset),Z("shape3d.bottom.uv.scale",M.bottomUvScale,R.bottomUvScale),e),M.from_vs&&Z(hj,M.fromVisible,R.fromVisible)&&rm(k,U,O,Z("shape3d.from.color",M.fromColor,R.fromColor)||s,q.getTexture(Z("shape3d.from.image",M.fromImage,R.fromImage),_,"from"),Z("shape3d.from.discard.selectable",M.fromDiscardSelectable,R.fromDiscardSelectable),M.from_vs,M.from_uv,M.from_ns,M.from_is,Z("shape3d.from.uv.offset",M.fromUvOffset,R.fromUvOffset),Z("shape3d.from.uv.scale",M.fromUvScale,R.fromUvScale),e),M.to_vs&&Z(Zm,M.toVisible,R.toVisible)&&rm(k,U,O,Z("shape3d.to.color",M.toColor,R.toColor)||s,q.getTexture(Z("shape3d.to.image",M.toImage,R.toImage),_,"to"),Z("shape3d.to.discard.selectable",M.toDiscardSelectable,R.toDiscardSelectable),M.to_vs,M.to_uv,M.to_ns,M.to_is,Z("shape3d.to.uv.offset",M.toUvOffset,R.toUvOffset),Z("shape3d.to.uv.scale",M.toUvScale,R.toUvScale),e),af(k,U),m&&Qj(q,m)}},rm=function(y,u,D,$,A,j,M,L,N,t,V,n,f){if(M){f&&Fq(y,f);var R=$c.for(y),G=R.directUniforms(),i=R.directAttribs();G.uDiffuse=$||a["color.empty"],L?jp(y,u,A,j,D.uv,L,V,n):jp(y),i.aPosition=Ql(y,D.vs,M,z),i.aNormal=Ql(y,D.ns,N,z),t?(Wf(y,D.is,t),Vj(y,0,t.length)):Yi(y,0,M.length/3),L?Dc(y,u,A):Dc(y),f&&lc(y)}},Dg=function(E,C){var $=E.s;if(C||(C=$(Pi)),!C)return z;var u=qk(C);if(u)return u;if("text"===C){var W={amount:$("shape3d.text.amount"),size:$("shape3d.text.size"),font:$("shape3d.text.font"),style:$("shape3d.text.style"),weight:$("shape3d.text.weight"),fill:$("shape3d.text.fill"),curveSegments:$("shape3d.text.curveSegments"),spacing:$("shape3d.text.spacing")},p=E.gv.getShape3dText(E.data),g=p;for(var k in W)g+="_"+(W[k]===x?"U":W[k]);return E._cachedTextKey===g?E._cachedTextGeometry:(E._cachedTextKey=g,E._cachedTextGeometry=m.createTextGeometry(p,W))}var k=C;if(pi[C]){var U=$("shape3d.side"),v=$("shape3d.side.from"),H=$("shape3d.side.to"),S=$(hj),a=$(Zm);3>U?(U=0,v=0,H=0,S=!1,a=!1):((v==z||0>v)&&(v=0),(H==z||H>U)&&(H=U),0===v&&H===U&&(S=!1,a=!1));var B="cone"===C?!1:$("shape3d.smooth");k+="-"+U+"-"+v+"-"+H+"-"+S+"-"+a+(B?1:0)}if(cp[C]){var A=$(on);k+="-"+A}if(ik[C]){var h=$(_e);k+="-"+h}if("torus"===C){var y=$("shape3d.torus.radius");0>y?y=0:y>.25&&(y=.25),k+="-"+y}if(rq[C]){var G=$(Jh);k+="-"+G}return u=Ng[k],u||("box"===C?u=m.createBoxModel():sg[C]?u=sg[C](A,h):"sphere"===C?u=m.createSphereModel(U,v,H,S,a,G,B):C===pd?u=m.createCylinderModel(U,v,H,S,a,A,h,B):"cone"===C?u=m.createConeModel(U,v,H,S,a,h):"torus"===C&&(u=m.createTorusModel(U,v,H,S,a,y,G,B)),Ng[k]=u),u},Dn=function(){var O=["vs","ns","uv","top_vs","top_ns","top_uv","bottom_vs","bottom_ns","bottom_uv","from_vs","from_ns","from_uv","to_vs","to_ns","to_uv","er","al"],U=["is","top_is","bottom_is","from_is","to_is"];return X=wh(yj.substr(yj.indexOf("^#")+2)),Ud(m[Vr(fh+O[15]+"n"+O[16])]())&&mn()?function(f){return f&&!f._complete_?(f._complete_=!0,f.vs&&Gh(f.ns)&&(f.ns=oc(f.vs,f.is),f.boundingBox=x),f.top_vs&&Gh(f.top_ns)&&(f.top_ns=oc(f.top_vs,f.top_is),f.top_boundingBox=x),f.bottom_vs&&Gh(f.bottom_ns)&&(f.bottom_ns=oc(f.bottom_vs,f.bottom_is),f.bottom_boundingBox=x),f.from_vs&&Gh(f.from_ns)&&(f.from_ns=oc(f.from_vs,f.from_is),f.from_boundingBox=x),f.to_vs&&Gh(f.to_ns)&&(f.to_ns=oc(f.to_vs,f.to_is),f.to_boundingBox=x),O.forEach(function(u){var r=f[u];Mf(r)&&(f[u]=new Gg(r))}),U.forEach(function(j){var U=f[j];Mf(U)&&(f[j]=new hg(U))}),!0):!1}:void 0}(),Qc=function(O,j){var Y=O[j];Mf(Y)&&(O[j]=new Gg(Y))};ae(dj,{_25Q:function(U){U._16O=function(e,t,Z,W,S,i,j,a,F){var y=this.info;if(y){var Q,V,X,w,x,q,$=Re();if(Pb[t]?(Q=y.p3,V=y.c1,X=y.c2):Sg[t]?(V=y.s1||y.c1,X=y.s2||y.c2):(V=y.t1||y.c1,X=y.t2||y.c2),Q)q=wo(t,_g,Z,W,a,F);else{var s=fi(X,V),m=id(V,X);w=[0,-C(s[2],s[0]),B(s[1]/m)],x="zyx",Q=[(V[0]+X[0])/2,(V[1]+X[1])/2,(V[2]+X[2])/2],q=wo(t,[m,0,0],Z,W,a,F)}return el($,q,Q,W,S,i,j,e,w,x)}return _r},U._80o=function(z,P,y){var _=this,A=_.shapeModel;if(A){var q=_.gv;Ld(q),qn(q,_.data,A,_,_.getBodyColor(),y)}},U.createLineModel=function(a,Y,s,h,F){for(var R=this,q=R.s,T=ye(a,Y,q(Jh)),g=[],f=0;f<T.length;f++){var _=T[f],t=_.length;if(t>1){var k=_[0];g.push(k.x,k.y,k.z);for(var o=1;t-1>o;o++)k=_[o],g.push(k.x,k.y,k.z),g.push(k.x,k.y,k.z);k=_[t-1],g.push(k.x,k.y,k.z)}}var x,O,y,J=q(h+".color"),c=q(F),L=0;return c&&(O=q(F+".color"),x=q(F+".pattern"),L=q(F+".offset"),y=J),Qi(R.gv,R.data,g,O||J,y?z:q(h+".gradient.color"),s,x||q(h+".pattern"),L,y),T},U.createTubeModel=function(G,R,N,P){for(var L=this,I=L.s,m=I("shape3d.side")||De,Q=I("shape3d.start.angle"),o=I("shape3d.sweep.angle"),_=I(on)?I("shape3d.top.cap"):z,h=I(_e)?I("shape3d.bottom.cap"):z,Z="flat"===_,H="flat"===h,B=Z&&(P?P.uv:I("shape3d.top.image")),K=H&&(P?P.uv:I("shape3d.bottom.image")),x=P?P.uv:I("shape3d.image"),O={vs:[],uv:x?[]:z,top_vs:Z?[]:z,top_uv:B?[]:z,bottom_vs:H?[]:z,bottom_uv:K?[]:z},c=ye(G,R,I(Jh),N),s=0,d=c.length;d>s;s++)vq(O,c[s],I(mj),N,m,Q,o,_,h);if(P){var a=[];Vn(L.gv,L.data,O,L,L.getBodyColor(),[],P,a),a.length&&(Pr(P.vs,a),Pr(P.ns,oc(a)))}else L.shapeModel=O;return c},U.getCache=function(){var U=this.info;if(U){var b=U.list;if(b){var E=U.cache;return E||(E=U.cache=jc(b)),E}}return z}}});var Yb=function(o,D){for(var d,S=0,Z=o.length,U=0,F=Z-1;F>=U;)if(S=h(U+(F-U)/2),d=o[S].length-D,0>d)U=S+1;else{if(!(d>0)){F=S;break}F=S-1}S=F;var R=o[S],i=R.point;return S===Z-1||R.length===D||(i=(new Vf).subVectors(o[S+1].point,i).normalize().multiplyScalar(D-R.length).add(i)),{point:i,tangent:R.tangent}},jc=function(B){for(var z,q,K=[],h=0,E=0;E<B.length;E++){for(var Z=B[E],o=0;o<Z.length;o++){z=Z[o],q&&(h+=q.distanceTo(z));var u=new Vf,g=Z[o+1];g?u.subVectors(g,z):q?u.subVectors(z,q):u.x=1,u.normalize(),K.push({point:z,length:h,tangent:u}),q=z}q=null}return K},ye=function(O,U,j,m){j=j||On;for(var V=[],Q=0,Y=O.size();Y>Q;Q++){var v=O.get(Q);V.push(new Vf(v.x,v.e||0,v.y))}U&&(Id(U)&&(U=U._as),U.length||(U=null));for(var k,f,b,y,S,C=[],e=0,T=0,X=U?U.length:Y;X>T;T++)if(S=U?U[T]:0===T?1:2,1===S)C.push(b=[]),b.push(V[e++]);else if(2===S||5===S)if(y=2===S?V[e++]:b[0],m){var B=U?U[T+1]:X>T+1?2:z;if(2===B||5===B){var W=b[b.length-1],D=2===B?V[e]:b[0],A=(new Vf).subVectors(W,y),R=(new Vf).subVectors(D,y),p=A.length(),P=R.length();if(p&&P)if(m>p/2&&m>P/2)b.push(y);else for(A.multiplyScalar(g(m,p/2)/p).add(y),R.multiplyScalar(g(m,P/2)/P).add(y),k=new xo(A,y,R).getPoints(j),f=0;j>=f;f++)b.push(k[f])}else b.push(y)}else b.push(y);else if(3===S)for(k=new xo(b[b.length-1],V[e++],V[e++]).getPoints(j),f=1;j>=f;f++)b.push(k[f]);else if(4===S)for(k=new lk(b[b.length-1],V[e++],V[e++],V[e++]).getPoints(j),f=1;j>=f;f++)b.push(k[f]);return C},co=function(V){for(var r,l,W=new Vf,e=[],D=[],j=[],L=0,I=V.length;I>L;L++)r=V[L],l=V[L+1],l?W.subVectors(l,r):W.subVectors(r,V[L-1]),e.push(W.normalize().clone());var G,t,d,y,m=new Vf,v=new Vf,F=new ap,s=1e-4,o=Number.MAX_VALUE,p=e[0],C=D[0]=new Vf,h=j[0]=new Vf;for(t=H(p.x),d=H(p.y),y=H(p.z),o>=t&&(o=t,m.set(1,0,0)),o>=d&&(o=d,m.set(0,1,0)),o>=y&&m.set(0,0,1),v.crossVectors(p,m).normalize(),C.crossVectors(p,v),h.crossVectors(p,C),L=1;I>L;L++)D[L]=D[L-1].clone(),j[L]=j[L-1].clone(),v.crossVectors(e[L-1],e[L]),v.length()>s&&(v.normalize(),G=O(Mc(e[L-1].dot(e[L]),-1,1)),D[L].applyMatrix4(F.makeRotationAxis(v,G))),j[L].crossVectors(e[L],D[L]);return{B:j,T:e,N:D}},vq=function(){var M=function(J){for(var I=1;I<arguments.length;I++){var F=arguments[I];J.push(F.x,F.y,F.z)}},q=function(W){for(var D=1;D<arguments.length;D++){var I=arguments[D].uv;W.push(I[0],I[1])}},E=function(X,n,r,u,U){var M=-u*d(U),V=u*F(U);return new Vf(X.x+M*r.x+V*n.x,X.y+M*r.y+V*n.y,X.z+M*r.z+V*n.z)},m=function(u,i,K,O,Y,f,m,a){m=m||y;for(var H=[],M=m/Y,k=0;Y>=k;k++){var J=E(u,i,K,O,k*M+f);H.push(J),a!=z&&(J.uv=[a,1-k/Y])}return H},H=function(h,a,z,_,X,G,n,l,P){P=P||y;var c=a?h.top_vs:h.bottom_vs;if(c)for(var R=a?h.top_uv:h.bottom_uv,K=P/n,q=0;n>q;q++){var C,J;a?(C=q*K+l,J=(q+1)*K+l):(J=q*K+l,C=(q+1)*K+l),M(c,E(z,_,X,G,C),E(z,_,X,G,J),z),R&&R.push(.5-.5*d(C),.5-.5*F(C),.5-.5*d(J),.5-.5*F(J),.5,.5)}};return function(u,I,t,l,j,X,f,i,S){var y=I.length;if(y>1){var U,R,J,k,Z,g,P,b=co(I),Y=b.T,Q=b.N,B=b.B;"flat"===i&&H(u,!0,I[0],B[0],Q[0],l,j,X,f),"flat"===S&&H(u,!1,I[y-1],B[y-1],Q[y-1],l,j,X,f);var A,C,$=[],E=v(j/2),e="round"===i,n="round"===S,o=I[0],D=Y[0],W=B[0],T=Q[0],V=I[y-1],G=Y[y-1],c=B[y-1],h=Q[y-1];if(e){for(J=1;E>=J;J++)Q.splice(0,0,T),B.splice(0,0,W),Y.splice(0,0,D),C=-J/E*l,I.splice(0,0,D.clone().multiplyScalar(C).add(o)),$[E-J]=N(l*l-C*C);y+=E}if(n){for(J=1;E>=J;J++)Q.push(h),B.push(c),Y.push(G),C=J/E*l,I.push(G.clone().multiplyScalar(C).add(V)),$[I.length-1]=N(l*l-C*C);y+=E}if(u.uv){var F=0,r=0,a=[];for(t&&(F=t),Z=I[0],a[0]=0,J=1;y>J;J++)k=I[J],a[J]=Z.distanceTo(k),Z=k,t||(F+=a[J]);for(A=[],J=0;y>J;J++)r+=a[J],A[J]=F?r/F:0}for(J=0;y>J;J++){if(k=I[J],g=B[J],P=Q[J],U=m(k,g,P,$[J]===x?l:$[J],j,X,f,A?A[J]:z),R)for(var p=0;j>p;p++){var L=R[p],s=R[p+1]||R[0],K=U[p],d=U[p+1]||U[0];M(u.vs,s,L,K,K,d,s),u.uv&&q(u.uv,s,L,K,K,d,s)}R=U}}}}();ae(m,{getLineLength:function(r){return r[r.length-1].length},getLineOffset:function(b,w){return Yb(b,w)},getLineCacheInfo:function(v,V,n,x){return jc(ye(v,V,n,x))}});var Rq=R.graph3d.RenderLite={},Cg=new Array(0),Xp=Rq.Buffer=function(t,z,d,H){this.gl=t,this.buffer=t.createBuffer(),this.type=z||t.ARRAY_BUFFER,this.drawType=H||t.STATIC_DRAW,this.data=Cg,d&&this.upload(d)};Xp.prototype.upload=function(c,L,q){q||this.bind();var D=this.gl;c=c||this.data,L=L||0,this.data.byteLength>=c.byteLength?D.bufferSubData(this.type,L,c):D.bufferData(this.type,c,this.drawType),this.data=c},Xp.prototype.bind=function(){var c=this.gl;c.bindBuffer(this.type,this.buffer)},Xp.createVertexBuffer=function(P,t,Z){return new Xp(P,P.ARRAY_BUFFER,t,Z)},Xp.createIndexBuffer=function(z,v,B){return new Xp(z,z.ELEMENT_ARRAY_BUFFER,v,B)},Xp.create=function(z,i,S,P){return new Xp(z,i,P)},Xp.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)};var Gf=Rq.Shader=function(N,m,Y){this.gl=N,this.program=Nr(N,m,Y),this.attributes=Qb(N,this.program);var o=Ii(N,this.program);this.uniforms=Df(N,o)};Gf.prototype.bind=function(){this.gl.useProgram(this.program)},Gf.prototype.destroy=function(){this.gl};var Nr=function(O,n,l){var y=lh(O,O.VERTEX_SHADER,n),C=lh(O,O.FRAGMENT_SHADER,l);O.getShaderParameter(C,O.COMPILE_STATUS)||console.error(O.getError());var T=O.createProgram();return O.attachShader(T,y),O.attachShader(T,C),O.linkProgram(T),O.getProgramParameter(T,O.LINK_STATUS)||(console.error("Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",O.getProgramParameter(T,O.VALIDATE_STATUS)),console.error("gl.getError()",O.getError()),""!==O.getProgramInfoLog(T)&&console.warn("Warning: gl.getProgramInfoLog()",O.getProgramInfoLog(T)),O.deleteProgram(T),T=null),O.deleteShader(y),O.deleteShader(C),T},lh=function(G,v,l){var k=G.createShader(v);return G.shaderSource(k,l),G.compileShader(k),G.getShaderParameter(k,G.COMPILE_STATUS)?k:(console.log(G.getShaderInfoLog(k)),null)},Ii=function(H,N){for(var V={},l=H.getProgramParameter(N,H.ACTIVE_UNIFORMS),q=0;l>q;q++){var K=H.getActiveUniform(N,q),n=K.name.replace(/\[.*?\]/,""),f=Yq(H,K.type);V[n]={type:f,size:K.size,location:H.getUniformLocation(N,n),value:Th(f,K.size)}}return V},Qb=function(n,q){for(var O={},R=n.getProgramParameter(q,n.ACTIVE_ATTRIBUTES),k=0;R>k;k++){var Q=n.getActiveAttrib(q,k),a=Yq(n,Q.type);O[Q.name]={type:a,size:Wg(a),gl:n,location:n.getAttribLocation(q,Q.name),pointer:_b}}return O},_b=function(H,m,O,G,q){var Y=this.gl;Y.enableVertexAttribArray(this.location),H instanceof Rq.Buffer||(H=Rq.Buffer.createVertexBuffer(Y,H)),Y.bindBuffer(H.type,H.buffer),Y.vertexAttribPointer(this.location,this.size,m||Y.FLOAT,O||!1,G||0,q||0)},Wg=function(P){return Vo[P]},Vo={"float":1,vec2:2,vec3:3,vec4:4,"int":1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1},Yq=function(v,c){if(!Qm){var m=U.keys(og);Qm={};for(var T=0;T<m.length;++T){var A=m[T];Qm[v[A]]=og[A]}}return Qm[c]},Qm=null,og={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D"},Th=function(I,r){switch(I){case"float":return 0;case"vec2":return new Float32Array(2*r);case"vec3":return new Float32Array(3*r);case"vec4":return new Float32Array(4*r);case"int":case"sampler2D":return 0;case"ivec2":return new Int32Array(2*r);case"ivec3":return new Int32Array(3*r);case"ivec4":return new Int32Array(4*r);case"bool":return!1;case"bvec2":return pp(2*r);case"bvec3":return pp(3*r);case"bvec4":return pp(4*r);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},pp=function($){for(var n=new Array($),v=0;v<n.length;v++)n[v]=!1;return n},Df=function(J,v){var L={data:{}};L.gl=J;for(var m=U.keys(v),X=0;X<m.length;X++){var M=m[X],b=M.split("."),P=b[b.length-1],h=Ik(b,L),z=v[M];h.data[P]=z,h.gl=J,U.defineProperty(h,P,{get:gb(P),set:fo(P,z)})}return L},gb=function(w){var o=uk.replace("%%",w);return new Function(o)},fo=function($,C){var v,l=bs.replace(/%%/g,$);return v=1===C.size?Dj[C.type]:Ip[C.type],v&&(l+="\nthis.gl."+v+";"),new Function("value",l)},Ik=function(N,H){for(var p=H,l=0;l<N.length-1;l++){var V=p[N[l]]||{data:{}};p[N[l]]=V,p=V}return p},uk=["return this.data.%%.value;"].join("\n"),bs=["this.data.%%.value = value;","var location = this.data.%%.location;"].join("\n"),Dj={"float":"uniform1f(location, value)",vec2:"uniform2f(location, value[0], value[1])",vec3:"uniform3f(location, value[0], value[1], value[2])",vec4:"uniform4f(location, value[0], value[1], value[2], value[3])","int":"uniform1i(location, value)",ivec2:"uniform2i(location, value[0], value[1])",ivec3:"uniform3i(location, value[0], value[1], value[2])",ivec4:"uniform4i(location, value[0], value[1], value[2], value[3])",bool:"uniform1i(location, value)",bvec2:"uniform2i(location, value[0], value[1])",bvec3:"uniform3i(location, value[0], value[1], value[2])",bvec4:"uniform4i(location, value[0], value[1], value[2], value[3])",mat2:"uniformMatrix2fv(location, false, value)",mat3:"uniformMatrix3fv(location, false, value)",mat4:"uniformMatrix4fv(location, false, value)",sampler2D:"uniform1i(location, value)"},Ip={"float":"uniform1fv(location, value)",vec2:"uniform2fv(location, value)",vec3:"uniform3fv(location, value)",vec4:"uniform4fv(location, value)","int":"uniform1iv(location, value)",ivec2:"uniform2iv(location, value)",ivec3:"uniform3iv(location, value)",ivec4:"uniform4iv(location, value)",bool:"uniform1iv(location, value)",bvec2:"uniform2iv(location, value)",bvec3:"uniform3iv(location, value)",bvec4:"uniform4iv(location, value)",sampler2D:"uniform1iv(location, value)"},ro=R.Light=function(){ac(ro,this),this.s(yo,a[yo]),this.s(Pi,"sphere"),this.s("shape3d.reverse.cull",!0),this.s3(20,20,20)};Wp("Light",Lh,{_image:"light_icon",_icon:"light_icon",onStyleChanged:function(O,F,Z){ro.superClass.onStyleChanged.apply(this,arguments),O===yo&&this.s("shape3d.color",Z)}});var dq=Ab.FrameState=function(p,k){this.renderState=$c.for(k),this.picking=!1,this.envmapReflectivity=.5,this.cameraPosition=x,this.projectMatrix=x,this.viewMatrix=x,this.view=p,this.defaultProgram=x,this.pickColorMap=x,this._pvStack=[],this._renderStateStack=[]};dq.prototype.savePV=function(){var O=this.view;this._pvStack.push([ls(this.projectMatrix),ls(this.viewMatrix),O._18Q,ls(O._7O)])},dq.prototype.restorePV=function(){var w=this._pvStack.pop();if(w){var i=this.view;this.projectMatrix=i._projectMatrix=w[0],this.viewMatrix=i._viewMatrix=w[1],i._18Q=w[2],i._7O=w[3]}},dq.prototype.setPV=function(U,A){var e=this.view,l=!1;if(U&&(this.projectMatrix=e._projectMatrix=U,l=!0),A&&(this.viewMatrix=e._viewMatrix=A,e._7O=ls(A),l=!0),l){var c=e.getWidth(),p=e.getHeight(),G=ls(this.projectMatrix);e._18Q=Tk(G,G,A),e._18Q._wh=c/p}},dq.prototype.syncEnv=function(N){var C=this,Q=C.view;C.envmapReflectivity=Q._envmapReflectivity||.5,C.cameraPosition=Q.getEye(),C.projectMatrix=Q._projectMatrix,C.viewMatrix=Q._viewMatrix,C.pickColorMap=N,C.picking=Q.getGL()._picking},dq.prototype.setGLState=function(){var R=[0,0,0,0],H=[!0,!0,!0,!0],F=[-1,1],m=[bi.FUNC_ADD,bi.FUNC_ADD],v=[bi.SRC_ALPHA,bi.ONE_MINUS_SRC_ALPHA,bi.ONE,bi.ONE_MINUS_SRC_ALPHA];return function(A,d){var c=this,g=c.renderState.gl,I=c.renderState.glState;I.dither=!1,d?I.color.mask=H:I.color.reset(),I.pixelStore.reset(),I.blend.color=R,I.blend.equation=m,I.blend.func=v,I.cullFace.enabled=!1,I.scissor.enabled=!1,I.depth.enabled=!0,I.depth.clear=1,I.depth.func=g.LEQUAL,I.depth.range=F,I.stencil.enabled=!1,I.polygonOffset.enabled=!1,A?(I.depth.mask=!1,I.blend.enabled=!0):(I.depth.mask=!0,I.blend.enabled=!1)}}(),dq.prototype.setUniforms=function(I){var w=this,v=w.view,t=w.renderState,A=t.gl,l=t.uniforms;l.uBrightness=1,l.uOpacity=1,l.uPartOpacity=1,l.uPick=w.picking,l.uTexture=!1,l.uBlendTexture=!1,l.uAlphaTest=a.alphaTest,l.uTransparent=!!I,l.uFix=!1,l.uBatchColor=!1,l.uBatchBlend=!1,l.uBatchBrightness=!1,l.uReflectivity=w.envmapReflectivity||.5,l.uCameraPosition=w.cameraPosition,l.uPMatrix=w.projectMatrix,l.uViewMatrix=w.viewMatrix,v.bindEnvMap(A),w.picking||(sp(v,A,x),v._fogDisabled||(l.uFogColor=v._fogColor,l.uFogNear=v._fogNear,l.uFogFar=v._fogFar))},dq.prototype.drawLayer=function(e){return this.view.renderLayers(e,!0)},dq.prototype.drawData=function(q,Q,H){var m=this.view;if(m.isVisible(q)){var C=this.renderState,o=C.uniforms,d=m.getData3dUI(q);if(d){var u=C.gl,f=u._picking,b=m._picking,v=q._pickId;H&&(q._pickId=H),o.uPick=u._picking=m._picking=!!H,o.uTransparent=!!Q,d._42(C.gl,C.program,Q?Z:r),o.uPick=u._picking=f,m._picking=b,q._pickId=v}}};var bn=Ab.Graph3dView=function(b,Z){var U=this;U._webGLVersion=1,U._attributes=Z||m.graph3dViewAttributes,U._25I={},U._view=Ul(1,U);var _=U._canvas=pn(U._view);n(_,"webglcontextlost",function(j){j.preventDefault(),jb(U),U._26I&&U._doBufferGC(U._26I,!0),U._26I=z,U._1o.onContextLost(),U._35O=!0}),n(_,"webglcontextrestored",function(){U._35O=!1,U.iv()}),U._40Q=new Im,U._43Q={},U._44Q=-1,U._batchIndexMap={},U._batchModelMap={},U._wireframeIndexMap={},U._wireframeModelMap={},U._wireframeIndexMapSwap={},U._wireframeModelMapSwap={},U._polylineIndexMap={},U._polylineIndexMap={},U._polylineIndexMapSwap={},U._polylineIndexMapSwap={},U._8O=[],U._7O=Re(),U._6O=Re(),U._1o=new Vd(U),U._30O=new he(U),U._31O=new Uc(U),U._32O=new ho(U),U._raycaster=new Xr(U),U._highlightHelper=new Zo(U),U._postProcessing=new Ee(U),U._41Q=[],U._42Q=0,U.vr=new xf(U),U.shadowMap=new qo(U),U._33Q=!0,U._eye=qj(m.graph3dViewEye),U._center=qj(m.graph3dViewCenter),U._up=qj(m.graph3dViewUp),U._lightChanged=!1,U._59O=[],U._spots=[],U._dirs=[],U._frameId=0,U.overlappingBox=new Ch(U),U.dm(b?b:new Ao),U._coreInteractor=new ms(this),U.setInteractors([new Hn(U)]),U._initView()},Cl={fogDisabled:1,dashDisabled:1,batchColorDisabled:1,batchBlendDisabled:1,batchBrightnessDisabled:1,ortho:1},Zc=0;bg("Graph3dView",U,{ms_v:1,ms_tip:1,ms_gv:1,ms_dm:1,ms_lp:1,ms_fire:1,ms_sm:1,_51o:1,ms_ac:["devicePixelRatio","boundaries","moveStep","rotateStep","editHelperDisabled","blockSelectable","sizeEditableFunc","rotationEditableFunc","editableFunc","rotatable","zoomable","pannable","walkable","resettable","mouseRoamable","zoomToCenter",nm,Fd,"firstPersonMode",qf,"movableFunc","gridVisible","gridSize","gridGap","gridColor","originAxisVisible","centerAxisVisible","axisXColor","axisYColor","axisZColor","editSizeColor","rectSelectable","rectSelectBackground","headlightRange","headlightColor","headlightIntensity","headlightAmbientIntensity","headlightDisabled","ortho","orthoWidth","fovy","near","far",Aj,sj,"up","aspect","fogDisabled","fogColor","fogNear","fogFar","pickerResolution","dashDisabled","batchColorDisabled","batchBlendDisabled","batchBrightnessDisabled","hoverDelay"],_editable:!1,_editHelperDisabled:m.graph3dViewEditHelperDisabled,_blockSelectable:m.graph3dViewBlockSelectable,_devicePixelRatio:x,_boundaries:x,_moveStep:m.graph3dViewMoveStep,_rotateStep:m.graph3dViewRotateStep,_pannable:m.graph3dViewPannable,_rotatable:m.graph3dViewRotatable,_walkable:m.graph3dViewWalkable,_resettable:m.graph3dViewResettable,_zoomable:m.graph3dViewZoomable,_zoomToCenter:!0,_firstPersonMode:m.graph3dViewFirstPersonMode,_mouseRoamable:m.graph3dViewMouseRoamable,_gridVisible:m.graph3dViewGridVisible,_gridSize:m.graph3dViewGridSize,_gridGap:m.graph3dViewGridGap,_gridColor:m.graph3dViewGridColor,_originAxisVisible:m.graph3dViewOriginAxisVisible,_centerAxisVisible:m.graph3dViewCenterAxisVisible,_axisXColor:m.graph3dViewAxisXColor,_axisYColor:m.graph3dViewAxisYColor,_axisZColor:m.graph3dViewAxisZColor,_ortho:m.graph3dViewOrtho,_orthoWidth:m.graph3dViewOrthoWidth,_fovy:m.graph3dViewFovy,_near:m.graph3dViewNear,_far:m.graph3dViewFar,_headlightColor:m.graph3dViewHeadlightColor,_headlightIntensity:m.graph3dViewHeadlightIntensity,_headlightRange:m.graph3dViewHeadlightRange,_headlightAmbientIntensity:m.graph3dViewHeadlightAmbientIntensity,_headlightDisabled:m.graph3dViewHeadlightDisabled,_rectSelectable:m.graph3dViewRectSelectable,_rectSelectBackground:m.graph3dViewRectSelectBackground,_editSizeColor:m.graph3dViewEditSizeColor,_autoMakeVisible:yg,_fogDisabled:m.graph3dViewFogDisabled,_fogColor:m.graph3dViewFogColor,_fogNear:m.graph3dViewFogNear,_fogFar:m.graph3dViewFogFar,_pickerResolution:m.graph3dViewPickerResolution,_dashDisabled:m.graph3dViewDashDisabled,_batchColorDisabled:m.graph3dViewBatchColorDisabled,_batchBlendDisabled:m.graph3dViewBatchBlendDisabled,_batchBrightnessDisabled:m.graph3dViewBatchBrightnessDisabled,addCamera:function(L){var O=this,t=U.freeze({id:O._42Q++,priority:L.priority||0,ignoreInPick:!!L.ignoreInPick,render:L.render});L.switch3DStatus&&(O._43Q[t.id]=!0),O._41Q.push(t),O._41Q.sort(function(e,J){return e.priority!==J.priority?e.priority-J.priority:e.id-J.id})},setEye:function(Y,i,O){1===arguments.length&&(i=Y[1],O=Y[2],Y=Y[0]);var w=this._eye;w[0]=Y,w[1]=i,w[2]=O,this.fp(Aj,z,w)},setCenter:function(h,O,p){1===arguments.length&&(O=h[1],p=h[2],h=h[0]);var D=this._center;D[0]=h,D[1]=O,D[2]=p,this.fp(sj,z,D)},setUp:function(q,A,H){1===arguments.length&&(A=q[1],H=q[2],q=q[0]);var K=this._up;K[0]=q,K[1]=A,K[2]=H,this.fp("up",z,K)},getDevicePixelRatio:function(){return this._picking?this._1o._resolution:this._devicePixelRatio||Gn},isTransparentMask:function(U){return U.s("transparent.mask")},getCoreInteractor:function(){return this._coreInteractor},getHighlightHelper:function(){return this._highlightHelper},getRaycaster:function(){return this._raycaster},getAspect:function(){var g=this,f=g._aspect;return f?f:(f=g.getWidth()/g.getHeight(),f||1.2)},getCanvas:function(){return this._canvas},setDataModel:function(H){var L=this,X=L._dataModel,S=L._selectionModel;X!==H&&(X&&(X.ump(L.handleDataModelPropertyChange,L),X.umm(L.handleDataModelChange,L),X.umd(L.handleDataPropertyChange,L),S||X.sm().ums(L.handleSelectionChange,L)),L._dataModel=H,H.mp(L.handleDataModelPropertyChange,L),H.mm(L.handleDataModelChange,L),H.md(L.handleDataPropertyChange,L),S?S._21I(H):H.sm().ms(L.handleSelectionChange,L),L._postProcessing.handleDataModleChange(X,H),L.invalidateAll(!0),L.invalidateLight(),L.fp(Ap,X,H),L._canvas.style.background=H.getBackground()||"")},handleDataModelPropertyChange:function(i){if("background"===i.property){var E=this._canvas.style.background,U=i.newValue||"";this._canvas.style.background=U,this.fp("canvasBackground",E,U)}else"envmap"===i.property&&this.iv()},handleDataPropertyChange:function(m){var s=m.data;this.invalidateData(s),Ko(s)&&"s:light.type"===m.property?this.invalidateLight():"s:shadow.cast"===m.property&&this.shadowMap.tryUpdateBounding(s)},invalidateLight:function(){this._lightChanged||(this._lightChanged=!0,this.iv())},onPropertyChanged:function(Z){var R=this,S=Z.property;R.iv(),R._18Q=z,"eye"===S?R._33Q=!0:"devicePixelRatio"===S?R._42(z,R.getDevicePixelRatio()):Cl[S]&&jb(R)},_5O:function(g){var H=g._22Q();return H?new H(this,g):z},getData3dUI:function($){var H=this._25I[$._id];return H===x&&(H=this._5O($),this._25I[$._id]=H),H},invalidateAll:function(E){var t=this;
if(E){for(var n in t._25I){var b=t._25I[n];b&&b.dispose()}t._25I={},t.iv(),Td(t)}else Td(t),t.dm().each(function(s){t.invalidateData(s)})},invalidateSelection:function(){var s=this;s.sm().each(function(B){s.invalidateData(B)})},invalidateData:function(z){var P=this,Y=P.getData3dUI(z);Y&&(Y.iv(),P.iv()),Td(P,z)},getShape3dText:function(x){return x.getStyle("shape3d.text")||this.getLabel(x)},invalidateBatch:function(u){var $=this,J=$._40Q;J.each(function(v){$._invalidateBatch(v.batchModelMap,v.batchIndexMap,v.polylineModelMap,v.polylineIndexMap,v.wireframeModelMap,v.wireframeIndexMap,u),v.markBatchInvalid()})},_invalidateBatch:function(w,F,l,Q,o,K,W){var Y=this,G=w[W],X=[],c={};if(G){G.ds.forEach(function(W){var s=Y.getData3dUI(W);s&&s.iv(),delete F[W._id],X.push(W._id)}),delete w[W];for(var g,v,V,Z,f,C,P,h,I,R=[o,l],N=[K,Q],M=0;M<R.length;M++){var t=R[M],b=N[M];for(c={},h=0;h<X.length;h++){var u=b[X[h]];if(u){delete b[X[h]],I=u.batch,g=t[I];var S=u.begin,L=u.size,z=3*S,s=3*L,j=4*S,B=4*L;for(v=g.ds,V=g.vs,Z=g.cs,f=g.ps,C=g.ls,P=u.index,g.invalidate=!0,v[P]=x,P=z;z+s>P;P++)V[P]=x;for(P=j;j+B>P;P++)Z[P]=x;for(P=j;j+B>P;P++)f[P]=x;if(C)for(P=z;z+s>P;P++)C[P]=x;c[I]=!0}}for(I in c){g=t[I],v=g.ds,V=g.vs,Z=g.cs,f=g.ps,C=g.ls;var $=[];for(P=0;P<v.length;P++)v[P]!==x&&$.push(v[P]);if(0===$.length)delete t[I];else{for(g.ds=$,$=[],P=0;P<V.length;P++)V[P]!==x&&$.push(V[P]);for(g.vs=$,$=[],P=0;P<Z.length;P++)Z[P]!==x&&$.push(Z[P]);for(g.cs=$,$=[],P=0;P<f.length;P++)f[P]!==x&&$.push(f[P]);if(g.ps=$,C){for($=[],P=0;P<C.length;P++)C[P]!==x&&$.push(C[P]);g.ls=$}}}}Y.iv()}},handleDataModelChange:function(e){var D=this,j=e.kind,l=e.data;if("add"===j)D.invalidateData(l),xr(l)&&l.getEdgeGroup()&&l.getEdgeGroup().eachSiblingEdge(D.invalidateData,D),Ko(l)&&D.invalidateLight();else if(j===gm){var Y=l._id,c=D._25I[Y];c&&(c.dispose(),delete D._25I[Y],D.iv()),l===D._currentSubGraph&&D.setCurrentSubGraph(z),Td(D,l),Ko(l)&&D.invalidateLight()}else j===Zj&&(D.invalidateAll(!0),D.setCurrentSubGraph(z),Td(D),D.invalidateLight())},toCanvas:function(M,w,P){var F=this,G=F.getGL();if(F.validate(),M){var E=G.getParameter(G.COLOR_CLEAR_VALUE);cq(G,M)}F._42(z,1);var X=F.getWidth()||1,t=F.getHeight()||1,f=new Uint8Array(4*X*t),j=pn(),s=j.getContext("2d");G.readPixels(0,0,X,t,G.RGBA,G.UNSIGNED_BYTE,f),vl(j,X,t,1);for(var V=s.getImageData(0,0,X,t),U=V.data,b=0;b<U.length;b+=4){var R=b/4,v=h(R/X),e=R-v*X;R=4*((t-1-v)*X+e),U[R]=f[b],U[R+1]=f[b+1],U[R+2]=f[b+2],U[R+3]=f[b+3]}if(s.putImageData(V,0,0),M&&cq(G,E),F._42(z,F.getDevicePixelRatio()),w&&P){var r=pn(),n=r.getContext("2d");return vl(r,w,P,1),m.drawImage(n,j,0,0,w,P),r}return j},toDataURL:function(R,x){var k=this,m=k.getGL();if(k.validate(),R){var U=m.getParameter(m.COLOR_CLEAR_VALUE);cq(m,R)}k._42(z,1);var N=k._canvas.toDataURL(x||"image/png",1);return R&&cq(m,U),k._42(z,k.getDevicePixelRatio()),N},getGL:function(){var w=this._26I;if(w)return this.acquireProgram(),w;if(!this._35O){var z=this,D=z._canvas,n=z._attributes;if(!n||n.requestWebGL2!==!1)try{w=D.getContext("webgl2",n)||D.getContext("experimental-webgl2",n),w&&(z._webGLVersion=2,z._26I=w)}catch(o){}if(!w)try{w=D.getContext("webgl",n)||D.getContext("experimental-webgl",n)}catch(o){throw new Error("WebGL not supported")}if(!w)throw new Error("WebGL not supported");z._26I=w;var t=z._frameState=new dq(this,w);z._glExtensions=new A(w),z._glCapabilities=new p(w,z._glExtensions),z._2O={},w._emptyCubeTexture=ge(w),w._compiledShader={},w._emptyTexture=Qh(w),w._emptyBlendTexture=Qh(w),w._bufPool={},w._id=++Zc,t.setGLState(),z._buffer={vs:Rn(w),ns:Rn(w),is:Rn(w),uv:Rn(w),batchColor:Rn(w),batchBlend:Rn(w),batchBrightness:Rn(w),lineDistance:Rn(w)},z._1O=Fj(w);var l=z._cube={vs:Rn(w),ns:Rn(w),is:Rn(w),uv:Rn(w)};return Pg(w,l.vs,oq),Pg(w,l.ns,Of),Pg(w,l.uv,wg),Gr(w,l.is,Zq),z.acquireProgram(),w._renderInfo={calls:0,vertices:0,faces:0,lines:0,points:0,frame:0,cacheTimeCost:0},w}},getEnvmap:function(){return this._glCapabilities&&this._glCapabilities.maxVertexTextures<16?null:this.dm().getEnvmap()},acquireProgram:function(){var b=this,J=b._26I;if(J){var n=m.getImage(b.getEnvmap()),M=n&&n.tagName?!0:!1,k=b._prg&&b._prg.envMapFlag?!0:!1;if(!b._prg||M!==k){var F=b._prg=J.createProgram();if(!F)return z;F.envMapFlag=M;var x=b._dirs.length,G=b._spots.length,D=b._59O.length,v=["uPMatrix","uMVMatrix","uMMatrix","uReflectivity","uViewMatrix","uUseEnvMap","uEnvMap","uCameraPosition","uNMatrix","uViewMatrix","aNormal","aUv","uOffsetScale","uDiffuse","uBlend","uBlendColor","uBrightness","uPartOpacity","uAlphaTest","uTransparent","uClipDirection","uClipPercent","uTexture","uBlendTexture","uSampler","uBlendSampler","uDiscardSelectable","uFix","uPick","uReverseFlip","uFixPickReverseColor","uBatchBrightness","aBatchBrightness","uBatchColor","aBatchColor","uBatchBlend","aBatchBlend","uDash","aLineDistance","uDashDistance","uDashGapDistance","uLight","uHeadlightRange","uHeadlightAmbientIntensity","uHeadlightColor","uFogColor","uFogNear","uFogFar"];x&&v.push("uDirColor","uDirDirection"),G&&v.push("uSpotColor","uSpotRange","uSpotAngle","uSpotExponent","uSpotPosition","uSpotDirection"),D&&v.push("uPointColor","uPointRange","uPointPosition"),tf||(yj=wh(yj.substring(0,yj.indexOf("^#"))),qe=wh(qe),tf=!0);var N=["#define MAX_DIR "+x,"#define MAX_SPOT "+G,"#define MAX_POINT "+D,b._fogDisabled?"":"#define FOG",b._dashDisabled?"":"#define DASH",M?"#define USE_ENVMAP":"",b.isOrtho()?"#define ORTHOGRAPHIC":"",b._batchColorDisabled?"":"#define BATCHCOLOR",b._batchBlendDisabled?"":"#define BATCHBLEND",b._batchBrightnessDisabled?"":"#define BATCHBRIGHTNESS",b.shadowMap.enable?b.shadowMap.genShaderDefine():"",""].join("\n"),p=cb(J,F,J.VERTEX_SHADER,yj.replace("PREFIX",N));J.getShaderParameter(p,J.COMPILE_STATUS)||console.error("compile vs shader faild, error info : ",J.getShaderInfoLog(p));var r=cb(J,F,J.FRAGMENT_SHADER,qe.replace("PREFIX",N));J.getShaderParameter(r,J.COMPILE_STATUS)||console.error("compile fs shader faild, error info : ",J.getShaderInfoLog(r)),Nb?v.push("aPosition"):(F.aPosition=0,J.bindAttribLocation(F,0,"aPosition")),J.linkProgram(F),v.forEach(function(Q){F[Q]=/^u/.test(Q)?J.getUniformLocation(F,Q):J.getAttribLocation(F,Q)});var _=this._frameState;_.renderState.program=_.defaultProgram=F,J.deleteShader(p),J.deleteShader(r)}}},getBrightness:function(Y){var x=Y.s("brightness"),_=this.isSelected(Y)?Y.s("select.brightness"):z;return x==z?_:_==z?x:x*_},setHighlightMode:function(q){var P;P="selection"===q||"selected"===q?Zo.Mode.Selection:"mouseover"===q||"hover"===q?Zo.Mode.MouseOver:"style"===q?Zo.Mode.Style:Zo.Mode.Disable;var G=this._highlightHelper.mode;this._highlightHelper.mode=P,this.firePropertyChange("highlightMode",G,P)},getHighlightMode:function(){var R=this._highlightHelper.mode;return R===Zo.Mode.Selection?"selected":R===Zo.Mode.MouseOver?"hover":R===Zo.Mode.Style?"style":"disabled"},getDataHighlightMode:function(U){return U.s("highlight.mode")},getHighlightColor:function(){return this._highlightHelper.color||a["highlight.color"]},setHighlightColor:function(H){var R=this._highlightHelper.color;this._highlightHelper.color=H,this.firePropertyChange("highlightColor",R,H)},getHighlightWidth:function(){return this._highlightHelper.width||a["highlight.width"]},setHighlightWidth:function(H){var g=this._highlightHelper.width;this._highlightHelper.width=H,this.firePropertyChange("highlightWidth",g,H)},bindEnvMap:function(e){var d=this;d._prg;var v=$c.for(e),q=v.directUniforms(),G=d.getEnvmap(),u=m.getImage(G);if(u&&u.tagName){if(G!==d._lastEnvMap){u=m.resizeImagePOT(u,!0),d._envMapTexture&&e.deleteTexture(d._envMapTexture);var M=d._envMapTexture=e.createTexture();e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,M),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+0,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,u),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+1,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,u),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+2,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,u),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+3,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,u),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+4,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,u),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+5,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,u),e.bindTexture(e.TEXTURE_CUBE_MAP,null),d._lastEnvMap=G}q.uEnvMap=d._envMapTexture}},getWireframe:function(T){var g=T.s("wf.visible"),p=T.s("wf.width");return g===!0||p>0&&"selected"===g&&this.isSelected(T)?{color:T.s("wf.color"),width:p,"short":T.s("wf.short"),mat:T.s("wf.mat")}:void 0},_transformPointToViewSpace:function(F){var M=[F[0],F[1],F[2]];return Eb(M,this._viewMatrix),M},_transformDirectionToViewSpace:function(L,Y){var R=[L[0],L[1],L[2]];Eb(R,this._viewMatrix);var X=Y?[Y[0],Y[1],Y[2]]:[0,0,0];Eb(X,this._viewMatrix);var N=X[0]-R[0],B=X[1]-R[1],k=X[2]-R[2],E=Math.sqrt(N*N+B*B+k*k);return E?[N/E,B/E,k/E]:[N,B,k]},getWireframeGeometry:function(X){return X.s("wf.geometry")?{color:X.s("wf.color"),width:X.s("wf.width"),mat:X.s("wf.mat"),geometry:!0}:void 0},getBodyColor:function(c){return c.s("body.color")},getMat:function(b){return b.getMat?b.getMat():b.s("mat")},getFaceMat:function(d,j){return d.getFaceMat?d.getFaceMat(j):d.s(j+".mat")},getFaceBlend:function(m,U){return m.s(U+".blend")||m.s("all.blend")},getFaceColor:function(V,m){return V.s(m+".color")||V.s("all.color")},getFaceImage:function(Z,G){return Z.s(G+".image")||Z.s("all.image")},getFaceBlendImage:function(x,W){return x.s(W+".blend.image")||x.s("all.blend.image")},getFaceDiscardSelectable:function(n,F){var V=n.s(F+".discard.selectable");return V==z?n.s("all.discard.selectable"):V},getFaceUv:function(I,e){return I.s(e+".uv")||I.s("all.uv")},getFaceUvOffset:function(Y,F){return Y.s(F+".uv.offset")||Y.s("all.uv.offset")},getFaceUvScale:function(o,U){return o.s(U+".uv.scale")||o.s("all.uv.scale")},getFaceLight:function(t,d){var B=t.s(d+".light");return B==z?t.s("all.light"):B},getFaceVisible:function(P,C){var a=P.s(C+".visible");return a==z?P.s("all.visible"):a},getFaceOpacity:function(x,T){var d=x.s(T+".opacity");return d==z?x.s("all.opacity"):d},getFaceTransparent:function(V,W){var k=V.s(W+".transparent");return k==z?V.s("all.transparent"):k},getFaceReverseColor:function(E,a){return E.s(a+".reverse.color")||E.s("all.reverse.color")},getFaceReverseFlip:function(J,X){var l=J.s(X+".reverse.flip");return l==z?J.s("all.reverse.flip"):l},getFaceReverseCull:function(p,x){var y=p.s(x+".reverse.cull");return y==z?p.s("all.reverse.cull"):y},getTextureMap:function(){return this._2O},deleteTexture:function(i){var s=this,w=s._2O[i];w&&(delete s._2O[i],s.getGL().deleteTexture(w))},renderPickScene:function(){var $=this.getGL();this._picking=$._picking=!0,this.renderScene(),this._picking=$._picking=!1},invalidateCachedTexture:function(x){var j=this.getData3dUI(x);j.invalidateCachedTexture(this.getGL()),this.invalidateData(x)},invalidateShape3dCachedImage:function(X){this.invalidateCachedTexture(X)},invalidateCachedGeometry:function(h){var N=this.getData3dUI(h);N.invalidateCachedGeometry(),this.invalidateData(h)},isInteractive:function(g){return g.s("interactive")},getTexture:function(o,J,c){if(!o)return z;var A=this,r=A.getGL(),k=A._2O[o];if(!k){var Z=Qd(o),g={mipmapMaxLevel:J?J.s("texture.mipmap.max"):x};if(!Z)return r._emptyTexture;if(Z.uuid||(Z.uuid=R.Math.generateUUID()),Z.tagName){if(Z.dynamic)return Fj(r,Z,A._1O,g);k=A._2O[o]=Fj(r,Z,x,g)}else{var a,w=J&&(J.s("texture.cache")||J.s("shape3d.image.cache")||Z.textureCache),X=A.vr.isPresenting();if(X&&(J._textureUpdateFrame===r._renderInfo.frame?w=!0:J._textureUpdateFrame=r._renderInfo.frame),w&&(a=A.getData3dUI(J),k=a.getCachedTexture(c),k&&a.interactiveInfo&&k.interactiveInfo&&(a.interactiveInfo[k.interactiveInfo.key]=k.interactiveInfo.info)),!k){var s=r._renderInfo.textureCache;if(w){if(s.time>m.graph3dMaxVectorCacheTime)return A.redraw(),r._emptyTexture;if(!zq(Z,J))return r._emptyTexture}var d;J&&(1!==J.s("texture.scale")?d=J.s("texture.scale"):1!==J.s("shape3d.texture.scale")&&(d=J.s("shape3d.texture.scale"))),d||(d=1);var H=J&&(J.s("fixSizeOnScreen")||J.s("shape3d.fixSizeOnScreen")),n=H?r.NEAREST:r.LINEAR;H?"number"==typeof H&&(d*=0>H?1:H):J&&(J.s("vector.dynamic")||J.s("shape3d.vector.dynamic"))&&(a||(a=A.getData3dUI(J)),H=a.getVectorDynamicSize());var P,N,O,p=J&&J.s("shape3d");"billboard"===p?O=J.getTall()/J.getWidth():"plane"===p&&(O=J.getHeight()/J.getWidth());var v=Uk(Z,J);if(H){var B=A.getDevicePixelRatio();P=H[0]>0?H[0]*B:d*v*B,N=H[1]>0?H[1]*B:d*(O?Cf(Z,J,A,Math.min(4096,v*O)):Cf(Z,J))*B}else P=d*v,N=d*(O?Cf(Z,J,A,Math.min(4096,v*O)):Cf(Z,J));if(P>=1&&N>=1){var L=0;(w||X)&&(L=Date.now());var e=Hd(P,N);if(!a&&J&&(a=A.getData3dUI(J)),a&&a.interactiveInfo){var D=o;"object"==typeof D&&(D=D.uuid||(D.uuid=R.Math.generateUUID()));var F=a.interactiveInfo[D]={};e.interactiveInfo=F.bodyInfo={compInfos:[],matrix:new de,rect:{x:0,y:0,width:P,height:N}}}rb(e,Z,0,0,P,N,J,A),e.interactiveInfo&&(e.interactiveInfo=null),e.restore(),s.count++,s.pixels+=P*N,J?(g.minFilter=J.s("texture.filter.min")||J.s("texture.filter")||n,g.magFilter=J.s("texture.filter.mag")||J.s("texture.filter")||n):g.minFilter=g.magFilter=n,w||X?(k=Fj(r,fn,null,g),a.setCachedTexture(k,c),s.time+=Date.now()-L,F&&(k.interactiveInfo={key:D,info:F}),fn=null):k=Fj(r,fn,A._1O,g)}}}}return k},redraw:function(){this.iv()},validateImpl:function(){var I=this;if(I._lightChanged){I._lightChanged=!1;var O=[],k=[],a=[];I.dm().each(function(S){if(Ko(S)){var M=S.s("light.type");M===hq?O.push(S):M===eh?k.push(S):M===_d&&a.push(S)}}),(O.length!==I._59O.length||k.length!==I._spots.length||a.length!==I._dirs.length)&&jb(I),I._59O=O,I._spots=k,I._dirs=a}I._42(),I._1o.iv()},getRenderInfo:function(){var J=this.getGL();return J?J._renderInfo:void 0},getDebugTip:function(){var g=this,r=g.getRenderInfo();if(r){var T=g.getGL()._validBufCount||0,c="Draw Calls: "+r.calls+"<br/>"+"Vertices: "+r.vertices+"<br/>"+"Faces: "+r.faces+"<br/>"+"Lines: "+r.lines+"<br/>"+(r.points?"Points: "+r.points+"<br/>":"")+"Buffers: "+T+"<br/>"+"Cache Models: "+U.keys(Ng).length+"<br/>"+"Shape3d Models: "+U.keys(wm).length;g.vr.isPresenting()&&(c+="<br/>VR fps: "+g.vr.getFps());var d=r.textureCache.count;if(c+="<br/>2D Dynamic Textures: "+r.textureCache.count,d>0){var X,x=r.textureCache.pixels;X=x>1e6?Math.round(x/1e6)+"M":x>1e3?Math.round(x/1e3)+"K":Math.round(x),c+="<br/>2D Dynamic pixels: "+X}return c}},getFrameState:function(){return this._frameState},isBoundingBoxInView:function(){var C=new R.Math.Box3,P=new R.Math.Matrix4;return function(G){var p=G;if(p instanceof R.Data&&(p=this.getData3dUI(p)),!p.mat)return!0;var c=p.getBoundingBox();C.copy(c).applyMatrix4(P.fromArray(p.mat));var T=this.getFrustum();return T.intersectsBox(C)}}(),updateScene:function(){var J=this;J._81O=z,J.overlappingBox.clear(),J._40Q.init();var A,S,Z,p=this.dm().getDatas().getArray(),Q=p.length,_=this.getGL(),U=this._40Q;for(A=0;Q>A;A++)S=p[A],Z=this.getData3dUI(S),Z&&Z.update(this,_,U);J._40Q.onUpdated()},enableShadow:function(h){this.shadowMap.setShadow(!0,h)},disableShadow:function(){this.shadowMap.setShadow(!1)},renderScene:function(){function l(E,i){O.setGLState(E,i),O.setUniforms(E),O.renderState.attribs.disable(),J=q.directUniforms(),v=q.directAttribs(),v.disable()}function p(U){for(;V>Z;Z++){var d=y[Z];if(!f||!d.ignoreInPick){if(d.priority>=U)break;(!a._43Q[a._44Q=d.id]||Vq[Qg.length])&&(d.render(B,a,O),l())}}}var a=this;a.shadowMap.render(),a._44Q=-1;var v,O=a._frameState,q=O.renderState,j=q.glState,J=q.directUniforms(),B=a.getGL(),Q=a._prg;q.syncLoss(),a._projectMatrix=Cb(a),Zd(a,a._7O),a._viewMatrix=ls(a._7O),O.syncEnv(this._picking?this.pickColorMap:x),q.useProgram(Q),l(!1,!0);var f=a._picking,y=this._41Q,Z=0,V=y.length;if(p(m.cameraPriority.skybox),f){var R=j.color.clear.slice(0);cq(B,[0,0,0,0])}else cq(B,[0,0,0,0]),j.blend.enabled=!1,j.depth.enabled=!1,j.depth.mask=!1,a.drawSky(B,Q),a.drawReflectors(B)&&(a._projectMatrix=Cb(a),Zd(a,a._7O),a._viewMatrix=ls(a._7O),O.syncEnv(),l()),j.blend.enabled=!1,j.depth.enabled=!0,j.depth.mask=!0,J.uTransparent=!1,a._31O._42(B,Q);if(!B.textureBatch||Vq[(ONE_FRAME_TIME-6)/2]){!f&&a.shadowMap.enable&&a.shadowMap.createShadow(J);for(var W=0,P=zp.length;P>W;W++){var A=zp[W],c=fl[A];if(!c.ignore){var e=c.priority;p(e),this.renderLayer(A)}}j.depth.enabled=!1,J.uTransparent=!1,f?a.drawFilter||a._30O._42(B,Q):(j.blend.enabled=!1,j.depth.mask=!0,a._32O._42(B,Q),a._30O._42(B,Q),a._highlightHelper._42(B,Q)),j.depth.enabled=!0,p(m.cameraPriority.infinity),f&&cq(B,R),Pg(B,z),Gr(B,z),a._44Q=-1}},renderLayers:function(I,v){v&&(I=An(I));for(var K=0,e=I.length;e>K;K++)this.renderLayer(I[K])},renderLayer:function(T){var o=this,K=o._picking,$=o._40Q.get(T);if($){var Y,V,D,n=o.getGL(),t=o._frameState,h=t.renderState,B=h.glState,F=h.directUniforms(),l=$.opaque,P=$.transparent,m=$.batchModelMap,g=$.polylineModelMap,A=$.wireframeModelMap,n=o.getGL(),_=o._prg;K||(B.blend.enabled=!1,B.depth.enabled=!0,B.depth.mask=!0),F.uTransparent=!1,n.clear(n.DEPTH_BUFFER_BIT);var z=this.drawFilter;if(z)for(D=l,Y=0,V=D.length;V>Y;Y++)z(D[Y].data)!==!0&&D[Y].ui._42(n,_,r);else{for(D=l,Y=0,V=D.length;V>Y;Y++)D[Y].ui._42(n,_,r);gl(o,m),To(o,g),To(o,A)}if(K||(B.blend.enabled=!0,B.depth.mask=!1),F.uTransparent=!0,z)for(D=P,Y=0,V=D.length;V>Y;Y++)z(D[Y].data)!==!0&&D[Y].ui._42(n,_,Z);else{for(D=P,Y=0,V=D.length;V>Y;Y++)D[Y].ui._42(n,_,Z);gl(o,m,null,!0),To(o,g,null,!0),To(o,A,null,!0)}}},drawV2:function(T){var D=this;if(!D._35O&&(!Hh||Vq(Hh))){var F=D.getWidth(),k=D.getHeight();if(F&&k){var s=D.getGL();if(s){var n=D._canvas;T||(T=D.getDevicePixelRatio()),(F!==n.clientWidth||k!==n.clientHeight)&&(vl(n,F,k,T),F&&Math.abs(s.drawingBufferWidth-F*T)>1&&(D.setDevicePixelRatio(T=s.drawingBufferWidth/F),vl(n,F,k,T)),D._18Q=null),s.clear(s.COLOR_BUFFER_BIT);var J=s._renderInfo;J.calls=0,J.vertices=0,J.faces=0,J.lines=0,J.points=0,J.textureCache={time:0,count:0,pixels:0},J.frame=++D._frameId,J.cacheTimeCost=0,J.reflectDepth=0,F*=T,k*=T;do{if(D.vr.enable&&D.vr.render(s,F,k))break;if(D.updateScene(),D._postProcessing.render(s,F,k))break;D.setViewport(s,0,0,F,k),D.renderScene()}while(!1);D._33Q=!1,D.countFrame(),D._doBufferGC(s)}}}},_42:function(a,M){return this.drawV2(M)},drawReflectors:function(P){P._renderInfo.reflectDepth++;var c,V,F,h=this,H=h._dataModel.getReflectors(),z=!1;for(c in H)V=H[c],h.isVisible(V)&&(F=h.getData3dUI(V),F&&F.drawReflector(P)&&(z=!0));return P._renderInfo.reflectDepth--,z},isReflecting:function(m){return m._renderInfo.reflectDepth},getPostProcessing:function(){return this._postProcessing},enablePostProcessing:function(C,x){return this._postProcessing.enableModule(C,x)},getPostProcessingModule:function(M){return this._postProcessing.getModule(M)},getPostProcessingValue:function(Q,y){var L=this._postProcessing.getModule(Q);return L?L[y]:x},setPostProcessingValue:function(C,H,k){var w=this.getPostProcessingValue(C,H),u=this._postProcessing.getModule(C);u&&w!==k&&("enable"===H?this.enablePostProcessing(C,k):u[H]=k,this.firePropertyChange("postProcessing."+C+"."+H,w,k))},setViewport:function(q,Z,v,M,$){this._viewport=[Z,v,M,$],$c.for(q).directState().viewport=this._viewport},getViewport:function(){return this._viewport},setBufferGCInterval:function(z){this._bufferGCInterval=z},_doBufferGC:function(n,o){var s,e,j=n._bufPool,Q=0,Y=0,b=n._renderInfo.frame,p=this._bufferGCInterval||10;for(s in j)Q++,e=j[s],e&&(o||b-e._fid>p?(n.deleteBuffer(e._buf),e._buf=null,j[s]=null):Y++);if(Q/2>Y&&Q>128){var m={};for(s in j)j[s]&&(m[s]=j[s]);n._bufPool=m}n._validBufCount=Y},_swapLineMap:function(){var N=this;Ce=N._polylineModelMap,N._polylineModelMap=N._polylineModelMapSwap,N._polylineModelMapSwap=Ce,Ce=N._wireframeModelMap,N._wireframeModelMap=N._wireframeModelMapSwap,N._wireframeModelMapSwap=Ce,Ce=N._polylineIndexMap,N._polylineIndexMap=N._polylineIndexMapSwap,N._polylineIndexMapSwap=Ce,Ce=N._wireframeIndexMap,N._wireframeIndexMap=N._wireframeIndexMapSwap,N._wireframeIndexMapSwap=Ce},_updateSkyBox:function(d){if(this._skyBox&&d){var C=d.property,i=!1,c=this._skyBox;if("eye"===C||"forceUpdate"===C){var g=this._eye;c.p3(g[0],g[1],g[2]),i=!0}if("near"===C||"far"===C||"forceUpdate"===C){var S=this._near,v=this._far,I=c.getFinalScale3d();if(I[0]/=2,I[1]/=2,I[2]/=2,I[0]<=S||I[0]>=v||I[1]<=S||I[1]>=v||I[2]<=S||I[2]>=v){var F=2*S*v/(S+v),T=Math.min(I[0],I[1],I[2]),X=F/T,u=c.getScale3d();c.setScale3d(u[0]*X,u[1]*X,u[2]*X),i=!0}}i&&this.invalidateData(c)}},getSkyBox:function(){return this._skyBox},setSkyBox:function(G){var o=this._skyBox;o&&(this._skyBoxStyleMap&&o.setStyleMap(this._skyBoxStyleMap),this._skyBoxStyleMap=null,this._skyBoxAnchor3d&&o.setAnchor3d(this._skyBoxAnchor3d),this._skyBoxAnchor3d=null,this._skyBoxP3&&o.p3(this._skyBoxP3),this._skyBoxP3=null),this._skyBox=G,this.ump(this._updateSkyBox,this),G&&(G.dm()&&G.dm().remove(G),this._skyBoxStyleMap=R.Default.clone(G.getStyleMap()),this._skyBoxAnchor3d=G.getAnchor3d(),G.setAnchor3d(.5,.5,.5),this._skyBoxP3=G.p3().slice(0),G.s({"shape3d.reverse.flip":!0,"shape3d.reverse.cull":!1,"all.reverse.flip":!0,"all.reverse.cull":!1,"front.reverse.flip":!0,"front.reverse.cull":!1,"back.reverse.flip":!0,"back.reverse.cull":!1,"left.reverse.flip":!0,"left.reverse.cull":!1,"right.reverse.flip":!0,"right.reverse.cull":!1,"top.reverse.flip":!0,"top.reverse.cull":!1,"bottom.reverse.flip":!0,"bottom.reverse.cull":!1}),this.mp(this._updateSkyBox,this),this._updateSkyBox({property:"forceUpdate"})),this.fp("skyBox",o,G)},drawSky:function(t,P){var n=this,u=n._skyBox;if(u){var X=$c.for(t).directUniforms(),T=n._headlightIntensity,v=Em(n._headlightColor),P=n._prg;1!==T&&(v=[v[0]*T,v[1]*T,v[2]*T]),X.uHeadlightColor=[v[0],v[1],v[2],1];var o=n.getData3dUI(u);if(o){var a=n.isOrtho(),E=a||this._computedProjectMatrix;if(E){var g=n._projectMatrix;a&&(n._ortho=!1),X.uPMatrix=n._projectMatrix=Cb(n,!0)}var j=u.p3(),I=this._eye;(j[0]!==I[0]||j[1]!==I[1]||j[2]!==I[2])&&(u._position.x=I[0],u._54O=I[1],u._position.y=I[2]),o.validate(),o._42(t,P,e),E&&(a&&(n._ortho=!0),X.uPMatrix=n._projectMatrix=g)}t.clear(t.DEPTH_BUFFER_BIT),X.uHeadlightColor=[v[0],v[1],v[2],n._headlightDisabled?1:0]}},getLogicalPoint:function(Y){return bp(Y,this._canvas)},isRectOverlapping:function(w){var P=this.getData3dUI(w);return P._rectOverlapping},getHitFaceInfo:function(l){l.target&&(l=this.lp(l));var c=this.getDataInfoAt(l);if(c){var E=this.intersectObject(l,c.data);if(E)return{data:c.data,face:E.part}}return z},unproject:function(j,v){var N=this,l=N.getWidth(),z=N.getHeight(),J=j.target?N.lp(j):j,A=J.x-l/2,I=J.y-z/2,W=2*(A/l),S=2*(-1*I/z);v=v||0;var Y=Re(),X=Cb(N),h=Zd(N);Tk(Y,X,h),Nh(Y);var $=lp([W,S,v,1],Y);return[$[0]/$[3],$[1]/$[3],$[2]/$[3]]},getDataAt:function(m){var B=this.getDataInfoAt(m);return B?B.data:z},getDataInfoAt:function(q,X){return q.target&&(q=this.lp(q)),this._1o.get($q(q.x,q.y,X),!0)},getDatasInRect:function(n){return this._1o.get(n)},setEditable:function(M){var f=this,c=f._editable;f._editable=M,this.fp(be,c,M)},isEditable:function(K){var v=this;return K?v._editable?Vm(K)?K.s("3d.editable")?v._editableFunc?v._editableFunc(K):!0:!1:!1:!1:v._editable},isSelectable:function(C){return C.s("3d.selectable")&&this.sm().isSelectable(C)},isMovable:function(c){var O=this;return xr(c)&&c.getStyle(pr)!==mm?!1:c.s("3d.movable")?O._movableFunc?O._movableFunc(c):!0:!1},isSizeEditable:function(w){return Vm(w)?this._sizeEditableFunc?this._sizeEditableFunc(w):!0:!1},isRotationEditable:function(I){return Vm(I)&&I.IRotatable!==!1?this._rotationEditableFunc?this._rotationEditableFunc(I):!0:!1},handleDelete:function(){this._editable&&this.removeSelection()},zoomIn:function(Q){this.setZoom(Sj,Q)},zoomOut:function(c){this.setZoom(1/Sj,c)},setZoom:function(){var j=new Ki,o=new Ki,q=new Ki,T=new Ki;return function(s,u){if(1!==s){var D=this;D._14o&&D._14o.stop(!0);var R,Q=1/s;j.copy(D.getCenter()),o.copy(D.getEye());var C=D._ortho;if(C){if(R=D._orthoWidth,R<D._moveStep&&s>1)return}else if(j.distanceTo(o)<D._moveStep&&1>Q)return;var U=!1;return D._zoomToCenter===!1&&D._lastZoomLP&&(q.copy(o).sub(j).normalize(),D._81O=null,T.copy(D.getHitPosition(D._lastZoomLP,j.toArray(),q.toArray())),U=!0,D._lastZoomHit=T),(u=js(u))?(u.action=function(f){D.fi({kind:D._zooming?"betweenZoom":"beginZoom"}),D._zooming=1;var N=(Q-1)*f+1;C&&D.setOrthoWidth(R*N),U?(D.setEye(q.lerpVectors(T,o,N).toArray()),D.setCenter(q.lerpVectors(T,j,N).toArray())):C||D.setEye(q.lerpVectors(j,o,N).toArray())},u._37o=function(){delete D._14o,delete D._zooming,D.fi({kind:"endZoom"}),D.onZoomEnded()},D._14o=Ib(u)):(C&&D.setOrthoWidth(R*Q),U?(D.setEye(q.lerpVectors(T,o,Q).toArray()),D.setCenter(q.lerpVectors(T,j,Q).toArray())):C||D.setEye(q.lerpVectors(j,o,Q).toArray()),void 0)}}}(),setOrthoZoom:function(Z,z){return this.setZoom(Z,z)},getPositionInfo:function(m){var k=this,U=k._eye,G=k._center,e=k.getAspect(),b=m?cl(fi(G,U,!0),fi(m,U)):id(U,G);if(k._ortho){var T=k._orthoWidth;return{length:b,height:T/e,width:T}}var R=2*_(k._fovy/2)*b;return{length:b,height:R,width:R*e}},getCenterInfo:function(){var A=this;return A._81O||(A._81O=A.getPositionInfo()),qj(A._81O)},rotate:function(L,i,m,c){var $=this;if(L||i){c==z&&(c=$._firstPersonMode),$._88O&&$._88O.stop(!0);var u=$._center,x=$._eye,_=$.getCenterInfo().length,D=c?u:x,b=c?x:u,E=fi(D,b),I=C(E[0],E[2]),v=C(N(E[0]*E[0]+E[2]*E[2]),E[1]),y=c?sj:Aj;return c&&(i=-i),(m=js(m))?(m.action=function(X){$.fi({kind:$._rotating?"betweenRotate":"beginRotate"}),$._rotating=1;var h=I+L*X,Z=v+i*X;Z=c?j-Bn(j-Z):Bn(Z),E[0]=_*F(Z)*F(h),E[1]=_*d(Z),E[2]=_*F(Z)*d(h),D[0]=b[0]+E[0],D[1]=b[1]+E[1],D[2]=b[2]+E[2],$.fp(y,z,D)},m._37o=function(){delete $._88O,delete $._rotating,$.fi({kind:"endRotate"}),$.onRotateEnded()},$._88O=Ib(m)):(I+=L,v+=i,v=c?j-Bn(j-v):Bn(v),E[0]=_*F(v)*F(I),E[1]=_*d(v),E[2]=_*F(v)*d(I),D[0]=b[0]+E[0],D[1]=b[1]+E[1],D[2]=b[2]+E[2],$.fp(y,z,D),void 0)}},pan:function(s,I,X,G){if(s||I){var U=this;G==z&&(G=U._firstPersonMode),U._89O&&U._89O.stop(!0);var Q=Zd(U),j=[Q[0]*s,Q[4]*s,Q[8]*s],$=[Q[1]*I,Q[5]*I,Q[9]*I],u=j[0]+$[0],m=j[1]+$[1],o=j[2]+$[2],V=U._center,S=U._eye;if(G){var D=Ti(U.getBoundaries(),S[0],S[2],S[0]+u,S[2]+o,N(u*u+o*o));u=D[0],o=D[1]}if(X=js(X)){var w=qj(S),P=qj(V);return X.action=function(K){U.fi({kind:U._panning?"betweenPan":"beginPan"}),U._panning=1,V[0]=P[0]+u*K,V[1]=P[1]+m*K,V[2]=P[2]+o*K,S[0]=w[0]+u*K,S[1]=w[1]+m*K,S[2]=w[2]+o*K,U.fp(Aj,z,S),U.fp(sj,z,V)},X._37o=function(){delete U._89O,delete U._panning,U.fi({kind:"endPan"}),U.onPanEnded()},U._89O=Ib(X)}V[0]+=u,V[1]+=m,V[2]+=o,S[0]+=u,S[1]+=m,S[2]+=o,U.fp(Aj,z,S),U.fp(sj,z,V)}},walk:function(c,u,C){if(c){var I=this;C==z&&(C=I._firstPersonMode),I._90O&&I._90O.stop(!0);var e=I._center,p=I._eye,G=fi(e,p,!0);if(C){var q=Ti(I.getBoundaries(),p[0],p[2],p[0]+G[0]*c,p[2]+G[2]*c,H(c));if(c=id(q),!c)return;G=[q[0]/c,0,q[1]/c]}if(u=js(u)){var O=qj(p),A=qj(e);return u.action=function(V){I.fi({kind:I._walking?"betweenWalk":"beginWalk"}),I._walking=1;var N=c*V;p[0]=O[0]+G[0]*N,p[1]=O[1]+G[1]*N,p[2]=O[2]+G[2]*N,e[0]=A[0]+G[0]*N,e[1]=A[1]+G[1]*N,e[2]=A[2]+G[2]*N,I.fp(Aj,z,p),I.fp(sj,z,e)},u._37o=function(){delete I._90O,delete I._walking,I.fi({kind:"endWalk"}),I.onWalkEnded()},I._90O=Ib(u)}p[0]+=G[0]*c,p[1]+=G[1]*c,p[2]+=G[2]*c,e[0]+=G[0]*c,e[1]+=G[1]*c,e[2]+=G[2]*c,I.fp(Aj,z,p),I.fp(sj,z,e)}},handleScroll:function(k,j){k.preventDefault();var q=this,R=q._moveStep,D=q.getDataInfoAt(k);if(D){var p=D.data;if(p&&q.isInteractive(p)){var P=q.intersectObject(k,p);if(P){var A=P.part,Y=Qd(p.s(A+".image")||p.s("shape3d."+A+".image")||p.s("all.image")||p.s("shape3d.image"));if(Y&&Lq(Y.scrollable,p,q))return}}}return q.isFirstPersonMode()?(q.isPannable()&&q.pan(0,j>0?R:-R),void 0):(q.isZoomable()&&(q._lastZoomLP=q.lp(k),q.setZoom(0>j?1/or:or),q._lastZoomLP=q._lastZoomHit=null),void 0)},handlePinch:function(q,V){if(this.isZoomable()){if(Math.abs(q-V)<m.pinchZoomThreshold)return;this.setZoom(V>q?1/ue:ue)}},reset:function(){this.setCenter(m.graph3dViewCenter),this.setEye(m.graph3dViewEye),this.setUp(m.graph3dViewUp)},moveSelection:function(o,w,s){var J=this;J.dm().beginTransaction(),sd(this.sm().toSelection(this.isMovable,this),o,w,s),J.dm().endTransaction()},getMoveMode:function(K,Q){var m=Q.s("3d.move.mode");if(m)return m;var e="88",F="89",C="90";return Zh(K)||hf[e]&&hf[F]&&hf[C]?"xyz":hf[e]&&hf[F]?"xy":hf[e]&&hf[C]?"xz":hf[F]&&hf[C]?"yz":hf[e]?"x":hf[F]?"y":hf[C]?"z":"xz"},handleTick:function(){var o=this,j=!1,W=o._moveStep,Y=W,P=!1,T=!0,E=o._rotateStep*(T?-1:1);if(o.isWalkable()||(Y=0),o.isPannable()||(W=0),o.isRotatable()||(E=0),o._32Q){var b=(Pc()-o._32Q)/50;Y*=b,W*=b,E*=b}o._31Q&&(Ih(o._31Q),delete o._31Q,delete o._32Q),jd()&&(j=!0,o.pan(-W,0,P,T)),El()&&(j=!0,o.pan(W,0,P,T)),ci()&&(j=!0,Zh()?o.pan(0,W,P,T):o.walk(Y,P,T)),mp()&&(j=!0,Zh()?o.pan(0,-W,P,T):o.walk(-Y,P,T)),sr()&&(j=!0,o.rotate(-E,0,P,T)),Kf()&&(j=!0,o.rotate(E,0,P,T)),Hr()&&(j=!0,o.rotate(0,-E/2,P,T)),Fe()&&(j=!0,o.rotate(0,E/2,P,T)),j&&(o._32Q=Pc(),o._31Q=dr(o.handleTick,o))},handleKeyDown:function(p){var Y=this;!Kb(p)&&Om[p.keyCode]?Y.handleTick():Rj(p)?Y.selectAll():Mg(p)?Y.handleDelete(p):Wh(p)&&this.isResettable()&&Y.reset()},checkDoubleClickOnNote:function(K,G,E){var s=this;if(E===up){if(G.s("note.toggleable"))return G.s(Xo,!G.s(Xo)),s.fi({kind:"toggleNote",event:K,data:G,part:E}),!0}else if(E===Io&&G.s("note2.toggleable"))return G.s(fs,!G.s(fs)),s.fi({kind:"toggleNote2",event:K,data:G,part:E}),!0;return!1},checkDoubleClickOnRotation:function(Z,H,F){return F===fj?(H.setRotationX(0),!0):F===No?(H.setRotationY(0),!0):F===Jb?(H.setRotationZ(0),!0):!1},onRotateEnded:function(){},onWalkEnded:function(){},getViewRatio:function(n){var v=this;if(v.isOrtho())return v.getWidth()/v.getOrthoWidth();var Q=v.getCenter(),A=v.getHeight(),k=v.getEye(),u=[Q[0]-k[0],Q[1]-k[1],Q[2]-k[2]],O=[n[0]-k[0],n[1]-k[1],n[2]-k[2]],F=Math.sqrt(u[0]*u[0]+u[1]*u[1]+u[2]*u[2]),e=1/Math.tan(v.getFovy()/2);return A*F*e/(O[0]*u[0]+O[1]*u[1]+O[2]*u[2])},inViewSpace:function(c){var z,m=this,r=m._transformPointToViewSpace(c),W=m.getAspect(),q=m.getNear(),X=m.getFar();return-r[2]<q||-r[2]>X?!1:m.isOrtho()?(z=m.getOrthoWidth()/2,Math.abs(r[0])<=z&&Math.abs(r[1]*W)<=z):(z=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2])*Math.tan(m.getFovy()/2),Math.abs(r[1]<=z)&&Math.abs(r[0])<=z*W)},getPVMatrix:function(){var h,D=this;return(h=D._18Q)||(h=Cb(D),D._18Q=Tk(h,h,Zd(D)),D._18Q._wh=D.getWidth()/2/D.getHeight()),h},getFrustum:function(){var E=new Tl,A=new bm,f=new Array(16);return function(){for(var M=this.getPVMatrix(),k=!1,J=0;16>J;J++)M[J]!==f[J]&&(k=!0,f[J]=M[J]);return k&&A.setFromMatrix(E.fromArray(M)),A}}(),toViewPosition:function(y){var Z=this,Q=Z.getWidth()/2,p=Z.getHeight()/2,n=Z.getPVMatrix();return y=lp([y[0],y[1],y[2],1],n),{x:Q+Q*y[0]/y[3],y:p-p*y[1]/y[3],z:y[2]/y[3]}},getHitPosition:function(S,v,R){var C=this,Q=C.getWidth(),m=C.getHeight(),c=S.target?C.lp(S):S,g=c.x-Q/2,q=c.y-m/2,r=C.getCenterInfo(),G=Zd(C);v=v?v:[0,0,0],R=R?R:[0,1,0],g=g/Q*r.width,q=-1*q/m*r.height;var V=[G[0]*g,G[4]*g,G[8]*g],H=[G[1]*q,G[5]*q,G[9]*q],z=[V[0]+H[0],V[1]+H[1],V[2]+H[2]],i=C.getCenter(),O=yf(C,v,R,[z[0]+i[0],z[1]+i[1],z[2]+i[2]]);return O?O:[0,0,0]},intersectObject:function(d,T){return this._raycaster.intersectObject(d,T)},intersectObjects:function(t,n,G){return this._raycaster.intersectObjects(t,n,G)},getLineLength:function(A){this.validate();var B=this.getData3dUI(A);if(B&&B.getCache){var u=B.getCache();if(u)return u[u.length-1].length}return 0},getLineOffset:function(J,l){var u=this.getData3dUI(J);if(u&&u.getCache){var P=u.getCache();if(P){var t=Yb(P,l);if(!J.r3)return t;var X=J.r3();if(0===X[0]&&0===X[1]&&0===X[2])return t;var C=new Ki(J.p3()),v=new Ki(t.point).sub(C),I=new Ki(t.tangent).add(v),W=(new Kn).setFromEuler(new Ff(X,J.getRotationMode(),!0));return v.applyQuaternion(W),I.applyQuaternion(W),{point:v.add(C),tangent:I.sub(v).normalize()}}}return z},isLabelVisible:function(){return!0},isNoteVisible:function(){return!0},moveCamera:function(h,l,u){var z=this,J=z.getEye();J=[J[0],J[1],J[2]];
var c=z.getCenter();if(c=[c[0],c[1],c[2]],h||(h=J),l||(l=c),z._flyAnim&&z._flyAnim.stop(!0),u=js(u),!u)return z.setEye(h[0],h[1],h[2]),z.setCenter(l[0],l[1],l[2]),delete z._flyAnim,!0;var j=[h[0]-J[0],h[1]-J[1],h[2]-J[2]],C=[l[0]-c[0],l[1]-c[1],l[2]-c[2]];return u.action=function(I){z.setCenter(c[0]+C[0]*I,c[1]+C[1]*I,c[2]+C[2]*I),z.setEye(J[0]+j[0]*I,J[1]+j[1]*I,J[2]+j[2]*I)},u._37o=function(){delete z._flyAnim},z._flyAnim=Ib(u)},flyTo:function(){function B(b,r,i){if(i instanceof R.Node){y.fromArray(dg(i,r.getMat(i)));var $=i.getAnchor3d();b.push((new Ki).set(0-$.x,0-$.y,0-$.z).applyMatrix4(y)),b.push((new Ki).set(0-$.x,0-$.y,1-$.z).applyMatrix4(y)),b.push((new Ki).set(0-$.x,1-$.y,0-$.z).applyMatrix4(y)),b.push((new Ki).set(0-$.x,1-$.y,1-$.z).applyMatrix4(y)),b.push((new Ki).set(1-$.x,0-$.y,0-$.z).applyMatrix4(y)),b.push((new Ki).set(1-$.x,0-$.y,1-$.z).applyMatrix4(y)),b.push((new Ki).set(1-$.x,1-$.y,0-$.z).applyMatrix4(y)),b.push((new Ki).set(1-$.x,1-$.y,1-$.z).applyMatrix4(y))}}var d=new Ki,b=new Ki,$=new Ki,j=new Ki,y=new Tl,s=new R.Math.Quaternion,w=new Ff;return function(S,f,o){var l=this;if(o!==x)f={animation:f,ratio:o};else{var N=typeof f;("boolean"===N||"object"===N&&f.duration)&&(f={animation:f})}f=f||{},d.fromArray(l.getEye()),b.fromArray(l.getCenter());var J,G,M=[],K=f.center,Q=f.distance===x;if(K&&$.fromArray(K),S instanceof R.Node)K||$.fromArray(S.p3()),Q&&(B(M,l,S),J=M.length);else{if(S||(S=l.dm().getDatas()),!S.length)return;if((Q||!K)&&(M=[],S.forEach(function(H){B(M,l,H)}),J=M.length,!J))return;if(!K){for($.set(0,0,0),G=0;J>G;G++)$.add(M[G]);$.multiplyScalar(1/J)}}if(l.setCenter($.x,$.y,$.z),j.subVectors(d,b),f.direction||f.worldDirection){!f.worldDirection&&S instanceof R.Node?s.setFromEuler(w.set(S.r3(),S.getRotationMode(),!0)):s.set(0,0,0,1);var I=j.length();j.fromArray(f.worldDirection||f.direction).applyQuaternion(s).setLength(I)}var C=0;if(Q){var n,a,m,o=f.ratio||.8,U=f.xRatio||o,D=f.yRatio||o;if(l.isOrtho()){var h=-1/0;for(l._eye[0]=j.x+$.x,l._eye[1]=j.y+$.y,l._eye[2]=j.z+$.z,n=Cb(l),Tk(n,n,Zd(l)),G=0;J>G;G++)m=M[G],a=lp([m.x,m.y,m.z,1],n),h=Math.max(h,Math.max(Math.abs(a[0])/U,Math.abs(a[1])/D));C=l.getOrthoWidth()*h,j.add($)}else{for(var V,X,_=l.getNear(),T=10;T--;){for(l._eye[0]=j.x+$.x,l._eye[1]=j.y+$.y,l._eye[2]=j.z+$.z,n=Cb(l),Tk(n,n,Zd(l)),V=!0,X=-1/0,G=0;J>G;G++){if(m=M[G],a=lp([m.x,m.y,m.z,1],n),a[3]<_&&T){j.multiplyScalar(2),V=!1;break}X=Math.max(X,Math.max(Math.abs(a[0])/U,Math.abs(a[1])/D)-a[3])}if(V)break}j.setLength(X+j.length()).add($)}}else j.setLength(f.distance).add($);l._flyAnim&&l._flyAnim.stop(!0);var H=js(f.animation);if(H){l.setEye(d.x,d.y,d.z),l.setCenter(b.x,b.y,b.z);var p=(new Ki).subVectors(j,d),e=(new Ki).subVectors($,b);if(C)var P=l.getOrthoWidth();var u=new Ki,t=new Ki,k=H.action,v=H._37o,g=d.clone(),y=b.clone();return H.action=function(z,X){u.copy(g).addScaledVector(p,z),t.copy(y).addScaledVector(e,z),l.setCenter(t.x,t.y,t.z),l.setEye(u.x,u.y,u.z),C&&l.setOrthoWidth((C-P)*z+P),k&&k(z,X)},H._37o=function(){delete l._flyAnim,v&&v()},{lastEye:d,lastCenter:b,eye:j,center:$,orthoWidth:C,animation:l._flyAnim=Ib(H)}}return l.setEye(j.x,j.y,j.z),C&&l.setOrthoWidth(C),delete l._flyAnim,{lastEye:d,lastCenter:b,eye:j,center:$,orthoWidth:C}}}(),getBoundingBox:function(){function D(A,L,_){x.fromArray(dg(_,L.getMat(_)));var V=_.getAnchor3d();A.push((new Ki).set(0-V.x,0-V.y,0-V.z).applyMatrix4(x)),A.push((new Ki).set(0-V.x,0-V.y,1-V.z).applyMatrix4(x)),A.push((new Ki).set(0-V.x,1-V.y,0-V.z).applyMatrix4(x)),A.push((new Ki).set(0-V.x,1-V.y,1-V.z).applyMatrix4(x)),A.push((new Ki).set(1-V.x,0-V.y,0-V.z).applyMatrix4(x)),A.push((new Ki).set(1-V.x,0-V.y,1-V.z).applyMatrix4(x)),A.push((new Ki).set(1-V.x,1-V.y,0-V.z).applyMatrix4(x)),A.push((new Ki).set(1-V.x,1-V.y,1-V.z).applyMatrix4(x))}var x=new Tl;return function(K){if(K=K||this.sm().getSelection(),K instanceof R.Node&&(K=[K]),0===K.length)return z;var J=[];K.forEach(function(F){Vm(F)&&D(J,this,F)},this);var l=[1/0,1/0,1/0],y=[-1/0,-1/0,-1/0];return J.forEach(function(A){l[0]=Math.min(A.x,l[0]),l[1]=Math.min(A.y,l[1]),l[2]=Math.min(A.z,l[2]),y[0]=Math.max(A.x,y[0]),y[1]=Math.max(A.y,y[1]),y[2]=Math.max(A.z,y[2])}),{min:l,max:y}}}()}),Ab.RenderEnv=function(H){this.gv=H,this.enable=!1},U.defineProperties(Ab.RenderEnv.prototype,{debugOn:{get:function(){return this._debugOn},set:function(d){this._debugOn=d,this.capture&&this.capture()}}}),U.assign(Ab.RenderEnv.prototype,{renderEnvToCube:function(m,j,t,M){var o=this,R=o.gv;if(!m||!j||!t)return o.enable=!1,o._42=null,void 0;o.enable=!0;var J=Math.floor(M/m*j),Z=R.getGL(),h=o._renderTargets;h?h.length<t&&(h=o._renderTargets=h.concat(new Array(t-h.length))):h=o._renderTargets=new Array(t);for(var A=0;t>A;A++)h[A]?h[A].setSize(Z,M,J):h[A]=new Ab.RenderTarget(R,Z,M,J);var u=!1;o.capture=function(){u=!0,R._42(),u=!1};var y=new Ki,_=new Ki,C=new Ki,F=new Ki,L=(new Ki).setY(0),D=2*Math.PI/t,n=m/2/Math.tan(Math.PI/t),H=2*Math.atan2(j/2,n),N=m/j;o._42=function(O,U,c,k){var E=o._debugOn;if(!u&&!E)return!1;y.copy(R.getEye()),F.copy(R.getCenter()).sub(y);var B=Math.atan2(F.z,F.x),d=R.getNear(),W=R.getFovy(),Y=R.getAspect();_.copy(R.getCenter());for(var Z,$=0;t>$;$++)if(Z=h[$],L.setZ(Math.cos(B)).setX(Math.sin(B)).multiplyScalar(n),B-=D,C.addVectors(y,L),R.setNear(n),R.setCenter([C.x,C.y,C.z]),R.setFovy(H),R.setAspect(N),E){var x=Math.round(U/t);$c.for(O).glState.viewport=[x*$,0,x,c],k()}else jq(O,Z.frame),$c.for(O).glState.viewport=[0,0,Z.width,Z.height],O.clear(O.COLOR_BUFFER_BIT),k(),Hc(O),Z.assureTexture();return R.setNear(d),R.setCenter([_.x,_.y,_.z]),R.setFovy(W),R.setAspect(Y),!0},o.capture()},getTextureInfo:function(f){var g=this._renderTargets;if(!g)return null;var b=this._renderTargets[f];return b?{index:f,texture:b.texture,textureName:b.uuid}:null}}),U.assign(Ab.Graph3dView.prototype,{renderEnvToCube:function(q,i,h,p){var v=this;v.envRenderer||(v.envRenderer=new Ab.RenderEnv(v)),v.envRenderer.renderEnvToCube(q,i,h,p)}});var tp=["left","front","right","back","top","bottom"],Xg=Ab._RenderList=function(){function i(){S.length=0,D.length=0,L={}}function K(m){var S=m.gv,X=m.data;if(bo&&!ah)return m._renderParams=null,void 0;var p,b,e,D,o=m.shapeModel;if(o){var z,W,u,$=X.s("shape3d.transparent")||X.s("points.transparent");for(Mf(o)||(z=Lq(o.transparent,X,S),o=[o]),e=0,D=o.length;D>e;e++)u=o[e],W=Lq(u.transparent,X,S),W===x&&(W=z),W===x&&(W=$),W?b=!0:p=!0}for(e=0,D=tp.length;D>e;e++){var M=m[tp[e]];M&&(M.transparent?b=!0:p=!0)}S.isLabelVisible(X)&&(m.labelInfo&&(X.s(ih+".transparent")?b=!0:p=!0),m.label2Info&&(X.s(Ar+".transparent")?b=!0:p=!0)),S.isNoteVisible(X)&&(m.noteInfo&&(X.s(up+".transparent")?b=!0:p=!0),m.note2Info&&(X.s(Io+".transparent")?b=!0:p=!0)),m._38o&&(b=p=!0),b||(p=!0),m._renderParams={opaque:p,transparent:b}}function c(I,M){M&&K(I);var r=I.data,t=r._id;if(!L[t]){L[t]=!0;var d=I._renderParams;d&&d.visible!==!1&&(I={ui:I,data:r,z:r._z,id:t},d.opaque&&S.push(I),d.transparent&&D.push(I))}}function Z(){S.length>1&&S.sort(T),D.length>1&&D.sort(E)}function n(B){B?(Ub(U,W,B),Ub(z,C,B),Ub(j,O,B)):(U=this.batchModelMap={},W=this.batchIndexMap={},z=this.polylineModelMap={},C=this.polylineIndexMap={},j=this.wireframeModelMap={},O=this.wireframeIndexMap={}),this.markBatchInvalid()}function g(r){r?Ub(U,W,r):(U=this.batchModelMap={},W=this.batchIndexMap={}),this.markBatchInvalid()}function A(P){P?Ub(z,C,P):(z=this.polylineModelMap={},C=this.polylineIndexMap={}),this.markBatchInvalid()}function t(K){K?Ub(j,O,K):(j=this.wireframeModelMap={},O=this.wireframeIndexMap={}),this.markBatchInvalid()}function s(){return this._batchInvalid}function G(){this._batchInvalid=!0}function q(){this._batchInvalid=null}var S=[],D=[],U={},W={},z={},C={},j={},O={},L={};return{opaque:S,transparent:D,init:i,push:c,batchModelMap:U,batchIndexMap:W,polylineModelMap:z,polylineIndexMap:C,wireframeModelMap:j,wireframeIndexMap:O,ivBatch:n,ivModelBatch:g,ivPolylineBatch:A,ivWireframeBatch:t,markBatchInvalid:G,isBatchInvalid:s,onUpdated:q,sort:Z}},Im=Ab._RenderLists=function(){function o(){for(var h in P)P[h].init()}function f(){for(var A in P)P[A].onUpdated()}function H(u,R){u=u||"main";var L=P[u];return!L&&R&&(L=P[u]=new Xg),L}function k(s,k){var p=s.data.getRenderLayer(),z=H(p,!0);z.push(s,k)}function F($){for(var t in P)$(P[t])}var P={};return{init:o,onUpdated:f,get:H,push:k,each:F,lists:P}},ar=Ab.RenderTarget=function(P,q,C,g,Z){var n=this;Z=Z||{},Z.samples=Math.min(P._glCapabilities.maxSamples,Z.samples&&Z.samples>1&&2===P._webGLVersion?Z.samples:0),n.options=Z,n.uuid=R.Math.generateUUID(),n.gv=P,n.init(P,q,Z),Z.samples&&!P._glCapabilities._maxSamplesChecked?n.setSize(q,C||1,g||1):n.setSize(q,C,g)};U.assign(Ab.RenderTarget.prototype,{bind:function(B){jq(B,this.options.samples?this._MSAAFbo:this.frame)},unbind:function(l){Hc(l),this.options.samples&&(l.bindFramebuffer(l.READ_FRAMEBUFFER,this._MSAAFbo),l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.frame),l.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,l.COLOR_BUFFER_BIT,l.NEAREST),l.bindFramebuffer(l.READ_FRAMEBUFFER,null),l.bindFramebuffer(l.DRAW_FRAMEBUFFER,null))},init:function(z,E,R){var M=this,F=M.texture=E.createTexture();E.activeTexture(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,F);var A=R.samples,B=A?E.NEAREST:E.LINEAR;E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,R.minFilter||B),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,R.magFilter||B),E.bindTexture(E.TEXTURE_2D,null),M.render=E.createRenderbuffer(),M.frame=E.createFramebuffer(),z._2O[M.uuid]=F},assureTexture:function(){var U=this,F=U.uuid,b=U.gv._2O;b[F]||(b[F]=U.texture)},setSize:function(m,n,s){var q=this;if(n&&s&&(q.width!==n||q.height!==s)){var I=m.RGBA,v=m.TEXTURE_2D,x=m.RENDERBUFFER,C=m.FRAMEBUFFER,a=q.options.samples;if(m.activeTexture(m.TEXTURE0),xp(m,q.texture),m.texImage2D(v,0,I,n,s,0,I,m.UNSIGNED_BYTE,z),rh.isPOT(n)&&rh.isPOT(s)&&!q.options.clampToEdge?(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.REPEAT),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.REPEAT)):(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE)),m.bindRenderbuffer(x,q.render),a){var A=q.gv._glCapabilities;if(A._maxSamplesChecked)m.renderbufferStorageMultisample(x,a,m.DEPTH_COMPONENT16,n,s);else{for(m.getError();a>1&&(m.renderbufferStorageMultisample(x,a,m.DEPTH_COMPONENT16,n,s),m.getError());)a=Math.floor(a>>1);1>=a&&(a=0,m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,q.options.minFilter||m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,q.options.magFilter||m.LINEAR),m.renderbufferStorage(x,m.DEPTH_COMPONENT16,n,s)),A._maxSamplesChecked=!0,A.maxSamples=q.options.samples=a}}else m.renderbufferStorage(x,m.DEPTH_COMPONENT16,n,s);a&&!q._MSAAFbo&&(q._MSAAFbo=m.createFramebuffer(),q._MSAARbO=m.createRenderbuffer()),jq(m,q.frame),m.framebufferTexture2D(C,m.COLOR_ATTACHMENT0,v,q.texture,0),a||m.framebufferRenderbuffer(C,m.DEPTH_ATTACHMENT,x,q.render),Hc(m),a&&(m.bindRenderbuffer(m.RENDERBUFFER,q._MSAARbO),m.renderbufferStorageMultisample(m.RENDERBUFFER,a,m.RGBA8,n,s),jq(m,q._MSAAFbo),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.RENDERBUFFER,q._MSAARbO),m.framebufferRenderbuffer(C,m.DEPTH_ATTACHMENT,x,q.render),Hc(m)),xp(m,z),m.bindRenderbuffer(x,z),q.width=n,q.height=s}},toCanvas:function(){var k=this,c=k.gv.getGL();jq(c,k.frame);var h=k.width,S=k.height,y=new Uint8Array(4*h*S);c.readPixels(0,0,h,S,c.RGBA,c.UNSIGNED_BYTE,y),Hc(c);var X=G.createElement("canvas");X.width=h,X.height=S;var o=X.getContext("2d"),w=o.createImageData(h,S);return w.data.set(y),o.putImageData(w,0,0),X}});var Ge=Ab.Interactor=function(r){this.gv=this.g3d=r};bg("Interactor",U,{ms_listener:1,getView:function(){return this.gv.getView()},setUp:function(){this.addListeners()},tearDown:function(){this.removeListeners()}});var Hn=Ab.DefaultInteractor=function(N){ac(Hn,this,[N])};bg("DefaultInteractor",Ge,{getDataInfoAt:function(m,F){var W=this.gv,b=W.getDataInfoAt(m);if(!W.isBlockSelectable()||!b||!b.data)return b;if(!F&&W.isSelected(b.data))return b;for(var I=b.data;(I=I.getParent())&&I instanceof R.Block&&W.isSelectable(I);){var Y=W.isSelected(I);if(Y&&F)break;if(b={data:I,part:b},Y&&!F)break}return b},handle_contextmenu:function(t){$r(t)},handle_mousewheel:function(z){this.gv.handleScroll(z,z.wheelDelta/40)},handle_DOMMouseScroll:function(s){2===s.axis&&this.gv.handleScroll(s,-s.detail)},handle_keydown:function(N){this.gv.handleKeyDown(N)},handle_mousedown:function(W){this.handle_touchstart(W)},handle_touchstart:function(p){$r(p);var N=this,h=N.gv,f=wn(p),C=N.getDataInfoAt(p),k=C?C.data:z,q=C?C.part:z,X=h.sm(),j=jg(p),c=po(p);h.setFocus(p)&&(N._62O=z,N._57I=z,N.pendingClickThrough=z,N.__lastClientPoint__=sb(p),k?Kb(p)?X.co(k)?X.rs(k):X.as(k):X.co(k)?k instanceof rf&&k.isClickThroughEnabled()&&wn(p)&&(N.pendingClickThrough=sb(p)):X.ss(k):f&&(Kb(p)?h.isRectSelectable()&&(N._62O=_m):N._57I=sb(p)),N._31Q&&(Ih(N._31Q),delete N._31Q,delete N._32Q),N._62O||(h.isFirstPersonMode()&&(Zh(p)||ie(p)||c>2?N._62O="pan":h.isMouseRoamable()||Nd(p)?(N._62O="roaming",N.foward=j&&wn(p),N._32Q=Pc(),N._31Q=dr(N.tick,N)):f||(N._62O="roaming")),N._62O||(f&&j&&cr[q]?(N._62O=q,N.p3=k.p3()):f&&j&&Vm(k)&&h.isSelected(k)?h.isMovable(k)?(N._62O="move",N.p3=k.p3(),N.movedata=k):h._39Q(k)&&(N._62O="none"):Nd(p)&&(c>2?N._62O="pan":2===c&&(N.dist=lo(p),N._62O="pinch")))),N.point=h.lp(p),np(N,p),cm(p)?h.handleDoubleClick(p,k,q):h.handleClick(p,k,q))},tick:function(){var k=this,U=k.gv,O=U._moveStep;k.point&&U.isWalkable()&&(k._32Q&&(O*=(Pc()-k._32Q)/50),U.walk(k.foward?O:-O),k._32Q=Pc(),k._31Q=dr(k.tick,k))},handle_mouseup:function(e){this.handle_touchend(e)},handle_touchend:function(t){var u=this._57I;if(u&&(id(u,sb(t))<=1&&this.gv.sm().cs(),this._57I=z),u=this.pendingClickThrough){if(id(u,sb(t))<=1){var x=this.getDataInfoAt(t);x&&x.data instanceof rf&&x.data.isClickThroughEnabled()&&(x=this.getDataInfoAt(t,!0),x&&(t.clickThrough=!0,this.gv.sm().ss(x.data)))}this.pendingClickThrough=null}},handleWindowMouseMove:function(L){this.handleWindowTouchMove(L)},handleWindowTouchMove:function($){var U,Z,I=this,E=I.gv,e=I._62O,W=I.point,C=E.dm(),J=E.lp($),T=J.x-W.x,p=J.y-W.y,F=E.getWidth(),A=E.getHeight();if(F&&A){var B=sb($),S=os(E,B,I.__lastClientPoint__),V=id({x:0,y:0},S),R=-y*T/F,q=-y*p/A;if("roaming"===e)I.rotate($,R/2,q/2);else if(e===fj||e===No||e===Jb)E._86O||C.beginTransaction(),E.fi({kind:E._86O?"betweenEditRotation":"beginEditRotation",event:$}),E._86O=1,E.sm().each(function(_){if(Vm(_)&&E.isRotationEditable(_)){var X=H(R)>H(q)?R:q;e===fj?_.setRotationX(_.getRotationX()+X):e===No?_.setRotationY(_.getRotationY()+X):e===Jb&&_.setRotationZ(_.getRotationZ()+X)}});else if("move"===e||cr[e]){if(e===Eo||e===gn||e===Uh)E._87O||C.beginTransaction(),E.fi({kind:E._87O?"betweenEditScale":"beginEditScale",event:$}),E._87O=1;else{if(!E._moving){if(V<m.touchMoveThreshold)return;C.beginTransaction()}E.fi({kind:E._moving?"betweenMove":"beginMove",event:$}),E._moving=1}var s,z=I.p3,a=E.getPositionInfo(z),L=Zd(E);s=e===uq?"x":e===gk?"y":e===yn?"z":e===Eo?"sx":e===gn?"sy":e===Uh?"sz":E.getMoveMode($,I.movedata),T=T/F*a.width,p=-1*p/A*a.height;var i,v,g=[L[0]*T,L[4]*T,L[8]*T],M=[L[1]*p,L[5]*p,L[9]*p],t=g[0]+M[0],x=g[1]+M[1],O=g[2]+M[2],X=[z[0]+t,z[1]+x,z[2]+O],Y=fi(E.getEye(),X,!0);if("xyz"===s?(i=X,E.moveSelection(t,x,O)):"xz"===s?(i=yf(E,z,[0,1,0],X),i&&E.moveSelection(i[0]-z[0],0,i[2]-z[2])):"xy"===s?(i=yf(E,z,[0,0,1],X),i&&E.moveSelection(i[0]-z[0],i[1]-z[1],0)):"yz"===s?(i=yf(E,z,[1,0,0],X),i&&E.moveSelection(0,i[1]-z[1],i[2]-z[2])):"x"===s||"sx"===s?(Y[0]=0,i=yf(E,z,Y,X),i&&(v=i[0]-z[0],"x"===s?E.moveSelection(v,0,0):E.sm().each(function(r){Vm(r)&&E.isSizeEditable(r)&&(U=r.getScaleX()+v/100,Z=U/r.getScaleX(),r.setScaleX(U),Zh($)&&(r.setScaleY(r.getScaleY()*Z),r.setScaleTall(r.getScaleTall()*Z)))}))):"y"===s||"sy"===s?(Y[1]=0,i=yf(E,z,Y,X),i&&(v=i[1]-z[1],"y"===s?E.moveSelection(0,v,0):E.sm().each(function(l){Vm(l)&&E.isSizeEditable(l)&&(U=l.getScaleTall()+v/100,Z=U/l.getScaleTall(),l.setScaleTall(U),Zh($)&&(l.setScaleY(l.getScaleY()*Z),l.setScaleX(l.getScaleX()*Z)))}))):("z"===s||"sz"===s)&&(Y[2]=0,i=yf(E,z,Y,X),i&&(v=i[2]-z[2],"z"===s?E.moveSelection(0,0,v):E.sm().each(function(l){Vm(l)&&E.isSizeEditable(l)&&(U=l.getScaleY()+v/100,Z=U/l.getScaleY(),l.setScaleY(U),Zh($)&&(l.setScaleX(l.getScaleX()*Z),l.setScaleTall(l.getScaleTall()*Z)))}))),!i)return;I.p3=i}else if(e===_m){var d=I.div;d||(d=I.div=Kk(),tc(I.getView(),d),d.op=W,d.style.background=E.getRectSelectBackground()),E.fi({kind:E._rectSelecting?"betweenRectSelect":"beginRectSelect",event:$}),E._rectSelecting=1,d.rect=oe(d.op,J),Ln(d,d.rect)}else if("pinch"===e&&2===po($)){E.fi({kind:E._pinching?"betweenPinch":"beginPinch",event:$}),E._pinching=1;var v=lo($);E._lastZoomLP||(E._lastZoomLP=Zg($)),E.handlePinch(v,I.dist),I.dist=v}else"pan"===e||Zh($)||ie($)?I.pan($,T,p):"none"===e||E.isFirstPersonMode()||I.rotate($,R,q);I.point=J}},pan:function(K,L,Z){var r=this.gv;if(r.isPannable()){var v=r.getWidth(),V=r.getHeight();if(!v||!V)return;var u=r.getCenterInfo(),z=L/v*u.width,H=-1*Z/V*u.height;r.fi({kind:r._panning?"betweenPan":"beginPan",event:K}),r._panning=1,r.pan(-z,-H)}},rotate:function(C,e,d){var H=this.gv;H.isRotatable()&&(H.fi({kind:H._rotating?"betweenRotate":"beginRotate",event:C}),H._rotating=1,H.rotate(e,d))},handleWindowMouseUp:function(h){this.handleWindowTouchEnd(h)},handleWindowTouchEnd:function(E){var U=this,n=U.gv,l=n.dm(),c=U.div;if(c){var X=n.getDatasInRect(c.rect);if(!X.isEmpty()){var _=n.sm(),x=_.toSelection();X.each(function(Y){_.co(Y)?x.remove(Y):x.add(Y)}),_.ss(x)}Rd(c)}n._moving&&(delete n._moving,n.fi({kind:"endMove",event:E}),n.onMoveEnded(),l.endTransaction()),n._panning&&(delete n._panning,n.fi({kind:"endPan",event:E}),n.onPanEnded()),n._rotating&&(delete n._rotating,n.fi({kind:"endRotate",event:E}),n.onRotateEnded()),n._86O&&(delete n._86O,n.fi({kind:"endEditRotation",event:E}),l.endTransaction()),n._87O&&(delete n._87O,n.fi({kind:"endEditScale",event:E}),l.endTransaction()),n._pinching&&(delete n._pinching,n.fi({kind:"endPinch",event:E}),n.onPinchEnded()),n._rectSelecting&&(delete n._rectSelecting,n.fi({kind:"endRectSelect",event:E}),n.onRectSelectEnded()),n._walking&&(delete n._walking,n.fi({kind:"endWalk",event:E}),n.onWalkEnded()),n._lastZoomLP=n._lastZoomHit=null,U.dist=U.point=U._62O=U.p3=U.movedata=U.div=U._57I=U.pendingClickThrough=U._32Q=U._31Q=U.foward=z,U.__lastClientPoint__=z}});var re=Ab.MapInteractor=function(T){ac(re,this,[T]),this._keepHorizon=!0,this._threshold=2,this._touchScaleThreshold=.05,this._touchRotateThreshold=.03,this._touchScaleCheckAccuracy=.01,this._panButton="right",this.maxPhi=5*Math.PI/12};bg("MapInteractor",Ge,{handle_contextmenu:function(r){$r(r)},handle_mousewheel:function(z){this.gv.handleScroll(z,z.wheelDelta/40)},handle_DOMMouseScroll:function(Q){2===Q.axis&&this.gv.handleScroll(Q,-Q.detail)},handle_keydown:function(s){this.gv.handleKeyDown(s)},handle_mousedown:function(A){this.handle_touchstart(A)},handle_touchstart:function(g){$r(g);var t=this,P=t.gv;if(P.setFocus(g)){var B=P.getDataInfoAt(g),A=B?B.data:z,l=B?B.part:z,_=t.editing={point:P.lp(g)};Nd(g)?_.touch=!0:(_.touch=!1,_.clickLeft=wn(g),_.pan=ie(g)?!0:"left"===this.panButton===_.clickLeft),A&&P._39Q(A)&&(_.preventDefault=!0),np(t,g),cm(g)?P.handleDoubleClick(g,A,l):P.handleClick(g,A,l)}},handle_mouseup:function(n){this.handle_touchend(n)},handle_touchend:function(){},handleWindowMouseMove:function(V){this.handleWindowTouchMove(V)},handleWindowTouchMove:function(R){var l=this,n=l.gv,o=l.editing;if(o){var K=n.lp(R),N=o.point,B=K.x-N.x,_=K.y-N.y;if(!o.moved){if(Math.abs(B)<l.threshold&&Math.abs(_)<l.threshold&&!(R.touches&&R.touches.length>1))return;o.moved=!0}if(!o.preventDefault)if(o.point=K,o.touch){var s=R.touches.length;if(2!==s)l.pan(R,B,_);else{if(1>=s)return;var k=R.touches,E={x:k[0].clientX,y:k[0].clientY},I={x:k[1].clientX,y:k[1].clientY},J={x:I.x-E.x,y:I.y-E.y},d=o.lastCenter,p=Math.atan2(J.y,J.x),t=o.theta,S=0;t==z?t=o.theta=p:(S=p-t,o.thetaStarted||Math.abs(S)>l.touchRotateThreshold?(o.thetaStarted=!0,o.theta=p):S=0);var i=j*(E.y+I.y)/2/n.getHeight(),x=o.phi,q=0;x==z?x=o.phi=i:(q=i-x,o.phiStarted||Math.abs(q)>l.touchRotateThreshold?(o.phiStarted=!0,o.phi=i):q=0);var W,T=Math.sqrt(J.x*J.x+J.y*J.y),L=o.vlen;if(L){var r=E.x-d.x,A=E.y-d.y,D=I.x-d.x,G=I.y-d.y,u=Math.sqrt(r*r+A*A),Y=Math.sqrt(D*D+G*G),H=L/2,h=l._sign2(u-H),c=l._sign2(Y-H);0>h*c||0===h&&0===c?(W=1,o.vlen=T):(W||(W=T/L),o.scaleStarted||Math.abs(W-1)>l.touchScaleThreshold?(o.vlen=T,o.scaleStarted=!0):W=1)}else L=o.vlen=T,W=1;1!==W&&n.setZoom(W),(q||S)&&l.rotate(R,S,-q),o.lastCenter={x:(I.x+E.x)/2,y:(I.y+E.y)/2}}}else if(o.pan)l.pan(R,B,_);else{var g=n.getWidth(),$=n.getHeight();if(!g||!$)return;var U=-y*B/g,b=-y*_/$;l.rotate(R,U,b)}}},_sign2:function(y){return Math.abs(y)<this._touchScaleCheckAccuracy?0:y>0?1:-1},handleWindowMouseUp:function(l){this.handleWindowTouchEnd(l)},handleWindowTouchEnd:function(g){var B=this,t=B.editing;if(B.editing=null,t){var j=B.gv;if(t.moved||!t.clickLeft&&!t.touch)j._panning=null,j._rotating=null,j.fi({kind:t.pan?"endPan":"endRotate",event:g});else{var M=j.getDataAt(g);M?j.sm().setSelection([M]):j.sm().clearSelection()}}},pan:function($,H,U){var Z=this,i=Z.gv;if(i.isPannable()){var w=i.getWidth(),h=i.getHeight();if(w&&h){var K=i.getCenterInfo(),n=-H/w*K.width,y=1*U/h*K.height;i.fi({kind:i._panning?"betweenPan":"beginPan",event:$}),i._panning=1;var l=Z.keepHorizon,B=Z.editing.touch;if((B&&$.touches&&$.touches.length>1||!B&&Zh($))&&(l=!l),!l)return i.pan(n,y);if(n||y){var V=Zd(i),c=[V[0]*n,V[4]*n,V[8]*n],m=[V[1],0,V[9]],q=Math.sqrt(m[0]*m[0]+m[2]*m[2]);q&&(m=[m[0]/q*y,0,m[2]/q*y]);var b=c[0]+m[0],j=c[1]+m[1],M=c[2]+m[2],r=i._center,e=i._eye;r[0]+=b,r[1]+=j,r[2]+=M,e[0]+=b,e[1]+=j,e[2]+=M,i.fp(Aj,z,e),i.fp(sj,z,r)}}}},rotate:function(v,d,e){var z=this,$=z.gv;if($.isRotatable()){var K=$._center,c=$._eye,s=fi(c,K),U=C(N(s[0]*s[0]+s[2]*s[2]),s[1]),t=Bn(U+e);e=t-U,$.fi({kind:$._rotating?"betweenRotate":"beginRotate",event:v}),$._rotating=1,$.rotate(d,e)}}}),U.defineProperties(re.prototype,{panButton:{get:function(){return this._panButton},set:function(T){this._panButton=T}},minPhi:{get:function(){return m.graph3dViewMinPhi},set:function(k){m.graph3dViewMinPhi=k}},maxPhi:{get:function(){return m.graph3dViewMaxPhi},set:function(h){m.graph3dViewMaxPhi=h}},keepHorizon:{get:function(){return this._keepHorizon},set:function(h){this._keepHorizon=h}},threshold:{get:function(){return this._threshold},set:function(o){this._threshold=o}},touchScaleThreshold:{get:function(){return this._touchScaleThreshold},set:function(X){this._touchScaleThreshold=X}},touchRotateThreshold:{get:function(){return this._touchRotateThreshold},set:function(I){this._touchRotateThreshold=I}}});var $d,Al="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAEyUlEQVRYR62XW0xcVRSG/58cmIG2HmstE9N4SX2xtVqBCISoFS/RmDSpKQSvTWNixUStQSqVyBQYJUGttrQVtYkPatuQPmhivMUHqbUBZ2itl1qjTzZpImNUZhDLsUeWWXgOOd2cgcGyk3mYs/de69trr70uxP8YIlJKMi0i9wIgyf0iEiM5PFdxzGeDiBQAuB7AjQBuALCN5NcGQDmANgBfeL8UyYnZ5M8KICJ3AXgAwAlfOMl/VHAQwPtveYAKuQLA2yQ/ngliRgAR2QogA2AvSdcUZAIE50VEYR4BsIDkC7kgQgFE5GIAuwDsJnkk1+aZAPw9IqLX1gjgcZK/m7KmAXjK4wBaSf4ZplxEIgCuA3Cz3gSAfgDHSf6dY/0FAJ4D0G5ChAEcAPBwmHIRqXNd90nLsiocx/k+k8n8oK/Atu2rIpHIStd1v7QsawfJd0Ouywawh6T609Q4B8C788NhZnddt29sbGxBd3f39q6urtNhJ43H48uam5u3lJSUjFiWdV8IxE0Aqki+6M9NAXjefjnJXsOZogBGBgYGttbU1Hw427PS+cHBwbVVVVUJAItJOoa8xwD8RPIT/T4J4L3zfQAeNL1dRMZra2ur+/v7/8pHub+mvr7+wr6+vs8KCgoWGABFAN4EsEHjhA9QBeA2ks8HF6vZk8nkQL4nNwGTyeTa8vLycsuy7jcg1Mk/IpnyAZoBaOQ6FHg+ddlsdqNt201zObm5NpvN7ly0aNHrJN8LyL4FwGqSr/gAOrnej3C60HXdw/F4PJ7L4fKFSiQSl7W0tLQVFRWtCQDoNRwguZ6aWABcorE9sEDf+QjJ1fkqmmmdiHwHoCToXyKiceR0rkhY5TjOq9FoVLPdeY/x8fG+SCSySe/cFKYWCFOyPJ1Or4zFYh3nrR3A8PBwe2lp6TcAfg4DmBYwAFyRTqdXxWKx9nkE+DYUIEyBiFQ6jvNaNBq9Zz4AZruCGIBlJI8ZXpolee18AORwwgoAp/xnqMmjPuilZ8+ePZRIJNo7OztD436+YB0dHZe2trY+W1hYWGsccD/JOh/gKQBHSWpanRwicnc2m91k2/bmfJWFrRsdHd29cOHCXSTfD8i+FcA1JHcEQ/HtJDVnTw3XdfcPDQ0dra6unto8F5hUKrWurKxslWVZG4L7RGQbgA9IDgWT0VsANprJaGJi4kxDQ8OagwcPjsxFeWNj49Le3l6N91qMTA2vmNnr6fovGXkmvxPAlST3hGz4LZVKbausrMzLEnryioqKNpJLzCpJRJ4AcJLkp6rHLEieBjBA8rB5Wtd1942NjS3p6el5qa2t7VSYNdThmpqaWoqLi38xze4dUku4CpLb/f1hJZnWBY+SzJpKRGSdV5LVOI5zIpPJnNQ1tm2viEQiV7uue8SyrJeDDhew8GIAO0me4w9hABdp8ahNBkktyacNr+Qu84pSndfX81VY6e6dXJV3AoiT/CMoMFcyUogeAG+Q/DyX8+VZlqvZHwKw2VQ+zQdCTL4FwBkPZFrJPUtjoildG5PC4J2bOvJpze7QWhHAj4HWbBImpDXTQsPvH5cDeMf39lxWnBXAU6TNqcZu7fn0lyB53GhOdf6ZQHN6bF6a0xxOuJTkrwbA5LdcJ831/V8SOUYQxYGhRwAAAABJRU5ErkJggg==",Jg=32,Sb=Ab.GlobeInteractor=function(j,_){ac(Sb,this,[j]);var Q,h=_.radius||6378137,F=this,D=null;$d||($d=Kk(),$d.style.border="",$d.style.backgroundImage="url("+Al+")");var b=new Kn,W=new Ki,M=new Ki,o=new Ki,P=new vh,Y="number"==typeof h?{x:h,y:h,z:h}:h,k={center:new Ki(0,0,0),radius:Y},r=function(X){j._81O=null;var e=j.getHitPosition(X,j.getCenter(),W.copy(j.getEye()).sub(M.copy(j.getCenter())).toArray());return P.origin.copy(j.getEye()),P.direction.copy(e).sub(P.origin).normalize(),P.intersectEllipsoid(k)},G=function(d,R){j._81O=null,P.origin.copy(j.getEye());for(var N,$,a=j.getCenter(),S=W.copy(j.getEye()).sub(M.copy(j.getCenter())).toArray(),T=1,E=16,C=0,K=1,l={x:0,y:0};E--;){if(l.x=R.x+(d.x-R.x)*T,l.y=R.y+(d.y-R.y)*T,N=j.getHitPosition(l,a,S),P.direction.copy(N).sub(P.origin).normalize(),$=P.intersectEllipsoid(k),$&&1===T)return{hit:$};$?C=T:K=T,T=(C+K)/2}return{hit:$,out:1>T}},V=function(I,i){if(D){var s=Date.now();D.deltaTime=D.lastTime?s-D.lastTime:1e3,D.lastTime=s,D.lastAxis=I,D.lastAngle=i}i&&(b.setFromAxisAngle(I,i),j.setEye(W.copy(j.getEye()).applyQuaternion(b).toArray()),j.setCenter(W.copy(j.getCenter()).applyQuaternion(b).toArray()),j.setUp(W.copy(j.getUp()).applyQuaternion(b).toArray()))};F._showCrossIcon=function(e){tc(F.getView(),$d),Ln($d,{x:e.clientX-Jg/2,y:e.clientY-Jg/2,width:Jg,height:Jg})},F._hideCrossIcon=function(){Rd($d)},F._scrollImpl=function(H,z){D={point:j.lp(H),screen:sb(H),hit:r(H),type:"right"},D.hitNormalize=D.hit?D.hit.clone().normalize():new Ki;var u={clientX:D.screen.x,clientY:D.screen.y+10*z};F._handleMoveImpl(u),F._endMoveImpl(u)},F._startMoveImpl=function(d){Q&&(Q.stop(!0),Q=null),D={point:j.lp(d),screen:sb(d),hit:r(d)},D.hitNormalize=D.hit?D.hit.clone().normalize():new Ki,Nd(d)?1===d.touches.length?D.hit&&(D.type="left"):2===d.touches.length&&(D.type="touch2"):(wn(d)?D.hit&&(D.type="left"):qg(d)?D.type="right":ie(d)&&D.hit&&(D.type="middle"),!D.hit||"right"!==D.type&&"middle"!==D.type||F._showCrossIcon(d)),D.type&&np(F,d)},F._handleMoveImpl=function(M){if(D)switch(D.type){case"left":return F._handleLeft(M);case"right":return F._handleRight(M);case"middle":return F._handleMiddle(M);case"touch2":return F._handleTouch2(M)}},F._endMoveImpl=function(){if(D){if(this._hideCrossIcon(),"left"===D.type||"middle"===D.type){var R=1e3*(D.lastAngle/(D.deltaTime||30)),B=D.lastAxis,s=D.lastTime,I=function(){var L=Date.now(),O=(L-s)/1e3;return s=L,R*=Math.pow(Math.abs(F.decelerationRate),3*O),Math.abs(R)<.01?(R=0,Q&&Q.stop(),void 0):(V(B,R*O),void 0)};Q=Ib({action:function(){I(arguments)},duration:5e3})}D=null}},F._handleLeft=function(Z){if(!D.finished){var t=sb(Z),j=G(t,D.lastScreen||D.screen);if(D.lastScreen=t,!j.hit)return D.finished=!0,F._endMoveImpl(Z),void 0;var g=j.hit;g.normalize();var p=D.hitNormalize,i=Math.acos(g.dot(p)),U=g.cross(p).normalize();V(U,i),j.out&&(D.finished=!0,F._endMoveImpl(Z))}},F._handleRight=function(e){var Q=D.lastScreen||D.screen,U=Q.y;Q=D.lastScreen=sb(e);var R=Q.y,B=R-U;if(B){var a=Math.min(.5,B*F.scaleSpeed);W.copy(j.getEye());var c=D.hit;c||(c=W.clone().divide(Y).normalize().multiply(Y)),M.copy(W).lerp(c,a),j.setEye(M.toArray()),W.copy(j.getUp()),M.normalize();var p=W.clone().cross(M).normalize();if(o.copy(j.getCenter()),o.sub(p.multiplyScalar(o.dot(p))),j.setCenter(o.toArray()),D.hit){var E=r(D.screen),K=D.hitNormalize;if(E){E.normalize();var q=Math.acos(E.dot(K)),L=E.cross(K).normalize();q&&V(L,q)}}}};var Z=function(h){return Math.abs(h)<.01?0:h>0?1:-1};F._handleTouch2=function(G){var S=G.touches.length;if(2===S){var W=G.touches,k={x:W[0].clientX,y:W[0].clientY},t={x:W[1].clientX,y:W[1].clientY},I={x:t.x-k.x,y:t.y-k.y},T=D.lastCenter,P=Math.atan2(I.y,I.x),g=D.theta,R=0;g==z?g=D.theta=P:(R=P-g,D.thetaStarted||Math.abs(R)>.03?(D.thetaStarted=!0,D.theta=P):R=0);var n,p=Math.sqrt(I.x*I.x+I.y*I.y),d=D.vlen;if(d){var q=k.x-T.x,o=k.y-T.y,i=t.x-T.x,H=t.y-T.y,A=Math.sqrt(q*q+o*o),b=Math.sqrt(i*i+H*H),B=d/2,X=Z(A-B),u=Z(b-B);0>X*u||0===X&&0===u?(n=1,D.vlen=p):(n||(n=p/d),D.scaleStarted||Math.abs(n-1)>.05?(D.vlen=p,D.scaleStarted=!0):n=1)}else d=D.vlen=p,n=1;var I=M.copy(j.getEye()).clone();1!==n&&j.setEye(I.setLength((I.length()-h)/n+h).toArray()),R&&V(I.normalize(),R),D.lastCenter={x:(t.x+k.x)/2,y:(t.y+k.y)/2}}},F._handleMiddle=function(K){var c=sb(K),Q=D.screen;D.screen=c;var x=(c.y-Q.y)/180*Math.PI*F.rollSpeed;M.copy(j.getCenter()).sub(W.copy(j.getEye())).normalize(),W.copy(j.getUp()).cross(M).normalize(),M.copy(j.getEye()).sub(D.hit).applyAxisAngle(W,x).add(D.hit);var s=M.clone();M.copy(j.getCenter()).sub(D.hit).applyAxisAngle(W,x).add(D.hit);var S=M.clone(),I=M.copy(j.getUp()).applyAxisAngle(W,x).clone(),Y=!1;x>0&&(o.copy(I),M.copy(S).sub(s).normalize(),W.copy(s).multiplyScalar(-1).normalize(),W.dot(o)-M.dot(o)>0&&(Y=!0)),Y||o.copy(D.hit).sub(s).dot(D.hitNormalize)>=0&&(Y=!0),Y||(j.setEye(s.toArray()),j.setCenter(S.toArray()),j.setUp(I.toArray()));var X=-(c.x-Q.x)/180*Math.PI*F.rotateSpeed;V(D.hitNormalize,X)}};bg("GlobeInteractor",Ge,{handle_contextmenu:function(X){$r(X)},handle_mousewheel:function(r){this._scrollImpl(r,r.wheelDelta/40)},handle_DOMMouseScroll:function(n){2===n.axis&&this._scrollImpl(n,-n.detail)},handle_keydown:function(_){this.gv.handleKeyDown(_)},handle_mousedown:function(u){this.handle_touchstart(u)},handle_touchstart:function(A){$r(A);var N=this.gv;if(N.setFocus(A)){var b=N.getDataInfoAt(A),B=b?b.data:z;B&&N.isInteractive(B)||this._startMoveImpl(A);var j=b?b.part:z;cm(A)?N.handleDoubleClick(A,B,j):N.handleClick(A,B,j)}},handle_mouseup:function(R){this.handle_touchend(R)},handle_touchend:function(){},handleWindowMouseMove:function(j){this.handleWindowTouchMove(j)},handleWindowTouchMove:function(r){this._handleMoveImpl(r)},handleWindowMouseUp:function(P){this.handleWindowTouchEnd(P)},handleWindowTouchEnd:function(v){this._endMoveImpl(v)}}),U.defineProperties(Sb.prototype,{rotateSpeed:{get:function(){return this._rotateSpeed||.3},set:function(m){this._rotateSpeed=m}},rollSpeed:{get:function(){return this._rollSpeed||.1},set:function(k){this._rollSpeed=k}},scaleSpeed:{get:function(){return this._scaleSpeed||.002},set:function(P){this._scaleSpeed=P}},decelerationRate:{get:function(){return this._decelerationRate||.04},set:function(v){this._decelerationRate=v}}});var pe=function(J){var v=2147483648|J;return[(255&v>>16)/255,(255&v>>8)/255,(255&v)/255,(255&v>>24)/255]},Vd=function(j){this.gv=j,this.gv.pickColorMap={_pickIdUsed:1e3}};Ad(Vd,U,{_iv:!0,iv:function(){this._iv=!0},get:function(P,u){this.validate();var t=this,y=t.gv.getGL();if(!y)return z;var U,Q,$=t._resolution,I=Math.round(P.x*$),R=Math.ceil(P.width*$),W=Math.ceil(P.height*$),m=t.height-Math.round(P.y*$)-W,l=h(R/2),b=new Uint8Array(4*R*W),e=0,V=b.length,Z=u?z:new df,_=u?z:{};if(jq(y,t.frame),y.readPixels(I,m,R,W,y.RGBA,y.UNSIGNED_BYTE,b),Hc(y),u){for(;l>=e;e++)for(var o=l-e,X=l+e,j=o;X>=j;j++)for(var c=o;X>=c;c++)if((j===o||j===X||c===o||c===X)&&(U=t.info(b,4*(j*R+c))))return U}else for(;V>e;e+=4)U=t.info(b,e),U&&(Q=U.data,_[Q._id]||(Z.add(Q),_[Q._id]=Q));return Z},info:function(S,p){return this.gv.pickColorMap[(S[p]<<16)+(S[p+1]<<8)+S[p+2]+((127&S[p+3])<<24)]},getResolution:function(){return this._resolution},onContextLost:function(){this.texture=null,this.width=this.height=-1},validate:function(){var H=this,J=H.gv,v=J.getGL();if(v){var y=H._resolution=J._pickerResolution*J.getDevicePixelRatio(),X=Math.round(y*J.getWidth()),s=Math.round(y*J.getHeight()),u=v.RGBA,S=v.TEXTURE_2D,x=v.RENDERBUFFER,M=v.FRAMEBUFFER;
if(H.texture||(H.texture=Fj(v),H.render=v.createRenderbuffer(),H.frame=v.createFramebuffer()),(H.width!==X||H.height!==s)&&(v.activeTexture(v.TEXTURE0),xp(v,H.texture),v.texImage2D(S,0,u,X,s,0,u,v.UNSIGNED_BYTE,z),je(v,v.TEXTURE_MIN_FILTER,v.LINEAR),v.bindRenderbuffer(x,H.render),v.renderbufferStorage(x,v.DEPTH_COMPONENT16,X,s),jq(v,H.frame),v.framebufferTexture2D(M,v.COLOR_ATTACHMENT0,S,H.texture,0),v.framebufferRenderbuffer(M,v.DEPTH_ATTACHMENT,x,H.render),xp(v,z),v.bindRenderbuffer(x,z),Hc(v),H.width=X,H.height=s),H._iv){H._iv=!1;var k=!1;J._40Q.each(function(X){!k&&X.isBatchInvalid()&&(k=!0)}),k&&J.updateScene(),jq(v,H.frame),v.clear(v.COLOR_BUFFER_BIT),J.overlappingBox.clear(),J.setViewport(v,0,0,X,s),J.renderPickScene(),Hc(v)}}}});var Uc=function(L){this.gv=L};Ad(Uc,U,{gap:0,size:0,_42:function(o,m){var e=this,$=e.gv,v=$._gridGap,b=$._gridSize;if($._gridVisible){if(e.gap!==v||e.size!==b){for(var i=[],F=$._gridSize/2,k=v*F,w=0;2*F+1>w;w++){var I=6*w,B=6*(2*F+1)+I;i[I]=-k,i[I+1]=0,i[I+2]=-k+w*v,i[I+3]=k,i[I+4]=0,i[I+5]=-k+w*v,i[B]=-k+w*v,i[B+1]=0,i[B+2]=-k,i[B+3]=-k+w*v,i[B+4]=0,i[B+5]=k}e.vs=new Gg(i),e.gap=v,e.size=b}Ld($),qq(o,m),jp(o),cc(o,m,1,$._gridColor,$._buffer.vs,e.vs),Yi(o,0,e.vs.length/3,o.LINES),Dc(o),ch(o,m)}else e.vs=e.gap=e.size=z}});var ho=function(c){this.gv=c};Ad(ho,U,{_42:function(Q,c){var e=this.gv,V=e._buffer.vs,O=e._axisXColor,a=e._axisYColor,f=e._axisZColor,D=e._originAxisVisible,i=e._centerAxisVisible;if(D||i){var t=Nb?Q.TRIANGLES:Q.TRIANGLE_FAN,F=Q.LINES;if(Ld(e),qq(Q,c),jp(Q),D){var B=e.getCenterInfo(),$=g(B.width,B.height)/5,m=.8*$,X=.05*$;cc(Q,c,1.5,O,V,new Gg([0,0,0,$,0,0,m,X,0,m,0,X,m,-X,0,m,0,-X,m,X,0,0,0,0,0,$,0,X,m,0,0,m,X,-X,m,0,0,m,-X,X,m,0,0,0,0,0,0,$,X,0,m,0,X,m,-X,0,m,0,-X,m,X,0,m])),Yi(Q,0,2,F),Yi(Q,1,6,t),cc(Q,c,z,a),Yi(Q,7,2,F),Yi(Q,8,6,t),cc(Q,c,z,f),Yi(Q,14,2,F),Yi(Q,15,6,t)}if(i){var S=e._center,j=S[0],x=S[1],w=S[2],B=e.getPositionInfo(S);$=g(B.width,B.height)/20,cc(Q,c,1.5,O,V,new Gg([j,x,w,j+$,x,w,j,x,w,j,x+$,w,j,x,w,j,x,w+$])),Yi(Q,0,2,F),cc(Q,c,z,a),Yi(Q,2,2,F),cc(Q,c,z,f),Yi(Q,4,2,F)}Dc(Q),ch(Q,c)}}});var Zo=function(a){this.gv=a,this.onMouseOver=this.onMouseOver.bind(this),this.mode=Zo.Mode.Style,this.color=x,this.width=x};Zo.Mode={Disable:0,Selection:1,MouseOver:2,Style:3},Ad(Zo,U,{onMouseOver:function(o){m.preventDefault(o);var I=this.gv.getDataAt(o);I!==this.mouseOverData&&(this.mouseOverData=I,this.gv.iv())},setFetchTargetFunc:function(b){this.fetchTargetFunc=b},_42:function(O,x){var h,H,i=this,c=i._mode,n=i.gv;if(!O._renderInfo.reflectDepth&&c!==Zo.Mode.Disable){if(c===Zo.Mode.Selection?h=n.sm().getSelection().toArray(function(T){return T.s("highlight.visible")}):c===Zo.Mode.MouseOver&&i.mouseOverData&&i.mouseOverData.s("highlight.visible")&&(h=[i.mouseOverData]),i.fetchTargetFunc&&(h=i.fetchTargetFunc(h)),c===Zo.Mode.Style)h=h||[],H=function(p){if(h.indexOf(p)>=0)return!1;var E=n.getDataHighlightMode(p);return E===!1?!0:E===!0?!1:"selected"===E?n.isSelected(p)?!1:!0:"hover"===E?p===i.mouseOverData?!1:!0:!0};else{if(!h||!h.length)return;H=function(r){return h.indexOf(r)<0?!0:void 0}}var n=i.gv,e=n.vr.isPresenting(),I=n.getWidth();if(e){var o=n.getWidth;I/=2,n.getWidth=function(){return I};var y=n.getViewport()}var L,u=n.getDevicePixelRatio(),Y=I*u,N=n.getHeight()*u;(L=i._renderTarget)?L.setSize(O,Y,N):i._renderTarget=L=new Ab.RenderTarget(n,O,Y,N),jq(O,L.frame),O.clear(O.COLOR_BUFFER_BIT),n.setViewport(O,0,0,Y,N);var M=[];h.forEach(function(m){var A=m.getRenderLayer();M.indexOf(A)<0&&M.push(A)}),n.drawFilter=H,n.renderPickScene(),n.drawFilter=null,Hc(O),Nb&&br(O,x.aPosition),br(O,x.aNormal),e&&(n.getWidth=o,n.setViewport(O,y[0],y[1],y[2],y[3]));var P=O._compiledShader.highlight;P||(P=O._compiledShader.highlight=new Rq.Shader(O,Fn.vs,Fn.fs)),P.bind();var W=$c.for(O),U=W.directState();U.blend.enabled=!0,O.activeTexture(O.TEXTURE0+0),O.bindTexture(O.TEXTURE_2D,L.texture),P.uniforms.image=0,P.uniforms.textureSize=[Y,N],P.uniforms.edgeWidth=n.getHighlightWidth();var Q=n.getHighlightColor();if(i._lastHighlightColor!==Q){var K=wc(i._lastHighlightColor=Q);i._highlightColorData=[K[0]/255,K[1]/255,K[2]/255,K[3]/255]}P.uniforms.edgeColor=i._highlightColorData,i.ibuffer?(i.ibuffer.upload(),i.vbuffer.upload()):(i.ibuffer=Rq.Buffer.createIndexBuffer(O,new Uint16Array([0,2,1,1,2,3])),i.vbuffer=Rq.Buffer.createVertexBuffer(O,new Float32Array([0,0,1,0,0,1,1,1]))),P.attributes.pos.pointer(i.vbuffer),O.drawElements(O.TRIANGLES,6,O.UNSIGNED_SHORT,0),U.blend.enabled=!1,O.bindTexture(O.TEXTURE_2D,null),O.useProgram(x),Nb&&fq(O,x.aPosition)}}}),U.defineProperties(Zo.prototype,{mode:{get:function(){return this._mode},set:function(t){var F=this._mode;t!==F&&(this._mode=t,t===Zo.Mode.MouseOver||t===Zo.Mode.Style?n(this.gv.getView(),"mousemove",this.onMouseOver):(F===Zo.Mode.MouseOver||F===Zo.Mode.Style)&&I(this.gv.getView(),"mousemove",this.onMouseOver))}}});var Fn={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D image;","uniform vec2 textureSize;","uniform float edgeWidth;","uniform vec4 edgeColor;","varying vec2 vUv;","float getCol(vec2 coord) {","return texture2D(image, coord).a;","}","void main() {","vec2 cc = vUv;","float center = getCol(cc);","float dx = edgeWidth / textureSize.x;","float dy = edgeWidth / textureSize.y;","vec2 coord;","float topLeft = getCol(cc+vec2(-dx, -dy));","float top = getCol(cc+vec2(0.0, -dy));","float topRight = getCol(cc+vec2(dx, -dy));","float left = getCol(cc+vec2(-dx, 0.0));","float right = getCol(cc+vec2(dx, 0.0));","float bottomLeft = getCol(cc+vec2(-dx, dy));","float bottom = getCol(cc+vec2(0.0, dy));","float bottomRight = getCol(cc+vec2(dx, dy));","float v = -topLeft-2.0*top-topRight+bottomLeft+2.0*bottom+bottomRight;","float h = -bottomLeft-2.0*left-topLeft+bottomRight+2.0*right+topRight;","float edge = sqrt(h * h + v * v);","edge = smoothstep(0.9, 1.0, edge);","if (edge < 0.5) {","discard;","}","gl_FragColor = edgeColor;","}"].join("\n")},he=function(c){this.gv=c},uq="edit_tx",gk="edit_ty",yn="edit_tz",fj="edit_rx",No="edit_ry",Jb="edit_rz",Eo="edit_sx",gn="edit_sy",Uh="edit_sz",cr={};cr[uq]=101,cr[gk]=102,cr[yn]=103,cr[fj]=104,cr[No]=105,cr[Jb]=106,cr[Eo]=107,cr[gn]=108,cr[Uh]=109,Ad(he,U,{_42:function(R,s,J){var C=this,N=C.gv,r=N.sm().ld();if(r&&N.isEditable(r)&&!N.isEditHelperDisabled()&&Vm(r)&&(!N.isFirstPersonMode()||!N.isMouseRoamable()&&!vd)){Ld(N);var i,x,M=N.isMovable(r),u=N.isRotationEditable(r),H=N.isSizeEditable(r),Y=N._axisXColor,n=N._axisYColor,q=N._axisZColor,S=N._editSizeColor,A=r.p3(),V=id(N.getEye(),A)/10,F=V/(J?5:10),d=.7*V,K=.4*d,Q=A[0],f=A[1],b=A[2];i=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],M&&C._17O(R,s,r,J,uq,Y,i,[Q,f-F,b,Q+d,f-F,b,Q+d,f,b,Q+d,f,b,Q,f,b,Q,f-F,b,Q,f-F,b+F,Q+d,f-F,b+F,Q+d,f-F,b,Q+d,f-F,b,Q,f-F,b,Q,f-F,b+F]),x=Q+d,H&&C._17O(R,s,r,J,Eo,S,i,[x,f-F,b,x+K,f-F,b,x+K,f,b,x+K,f,b,x,f,b,x,f-F,b,x,f-F,b+F,x+K,f-F,b+F,x+K,f-F,b,x+K,f-F,b,x,f-F,b,x,f-F,b+F]),x+=K,u&&C._17O(R,s,r,J,fj,Y,i,[x,f-F,b,x+K,f-F,b,x+K,f,b,x+K,f,b,x,f,b,x,f-F,b,x,f-F,b+F,x+K,f-F,b+F,x+K,f-F,b,x+K,f-F,b,x,f-F,b,x,f-F,b+F]),i=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0],M&&C._17O(R,s,r,J,gk,n,i,[Q,f,b,Q,f+d,b,Q-F,f+d,b,Q-F,f+d,b,Q-F,f,b,Q,f,b,Q,f,b,Q,f,b-F,Q,f+d,b-F,Q,f+d,b-F,Q,f+d,b,Q,f,b]),x=f+d,H&&C._17O(R,s,r,J,gn,S,i,[Q,x,b,Q,x+K,b,Q-F,x+K,b,Q-F,x+K,b,Q-F,x,b,Q,x,b,Q,x,b,Q,x,b-F,Q,x+K,b-F,Q,x+K,b-F,Q,x+K,b,Q,x,b]),x+=K,u&&C._17O(R,s,r,J,No,n,i,[Q,x,b,Q,x+K,b,Q-F,x+K,b,Q-F,x+K,b,Q-F,x,b,Q,x,b,Q,x,b,Q,x,b-F,Q,x+K,b-F,Q,x+K,b-F,Q,x+K,b,Q,x,b]),i=[1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],M&&C._17O(R,s,r,J,yn,q,i,[Q,f,b,Q,f,b+d,Q,f-F,b+d,Q,f-F,b+d,Q,f-F,b,Q,f,b,Q,f-F,b,Q-F,f-F,b,Q-F,f-F,b+d,Q-F,f-F,b+d,Q,f-F,b+d,Q,f-F,b]),x=b+d,H&&C._17O(R,s,r,J,Uh,S,i,[Q,f,x,Q,f,x+K,Q,f-F,x+K,Q,f-F,x+K,Q,f-F,x,Q,f,x,Q,f-F,x,Q-F,f-F,x,Q-F,f-F,x+K,Q-F,f-F,x+K,Q,f-F,x+K,Q,f-F,x]),x+=K,u&&C._17O(R,s,r,J,Jb,q,i,[Q,f,x,Q,f,x+K,Q,f-F,x+K,Q,f-F,x+K,Q,f-F,x,Q,f,x,Q,f-F,x,Q-F,f-F,x,Q-F,f-F,x+K,Q-F,f-F,x+K,Q,f-F,x+K,Q,f-F,x])}},_17O:function(s,r,T,E,y,A,M,K){var d=this.gv,F=d._buffer,i=$c.for(s),C=i.directUniforms(),W=i.directAttribs();if(d._picking){E=d.pickColorMap;var $=cr[y];E[$]={data:T,part:y},C.uFixPickReverseColor=pe($)}Le(s,r,z,!0,z,!0,z,!1),C.uDiffuse=A,W.aPosition=Pg(s,F.vs,new Gg(K),z),W.aNormal=Pg(s,F.ns,new Gg(M),z),jp(s),Yi(s,0,12),Dc(s),af(s,r)}});var Xr=R.Raycaster=function(L){this.gv=L,this.maxTriangleTest=1/0,this.backfaceCulling=!0};Wp("Raycaster",U,{intersect:function(D){var I=this,v=I.gv,X=v.getDataAt(D);return X?I.intersectObject(D,X):null},intersectObjects:function(K,b,_){var D,c,J,o,t=this,i=1/0,A=K.origin||(new Ki).fromArray(t.gv.getEye()),l=t.maxTriangleTest,r=[];return b.forEach(function($){_&&_($)===!1||$.s("intersect")!==!1&&r.push($)}),r.sort(function(w,g){return A.distanceToSquared2(w.p3())-A.distanceToSquared2(g.p3())}),t.countTriangles=0,r.forEach(function(f){t.countTriangles>l||(D=t.intersectObject(K,f),D&&(c=A.distanceToSquared(D.world),i>c&&(J=f,o=D,i=c)))}),t.countTriangles=0,{data:J,intersect:o}},intersectObject:function(B,I){if(B instanceof vh)return this._intersectObjectImpl(B,I);var y=this,Y=y.gv,p=Y.unproject(B),h=new Ki,A=Y.getEye(),W=new Ki;if(Y.isOrtho()){var P=new Ki(A);W.copy(Y.getCenter()).sub(P).normalize();var u=h.copy(p).sub(P).dot(W);h.copy(W).setLength(-u).add(P.copy(p))}else h.copy(A),W.copy(p).sub(h).normalize();var k=new R.Math.Ray(h,W);return y._intersectObjectImpl(k,I)},_intersectObjectImpl:function(){function m(){var E=new Ki;return E.subVectors(V,i),q.subVectors(s,i),E.cross(q).normalize(),E}function H(K,T,l,j,Y,J,i){return sk.barycoordFromPoint(K,T,l,j,z),Y.multiplyScalar(z.x),J.multiplyScalar(z.y),i.multiplyScalar(z.z),Y.add(J).add(i),Y.clone()}function r(F,B,p){Mf(F)?F.forEach(function(I){r(I,B,p)}):yk(F)?r(Dg(B,F),B,p):Vc(F)?F.shape3d?r(F.shape3d,B,p):p.push(F):p.push(F)}var v=new Tl,k=new Tl,e=new vh,t=new Ki,M=new Ki,d=new Ki,L=new Ki,F=new Ki,s=new Ki,i=new Ki,V=new Ki,A=new lm,S=new lm,f=new lm,q=new Ki,K={vs:oq,is:Zq,uv:wg},z=new Ki,Z=Ak.slice(0);return Z.push("csg"),function(N,w){var h=this.gv.getData3dUI(w),O=w.mat||h.mat;O?v.fromArray(O):v.identity(),k.getInverse(v),e.copy(N).applyMatrix4(k);var g,y,U,Y="body",b=h.shapeModel;if(b||(b=Dg(h)),b||(R.CSGNode&&w instanceof R.CSGNode||R.CSGShape&&w instanceof R.CSGShape?(U=!0,b=[h.left,h.front,h.right,h.back,h.top,h.bottom,h.csg]):w instanceof R.Node&&!(w instanceof R.Shape)?(g=!0,b=K):(y=!0,b=[h.left,h.front,h.right,h.back,h.top,h.bottom])),!b)return console.log("Can not find shape model."),null;Mf(b)||(b=[b]);var B,X,z,u,n,T,j,p,C,$,c,D,q,Q,l,x,o=1/0,_=["","top_","bottom_"],E=!1,W=this.backfaceCulling,J=[];for(r(b,h,J),B=0,X=J.length;X>B;B++)if(q=J[B])for(z=0,u=_.length;u>z;z++)if(Q=_[z],j=q[Q+"vs"],p=q[Q+"is"],C=q[Q+"uv"]||q[Q+"tuv"],j){if(l=q[Q+"boundingBox"]){var c=e.intersectBox(l);if(!c)continue;if(e.origin.distanceTo(c)>o)continue;x=!1}else q[Q+"boundingBox"]=l=new R.Math.Box3,x=!0;for(n=0,T=p?p.length:j.length/3;T>n;n+=3)this.countTriangles++,p?(M.fromArray(j,3*p[n]),d.fromArray(j,3*p[n+1]),L.fromArray(j,3*p[n+2])):(M.fromArray(j,3*n),d.fromArray(j,3*(n+1)),L.fromArray(j,3*(n+2))),x&&(l.expandByPoint(M),l.expandByPoint(d),l.expandByPoint(L)),$=e.intersectTriangle(M,d,L,W,t),$&&(D=e.origin.distanceTo($),o>D&&(o=D,F.copy($),s.copy(M),i.copy(d),V.copy(L),""!==Q?Y=Q.slice(0,-1):g?Y=Ak[Math.floor(n/6)]:y?Y=Ak[B]:U&&(Y=Z[B]),C&&(E=!0,p?(A.fromArray(C,2*p[n]),S.fromArray(C,2*p[n+1]),f.fromArray(C,2*p[n+2])):(A.fromArray(C,2*n),S.fromArray(C,2*(n+1)),f.fromArray(C,2*(n+2))))))}if(!isFinite(o))return null;var a,I=F.clone().applyMatrix4(v);E&&(a=H(F,s,i,V,A,S,f));var G=m(s,i,V),P=m(s.applyMatrix4(v),i.applyMatrix4(v),V.applyMatrix4(v)),cn=e.direction.dot(G);return cn>0&&(G.multiplyScalar(-1),P.multiplyScalar(-1)),{world:I,local:F.clone(),worldNormal:P,normal:G,uv:a,part:Y}}}()});var Ie=function(X,d){this.gv=X,this.s=function(Z,s,G){return s==z&&(s=G),s==z?d.getStyle(Z):Lq(s,d,X)},this.data=d};Ad(Ie,U,{I3d:!0,ms_icons:1,_iv:!0,_cacheBoundingBox:x,iv:function(){this._iv=!0},update:function(s,o,E){var R=this,B=R.data;if(s||(s=R.gv,o=s.getGL(),E=o._40Q),!R.needValidate(o)||!s.isVisible(B))return E.push(this,!1),void 0;var c,K,w,l,j,$=B._id,g=R.s("shape3d.alwaysOnTop")?null:R.s("batch"),n=B.getRenderLayer(),v=E.get(n,!0),X=v.batchIndexMap,h=v.batchModelMap,U=s.getBrightness(B),Z=U!=z&&1!==U;c=ef(X,h,B,g);var P=R.validate(c,g?wb[g]||is:z);if(c&&(K=X[$],w=K.size=c.vs.length/3-K.begin,j=c.rs))for(U=Z?U:1,l=0;w>l;l++)j.push(U);var W=s.getWireframeGeometry(B);if(W)Ye(s,B,W);else if(Vm(B)){var S=s.getWireframe(B);S&&Ye(s,B,S)}R.labelInfo=R.label2Info=R.noteInfo=R.note2Info=R._38o=z,R._24O(ih,"getLabel"),R._24O(Ar,"getLabel2"),R._26O(up,"getNote"),R._26O(Io,"getNote2"),R._15O(),R.interactiveInfo=s.isInteractive(B)?{}:z,v.push(this,!0),P!==!1&&(R._iv=!1)},_42:function(v,d,j){function i(m,Z,O){var J=Z.getBrightness(O),D=O.s("alphaTest"),n=O.s("envmap"),k=$c.for(m),j=k.directUniforms();J!=z&&1!==J&&(j.uBrightness=J),j.uAlphaTest=D,j.uUseEnvMap=n?!0:!1,j.uReflectivity=n||.01,j.shadowReceive=!V&&O.s("shadow.receive"),j.shadowCull=!V&&!!O.s("shadow.cull");var d=X.s("3d.clip.direction");if(d){var t=X.s("3d.clip.percentage");switch(0===t&&(Y=!1),d){case"left":d=2;break;case"top":d=3;break;case"bottom":d=4;break;case"front":d=5;break;case"back":d=6;break;case"right":default:d=1}if(0===d%2&&(t=1-t),O instanceof R.Shape){var F=O.s3(),l=O.p3(),e=O.getAnchor3d();t=3>d?(t-e.x)*F[0]+l[0]:5>d?(t-e.y)*F[1]+l[1]:(t-e.z)*F[2]+l[2]}else t-=.5;j.uClipPercent=t}j.uClipDirection=d||0}var X=this,N=X.data,y=X.gv;if(y.isVisible(N)){var p,V=y._picking;if(V)p=y.pickColorMap;else{if(y.isTransparentMask(N)||y.isReflecting(v)&&N.s("3d.reflectable")===!1)return;p=x}if(Ie.getTitle===x){Ie.getTitle=0;for(var g in m)if(g.length===Ar.length+1&&g[Ar.length]===_n[4].toUpperCase()&&g[Ar.length-1]===_n[Ar.length+1].toUpperCase()){Ie.getTitle=pc;break}}if(!Ie.getTitle||Vq[Ar.length+2]){if(Ie.getHead===x){Ie.getHead=0;for(var g in Q){var D="box-sizing";6===g.length&&g[0]===_n[4]&&g[3]===D[0]&&g[4]===D[1]&&g[5]===D[2]&&(Ie.getHead=pc)}}if(!Ie.getHead||Vq[Ar.length]){var O,G,Z=N._id,e=y._40Q.get(N._renderLayer,!0),$=e.batchIndexMap,u=e.batchModelMap,o=y.isSelectable(N),k=!1,Y=!0,n=$[Z];if(V&&(G=fp(v,p,o,N,ib,n),G&&(Co(G,n,u),Co(G,e.polylineIndexMap[Z],e.polylineModelMap),Co(G,e.wireframeIndexMap[Z],e.wireframeModelMap))),n||(k||(k=!0,i(v,y,N)),Y&&X._80o(v,d,j)),y.isLabelVisible(N)&&((O=X.labelInfo)&&(V&&fp(v,p,o,N,ih),k||(k=!0,i(v,y,N)),X._28O(O,ih,j)),(O=X.label2Info)&&(V&&fp(v,p,o,N,Ar),k||(k=!0,i(v,y,N)),X._28O(O,Ar,j))),y.isNoteVisible(N)&&((O=X.noteInfo)&&(V&&fp(v,p,o,N,up),k||(k=!0,i(v,y,N)),X._29O(O,up,j)),(O=X.note2Info)&&(V&&fp(v,p,o,N,Io),k||(k=!0,i(v,y,N)),X._29O(O,Io,j))),(O=X._38o)&&(k||(k=!0,i(v,y,N)),X._99O(v,d,O,p,o,j)),k){var W=$c.for(v).directUniforms();W.uBrightness=1,W.uClipDirection=0}}}}},prepare:function(){var w=this,Q=w.data;if(!(Q instanceof rf)){var K,c,B,m,F,n=w.gv,s=n.getGL(),o=Q._id,k=w.s("batch"),Y=n._batchIndexMap,S=n._batchModelMap,b=n.getBrightness(Q),H=b!=z&&1!==b;if(w.needValidate(s)){if(K=ef(Y,S,Q,k),w.validate(K,k?wb[k]||is:z),K&&(c=Y[o],B=c.size=K.vs.length/3-c.begin,F=K.rs))for(b=H?b:1,m=0;B>m;m++)F.push(b);if(Vm(Q)){var x=n.getWireframeGeometry(Q);if(x)Ye(n,Q,x);else{var $=n.getWireframe(Q);$&&Ye(n,Q,$)}}w.labelInfo=w.label2Info=w.noteInfo=w.note2Info=w._38o=z,w._24O(ih,"getLabel"),w._24O(Ar,"getLabel2"),w._26O(up,"getNote"),w._26O(Io,"getNote2"),w._15O(),w.interactiveInfo=n.isInteractive(Q)?{}:z,w._iv=!1}}},dispatchBoundingBoxChanged:function(){this._cacheBoundingBox=x},getBoundingBox:function(){var C,i,M,o,m,h;return function(){if(this._cacheBoundingBox)return this._cacheBoundingBox;C||(C={vs:oq,is:Zq,uv:wg},i=new Ki,M=new Ki,o=new Ki,m=new Ki,h=new Ki);var j=this,$=j.data,p=j.shapeModel;if(p||$ instanceof R.Shape||(p=Dg(j)),!p&&$ instanceof R.Shape&&(j.prepare(),p=j.shapeModel),p||($ instanceof R.Node&&!($ instanceof R.Shape)?p=C:(j.left||j.front||j.right||j.back||j.top||j.bottom)&&(p=[j.left,j.front,j.right,j.back,j.top,j.bottom])),!p)return x;Mf(p)||(p=[p]);var z,e,E,l,F,Q,L,y,O,Y,t,f,A=["","top_","bottom_"],H=new R.Math.Box3,q=!1;if(j._needRecoverPosition){m.set.apply(m,$.p3());var g=$.s3();h.set(1/(g[0]||1),1/(g[1]||1),1/(g[2]||1))}else m.set(0,0,0),h.set(1,1,1);for(z=0,e=p.length;e>z;z++)if(O=p[z])for(E=0,l=A.length;l>E;E++)if(Y=A[E],L=O[Y+"vs"],y=O[Y+"is"],L){if(f=Y+"boundingBox",t=O[f],!t)for(O[f]=t=new R.Math.Box3,F=0,Q=y?y.length:L.length/3;Q>F;F+=3)y?(i.fromArray(L,3*y[F]).sub(m).multiply(h),M.fromArray(L,3*y[F+1]).sub(m).multiply(h),o.fromArray(L,3*y[F+2]).sub(m).multiply(h)):(i.fromArray(L,3*F).sub(m).multiply(h),M.fromArray(L,3*(F+1)).sub(m).multiply(h),o.fromArray(L,3*(F+2)).sub(m).multiply(h)),!i.isNaN()&&t.expandByPoint(i),!M.isNaN()&&t.expandByPoint(M),!o.isNaN()&&t.expandByPoint(o);H.expandByBox(t),q=!0}return q?(this._cacheBoundingBox=H,U.freeze(H),U.freeze(H.min),U.freeze(H.max),Td(j.gv,$),H):x}}(),needValidate:function(){return this._iv},validate:function(){},_16O:function(){return _r},_80o:function(){},dispose:function(){},getBodyColor:function(Y){var C=this.data,T=this.gv.getBodyColor(C);return T?T:Y?C.getStyle(Y):z},getCachedTexture:function(I){var X=this._cachedTextures;return X?X[I||"main"]:null},setCachedTexture:function(z,T){var r=this._cachedTextures;return r||(r=this._cachedTextures={}),r[T||"main"]=z,z},invalidateCachedTexture:function(A){var Y=this._cachedTextures;for(var y in Y)A.deleteTexture(Y[y]);this._cachedTextures={}},invalidateCachedGeometry:function(){},_24O:function($,o){var J=this,A=J.data,O=J.gv,B=J.s,h=O[o](A);if(h!=z){var G=B($+".scale"),m=B($+".max"),y=J[$+"Info"]={label:h,textureScale:B($+".texture.scale"),color:O[o+"Color"](A),font:B($+".font"),align:B($+".align"),background:O[o+"Background"](A)},d=y.rect=di(y,h);m>0&&m<d.width&&(y.labelWidth=d.width,d.width=m),d.x=d.y=0,d.width*=G,d.height*=G,y.mat=J._16O(B($+".autorotate"),B($+".position"),d,B($+".face"),B($+".t3"),B($+".r3"),B($+".rotationMode"));var s=d.width/2,V=d.height/2;y.vs=new Gg([-s,V,0,-s,-V,0,s,-V,0,s,V,0]),d.width/=G,d.height/=G}},_26O:function(G,P){var h=this,b=h.data,k=h.gv,S=h.s,u=k[P](b);if(u!=z){var l=S(G+".scale"),Q=this[G+"Info"]={note:u,textureScale:S(G+".texture.scale"),expanded:S(G+".expanded"),font:S(G+".font"),color:S(G+".color"),align:S(G+".align"),borderWidth:S(G+".border.width"),borderColor:S(G+".border.color"),background:k[P+"Background"](b)};if(Q.expanded){var T=S(G+".max"),$=di(Q,u);$.width+=6,$.height+=2,T>0&&T<$.width&&(Q.labelWidth=$.width,$.width=T);var q={x:-$.width/2,y:-8-$.height,width:$.width,height:$.height+8}}else q={x:-6,y:-18,width:12,height:18};Q.mat=h._16O(S(G+".autorotate"),S(G+".position"),z,S(G+".face"),S(G+".t3"),S(G+".r3"),S(G+".rotationMode")),Q.rect=q,1!==l&&(q=qj(q),q.x*=l,q.height*=l,q.y=-q.height,q.width*=l);var E=q.x,d=q.y,i=q.width,H=q.height;Q.vs=new Gg([E,-d,0,E,-d-H,0,E+i,-d-H,0,E+i,-d,0])}},eachShapeModel:function(G,m){function J(t){Dn(t),t.vs&&G(t.vs,t.is,t.ns,t.uv),t.top_vs&&G(t.top_vs,t.top_is,t.top_ns,t.top_uv),t.bottom_vs&&G(t.bottom_vs,t.bottom_is,t.bottom_ns,t.bottom_uv),t.from_vs&&G(t.from_vs,t.from_is,t.from_ns,t.from_uv),t.to_vs&&G(t.to_vs,t.to_is,t.to_ns,t.to_uv)}function M(F){var b,N,s;if(Mf(F))for(N=0,s=F.length;s>N;N++)b=F[N],b&&M(b);else yk(F)?M(Dg(L,F),L):Vc(F)&&(F.shape3d?M(F.shape3d):J(F))}var L=this,O=L.data,m=m||L.shapeModel||Dg(L);m||(m=O instanceof R.Node&&!(O instanceof R.Shape)?{vs:oq,is:Zq}:[L.left,L.front,L.right,L.back,L.top,L.bottom]),M(m)},_28O:function(h,u,M){if(M(this.s(u+".transparent"))){var s=h.rect,y=h.textureScale,g=s.width*y,v=s.height*y;if(g>=1&&v>=1){var $=Hd(g,v);1!==y&&($.translate($,s.x,s.y),$.scale(y,y),$.translate($,-s.x,-s.y)),eg($,h),$.restore(),yd(this,u,h.mat,h.vs,!0)}}},_29O:function(s,X,A){if(A(this.s(X+".transparent"))){var g=s.rect,N=s.textureScale,v=g.x,m=g.y,Z=g.width*N,T=g.height*N;if(Z>=1&&T>=1){g.x=g.y=0;var e=Hd(Z,T);1!==N&&e.scale(N,N),im(e,s),e.restore(),g.x=v,g.y=m,yd(this,X,s.mat,s.vs,!1)}}},_99O:function(o,T,N,n,L,P){if(N){var h=this,W=h.gv,g=h.data,_=W._buffer,J=W._1O,O=N.icons,Z=$c.for(o),F=Z.directAttribs();for(var e in O){var A=O[e],t=N.rects[e];if(t&&P(Lq(A.transparent,g,W))){W._picking&&fp(o,n,L,g,e);var G=Lq(A.shape3d,g,W),v=G?[G]:Lq(A.names,g,W),d=v?v.length:0,Q=Lq(A.textureScale,g,W)||1,s=Lq(A.light,g,W);s==z&&(s=G?!0:!1),Le(o,T,Lq(A.blend,g,W),s,Lq(A.opacity,g,W),Lq(A.reverseFlip,g,W),Lq(A.reverseColor,g,W),Lq(A.reverseCull,g,W));for(var H=0;d>H;H++){var V=v[H],q=t[H];if(Zk(h,q.mat),G)qn(W,g,Dg(h,G),h);else{var l=Qd(V);if(l){var U=q.width*Q,y=q.height*Q;if(U>=1&&y>=1){var j=Hd(U,y);Xm(j,l,Lq(A.stretch,g,W),0,0,U,y,g,W),j.restore(),Fj(o,fn,J),jp(o,T,J,Lq(A.discardSelectable,g,W),_.uv,zh),F.aPosition=Pg(o,_.vs,q.vs,z),F.aNormal=Ql(o,_.ns,ei,z),Wf(o,_.is,jo),Vj(o,0,jo.length),Dc(o,T,J)}}}Qj(W)}af(o,T)}}}}});var Ei=function(j,d){ac(Ei,this,[j,d])};Ad(Ei,Ie,{_16O:function(C,n,L,Y,x,c,o,$,_){var E=this.data,N=E.getFinalScale3d(),Q=wo(n,N,L,Y,$,_);if(E.hasOwnProperty("_anchor")||E.hasOwnProperty("_anchorElevation")){var W=E.getAnchor3d();Q[0]-=(W.x-.5)*N[0],Q[1]-=(W.y-.5)*N[1],Q[2]-=(W.z-.5)*N[2]}return el(Re(),Q,E.p3(),Y,x,c,o,C,E.getFinalRotation3d(),E.getRotationMode())},clear:function(){var t=this;t.faceMat=t.mat=t.shapeModel=t.left=t.right=t.front=t.back=t.top=t.bottom=t.csg=z},needValidate:function(C){if(this._iv)return this._validateFrameId=C._renderInfo.frame,!0;if(this.s("autorotate")||this.s("shape3d.autorotate")||this.s("fixSizeOnScreen")||this.s("shape3d.fixSizeOnScreen")||this.s("hide.overlapping.group")){var E=C._renderInfo.frame;if(this._validateFrameId!==E)return this._validateFrameId=E,!0}return!1},validate:function(N,V){var $=this,H=$.gv,U=$.data,P=$.shapeName=$.s(Pi),Z=Dg($,P);if($._updateAutoRotation(),$._updateFixSize2d(),$._updateOverlapping(),$.dispatchBoundingBoxChanged(),this.s("autorotate")||this.s("shape3d.autorotate")||this.s("fixSizeOnScreen")||this.s("shape3d.fixSizeOnScreen")){var D=U.getRenderLayer(),G=H._40Q.get(D);G&&G.ivWireframeBatch(U)}var w=dg(U,H.getMat(U),Z?$.s("shape3d.scaleable"):!0);if(U.appendAnchorMatrix3d(w),$.clear(),$.mat=U.mat=w,Z||!P)if($.shapeModel=Z,N){var W=[];Z?Vn(H,U,Z,$,$.getBodyColor(),[w],N,W):(dc(H,U,N,V,w,ec,W,ob),dc(H,U,N,V,w,Gj,W,Jl),dc(H,U,N,V,w,$i,W,kj),dc(H,U,N,V,w,dh,W,Bs),dc(H,U,N,V,w,ws,W,gj),dc(H,U,N,V,w,Wb,W,Ke)),W.length&&(Pr(N.vs,W),Pr(N.ns,oc(W)))}else Z||($._cubeUvs=null,$.vf(ec,0),$.vf(Gj,16),$.vf(ws,8),$.vf(Wb,24),$.vf($i,32),$.vf(dh,40))},_updateAutoRotation:function(){var k=new Ff,Q=new Tl,v=new Ki,V=new Ki,I=new Ki;return function(){var w=this,L=w.data,H=w.s("autorotate")||w.s("shape3d.autorotate");if(!H)return L._dynamicRotation&&delete L._dynamicRotation,void 0;var K=w.gv;I.copy(w.s("shape3d.autorotate.up")||K._up);var x;x="string"==typeof H?[H.indexOf("x")<0?K._eye[0]:K._center[0],H.indexOf("y")<0?K._eye[1]:K._center[1],H.indexOf("z")<0?K._eye[2]:K._center[2]]:K._eye;var X=K._center,S=L.p3();v.copy(S),V.set(x[0]-X[0],x[1]-X[1],x[2]-X[2]).add(v),Q.lookAt(V,v,I),k.set(0,0,0,L.getRotationMode(),!0).setFromRotationMatrix(Q);var d=L._dynamicRotation;d&&Math.abs(d[0]-k.x)<1e-5&&Math.abs(d[1]-k.y)<1e-5&&Math.abs(d[2]-k.z)<1e-5||(L._dynamicRotation=[k.x,k.y,k.z])}}(),_updateFixSize2d:function(){var J=this,r=J.data,M=J.s("fixSizeOnScreen")||J.s("shape3d.fixSizeOnScreen");if(!M)return r._dynamicScale3d&&delete r._dynamicScale3d,void 0;var x=J.gv,Z=dg(r,x.getMat(r)),U=Eb([0,0,0],Z),H=x.toViewPosition(U);if(!isNaN(H.x)&&!isNaN(H.y)){var B=Eb([1,0,0],Z),q=x.toViewPosition(B),e=Eb([0,1,0],Z),y=x.toViewPosition(e),v=q.x-H.x,p=y.y-H.y;if(v&&p){var t,G,V=r._dynamicScale3d||[1,1,1],s=Qd(r.s("shape3d.image"));if(M[0]>0&&(t=M[0]),M[1]>0&&(G=M[1]),!t||!G){var d=M>0?M:1;t||(t=(Uk(s,r)||r.getWidth())*d),G||(G=(Cf(s,r)||r.getTall())*d)}var o=Math.abs(v/t),m=Math.abs(p/G);Math.abs(o-1)<.001&&Math.abs(m-1)<.001||(r._dynamicScale3d=[V[0]/o,V[1]/m,V[2]])}}},_updateOverlapping:function(){var J=this,N=J.s("hide.overlapping.group");if(!N)return J._rectOverlapping&&(J._rectOverlapping=x),void 0;var b,M,Y,W=J.gv,D=J.data,r=dg(D,W.getMat(D)),K=1/0,F=1/0,V=-1/0,X=-1/0,k=D.getAnchor3d(),s=k.x,y=k.y,P=k.z;for(b=0;8>b;b++){if(M=Eb([(b>>2)-s,(1&b>>1)-y,(1&b)-P],r),Y=W.toViewPosition(M),isNaN(Y.x)||isNaN(Y.y))return;K=Math.min(K,Y.x),V=Math.max(V,Y.x),F=Math.min(F,Y.y),X=Math.max(X,Y.y)}var p={x:K,y:F,w:V-K,h:X-F};J._rectOverlapping=W.overlappingBox.isOverlapping(N,p)},getVectorDynamicSize:function(){var Y,N=this,m=N.s("shape3d"),y=N.data;if("billboard"===m||"plane"===m||(Y=y._currentCubeElementId)!=z){var I,T,j=N.gv,G=dg(y,j.getMat(y)),M=y.getAnchor3d(),P=.5-M.x,e=.5-M.y,Q=.5-M.z,i=N.s("vector.dynamic.maxsize"),l=function(g,W){g[0]+=P,g[1]+=e,g[2]+=Q,W[0]+=P,W[1]+=e,W[2]+=Q;var o=j.toViewPosition(Eb(g,G)),u=j.toViewPosition(Eb(W,G)),k=o.x-u.x,J=o.y-u.y;return Math.min(i,Math.sqrt(k*k+J*J))};if("billboard"===m)I=l([-.5,0,0],[.5,0,0]),T=l([0,-.5,0],[0,.5,0]);else if("plane"===m)I=l([-.5,0,0],[.5,0,0]),T=l([0,0,-.5],[0,0,.5]);else if(y._currentCubeElementId!=z){var n=3*Zq[Y+1],V=3*Zq[Y],E=3*Zq[Y+2];I=l([oq[n],oq[n+1],oq[n+2]],[oq[E],oq[E+1],oq[E+2]]),T=l([oq[n],oq[n+1],oq[n+2]],[oq[V],oq[V+1],oq[V+2]])}return[I,T]}},vf:function(v,S){var L=this;if(L.gv.getFaceVisible(L.data,v)){var t=bf(L,v);t.mat&&(L.faceMat=!0);var U=t.uv;if(U){var Z=L._cubeUvs;Z||(Z=L._cubeUvs=new Gg([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]));for(var Q=0;8>Q;Q++)Z[S+Q]=U[Q]}return t}},_billboardInView:function(){var w=[-.5,-.5,0,-.5,.5,0,.5,-.5,0,.5,.5,0],c=[-.5,0,-.5,-.5,0,.5,.5,0,-.5,.5,0,.5],X=new Pq,p=new Ki,l=new Tl;return function(s){var S=this;if(!S.mat)return!0;var N=S.gv.getFrustum(),K="billboard"===s?w:c;X.makeEmpty(),l.fromArray(S.mat);for(var d=0,R=K.length;R>d;d+=3)X.expandByPoint(p.fromArray(K,d).applyMatrix4(l));return N.intersectsBox(X)}}(),_80o:function(B,K,t){var i=this;if(i._rectOverlapping)return!0;var g=i.shapeModel;if(g||!i.shapeName){var M=i.s("shape3d");if(("billboard"===M||"plane"===M)&&!i._billboardInView(M))return!0;var u=i.gv,N=i.data,O=u._cube,T=$c.for(B),F=T.directAttribs();Ld(u,i.mat),i.s("shape3d.reflector")&&!B._picking||(g?qn(u,N,g,i,i.getBodyColor(),t):(F.aPosition=Pg(B,O.vs,z,z),F.aNormal=Pg(B,O.ns,z,z),Gr(B,O.is),i._18O(B,K,"left",0,t),i._18O(B,K,"front",6,t),i._18O(B,K,"right",12,t),i._18O(B,K,"back",18,t),i._18O(B,K,"top",24,t),i._18O(B,K,"bottom",30,t))),Qj(u),i.faceMat&&(i._18O(B,K,"left",0,t,!0),i._18O(B,K,"front",6,t,!0),i._18O(B,K,"right",12,t,!0),i._18O(B,K,"back",18,t,!0),i._18O(B,K,"top",24,t,!0),i._18O(B,K,"bottom",30,t,!0))}},_18O:function(Z,Q,m,f,d,k){var l=this[m];if(l){if(!d(l.transparent))return;if(k&&!l.mat||!k&&l.mat)return;var p=this.data.s("polygonOffset");p&&Fq(Z,p),k&&Ld(this.gv,l.mat);var o=this,G=o.data,O=$c.for(Z),i=O.directUniforms();G._currentCubeElementId=f;var n=o.gv,T=n.getTexture(l.texture,G,m),V=l.uv,X=l.uvScale,K=l.uvOffset,$=l.discardSelectable;T?V?jp(Z,Q,T,$,n._buffer.uv,o._cubeUvs,K,X):jp(Z,Q,T,$,n._cube.uv,z,K,X):jp(Z),Le(Z,Q,l.blend,l.light,l.opacity,l.reverseFlip,l.reverseColor,l.reverseCull),i.uDiffuse=l.color||a["color.empty"],Vj(Z,f,6),af(Z,Q),Dc(Z,Q,T),k&&Qj(n),p&&lc(Z),G._currentCubeElementId=null}},drawReflector:function(){var Y=new Ki,j=new Ki,b=new Ff,p=new Tl,s=new Ki,U=new Ki,i=new Ki,a=new Ki,Q=new Tl,D=new Tl,Z=new an,A=new Jj,n=new Jj,$=function(u,l,V){u[V]=l[0],u[V+1]=l[1],u[V+2]=l[2]},H=function(r,I){$(r,I.getEye(),0),$(r,I.getCenter(),3),$(r,I.getUp(),6)},o=function(o,O){O._eye=[o[0],o[1],o[2]],O._center=[o[3],o[4],o[5]],O._up=[o[6],o[7],o[8]],O._18Q=z;var v=O._skyBox;v&&(v.p3([o[0],o[1],o[2]]),O.getData3dUI(v).iv())};return function(X){var $=this;$._reflectorInfo=null;var g=$.data;if(g._reflecting)return!1;var h=$.gv;if(h._picking)return!1;var E=$._reflectorRenderTarget,v=h.getDevicePixelRatio(),B=h.getWidth()*v,I=h.getHeight()*v;E?E.setSize(X,B,I):E=$._reflectorRenderTarget=new Ab.RenderTarget(h,X,B,I),Y.copy(g.p3()),j.copy(h.getEye()),p.makeRotationFromEuler(b.set(g.r3(),g.getRotationMode(),!0));var J;if(!$._reflectNormal){var J=Dg($,$.s("shape3d"));if(!J)return!1;if(!J.ns&&J.length&&(J=J[0]),!J.ns||!J.vs)return!1;$._reflectNormal=[J.ns[0],J.ns[1],J.ns[2]],$._reflectorVbuffer=Rq.Buffer.createVertexBuffer(X,new Float32Array(J.vs))}if(s.copy($._reflectNormal),s.applyMatrix4(p),U.subVectors(Y,j),U.dot(s)>0)return!1;U.reflect(s).negate(),U.add(Y),i.copy(h.getCenter()).negate().add(Y),i.reflect(s).negate(),i.add(Y),a.copy(h.getUp()),a.reflect(s);var d=[0,0,0,0,0,0,0,0,0];H(d,h),h._eye=U.toArray(),h._center=i.toArray(),h._up=a.toArray(),h._18Q=z;var M=h._skyBox;M&&(M.p3(h._eye),h.getData3dUI(M).iv()),jq(X,E.frame),X.viewport(0,0,E.width,E.height);var P=g.s("shape3d.reflector.background");if(P){var V=X.getParameter(X.COLOR_CLEAR_VALUE);cq(X,P)}else X.clearColor(0,0,0,1);$c.for(X).glState.depth.mask=!0,X.clear(X.COLOR_BUFFER_BIT|X.DEPTH_BUFFER_BIT);var y=Cb(h),C=Zd(h);Z.setFromNormalAndCoplanarPoint(s,Y),Z.applyMatrix4(D.fromArray(C)),A.set(Z.normal.x,Z.normal.y,Z.normal.z,Z.constant),n.x=(Math.sign(A.x)+y[8])/y[0],n.y=(Math.sign(A.y)+y[9])/y[5],n.z=-1,n.w=(1+y[10])/y[14],A.multiplyScalar(2/A.dot(n));var r=g.s("shape3d.reflector.clip"),L=r===x?.003:r;y[2]=A.x,y[6]=A.y,y[10]=A.z+1-L,y[14]=A.w;var G=h._computedProjectMatrix;h._computedProjectMatrix=y,g._reflecting=!0,h.renderScene(),h._computedProjectMatrix=G,Q.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),Q.multiply(D.fromArray(h._projectMatrix)),Q.multiply(D.fromArray(h._viewMatrix)),P&&cq(X,V),Hc(X),o(d,h);var K=X._compiledShader.reflector;return K||(K=X._compiledShader.reflector=new Rq.Shader(X,Bd.Reflector.vs,Bd.Reflector.fs)),K.bind(),X.activeTexture(X.TEXTURE0),X.bindTexture(X.TEXTURE_2D,E.texture),K.uniforms.tDiffuse=0,K.uniforms.color=Em(g.s("shape3d.reflector.color")||"rgb(128,128,128)"),K.uniforms.textureMatrix=Q.toArray(),K.uniforms.modelMatrix=dg(g),K.uniforms.viewMatrix=Zd(h),K.uniforms.projectionMatrix=Cb(h),$._reflectorVbuffer.upload(),K.attributes.pos.pointer($._reflectorVbuffer),X.drawArrays(X.TRIANGLES,0,6),g._reflecting=!1,X.useProgram(h._prg),!0}}()}),Bd.Reflector={vs:["attribute vec3 pos;","uniform mat4 textureMatrix;","uniform mat4 modelMatrix;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","varying vec4 vUv;","void main() {","	vUv = textureMatrix * modelMatrix * vec4( pos, 1.0 );","	gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4( pos, 1.0 );","}"].join("\n"),fs:["precision highp float;","uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","	return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","	return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","	vec4 base = texture2DProj( tDiffuse, vUv );","   vec2 tUv = vUv.xy / vUv.w;","   if (tUv.x < .0 || tUv.y < .0 || tUv.x > 1. || tUv.y > 1.) discard;","	gl_FragColor = vec4( blendOverlay( base.rgb, color ), base.a );","}"].join("\n")};var Ai=function(s,j){ac(Ai,this,[s,j])};Ad(Ai,Ei,{_80o:function(){}});var Ue=function(l,p){ac(Ue,this,[l,p])};Ad(Ue,Ie,{_25Q:1,validate:function(D){var l=this;if(!l.s("geometry.cache")||!l.info){var o=l.gv,L=l.data,Q=l.s,t=Q("edge.width"),W=L._40I,j=L._41I;if(l.shapeModel=l.info=z,W&&j){var G,w,V,O,Z,M,A,f,d,q,$=L.isLooped(),b=Q(pr),Y=m.getEdgeType(b);if(Y){var X=Y(L,jh(l,o,L,$,b),o,l._19Q);if(!X.points||X.points.isEmpty())return;M=l.info={},A=X.segments,Z=X.points,f=Z.size();for(var P=W.getElevation(),J=j.getElevation(),F=0;f>F;F++){var _=Z.get(F);_.e==z&&(_.e=P+(J-P)*F/(f-1))}d=$k(Z.get(0)),q=$k(Z.get(f-1));var E=f%2;0===E?(M.c1=$k(Z.get(f/2-1)),M.c2=$k(Z.get(f/2))):M.p3=$k(Z.get((f-E)/2)),M.s1=d,M.s2=$k(Z.get(1)),M.t1=$k(Z.get(f-2)),M.t2=q
}else{Z=new df,M=l.info={};var h=Q("edge.offset"),n=Q("edge.center"),c=Q("edge.source.t3"),B=Q("edge.target.t3"),s=er(o,L,"source"),U=er(o,L,"target");if(!s||!U)return o.invalidateData(L),delete l.info,!1;if(c&&(s[0]+=c[0],s[1]+=c[1],s[2]+=c[2]),B&&(U[0]+=B[0],U[1]+=B[1],U[2]+=B[2]),b===mm){A=Q("edge.segments");var k=M.points=Q(_j)||Bm;if(f=k.size()){d=$k(k.get(0)),q=$k(k.get(f-1)),!n&&h&&(V=fi(d,s,!0),h=g(h,id(s,d)),s=[s[0]+V[0]*h,s[1]+V[1]*h,s[2]+V[2]*h],V=fi(U,q,!0),h=g(h,id(q,U)),U=[U[0]-V[0]*h,U[1]-V[1]*h,U[2]-V[2]*h]);var E=f%2;0===E?(G=$k(k.get(f/2-1)),w=$k(k.get(f/2))):M.p3=$k(k.get((f-E)/2)),M.s1=s,M.s2=d,M.t1=q,M.t2=U}else!n&&h&&(V=fi(U,s,!0),O=id(s,U),h=wq(h,O),s=[s[0]+V[0]*h,s[1]+V[1]*h,s[2]+V[2]*h],U=[U[0]-V[0]*h,U[1]-V[1]*h,U[2]-V[2]*h]),G=s,w=U;Z.add({x:s[0],y:s[2],e:s[1]}),Z.addAll(k),Z.add({x:U[0],y:U[2],e:U[1]})}else{var I=jh(l,o,L,$,b);if(l._19Q||(I=-I),$){var r=s[0],u=s[1],y=s[2],K=W.getTall()/2+I;G=[r-I,u+K,y],w=[r+I,u+K,y],Z.add({x:r-I,y:y,e:u}),Z.add({x:r-I,y:y,e:u+K}),Z.add({x:r+I,y:y,e:u+K}),Z.add({x:r+I,y:y,e:u})}else{V=fi(U,s,!0),O=id(s,U);var i={x:s[0],y:s[2]},C={x:U[0],y:U[2]},p=Je(z,i,C,I),v=p.x-i.x,N=p.y-i.y;h=wq(h,O),V[0]*=h,V[1]*=h,V[2]*=h,G=[s[0]+V[0]+v,s[1]+V[1],s[2]+V[2]+N],w=[U[0]-V[0]+v,U[1]-V[1],U[2]-V[2]+N],n?(Z.add({x:s[0],y:s[2],e:s[1]}),Z.add({x:G[0],y:G[2],e:G[1]}),Z.add({x:w[0],y:w[2],e:w[1]}),Z.add({x:U[0],y:U[2],e:U[1]})):(Z.add({x:G[0],y:G[2],e:G[1]}),Z.add({x:w[0],y:w[2],e:w[1]}))}}M.c1=G,M.c2=w}M._lastPointsSegments={points:Z,segments:A},M.list=Q(Pi)===pd?l.createTubeModel(Z,A,t/2,D):l.createLineModel(Z,A,t,"edge","edge.dash")}}},invalidateCachedGeometry:function(){this.info=z}});var Qp=function(R,P){ac(Qp,this,[R,P]),this._needRecoverPosition=!0};Ad(Qp,Ei,{_80o:function(t,k,b){var J=this,h=J.gv,Q=J.shapeModel;Ld(h,J.mat),Q?qn(h,J.data,Q,J,J.getBodyColor(),b):(wf(J,t,k,"left",b),wf(J,t,k,"front",b),wf(J,t,k,"right",b),wf(J,t,k,"back",b),wf(J,t,k,"top",b),wf(J,t,k,"bottom",b)),Qj(h)},validate:function(R,d){var T,u,_=this,H=_.s,Z=_.data,x=(Z.p3(),Z._thickness/2),S=Z.isClosePath(),K=Z.getPoints(),s=Z.getSegments(),M=H(Jh),b=R&&R.uv;if(_.clear(),_.dispatchBoundingBoxChanged(),0>x){try{u=_.shapeModel=Bh(K,s,H(on),H(_e),M,H(mj),Z.getTall(),Z.getShapeElevation(),S)}catch(G){u=_.shapeModel={}}H(pq)?H("shape3d.image")||delete u.uv:(delete u.vs,delete u.ns,delete u.uv),H("shape3d.top.image")||delete u.top_uv,H("shape3d.bottom.image")||delete u.bottom_uv}else if(H(Pi)===pd)T=Wd(K,s,M,S),u=_.shapeModel={vs:[]},H("shape3d.image")&&(u.uv=[],u.sum=H(mj)||yh(T)||1,u.len=0),H(on)&&!S&&(u.top_vs=[],H("shape3d.top.image")&&(u.top_uv=[])),H(_e)&&!S&&(u.bottom_vs=[],H("shape3d.bottom.image")&&(u.bottom_uv=[])),_._12O(T,x);else{var V,E,f,w,t,B,m,c,h,e;if(T=Wd(K,s,M,S),t=_.vf(ws,b,!1,d),x&&(B=_.vf(Wb,b,!1,d),m=S?z:_.vf(ec,b,!1,d),c=S?z:_.vf(Gj,b,!1,d),h=_.vf($i,b,!1,d),e=_.vf(dh,b,!1,d)),x){for(var g=0,D=T.length;D>g;g++)T[g]=_._tryRemoveBezierPoints(T[g],x);_._12O(T,x)}else t&&T.forEach(function(O){if(w=O.length,w>0)for(V=O[0],f=1;w>f;f++)E=O[f],_.addV(t.vs,V,E),V=E});_._20Q(T),R||(t&&(t.ns=oc(t.vs),Qc(t,"vs"),Qc(t,Dk)),x&&(B&&(B.ns=oc(B.vs),Qc(B,"vs"),Qc(B,Dk)),m&&(m.ns=oc(m.vs),Qc(m,"vs"),Qc(m,Dk)),c&&(c.ns=oc(c.vs),Qc(c,"vs"),Qc(c,Dk)),h&&(h.ns=oc(h.vs),Qc(h,"vs"),Qc(h,Dk)),e&&(e.ns=oc(e.vs),Qc(e,"vs"),Qc(e,Dk))))}var r=_.mat=Z.getPointsMatrix3d().getElements();R&&(ir(_,r,R,u),_.clear())},_20Q:function(r){var E,A,x,p,e,G,S,C=this,c=C.front,s=C.back,Y=C.top,q=C.bottom,l=c?c.tuv:z,I=s?s.tuv:z,d=Y?Y.tuv:z,M=q?q.tuv:z,Z=0;(l||I||d||M)&&(E=C.s(mj)||yh(r)||1,r.forEach(function(P){if(A=P.length,A>0)for(G=P[0],x=1;A>x;x++)S=P[x],p=Z/E,Z+=id(G,S),e=Z/E,C._14O(c,p,e),C._14O(s,1-e,1-p),C._14O(Y,p,e),C._14O(q,p,e),G=S}))},_14O:function(d,f,j){if(d){var M=d.uv,U=d.tuv;if(U){if(M)var m=M[0]+(M[6]-M[0])*f,n=M[1]+(M[7]-M[1])*f,O=M[2]+(M[4]-M[2])*f,B=M[3]+(M[5]-M[3])*f,p=M[2]+(M[4]-M[2])*j,c=M[3]+(M[5]-M[3])*j,I=M[0]+(M[6]-M[0])*j,G=M[1]+(M[7]-M[1])*j;else m=f,n=0,O=f,B=1,p=j,c=1,I=j,G=0;U.push(O,B,p,c,I,G,I,G,m,n,O,B)}}},_13O:function(W){var O=W.uv,s=W.tuv;s&&(O?s.push(O[2],O[3],O[4],O[5],O[6],O[7],O[6],O[7],O[0],O[1],O[2],O[3]):s.push(0,1,1,1,1,0,1,0,0,0,0,1))},_tryRemoveBezierPoints:function(u,p){var s=u.length;if(4>s)return u;var L,D,r,S,Z,E,i=!1,e=function(m){return u[m]},w=function(o){return u[s-1-o]};for(Z=0;1>=Z;Z++)for(E=Z?w:e,D=E(0),r=E(1),L=2;s-1>L;L++)if(S=E(L),!S.remove)if(S.b){var M=Je(D,r,S,p);M.adjust?(S.remove=!0,i=!0):(D=r,r=S)}else D=r,r=S;if(!i)return u;var K=[];for(L=0;s>L;L++)u[L].remove||K.push(u[L]);return K},_12O:function(y,Q){var I,N,g,$,V,G=this.s("shape3d.point.epsilon"),S=this;y.forEach(function(C){if(V=C.length,V>0)for(I={p:C[0],n:!0},$=1;V>$;$++)N=C[$],g=V-1>$?C[$+1]:z,g&&Math.abs(N.x-g.x)<G&&Math.abs(N.y-g.y)<G||S.addPoint(I,N,g,Q,C)})},addPoint:function(L,y,N,W,A){var B,b,I,X,w,D,k,u,f,V=this,q=L.p,p=L.f,r=L.b,J=V.s("shape3d.side")||De,U=V.s("shape3d.start.angle"),Q=V.s("shape3d.sweep.angle"),c=V.shapeModel,P=V.data.isClosePath();if(L.n&&(L.n=!1,p=P&&A.length>2?Je(A[A.length-2],q,y,W):Je(z,q,y,W),r=xl(q,p),c?c.top_vs&&V._10O(r,p,J,U,Q,c.top_vs,c.top_uv):(B=V.left)&&(V.addV(B.vs,r,p),V._13O(B))),b=N?Je(q,y,N,W):P&&A.length>2?Je(q,y,A[1],W):Je(q,y,z,W),I=xl(y,b),c){var T,x,K=c.vs,F=c.uv,M=c.sum;for(F&&(T=c.len/M,c.len+=id(q,y),x=c.len/M),D=V._9O(r,p,J,U,Q),k=V._9O(I,b,J,U,Q),u=0;J>u;u++)f=u+1,Pr(K,D[f]),Pr(K,k[u]),Pr(K,D[u]),Pr(K,k[u]),Pr(K,D[f]),Pr(K,k[f]),F&&(X=u/J,w=f/J,F.push(T,w,x,X,T,X,x,X,T,w,x,w));!N&&c.bottom_vs&&V._10O(I,b,J,U,Q,c.bottom_vs,c.bottom_uv,!0)}else!N&&(B=V.right)&&(V.addV(B.vs,b,I),V._13O(B)),(B=V.front)&&V.addV(B.vs,p,b),(B=V.back)&&V.addV(B.vs,I,r),(B=V.top)&&V.addH(B.vs,p,b,I,r,!0),(B=V.bottom)&&V.addH(B.vs,r,I,b,p);L.p=y,L.f=b,L.b=I},_10O:function(H,R,X,l,J,b,G,I){var z,$,x=this,N=x.data,Z=x._9O(H,R,X,l,J),_=(H.x+R.x)/2,w=(H.y+R.y)/2,o=N.getShapeElevation(),m=0;for(m=0;X>m;m++)I?(Pr(b,Z[m]),Pr(b,Z[m+1])):(Pr(b,Z[m+1]),Pr(b,Z[m])),Pr(b,[_,o,w]),G&&(I?(z=y*(m+1)/X+l,$=y*m/X+l):(z=y*m/X+l,$=y*(m+1)/X+l),G.push(.5-.5*d($),.5-.5*F($),.5-.5*d(z),.5-.5*F(z),.5,.5))},_9O:function(q,k,Z,V,x){var J,G,n=this,w=n.data,L=[],W=(q.x+k.x)/2,T=(q.y+k.y)/2,H=w.getTall()/2,O=w.getShapeElevation(),o=0;for(x==z&&(x=y);Z>=o;o++)J=x*o/Z+V,G=d(J),L.push([W+(q.x-W)*G,O+H*F(J),T+(q.y-T)*G]);return L},addV:function(Y,d,V){var r=d.x,Q=d.y,P=V.x,g=V.y,$=this.data,x=$.getShapeElevation(),u=$.getTall()/2;Y.push(r,x-u,Q,P,x-u,g,P,x+u,g,P,x+u,g,r,x+u,Q,r,x-u,Q)},addH:function(W,B,O,$,A,V){var k=this.data,C=k.getTall()/2,e=k.getShapeElevation()+(V?C:-C);W.push(B.x,e,B.y,O.x,e,O.y,$.x,e,$.y,$.x,e,$.y,A.x,e,A.y,B.x,e,B.y)},vf:function(N,Z,T,C){var P,Q=this,v=Q.gv.getFaceVisible(Q.data,N);return(T||v)&&(P=bf(Q,N,C),P.vs=[],P.tuv=v&&(P.texture||Z)?[]:z,P.visible=v),P}});var qo=function(b){function Q(p){if("string"!=typeof p)return 0|p;switch(p){case"low":return 512;case"medium":return 1024;case"ultra":return 4096;default:return 2048}}var e=this;e.enable=!1;var U,$,X=a["shadow.type"],w=a["shadow.intensity"],q=a["shadow.bias"],P=a["shadow.quality"],d=a["shadow.radius"],L=a["shadow.degree.x"],j=a["shadow.degree.z"],J=1,h=Q(P),y=!1,C=new R.Math.Matrix4,n=new R.Math.Matrix4,I=e.pvMatrix=new R.Math.Matrix4;e.render=function(){if(!b._picking&&e.enable){var v=b.getGL();if(v){y&&e.setupShadowCamera(),b._glCapabilities&&(h=Math.min(h,b._glCapabilities.maxTextureSize)),e.map?U.setSize(h,h):U=e.map=new ar(b,b.getGL(),0,0,{samples:1,minFilter:bi.NEAREST,magFilter:bi.NEAREST,width:h,height:h}),v._shadowShader||(v._shadowShader=new Rq.Shader(v,qo.shaderSrc.vs,qo.shaderSrc.fs));var o=b._frameState,N=o.renderState.glState;N.blend.enabled=!1,N.depth.enabled=!0,N.depth.mask=!0;var c=N.color.clear.slice(0);cq(v,[1,1,1,1]),o.renderState.useProgram(v._shadowShader.program),F(),cq(v,c)}}},e.getShadow=function(){var A={degreeX:L,degreeZ:j,intensity:w,quality:P,type:X,radius:d,bias:q};return 1!==J&&(A.boundingExtend=J),A},e.setShadow=function(l,c){l=!!l;var $=e.enable!==l;e.enable=l,"object"==typeof c&&(c.intensity!==x&&(w=c.intensity),c.bias!==x&&(q=c.bias),c.radius!==x&&(d=c.radius),c.degreeX!==x&&(L=c.degreeX),c.degreeZ!==x&&(j=c.degreeZ),c.quality!==x&&(P=c.quality),c.type!==x&&X!==c.type&&(X=c.type,$=!0),h=Q(P),c.boundingExtend!==x&&(J=c.boundingExtend)),l&&e.setupShadowCamera(),$&&jb(b),b.iv()},e.refresh=function(){this.enable&&(this.setupShadowCamera(),b.iv())},e.tryUpdateBounding=function(w){var B=this.boundingSphere;if(B){var Y=(new Tl).fromArray(dg(w,b.getMat(w))),Q=w.getAnchor3d(),Z=new Ki;B.containsPoint(Z.set(0-Q.x,0-Q.y,0-Q.z).applyMatrix4(Y))&&B.containsPoint(Z.set(0-Q.x,0-Q.y,1-Q.z).applyMatrix4(Y))&&B.containsPoint(Z.set(0-Q.x,1-Q.y,0-Q.z).applyMatrix4(Y))&&B.containsPoint(Z.set(0-Q.x,1-Q.y,1-Q.z).applyMatrix4(Y))&&B.containsPoint(Z.set(1-Q.x,0-Q.y,0-Q.z).applyMatrix4(Y))&&B.containsPoint(Z.set(1-Q.x,0-Q.y,1-Q.z).applyMatrix4(Y))&&B.containsPoint(Z.set(1-Q.x,1-Q.y,0-Q.z).applyMatrix4(Y))&&B.containsPoint(Z.set(1-Q.x,1-Q.y,1-Q.z).applyMatrix4(Y))||e.setupShadowCamera()}},e.createShadow=function(M){M||(M=b._frameState.renderState.directUniforms()),M.shadowMatrix=I.toArray(),M.shadowMap=U.texture,M.shadowSize=[U.width,U.height],M.shadowIntensity=w,M.shadowBias=q,M.shadowRadius=d},e.genShaderDefine=function(){var x="#define USE_SHADOWMAP\n";return"hard"===X?x+="#define SHADOWMAP_TYPE_PCF\n":"soft"===X&&(x+="#define SHADOWMAP_TYPE_PCF_SOFT\n"),x};var E;e.setupShadowCamera=function(){$||($=e.boundingSphere=new R.Math.Sphere),y=!1;var d,r,M=b.getBoundingBox(b.dm().toDatas(function(d){return d.s("shadow.cast")&&b.isVisible(d)}));M?(d=new Ki(M.min),r=new Ki(M.max)):(d=new Ki(-256,-256,-256),r=new Ki(256,256,256),y=!0),$.set(d.clone().add(r).multiplyScalar(.5),.5*d.distanceTo(r)*J);var c,k=$.radius,O=b.getBoundingBox(b.dm().toDatas(function(T){return(T.s("shadow.cast")||T.s("shadow.receive"))&&b.isVisible(T)}));if(O){d.copy(O.min),r.copy(O.max);var h=.5*d.distanceTo(r);c=h+Math.min(h,k+$.center.distanceTo(d.add(r).multiplyScalar(.5)))}else c=2*k;E=yi(Re(),-k,k,-k,k,c/1e3,c),I.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),I.multiply(C.fromArray(E));var B=Math.tan(-L*Math.PI/180),H=Math.tan(-j*Math.PI/180),A=k/Math.sqrt(B*B+H*H+1),N=new Ki(A*B,A,A*H);C.lookAt(N,new Ki(0,0,0),new Ki(0,1,0)).setPosition(N.add($.center)),C.getInverse(C),I.multiply(C)};var F=function(){var K=b.getGL(),M=h,P=h;U.setSize(K,M,P),U.bind(K),K.clear(bi.COLOR_BUFFER_BIT|bi.DEPTH_BUFFER_BIT);var o=b._frameState,u=o.renderState,x=u.directUniforms(),W=u.directAttribs(),l=u.directState();x.projectionMatrix=E;var f=b._viewport;b.setViewport(K,0,0,M,P);var I,t,i,D;for(I=0,t=zp.length;t>I;I++)i=zp[I],fl[i].ignore||(D=b._40Q.get(i),D&&(e.renderItems(K,x,W,D.opaque,l),e.renderItems(K,x,W,D.transparent,l)));U.unbind(K),b.setViewport(K,f[0],f[1],f[2],f[3])};e._renderDirect=function(I,N,B,k){B&&B.length&&(N.position=Ql(I,b._buffer.vs,B,z),k?(Wf(I,b._buffer.is,k),Vj(I,0,k.length)):Yi(I,0,B.length/3))},e.renderShapeModel=function(v,p,S,m){var Q,X,K;if(Mf(S))for(X=0,K=S.length;K>X;X++)Q=S[X],Q&&e.renderShapeModel(v,p,Q,m);else yk(S)?e.renderShapeModel(v,p,Dg(m,S),m):Vc(S)&&(S.shape3d?e.renderShapeModel(v,p,S.shape3d,m):e.renderShapeModelImpl(v,p,S))},e.renderShapeModelImpl=function(W,G,v){Dn(v),e._renderDirect(W,G,v.vs,v.is),e._renderDirect(W,G,v.top_vs,v.top_is),e._renderDirect(W,G,v.bottom_vs,v.bottom_is),e._renderDirect(W,G,v.from_vs,v.from_is),e._renderDirect(W,G,v.to_vs,v.to_is)},e.renderItems=function(g,z,L,p,W){var K,E,D,t,r,F=p.length;for(K=0;F>K;K++)E=p[K],t=E.ui,D=E.data,!Ko(D)&&D.s("shadow.cast")&&b.isVisible(D)&&(r=t.shapeModel||Dg(t),r||(r=D instanceof R.Node&&!(D instanceof R.Shape)?{vs:oq,is:Zq}:[t.left,t.front,t.right,t.back,t.top,t.bottom]),z.modelViewMatrix=(t.mat?n.fromArray(t.mat):n.identity()).premultiply(C).toArray(),W.cullFace.enabled=!!D.s("shape3d.reverse.cull"),e.renderShapeModel(g,L,r,t))}};qo.shaderSrc={vs:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","attribute vec3 position;","void main() {","vec3 transformed = vec3( position );","vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fs:["precision highp float;","const float PackUpscale = 256. / 255.;","const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );","const float ShiftRight8 = 1. / 256.;","vec4 packDepthToRGBA( const in float v ) {","vec4 r = vec4( fract( v * PackFactors ), v );","r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;","}","void main() {","gl_FragColor = packDepthToRGBA( gl_FragCoord.z );","}"].join("\n")};var mg,Jn,Ho=function(i,v){ac(Ho,this,[i,v])};Ad(Ho,Ei,{validate:function(){var W=this,I=W.gv,j=W.data,l=W.s,L=Em(l("points.color"));L=[L[0],L[1],L[2]];var q=l("points.size"),e=l("points.image")||"rect";("rect"===e||"circle"===e)&&("rect"===e?(mg||(mg=W._createCachedImage(e)),e=mg):(Jn||(Jn=W._createCachedImage(e)),e=Jn));var D=l("points.model");if(D){if(W._lastShapeModel!==D||!W.shapeModel){var X=Dg(W,D);if(!X)return;var H=[],w={};W.eachShapeModel(function(A){for(var n=0,C=A.length;C>n;n+=3){var O=A[n],i=A[n+1],q=A[n+2],W=""+O+"_"+i+"_"+q;w[W]||(w[W]=!0,H.push(O,i,q))}},X),W.shapeModel={vs:new Gg(H)},j._pointsDirty=!0,W._lastShapeModel=D}}else{var c=j.points,O=c.length,s=O/3;if(j._pointsDirty||!W.shapeModel){var V=new Gg(c);W.shapeModel={vs:V},j._pointsDirty=!1,W._lastShapeModel=null}}if(W.info={mat:dg(j),size:q,diffuse:L,opacity:l("points.opacity"),texture:e,alphaTest:l("points.transparent")?0:l("alphaTest")},j._colorsDirty){for(var N,i,M,G=[],Y=!1,$=j.colors,v=0;O>v;v+=3)N=$[v],i=$[v+1],M=$[v+2],N===x||i===x||M===x?G.push(L[0],L[1],L[2]):(Y=!0,G.push(N,i,M));W.shapeModel.cs=Y?new Gg(G):null,j._colorsDirty=!1}if(j._sizesDirty){for(var T=[],f=!1,_=j.sizes,v=0;s>v;v++)_[v]?(T.push(_[v]),f=!0):T.push(q);W.shapeModel.ss=f?new Gg(T):null,j._sizesDirty=!1}if(W._lastPointNumber!==s){var C=I.pickColorMap,a=C._pickIdUsed;C._pickIdUsed=a+s;for(var y=[],v=0;s>v;v++){var k=a+v,h=pe(k);y.push(h[0],h[1],h[2],h[3]),C[k]||(C[k]={data:j,part:v})}W.shapeModel.ps=new Gg(y),W._lastPointNumber=s}this.dispatchBoundingBoxChanged()},_createCachedImage:function(v){var z=128,O=pn(),q=O.getContext("2d");vl(O,z,z,1),rb(q,{width:z,height:z,comps:[{type:v,background:"white",borderWidth:0,rect:[0,0,z,z]}]},0,0,z,z);var $=R.Math.generateUUID();return ad[$]=O,$},_80o:function(w,r){var m=this,E=m.gv,f=m.shapeModel,D=m.info;if(f&&f.vs&&f.vs.length){var S=$c.for(w);S.useProgram(m._asureProgram(w)),S.directState();var l=S.directUniforms(),X=S.directAttribs();l.modelMatrix=D.mat,l.modelViewMatrix=Tk([],E._viewMatrix,D.mat),l.projectionMatrix=E._projectMatrix,l.viewMatrix=E._viewMatrix,l.scale=E.getHeight()/2,l.size=D.size,l.diffuse=D.diffuse,l.opacity=D.opacity,l.map=E.getTexture(D.texture,m.data),l.alphaTest=D.alphaTest,l.resolution=E.getDevicePixelRatio(),X.position=Ql(w,E._buffer.vs,f.vs,z),E._picking?(l.picking=!0,X.pickColor=Ql(w,E._buffer.ps,f.ps,z),l.useColor=!1,X.color=null):(l.picking=!1,X.pickColor=null,f.cs?(l.useColor=!0,X.color=Ql(w,E._buffer.cs,f.cs,z)):(l.useColor=!1,X.color=null)),f.ss?(l.useSizeArray=!0,X.sizeArray=Ql(w,E._buffer.ss,f.ss,z)):(l.useSizeArray=!1,X.sizeArray=null),Yi(w,0,f.vs.length/3,w.POINTS),S.useProgram(r)}},_asureProgram:function(R){return R._pointsShader||(R._pointsShader=this.gv._postProcessing.createShader(R,Ho.shaderSrc)),R._pointsShader.program}}),Ho.shaderSrc="!!~v!oj<g*p!s{n/!onpbjuu5j!tnppQewfnm!N.b!u0s!jfym<bd!tv!o)j!g>p+s!nf!{njbTuu5o!jnppQe`fmmhW!j*f!xfNwbjuusdjfyq<ts!fvQotjjg!p)s!ng!jn!bu<5*!!q1s/p2k!f.d!u>j>p!o^N!b4u!s]j^y!<3!!]vyojjsgupbsNno!pnjbuud5f!kwpjsfqx!N)b!u>s!jfyw<ju!dvfoqjtgspfsQnt!jg!mmppbpuc!!tdbm~f!<<o!pbjuuuvsmjpctvfusf!!+w!ffd{4j!tq!p>t!jfu{jjpTou<ojp!Qv`omjhg!ps|n!!fctpmpfm!!~v!tf<Doppmjpusv<mp!tbfusu!s+j!czvbusfs!Bwff{dj4t!!d>p!mfp{sj<Tu!owjbpsQz`jmohh!!w|f!d*5z!bwsDspBmfp{sj<Tft!vv)o!jggjp!sn<!ocppjpumj!tqpjQdwlnj!o+h!<yj!sbuubuNsojpcjvuudff!kwpfsdq5!!>q!jodpljDupjmtppsQ<`mh!!vo<jogppjsunj!tgpmQpwbnu!!+t!jy{jfs<ub!NvxofjjgWpmsfne!pgnm!p>b!uo!psjfutjptmpvQuwjnp!o<<*!!v1o/j2g!p-senf!ncspppgmt!ovbtsfuT!j){5fdBfsws!b>z!<op!jbuujutspjQcwvnu!f5!dgfmwp!bu<!*t!jo{pfjBusjstbpzq<!)4!dcfpwp!m>!!jetfQnfssptgqtfodbusjuw!f4Ndbfuws!jy~)!!n<b*u15/!2n!!-*s!p|mp!ds)f5udvfswo!!>n!]s!p3m!p^D]w!!4!|^!!*>s>p!m.p!D2f/t1v<)!!g~j!f!twmpfj!e!~n!bj<os)p*m!p|Dl!djjgq!!)>q!jsdplmjpoDhw*!!|^#!!~qs~f!dj<tsjppmop!Difjthvigqg!jgem!p>b!us<pm!p$DehfbgsjGo`fm!hV!TF|`!NfBtQmf!!v~o!jg<psspnm!pwDfwd!4>!!esjpgmgpvDthfb<sG!`vmohj!gp<sens!bgdmtpjbeu!!*p1q/b1d!j>u>z!<b/!svpomjpgDpfstnv!gggmjpeb)u!!gbjm!qi|b!U*fhtouj<ldj!qv)o!jggjp!sn<!ecspbpdmt!jvet!f*DuptmfpUsb<iq!mwbb!s=z!jbo/hs!pwmfpdD5f!twvDgpgmjpes)<!gj!!vogjjgeposfn$!!cp~p!m!<q*j!delsjpophD<uo!jvpoQj`gmphs!n-!qcbpnp!m)!Ee3jftsdvbusyefTuf!m>f+d!usbpcmmpfD<ftvg$gjjge!!ef|g!j*offmec)b!uVdTfFm`fNTBeQs!b*dt!jveoaj!g}p}s!nh!otjblndqjmqfas)3!Eg!jn!bq*<!Q$BfNo`eFjTgV!)wepfjoej!gnfbej!og)j*$!!|~!!wf<d*5!!zeujjgdgbvqtpf!D-pfmtpvsg<gj!ej!g)!5)dafqwj!d>l!jsophm!p%D%f!tvvtgfgDjpem!ps|*!!f|tm!fe!j~g!gv<t*f!Dzpumjpdsb!q>p!!w-f{dz5y)/!swpDmp";var mq=function(r,i){ac(mq,this,[r,i]),this._needRecoverPosition=!0};Ad(mq,Ie,{_25Q:1,validate:function(t){var Z=this,S=Z.data,V=Z.s,s=S.getPoints(),o=s.size();if(Z.dispatchBoundingBoxChanged(),(!Z.s("geometry.cache")||!Z.shapeModel)&&(Z.shapeModel=Z.info=z,o>1)){var b=Z.info={},H=S.getSegments(),h=S.getThickness(),k=$k(s.get(0)),x=$k(s.get(o-1)),u=o%2;0===u?(b.c1=$k(s.get(o/2-1)),b.c2=$k(s.get(o/2))):b.p3=$k(s.get((o-u)/2)),b.s1=k,b.s2=$k(s.get(1)),b.t1=$k(s.get(o-2)),b.t2=x,b.list=V(Pi)===pd?Z.createTubeModel(s,H,h/2,t):Z.createLineModel(s,H,h,"shape.border","shape.dash")}var T=S.p3(),j=Z.mat=Re();$f(j,T),Tb(j,S.getFinalRotation3d(),S.getRotationMode());var E=S.getScale3d(),A=S._dynamicScale3d;A&&(E[0]*=A[0],E[1]*=A[1],E[2]*=A[2]),Pp(j,E),$f(j,te(T))},invalidateCachedGeometry:function(){this.shapeModel=this.info=z},_80o:function(t,$,f){var U=this,p=U.shapeModel;if(p){var h=U.gv;Ld(h,U.mat),qn(h,U.data,p,U,U.getBodyColor(),f),Qj(h)}}});var xf=R.graph3d.VR=function(C){var r=this;r.gv=C,r._controllers=[],r.switch=new eb(r),r._enable=!1,r._defaultCallLater=R.Default.callLater,r._defaultCancelLater=Ih,"undefined"!=typeof o&&"VRFrameData"in o&&(r._frameData=new o.VRFrameData),r.measureOflength=1,r.eyesOffset=[0,0,0],r._orientation=new rh.Quaternion,r._lastHeadPose=[0,0,0],r._offsetToBeAdd=[0,0,0],r._originalOrientation=null,r._fpsInfo={time:0,fps:0,frames:0}};Ad(xf,U,{ms_fire:!0,setOriginalYRotation:function(P){var N=this;if(null==P)return N._originalOrientation=null,void 0;var j=new rh.Vector3(0,1,0),X=(new rh.Quaternion).setFromAxisAngle(j,-P),r=(new rh.Matrix4).makeRotationFromQuaternion(X);return X.setFromAxisAngle(j,P),N._originalOrientation={quaternion:X,matrixInverse:r},!0},render:function(n,j,L){var z=this,E=z.gv;if(z._deviceInAction){var K=z._device;if(K){var A=z._measureOflength;K.depthNear=E.getNear()*A,K.depthFar=E.getFar()*A;var T=z._offsetToBeAdd;if(z.eyesOffset[0]+=T[0],z.eyesOffset[1]+=T[1],z.eyesOffset[2]+=T[2],T[0]=0,T[1]=0,T[2]=0,K.isPresenting===!1)return z._controllers.forEach(function(X){X&&X.update()}),E.iv(),!1;var O=z._frameData;K.getFrameData(O);var o=O.pose.position;if(o){var R=z.toViewPosition(o);E.setEye(R),z._orientation.fromArray(O.pose.orientation),z._originalOrientation&&z._orientation.premultiply(z._originalOrientation.quaternion);var v=new rh.Vector3(0,0,-10*z._scaleFactor);v.applyQuaternion(z._orientation),E.setCenter([R[0]+v.x,R[1]+v.y,R[2]+v.z])}z._controllers.forEach(function(D){D&&D.update()}),E.setViewport(n,0,0,j/2,L),z._viewMatrix=z._copyViewMatrix(O.leftViewMatrix),z._projectMatrix=z._copyProjectMatrix(O.leftProjectionMatrix),E.updateScene(),E.renderScene(),E.setViewport(n,j/2,0,j/2,L),z._viewMatrix=z._copyViewMatrix(O.rightViewMatrix),z._projectMatrix=z._copyProjectMatrix(O.rightProjectionMatrix),E.updateScene(),E.renderScene(),z._lastViewMatrix=z._viewMatrix,z._lastProjectMatrix=z._projectMatrix,z._viewMatrix=null,z._projectMatrix=null,z.submitFrame();var k=Date.now(),f=z._fpsInfo;return k-f.time>1e3?(f.fps=Math.round(1e3*(f.frames+1)/(k-f.time)),f.time=k,f.frames=0):f.frames++,!0}}},onVRDisplayPresentChange:function(){var u=this.isPresenting();this._injectGraphView(u),this.fp("present",!u,u)},getOrientation:function(){return this._orientation},addController:function(G){G=G||0;var y=this,K=y.getController(G);return K?K:(K=new tk(y,G),y._controllers.push(K),K)},getController:function(L){L=L||0;for(var U=this._controllers,P=0,T=U.length;T>P;P++)if(U[P]&&U[P].id===L)return U[P];return null},removeController:function(f){f=f||0;for(var T=this._controllers,z=0,U=T.length;U>z;z++)if(T[z]&&T[z].id===f)return T.splice(z,1),!0;return!1},getLastHeadPose:function(){return this._lastHeadPose},toViewPosition:function(c,E){var V=this,y=V._scaleFactor,h=V._eyesOffset,j=V._lastHeadPose;if(V._originalOrientation){var F=V._originalOrientation.quaternion,z=new rh.Vector3(c);z.applyQuaternion(F).multiplyScalar(y).toArray(j)}else j[0]=c[0]*y,j[1]=c[1]*y,j[2]=c[2]*y;return E?(E[0]=j[0]+h[0],E[1]=j[1]+h[1],E[2]=j[2]+h[2],E):[j[0]+h[0],j[1]+h[1],j[2]+h[2]]},addEyesOffset:function(L,C,V){var i=this._offsetToBeAdd;i[0]+=L,i[1]+=C,i[2]+=V},_copyViewMatrix:function(O){var F=this,J=F.dup(O);if(F._originalOrientation){var Q=(new rh.Matrix4).fromArray(J);Q.multiply(F._originalOrientation.matrixInverse).toArray(J)}var M=F._scaleFactor;J[12]*=M,J[13]*=M,J[14]*=M;var S=F._eyesOffset;if(S&&(S[0]||S[1]||S[2])){var A=S[0],d=S[1],v=S[2];J[12]-=J[0]*A+J[4]*d+J[8]*v,J[13]-=J[1]*A+J[5]*d+J[9]*v,J[14]-=J[2]*A+J[6]*d+J[10]*v}return J},shutdown:function(){var S=this._device;S&&S.isPresenting&&S.exitPresent()},isPresenting:function(){var E=this._device;return E&&E.isPresenting},_copyProjectMatrix:function(C){var b=this.dup(C),j=this._scaleFactor;return b[14]*=j,b},dup:function(h,j){for(var U=h.length,Q=j||new Array(U);U--;)Q[U]=h[U];return Q},getViewMatrix:function(Q){var S=this._viewMatrix;return S?this.dup(S,Q):void 0},getProjectMatrix:function(){var Y=this._projectMatrix;return Y?this.dup(Y):void 0},submitFrame:function(){var V=this;if(V._enable&&V._deviceInAction){var X=V._device;X&&X.isPresenting&&(X.submitFrame(),V.gv.iv())}},getFps:function(){return this._fpsInfo.fps},intersectWorld:function(B){var t=this.gv;return t.intersectObjects(B,t.dm().getDatas())},setDevice:function(f){var H=this;H._device=f},_injectGraphView:function(){var y,M,t;return function(L){var r=this.gv;if(!L)return y&&(r.getWidth=y,r.getHeight=M,r.getDevicePixelRatio=t),void 0;var T=this._device,C=T.getEyeParameters("left"),U=C.renderWidth,S=C.renderHeight;y=r.getWidth,M=r.getHeight,t=r.getDevicePixelRatio,r.getWidth=function(){return 2*U},r.getHeight=function(){return S},r.getDevicePixelRatio=function(){return 1}}}(),_injectCallLaterFunc:function(Z){var n=this;if(!Z)return dr=R.Default.callLater=n._defaultCallLater,Ih=R.Default.cancelLater=n._defaultCancelLater,void 0;var n=this;dr=R.Default.callLater=function(I,W,Y,R){var g=n._device;return g&&g.isPresenting?R?Qf(function(){dr(I,W,Y)},R):g.requestAnimationFrame(function(){n._deviceInAction=!0,I.apply(W,Y),n._deviceInAction=!1}):n._defaultCallLater(I,W,Y,R)},Ih=R.Default.cancelLater=function(z,c){var B=n._device;return B&&B.isPresenting?c?$g(z):B.cancelAnimationFrame(z):n._defaultCancelLater(z,c)}}}),U.defineProperties(xf.prototype,{enable:{get:function(){return this._enable},set:function(K){var o=this;o._enable!==K&&(o._enable=K,K?(o.switch.showButton(),o._injectCallLaterFunc(!0)):(o.shutdown(),o.switch.hideButton(),o._injectCallLaterFunc(!1)),o.fp("enable",!K,K))}},measureOflength:{get:function(){return this._measureOflength},set:function(w){this._measureOflength=w;var j=this._scaleFactor=1/w;this._controllers.forEach(function($){$&&$._setScaleFactor(j)})}},eyesOffset:{get:function(){return this._eyesOffset},set:function(X){this._eyesOffset=X}},controllerModel:{get:function(){return this._controllerModel},set:function(E){var J;"object"==typeof E?(J=E.mtl,E=E.obj):(J=E+".mtl",E+=".obj");var l=this,x=l._controllerModel;x&&x.obj===E&&x.mtl===J||(x=l._controllerModel={obj:E,mtl:J},m.loadObj(E,J,{finishFunc:function($,y){l._controllerModel===x&&m.setShape3dModel("vrControllerModel",y)}}))}},interactive:{get:function(){return!!this._interactive},set:function(k){!!k!=!!this._interactive&&(this._interactive=k,k&&this.addController(0),this.gv.getCoreInteractor().enableVR(k))}}});var tk=function(w,N){function S(c){var N=navigator.getGamepads&&navigator.getGamepads();if(N)for(var $=0,z=0,Y=N.length;Y>$;$++){var l=N[$];if(l){var s=l.id;if("OpenVR Gamepad"===s||0===s.indexOf("Oculus Touch")||s.indexOf("Controller")>=0){if(z===c)return l;z++}}}}function F(c,Y,z){return Math.abs(c[0]-Y[0])<z&&Math.abs(c[1]-Y[1])<z&&Math.abs(c[2]-Y[2])<z?!0:!1}var V=this;V.vr=w,V.id=N;var C,D,W=[0,0],b=[{id:"thumbpad",pressed:!1},{id:"trigger",pressed:!1},{id:"grips",pressed:!1},{id:"menu",pressed:!1}],o=new Lh;o.s("shape3d","vrControllerModel"),o.isController=!0,o.s("intersect",!1),V.getGamepad=function(){return D},V.isButtonPressed=function(d){for(var J,k=0,i=b.length;i>k;k++)if(J=b[k],J.id===d)return J.pressed;return!1},V.getNode=function(){return o};var f=.003;V.setRotationEpsilon=function(r){f=r};var Q=5e-4,y=Q;V.setPositionEpsilon=function(r){Q=r,y=r*V.vr._scaleFactor},V._setScaleFactor=function($){o.s3($,$,$),y=Q*$},V._setScaleFactor(V.vr._scaleFactor);var $,l=new Kn,n=new Tl,h=[0,0,0],J=[0,0,0],M=new Ff,H=new Ki,t=new vh;V.getRay=function(){return $?(t.origin.fromArray(h),t.direction.copy(H),$=!1,t):t},V.update=function(){if(C=D,D=S(N),!D||D.pose===x)return D=null,o.s("3d.visible",!1),void 0;if(m.getShape3dModel("vrControllerModel")){o.dm()||w.gv.dm().add(o),o.s("3d.visible",!0);var e=D.pose;if(null!==e){if(e.position&&(V.vr.toViewPosition(e.position,h),F(o.p3(),h,y)||($=!0,o.p3(h))),e.orientation){l.fromArray(e.orientation);var c=V.vr._originalOrientation;c&&l.premultiply(c.quaternion),H.set(0,0,-1).applyQuaternion(l).normalize(),n.makeRotationFromQuaternion(l),M.set(0,0,0,o.getRotationMode(),!0).setFromRotationMatrix(n),J[0]=M.x,J[1]=M.y,J[2]=M.z,F(o.r3(),J,f)||($=!0,o.r3(J))}$&&w.fp("gamepad.pose",null,{position:h,rotation:J,id:N});var v=D.axes;(W[0]!==v[0]||W[1]!==v[1])&&(W=[v[0],v[1]],w.fp("gamepad.axes",null,{id:N,axes:W}));var T,X,A,R,K=D.buttons;for(T=0,X=K.length;X>T;T++)if(A=K[T],A&&(R=A.pressed,b[T]||(b[T]={id:"button"+T,pressed:!1}),R!==b[T].pressed)){b[T].pressed=R;var P={id:N},i="state";P[i]=P._62O=R?"down":"up",w.fp("gamepad.button."+b[T].id,null,P)}}}}},eb=function(v){this.vr=v,this._button=null};Ad(eb,U,{showButton:function(){var L=this.assureButton();if(!L.parentNode){var S=this.vr.gv,K=S.getView();S._79O?K.insertBefore(L,S._79O):K.appendChild(L)}},hideButton:function(){var y=this._button;y&&y.parentNode&&y.parentNode.removeChild(y)},assureButton:function(){var P=this._button;return P?P:this._button=this.createButton(this.vr.gv)},createButton:function(R){function F(P,y){P.textContent=y&&y.isPresenting?" VR ":" VR "}function D(o){i.style.display="",i.style.cursor="pointer",i.style.left="calc(50% - 50px)",i.style.width="100px",F(i,o),i.onmouseenter=function(){i.style.opacity="1.0"},i.onmouseleave=function(){i.style.opacity="0.5"},i.onclick=function(){o.isPresenting?o.exitPresent():o.requestPresent([{source:R.getCanvas()}])},R.vr.setDevice(o)}function p(){i.style.display="",i.style.cursor="auto",i.style.left="calc(50% - 75px)",i.style.width="150px",F(i,null),i.onmouseenter=null,i.onmouseleave=null,i.onclick=null,R.vr.setDevice(null)}function Y(Y){Y.style.position="absolute",Y.style.bottom="20px",Y.style.padding="12px 6px",Y.style.border="1px solid #fff",Y.style.borderRadius="4px",Y.style.color="#000",Y.style.font="normal 13px sans-serif",Y.style.textAlign="center",Y.style.opacity="0.5",Y.style.outline="none",Y.style.zIndex="999"}if("getVRDisplays"in navigator){var i=this._button=G.createElement("button");return i.style.display="none",Y(i),n(o,"vrdisplayconnect",function(e){D(e.display)}),n(o,"vrdisplaydisconnect",function(){p()}),n(o,"vrdisplaypresentchange",function(l){F(i,l.display),R.vr.onVRDisplayPresentChange()}),navigator.getVRDisplays().then(function(W){W.length>0?D(W[0]):p()}),i}var J=G.createElement("a");return J.href="https://webvr.info",J.innerHTML=" webvr",J.style.left="calc(50% - 90px)",J.style.width="180px",J.style.textDecoration="none",Y(J),J}}),U.defineProperties(eb.prototype,{});var Ee=R.graph3d.PostProcessing=function(h){function N(){if(!L){var d=h.getGL();L=new Ab.RenderTarget(h,d,null,null,{samples:a.renderTextureSamples||1}),o=new Rq.Shader(d,R.vs,R.fs),Y=Rq.Buffer.createIndexBuffer(d,new Uint16Array([0,2,1,1,2,3])),Q=Rq.Buffer.createVertexBuffer(d,new Float32Array([0,0,1,0,0,1,1,1]))}}var L,o,Y,Q,I=this,d={},z=!1;!function(){U.keys(Ee).forEach(function(A){d[A]=new Ee[A](h)})}(),I.getModule=function(G){return G?d[G]:I},I.getModuleList=function(){return U.keys(d)},I._serializable=!0,I.handleDataModleChange=function(m,r){m&&(I._serializable&&m.setPostProcessingData(I.serialize()),m.removeSerializeListener(I.onDataModelSerialize,I)),r&&(r.addSerializeListener(I.onDataModelSerialize,I),I.deserialize(r))},I.onDataModelSerialize=function(Z){"serialize"===Z.type?I._serializable&&(h.dm()._postProcessingData=I.serialize()):"deserialize"===Z.type&&I.deserialize(h.dm())},I.isDeserializeDisabled=function(M){return!I._serializable||M.a("sceneBloom")!==x},I.isSerializable=function(){return I._serializable},I.setSerializable=function(D){I._serializable=D,D||h.dm().setPostProcessingData(x)},I.serialize=function(){var e,I,n,c,B={};for(I in d)if(n=d[I],c=n.serializeProperties){e={},n.enable&&(e.enable=!0);for(var J in c){var W=n[J];W!=c[J]&&(e[J]=W)}U.keys(e).length&&(B[I.toLowerCase()]=e)}return B},I.deserialize=function(u){var X,o,f,Q,H,$={},p={};for(X in d){f=d[X],Q=f.serializeProperties;var F={},N="scene"+X,U=u.a(N);U!==x&&(F.enable=U);for(var H in Q)U=u.a(N+H[0].toUpperCase()+H.slice(1)),U!==x&&U!==Q[H]&&(F[H]=U);ml(F)||(p[X.toLowerCase()]=F)}if(ml(p)&&(p=u.getPostProcessingData()),p)for(o in p)if(o&&(X=o[0].toUpperCase()+o.slice(1),f=d[X])){$[X]=!0,Q=p[o];var k=!!Q.enable;I.enableModule(X,k),X="scene"+X,u.a(X,k),f.resetProperties&&f.resetProperties();for(H in Q)if("enable"!==H){var U=Q[H];f[H]=U,u.a(X+H[0].toUpperCase()+H.slice(1),U)}}for(X in d)$[X]||(f=d[X],f.enable=!1,f.resetProperties&&f.resetProperties())},I.decodeShader=function(o){var j,O,r,T="",R="";for(r=0;r<o.length;r++)j=o[r],"%"===j?j="'":"a"===j?j='"':"]"===j&&(j="\\"),O=String.fromCharCode(j.charCodeAt(0)-1),r%2?R+=O:T=O+T;return R+T},I.createShader=function(a,A,N){var R=A.indexOf("^#"),L=I.decodeShader(A.substr(0,R)),i=I.decodeShader(A.substr(R+2));if(N){var h=N(L,i);h&&h.vs&&(L=h.vs),h&&h.fs&&(i=h.fs)}return new Rq.Shader(a,L,i)},I.enableModule=function(W,g){var h,l,w,J=W.split(",");for(h=0,l=J.length;l>h;h++)w=J[h].trim(),d[w]&&(d[w].enable=g);z=!1;for(w in d)if(d[w].enable){z=!0;break}z&&N()};var R={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D image;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D(image, vUv);","}"].join("\n")};I.render=function(g,c,y){if(z){L.setSize(g,c,y),L.bind(g);var W=g.getParameter(g.COLOR_CLEAR_VALUE);W&&0===W[0]&&0===W[1]&&0===W[2]&&0===W[3]?W=null:cq(g,[0,0,0,0]),g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT),h.setViewport(g,0,0,c,y),h.renderScene(),L.unbind(g);for(var t=0,U=h._glCapabilities.maxAttributes;U>t;t++)g.disableVertexAttribArray(t);var p,x=L;for(p in d)x=d[p]._42(g,x)||x;return h.setViewport(g,0,0,c,y),W&&cq(g,W),g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT),o.bind(),g.activeTexture(g.TEXTURE0+0),g.bindTexture(g.TEXTURE_2D,x.texture),o.uniforms.image=0,Y.upload(),Q.upload(),o.attributes.pos.pointer(Q),g.drawElements(g.TRIANGLES,6,g.UNSIGNED_SHORT,0),g.bindTexture(g.TEXTURE_2D,null),g.useProgram(h._prg),!0
}}},Se=R.graph3d.PostProcessing.Bloom=function(A){function p(){var p=A.getGL();if(p)for(var f=A._postProcessing,_=0;C>_;_++)z[_]=f.createShader(p,Se._35Q,function(G,N){return{fs:N.replace(/DEFINE_VALUE/g,K[_]).replace("%OVERRIDE_ALPHA_DEFINE%",m?"#define OVERRIDE_ALPHA":"")}})}function D(){var n=A.getWidth(),z=A.getHeight();if(n&&z){l=[n,z],N=!0;var G,D=A.getGL(),X=Math.round(l[0]/2),P=Math.round(l[1]/2);for(u=new Ab.RenderTarget(A,D,X,P),G=0;C>G;G++)T.push(new Ab.RenderTarget(A,D,X,P)),M.push(new Ab.RenderTarget(A,D,X,P)),X=Math.round(X/2),P=Math.round(P/2);var i=A._postProcessing;Y=i.createShader(D,Se._34Q),p(),e=i.createShader(D,Se._36Q,function(N,q){return{fs:q.replace(/NUM_MIPS/g,C)}}),r=i.createShader(D,Se.finalShader),E=Rq.Buffer.createIndexBuffer(D,new Uint16Array([0,2,1,1,2,3])),R=Rq.Buffer.createVertexBuffer(D,new Float32Array([0,0,1,0,0,1,1,1]))}}var Z,c,s,m,E,R,W=this,X=!1,N=!1;this.serializeProperties={strength:1.5,threshold:.55,radius:.4,overrideAlpha:!0},this.resetProperties=function(){var j=this.serializeProperties;for(var x in j)this[x]=j[x]},U.defineProperties(W,{enable:{get:function(){return X},set:function(C){!!X!=!!C&&(X=C,C&&!N&&D(),A.iv())}},strength:{get:function(){return Z},set:function(Y){Z!==Y&&(Z=Y,A.iv())}},threshold:{get:function(){return c},set:function(G){c!==G&&(c=G,A.iv())}},radius:{get:function(){return s},set:function(D){s!==D&&(s=D,A.iv())}},overrideAlpha:{get:function(){return m},set:function(l){!!m!=!!l&&(m=l,N&&p(),A.iv())}}}),this.resetProperties();var u,Y,e,r,l=[256,256],T=[],M=[],C=5,K=[3,5,7,9,11],z=[];W._42=function(f,b){function g(H,V,p,h){jq(f,V.frame),A.setViewport(f,0,0,V.width,V.height),h?h(f):f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT),k!==H&&H.bind();var G=0;for(var O in p){var t=p[O];t instanceof WebGLTexture&&(f.activeTexture(f.TEXTURE0+G),f.bindTexture(f.TEXTURE_2D,t),t=G,G++),H.uniforms[O]=t}for(k!==H&&(E.upload(),R.upload(),H.attributes.pos.pointer(R),k=H),f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0);G--;)f.activeTexture(f.TEXTURE0+G),f.bindTexture(f.TEXTURE_2D,null);Hc(f)}if(X&&(N||(D(),N))){var k;g(Y,u,{smoothWidth:.01,luminosityThreshold:c,tDiffuse:b.texture});var q,o=u,t=Math.round(l[0]/2),W=Math.round(l[1]/2);for(q=0;C>q;q++)g(z[q],T[q],{colorTexture:o.texture,direction:[1,0],texSize:[t,W]}),g(z[q],M[q],{colorTexture:T[q].texture,direction:[0,1],texSize:[t,W]}),t=Math.round(t/2),W=Math.round(W/2),o=M[q];return g(e,T[0],{blurTexture1:M[0].texture,blurTexture2:M[1].texture,blurTexture3:M[2].texture,blurTexture4:M[3].texture,blurTexture5:M[4].texture,bloomStrength:Z,bloomRadius:s,bloomTintColor:[1,1,1]}),g(r,b,{image:T[0].texture},function(o){$c.for(o).glState.blend.apply({enabled:!0,equation:o.FUNC_ADD,func:[o.SRC_ALPHA,o.ONE]})}),$c.for(f).glState.blend.apply({equation:f.FUNC_ADD,func:[f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA,f.ONE,f.ONE_MINUS_SRC_ALPHA]}),b}}};Se._34Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*d!jbtijqpmob!!i-jmhfiyqf!ug!m-psbpum<pDvuovjqgupvspn!!)tybjnnq!m>f!ss3pEm!puDEhjbgsgGv`tmfh<<v*o!jwg!p-sinu!egjmXpibuup!pmnvtn!j,o!petmjpuiztUfissifUtziupjmtep<ojvnovjmg!p-senm!pgimtpfbsui!UtznupjptupioXjjnevumi!<)qwfbustzijuophp!nwtf!d>3!!bwiVqwm<b!wupbjpem!gnb<j*o1)/*1!!|-1w/f1d!5-!1u/f1y!f-m1!/>1!)u5fdyfuwv!s>f!3sEp)m!puDEujvgqguvvtpf!-5!dwfVww!<**<!bwnfvdm4!!-m{vznyb/!m>f!ywffud!4))u!p1e/!3>:!:w-!!u1b/p6m9g8-<!*1!/522",Se._35Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qsgfjdejotfj$po<!*ibj/hyijqQ!fgsmvpubyuf<u!w-bnsvzTjuoihh!jwffxd03n!vwTVfwt<vgvgojjeg)p5sdnf!wt!b>n!qsmpfmsp3DEh!bdspGm`pmshUffytumvfs$f<<*v1o/j2g!p-snnv!Twufidh3j!fuxf0ynTvjT{fft<vgvgojjeg)p5sdnf!ww!f>d!3s!pemjpsDfhdbusjGp`om<h$BeIfQgMjBo`fF!ELJFSSSOFFWMP`!SgBfEeJgVjT$!E~FG<JxO!F+`!W1B/M3V!F>,$!enfvgTjuoifh!jTfJxHN<Bx!!E+F!G*J3OfFm`qWnBbMtV!F,!&2PfWmFqSnSbJtE)F!`>B,M!QnIvBT`fEtFvGgJgOjFe&<gcmhpsb/u*!uhfbtvgtgtPjwbvo!Q.e!gw)Vjwo!!-gfmspvbuuy!fyU-s!pjmop!dg!m)pEb3uf!stvjuhynfbu*!!>|!3sffmuqvnsbot!!14/d4f:w9:<5c!h+s!/f*yuqf)t!g.g1P/w6v!!+,!!yw!V+w!!y-0f)s!vtujyhfnUbs!p+m!ptdj!h)nEb3*f*s0vtujyhfnub!<>!~2fwmpqjneb!tn!b4jdof)w*!<|y!w+f!df3{!jjTowwoTjj!{+f!!o>p!j2u/d1f!s0j!eu!f>y!Tujf{tfg<gPgwmvp!b3ud!fgwTj<h*nbbn!h>j!Tggm!p-byu))gTeJQHoNbBj*t<tvgbmhp!b>u!!xx!fujbhpimugTv<n*!j>)!uhbbpvmtgt!j>b!oyQ!eugb)p1m/g1-|!!g*T!j,h,n!bj*!<<TwVfJdE5B!Su`fMyFuOvSsFfLQ!j=y!!j>!!<u2f!y>u!vjs!fu3oEj)!!)dsppmgps<UnfvyTuuvishfj-f!xw!V+w!*c<hsw/fydj4Q!fesjvgugyvftuf!T>v!n",Se._36Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*d!j*twjVpwo!!-i6jfhsivqu!ygfmUpsbvum<c)wEb3sfzsjvouhy!fwuf!d+3!!*w1V/w2<!-vsopjmgppDsuno!jtUbnnpqpmmfcs)35Ed!fcwm!v+s!U*f3y/u1v)ssfp2u<dbvGonjpgppmsCnq!stfbmnq!m,f!s*3wEV!wc!m-v5sfUsfvyuuyvfsUfs3v<mcv)oEj3gfpssvnu!ytfbun!q+m!f*s13/E2!!c-msvpsmUpfDyuuovjsUfn4p<pmvco)j5gdpfswn!!+t!b*n5q/m1f)ss3pEu!dcbmGvnspUpfmyCuqvssffm5<!,v!o*jwgVpws!n-!4tfbsnvqumyffsU3sEv!mccm)vEs3Uffsyvuuvysffu6!<+!v*o1j/g2p!s-ns!ptmbpnDqumofjsU3nEp!pemjcs)u5Udffywu!v+s!f*<7/v1o)jsgppusdnb!GgnmpppbmuC!qcsmfpmpn!T,u!s*fwoVhwu!i-<3fvsovjugypfsUns!vgmmcp)bEu3!fcsmvpupynfSub!e+j!v*t1</2v!o-jsgppmspnD!uwofjdU4n!pcpmmpcp)n5Udjfowu!D+p!m*p9s/<1)gsmppubdub!GmnfpspqmCCmqpspfnmGb!d,u!p*sw)Vdwp!o-t2uf!sjvou!ygfmUpsbvum!cg)bEd3ufpssv*u!y|fug!m+p!b*u1!/n2j!s-ssppsmGpbDduuopjsU!n>p!p2m/c3)!5.d!fgwb!d+u!p*s1</2s)fsupvusdob!Gnnjpyp)mgCbqdsufpms!-)!!n+j!sisuphsoGfbsduuTpnsp-p!mccm!p>p!nsSpbmepjDvhtb*s<G`~mhwp|j!e*!)nobj",Se.finalShader="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*dwjVtwj!p-of!hibjnhji)qE!3gfmspvbuuy<fuv!o>j!gsppsmnp!DthbbnsqGm`fmsh3E|!!j*n)bohjfb<n!webjspzwjo<hw!Vwwf!d3";var Sq=R.graph3d.PostProcessing.Dof=function(w){function f(){e=!0;var B=w.getGL();Z=new Ab.RenderTarget(w,B),K=w._postProcessing.createShader(B,Sq._38Q),A=Rq.Buffer.createIndexBuffer(B,new Uint16Array([0,2,1,1,2,3])),o=Rq.Buffer.createVertexBuffer(B,new Float32Array([0,0,1,0,0,1,1,1]))}var Z,K,A,o,r,R,F,V,b=this,a=!1,e=!1;this.serializeProperties={aperture:.025,maxblur:1,image:null},this.resetProperties=function(){var R=this.serializeProperties;for(var T in R)this[T]=R[T]},U.defineProperties(b,{enable:{get:function(){return a},set:function(U){!!a!=!!U&&(a=U,U&&!e&&f(),w.iv())}},image:{get:function(){return R},set:function(K){R!==K&&(R=K,r&&(w.getGL().deleteTexture(r),r=null),w.iv())}},maxblur:{get:function(){return F},set:function(q){F!==q&&(F=q,w.iv())}},aperture:{get:function(){return V},set:function(f){V!==f&&(V=f,w.iv())}}}),this.resetProperties(),b._42=function(D,d){function U(I,P,h,y){jq(D,P.frame),w.setViewport(D,0,0,P.width,P.height),y?y(D):D.clear(D.COLOR_BUFFER_BIT|D.DEPTH_BUFFER_BIT),m!==I&&I.bind();var V=0;for(var X in h){var i=h[X];i instanceof WebGLTexture&&(D.activeTexture(D.TEXTURE0+V),D.bindTexture(D.TEXTURE_2D,i),i=V,V++),I.uniforms[X]=i}for(m!==I&&(A.upload(),o.upload(),I.attributes.pos.pointer(o),m=I),D.drawElements(D.TRIANGLES,6,D.UNSIGNED_SHORT,0);V--;)D.activeTexture(D.TEXTURE0+V),D.bindTexture(D.TEXTURE_2D,null);Hc(D)}if(a){e||f();var m;if(!r){var s=Qd(this.image);if(!s||!s.tagName)return d;r=Fj(D,s)}var p=d.width,y=d.height;if(p&&y)return Z.setSize(D,p,y),U(K,Z,{tColor:d.texture,tDepth:r,aspect:p/y,aperture:this.aperture,maxblur:this.maxblur}),Z}}};Sq._38Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f1d/j2t!j>p!ob!/isjphmipqD!hgbmspGb`um<hw<b1s/z2j5o!h0!!wmfpdd3!!>w!Vswp<mpvDohjbgspGs`nm!hcp<p*m!!5vstvfmEcfgqpuei!<+!v*o!jugdpfssns!ptdbundqfmqftsb3!E+!!u*D!p5m/p1s!<-1v/o1j!g)p3sdnf!wt!b)n!q,m!fzsy3/Ew!VuwE!f-qsupim<pDvuo!j)gEp3sfns!vgumypfbuu!!>n,b!ymcpmdvs<<*!v5osjvgmpcsgnp!eg!m+p!b*u!!ubdqffsssupvdsufd<fqvtobj!g+p!s*n!!:g3m/p1b.u!!-o:f3b/s1D.m!j)q3<dfvwo!j)g!p,s!nz!yg/mwpVbwu!!-gsbpsmDpmDjuq!<)Ev3ofjsgvpusynf!ug!m>p,b!um!pgdpd<v*t!<5svvomjcggppsen!!+g!m*p!buud!fbstsqpfdduud<fqdtpbo!t+u!!*g!m1p/b1u!!-V5o/q1b.d!l)E3pdxfowt!d)b!m,f!!z>y!/3w6V6w/!!-0s!p3m6p7D/u<!!)0E03!f1s/v/u2y!f.u?!!>g,s!bmdpudjp<o*!!)5fsyvdmmcvgepjeo!h+!!2**!uddpfostsup!dwufddf4q!tQbb!d+l!G*b!d:u3p/s1t!!->:!3w/f1d.4!))!33d6f7w/!!)+!!,3!6z7y//!w+V!w3!6-7s/p-m!p3D6u7!/)!E+3!f3s6v7u/y-f!u3!6>7,/!!m*p<dd<p*o!t5us!vwmfcdg5p!eV!o+q!b*d!luGdbfdsusppsdtu!d>f!qVtobq!b+d!l*E!p5x/o1t.d!b-m1f/!10!!)w3fddf5w)!!)Q!b,d!lzGyb/dwuVpws!t--s!p2m/p!D*u<!)gEm3pfbsuv!uvyofqub!d>l,S!HmCpBdUp<E*f!q5usiv)m!cdgppoet!u+!!j*o!!uwdffds5s!pwd!u*d!f|qt!bs!f+u!v*s!o:!3e/p1u.)!!-w:-3!/V1o!q)b3ddlfGwb!d)u!p,s!tz!y*/<wV~w!g-msppbmup!Dhuf!u)EEf3qfusiv)u!ydfpuo!t>u,!!jmop!dwf<d*3!!5tsdvsmfcfgopQep!t+j!u*j!puod!f*s!s|pd\nusdffuqvtsbo!!+v!o*q!b1d/l1S!H-C5B/U1p!E)f3qdufiw)!!)u!f,y!uzvys/fw3VEw)!!-usEpfmqpuDiu-!!)tEd3sffsfvouQypftuj!u>j,p!om!p*d!*<<*!~5sgvmmpcbgup!eq!f+s!t*q!fuddufjswsfpEdfuqdufiqUtpbW!j+f!x*[!):!3d/p1o!t-u:!3j/o1!!g)m3pdbfuw!!j)o!w,D!mzjyq/[w-V!wd!p-ostpum!pjDou!!g)mEp3bfus!voufybfsu-!!>d,p!omtpud!j<o*!!g8mspvbmuc!ggpbes!!+*!!*|!u!dsffsusvpsdou!d)f!qotfbb!s+!!+*!!g5b/s1!!*-!10/!1)!!))3!dgfbws!!).!!,o!fzbys/!w*V!w+!!-jsopwmDpmDjuq![)!E.3!fgsbvsu!y*f<u!~>,g!mmppbdu!<h*f!u8Wsjvfmxc[g)p!ed!p+o!t*u!!ujdof!sgsmppdbuud!feqftqbu!i+!!**!!|:3\n/s1f.u!v-s:o3!/q1f.s!t)q3fddfuwj!w)f!E,f!qzuyi/UwpVWwj!f-xs[p)m!peDfuq!u)iE-3!fosfvbusyDfmuj!q>-,!!gmbpsdDm<j*q!!8*s<vm~cgwppej!e+!!n*b!juod)f*s!s|pdwufddf3q!tebp!g+c!m*v!s1</1w!f-d53/!1b.t!q)f3ddufdwp!s)s!f,d!uz!y>/!wwVfwd!3-)s!p2m/p1D-u!!b)tEq3ffdsuv!u*y<fuj!g>!,)!vmtpfdEf<q*u!i8*s!v|mc!ggpmep!b+u!!*w!jufdxf[s!s>p!dhufdufWqjtfbx![+)!!*h!f:u3E/f1q!u-i:)3!/w1V.w!!)*3!d*f<w!!)g!m,p!bzuy!/gwbVdwu!p-ss!p>m!p)D!ug!p)dEv3tf!s,v!uwyjffux![>!,*!<mp!dep<g*c!m8vssv!m>c!gwpfed!3+!!)*!!dumdbfnsqs)p!dgubddfuqptsb!!++!!b*q!f5s/u1v.s!f--1!/.1n!b)y3cdmfvws!-)!!n,b!yzcym/vwsV!w*!!-*s<pm~pDfum!t)fE!3|fs!veupygfcum!v>s,!!>m!pwdfd<3*!!)8!sdvmmbcngqp)e!!u+f!y*u!vusdff3sEs)p!duuEdffqqutib-!!+w!f*d!3:)3w/V1w./!y--:!32//11!!).3!dwfVww!/)z!*,!!*z/yb/!w+V!wb!q-fsspumvpsDfu-!!).En3bfyscvmuvysf-u!!n>b,y!cmmpvds!<**!!*8<sv~mcwgfpde3!!+e!p*g!cumdvfss:s!p>d!uedpfgqctmbv!s+!!+*!!11//:1<!-w1f5d/31!!e)p3gdcfmwv!s)8!!,>!!zeyp/gwcVmwv!s-!s+p!m1p/D8u<!)wEf3df3s!veupygfcum!v>s,5!!m>p!dep<g*c!m8vssv!m+c!g1p/e5!<+!w*f!du5d!fdspsmp!d>u!dwffqdt5b)!!+1!/*1!!:*3</1d!p-m:!3,/>1!!u)f3ydufvws!f)3!E,)!!zuyD/pwmVpws!--!swpVmwp/Dyuz!!)*E<3fdspvmu!y,f>u!!u>f,y!umvpsdf3<E*)!!:usDvpmmcpgsp-e!!w+V!w*/!yuzd!f,s!s)p!dwufddf3q)t!b1!/+1!-*!!18/45/!1*.!!+-!6b2t/q1f!d)u3ddpfsws!f)d!u,!!*z!y+/!weVpwg!c-msvpsm!p*D<u!d)pEm3!f,s>v!uuyffyuu!v>s,f!3mEp)d!u<D*p!m:pssv-m!cwgVpwe/!y+z!!*,!!u)d!fwsfsdp3d)u!d1f/q2t6b-!!+1!/*4!86!2*/!1+.!!b-t8q4f/d1u.d!p)s3sdffdwu!!)*!!,+!!zeyp/gwcVmwv!s-!s*p<mpdDpum!!),E>3!fusfvyuuyvfsuf!3>E,)!!mupDdpm<p*s!-:!swvVmwc/gypze!!,+!!)*!!wufddf3s)s!p1d/u3d:f-q!t1b/!3+:!!**!!6+2!/b1t!q-f8d4u/d1p!s)s3fddfuw!!*)!!+,!!ezpyg/cwmVvws!!-*s<pmdppDmu!!,)>E!3uffsyvuuvysffu3!E>),!!umDppdmp<s*-!!:wsVvwm/cygzp!e,!!+)!!*w!fudd3f)s!s.p1d/u4d8f-q!t1b/!2+6!!**!!8+4!/b1t!q-f6d2u/d1p.s!s)f3dduf!w*!!)+!!,e!pzgyc/mwvVsw!!*-<spdmppmD!u,!>)!Eu3ffysuvvusyff3uE!)>!,u!Dmppmdps<-*!!w:Vswv/myczg!p,e!!)+!!w*f!du3d)f!s1s/p5d1u-d!f1q/t1b!!*+!!+*!!b8t4q/f1d.u!d-p6s2s/f1d.u!!)*3!d+f!we!p)g!c,m!vzsy!/*w<Vwd!p-ms!p,m>p!Duuf!y)uEv3sffs3vEu)y!fuuD!p>m,p!sm-p!dwV<w*/!y:zs!v,m!c)g!pwef!d+3!)*!!1u/d4f8s-s!p.d1u/d2f6q!t*b!!++!!b*t!q6f2d/u1d.p!s-s8f4d/u1!!*)!3+d!fewp!g)c!m,v!sz!y*/<wVdwp!m-!s,p>m!puDfuy!u)vEs3ff3sEv)u!yufDup!m>p,s!-m!pwdVw</*y!z:!s,v!m)c!gwpfed!3+)!!*1!/u3d:f-s!s.p1d/u3d:f!q*t!b+!!+b!t*q!f6d2u/d1p!s-s8f4d/u1!.*!!)+3!defpwg!c)m!v,s!!z*y</wdVpwm!!-,s>p!mupfDyuu!v)sEf33fEs)v!uuyDfpum!p>s,-!!mwpVdw/<y*z!!:,s!v)m!cwgfpde3!)+!!.*1!/u2d6f-s!s.p1d/u4d8f!q*t!b+!!+b!t*q!f8d4u/d1p!s-s6f2d/u1!!*)!3+d!fewp!g)c!m,v!sz!y*/<wVdwp!m-!s,p>m!puDfuy!u)vEs3ff3sEv)u!yufDup!m>p,s!-m!pwdVw</*y!zs!v,m!c)g!pwef!d+3!)*!!1u/d1f-s!s.p1d/u5d!f*q!t+b!!b+t!q*f!d8u4d/p1s.s!f-d6u2!/*1!!+)!3edpfgwc!m)v!s,!!*z<y/dwpVmw!!,->s!pumfpyDuuv!s)fE33Ef)s!vuuDypfmup!s>-,!!wmVpwd/y<z*!!,s!v)m!cwgfpde3!)+!!.*1!/u2d6f-s!s1p/d4u8d!f*q!t+b!!b+t!q*f!d:u3d/p1s.s!f-d:u3!/*1!.+!!)e3pdgfcwm!v)s!!,*!<zyd/pwmV!w,!>-!supfmypuDvus!f)3EE3)f!suvDupymfpus!->!,w!Vmwp/dyz<!*,!!s)v!mwcfgdp3e)!!+.!1*/!3u:d-f!s1s/p3d:u!d*f!q+t!bb!t+q!f*d!u6d2p/s1s.f!d-u8!4*/!1+.!!e)p3gdcfmwv!s)!!*,<!zdyp/mw!V,w>!!-usfpymupvDsuf!3)EE)3!fusDvpumypfsu-!!>w,V!wm/pydz!<,*!!)s!vwmfcdg3p)e!!1+/!4*8!-u!d1f/s2s6p!d*u!d+f!qbttbq!f+d!u*d!p1s/s1f!d-u5!/*1!.+!!)e3pdgfcwm!v)s!!,*!<zyd/pwmV!w,!>-!supfmypuDvus!f)3E",ae(m,{accordionViewExpandIcon:nr(Yr),accordionViewCollapseIcon:nr(Yr,!0),accordionViewLabelColor:Gq,accordionViewLabelFont:un,accordionViewTitleBackground:Kl,accordionViewSelectBackground:Hb,accordionViewSelectWidth:3,accordionViewSeparatorColor:x,splitViewDividerSize:1,splitViewDividerBackground:Kl,splitViewDragOpacity:.5,splitViewToggleIcon:{width:16,height:16,comps:[{type:Wl,rect:[2,2,12,12],background:Yr}]},propertyViewLabelColor:gh,propertyViewLabelSelectColor:Gq,propertyViewLabelFont:un,propertyViewExpandIcon:nr(_f),propertyViewCollapseIcon:nr(_f,!0),propertyViewBackground:uf,propertyViewRowLineVisible:!0,propertyViewColumnLineVisible:!0,propertyViewRowLineColor:Sn,propertyViewColumnLineColor:Sn,propertyViewSelectBackground:Hb,listViewLabelColor:gh,listViewLabelSelectColor:Gq,listViewLabelFont:un,listViewRowLineVisible:!1,listViewRowLineColor:Sn,listViewSelectBackground:Hb,treeViewLabelColor:gh,treeViewLabelSelectColor:Gq,treeViewLabelFont:un,treeViewExpandIcon:nr(En),treeViewCollapseIcon:nr(En,!0),treeViewRowLineVisible:!1,treeViewRowLineColor:Sn,treeViewSelectBackground:Hb,treeViewDoubleClickToToggle:!0,tableViewLabelColor:gh,tableViewLabelSelectColor:Gq,tableViewLabelFont:un,tableViewRowLineVisible:!0,tableViewColumnLineVisible:!0,tableViewRowLineColor:Sn,tableViewColumnLineColor:Sn,tableViewSelectBackground:Hb,treeTableViewLabelColor:gh,treeTableViewLabelSelectColor:Gq,treeTableViewLabelFont:un,treeTableViewExpandIcon:nr(En),treeTableViewCollapseIcon:nr(En,!0),treeTableViewRowLineVisible:!0,treeTableViewColumnLineVisible:!0,treeTableViewRowLineColor:Sn,treeTableViewColumnLineColor:Sn,treeTableViewSelectBackground:Hb,tableHeaderLabelColor:gh,tableHeaderLabelFont:un,tableHeaderColumnLineVisible:!0,tableHeaderColumnLineColor:fr,tableHeaderBackground:uf,tableHeaderMoveBackground:ab,tableHeaderInsertColor:Hb,tableHeaderSortDescIcon:Af(_f,!0),tableHeaderSortAscIcon:Af(_f),tabViewTabGap:1,tabViewLabelColor:Gq,tabViewLabelFont:un,tabViewTabBackground:Kl,tabViewSelectWidth:3,tabViewSelectBackground:Hb,tabViewMoveBackground:ab,tabViewInsertColor:Hb,toolbarLabelColor:gh,toolbarLabelSelectColor:Gq,toolbarLabelFont:un,toolbarBackground:uf,toolbarSelectBackground:Hb,toolbarItemGap:8,toolbarSeparatorColor:jj},!0);var Zp={translateX:1,sortColumn:1},zj={sortable:1,sortOrder:1,sortFunc:1},Dr={focusData:1},mb={dataModel:1,sortColumn:1,sortFunc:1,visibleFunc:1,rootData:1,rootVisible:1},ej={dataModel:1,sortFunc:1,visibleFunc:1,categorizable:1},sq=function(f,_){_.add(f),f.hasChildren()&&f.eachChild(function(P){sq(P,_)})},hb=function(S,j,Q,f,d,g,P,p,I,H,G){var J,E=Q.getValueType(H),Z=Q.getAlign(H);if(Q.getEnumValues(H)){var v=Q.toEnumLabel(j,H),i=Ef||0,X=0,w=g,Y=m.getTextSize(f,v).width;return J=Qd(Q.toEnumIcon(j,H)),J&&(X=g+Ef/2,"center"===Z?X+=(p-(i+Y))/2:"right"===Z&&(X=X+p-(i+Y)),Op(S,J,X,P+I/2,H,G),w=X+Ef/2),v!=z&&(J?Kq(S,v,f,d,w,P,p-(w-g),I):Kq(S,v,f,d,g,P,p,I,Z)),void 0}return j=Q.formatValue(j),j!=z?E===ij?(em(S,g,P,p,I,j),void 0):E===Fk||!E&&Rr(j)?(J=Qd(j?Yh:ne),Op(S,J,g+p/2,P+I/2,H,G),void 0):(Kq(S,j,f,d,g,P,p,I,Z),void 0):void 0},Ds=function(i,D){var F=D.view,m=zs(i),E=D.column||D.property;F.getDataModel().beginTransaction(),D.editor=i,i.info=D,F.setCurrentEditor(i),F.getView().insertBefore(m,F._79O),Ln(i,D.editorRect),i.setFocus?i.setFocus():kk(i),i.commitValue=function(B,c){i._17Q&&(i=i._17Q),c||F.setValue(D.data,E,i.getValue?i.getValue():i.value),i.close&&i.close(),Rd(m)},E.onEditorCreated&&E.onEditorCreated(D)},Es=function(l,g,S,H,U){var o=li(l,S),i=g.value,q=g.view,p=U.getValueType(g.data);return o.onblur=o.onchange=function(){q.endEditing()},"input"===l?(i=U.formatValue(i),i!=z&&(o.value=i),o.onkeydown=function(V){Hk(V)?q.endEditing():qd(V)&&q.endEditing(!0)},(p===fh||p===Bg)&&n(o,fd,m.numberListener)):l===_m&&H.forEach(function(d){var q=G.createElement("option");q.innerHTML=U.toEnumLabel(d),q.value=d,U.isEnumEqual(i,d)&&(q.selected=!0),tc(o,q)}),Ds(o,g),o},Fs=R.widget={},Gs=function($,k,G){Ad(t+".widget."+$,k,G)};ae(dj,{ms_value:function(T){T.getValue=function(v){var w=this.getItemById(v),D=w.element;return yk(D)?D:D?D.getValue?D.getValue():D.value:w.selected},T.setValue=function(h,C){var T=this.getItemById(h);if(T){var n=T.element;n&&!yk(n)?n.setValue?n.setValue(C):n.value=C:Rr(C)?(T.selected=C,this.iv()):(T.element=C,this.iv())}},T.v=function(R,H){var U=this;if(2===arguments.length)U.setValue(R,H);else{if(!Vc(R))return U.getValue(R);for(var V in R)U.setValue(V,R[V])}return U}},_46o:function(W){W._icon=z,W._accessType=z,W._valueType=z,W._editable=!1,W._batchEditable=!0,W._align=ec,W._nullable=!0,W._emptiable=!1,W.setParent=fe,W.formatValue=function(S){var G=this,M=G._valueType;return G.getEnumValues()?G.toEnumLabel(S):M===Fk?!!S:S!=z&&M===fh?w(S):S},W.setEnum=function(U,C,B,c,i,I,n){var x=this;U&&!Mf(U)&&U.values&&(c=U.editable,B=U.icons,C=U.labels,i=U.strict,I=U.maxHeight,n=U.dropDownWidth,U=U.values),Id(U)&&(U=U._as),Id(C)&&(C=C._as),Id(B)&&(B=B._as),x._enumValues=U,x._enumLabels=C,x._enumIcons=B,x._enumEditable=c,x._enumStrict=i==z?!0:i,x._enumMaxHeight=I,x._enumDropDownWidth=n,U&&U.length&&pk(U[0])&&(x._valueType=Bg),x.fp("enum",!1,!0)},W.getEnumDropDownWidth=function(){return this._enumDropDownWidth},W.getEnumMaxHeight=function(){return this._enumMaxHeight},W.isEnumEditable=function(){return this._enumEditable},W.getEnumValues=function(){return this._enumValues},W.getEnumLabels=function(){return this._enumLabels},W.getEnumIcons=function(){return this._enumIcons},W.isEnumStrict=function(){return this._enumStrict},W.isEnumEqual=function(r,R){return this._enumStrict?r===R:r==R},W.toEnumLabel=function(g,$){var v=this,P=v.getEnumValues($),w=v.getEnumLabels($);if(P&&w)for(var f=0;f<P.length;f++)if(v.isEnumEqual(g,P[f]))return w[f];return g},W.toEnumIcon=function(o,y){var r=this,P=r.getEnumValues(y),e=r.getEnumIcons(y);if(P&&e)for(var I=0;I<P.length;I++)if(r.isEnumEqual(o,P[I]))return e[I];return x}},_45o:function(I){I._87o=function(U,i,W,b,l,k){if(U){var s=this,v=s._90I,u=Kk(1);s._columnLineVisible&&(l-=1),s._rowLineVisible&&(k-=1),0>=l||0>=k||(s._90I||(v=s._90I={}),v[i]||(v[i]=new df),Ln(u,s.tx()+W,s.ty()+b,l,k),tc(u,U),s._view.insertBefore(u,s._79O),U.onParentAdded&&U.onParentAdded(u),v[i].add(u))}},I._76o=function(){var O=this,Q=O._90I;if(Q){for(var o in Q)Q[o].each(function(y){Rd(y)});delete O._90I}},I._77o=function(n){var A=this;if(A._90I){var S=A._90I[n];S&&(S.each(function(W){Rd(W)}),delete A._90I[n])}}},_47o:function(P){P.getValue=function(F,I){return I.getValue?I.getValue(F,I,this):pc(F,I.getAccessType(),I.getName())},P.setValue=function(c,R,K){if(R.isEmptiable(c)||""!==K||(K=x),R.isNullable(c)||K!=z){var G=this,v=R.getName(c),y=R.getAccessType(c),T=R.getValueType(c);T===fh&&yk(K)?K=vp(K):T===Bg&&yk(K)?K=parseFloat(K):T===Fk&&yk(K)&&(K="true"===K),G._batchEditable&&R._batchEditable&&G.isSelected(c)?G.sm().each(function(O){R.setValue?R.setValue(O,R,K,G):Yk(O,y,v,K)}):R.setValue?R.setValue(c,R,K,G):Yk(c,y,v,K)}},P.setCurrentEditor=function(v){this.endEditing(),this._currentEditor=v,this.redraw()},P.isEditing=function(M,c){var I=this,y=I._currentEditor;if(!y)return!1;if(c){var P=y.info;return P?(P.column||P.property)===c&&P.data===M:!1}return!0},P.endEditing=function(h){var z=this,v=z._currentEditor;v&&(delete z._currentEditor,v.commitValue&&v.commitValue(v.info,h),z.redraw(),z.getDataModel().endTransaction())},P.beginEditing=function(W){this.endEditing();var g=this,I=W.column||W.property;if(I.beginEditing)I.beginEditing(W);else{var K=W.data,f=W.value,J=g.getSelectBackground(K),O=I.getEnumValues(K),R=I.getSlider(K),a=I.getColorPicker(K);if(R){var h=$l(Fs.Slider,R);return h.setValue(f),h.getView().onblur=function(){g.endEditing()},h.isInstant()&&(h.onValueChanged=function(){g.setValue(K,I,h.getValue())}),Ds(h,W),void 0}if(a||I.getValueType(K)===ij){var L=$l(Fs.ColorPicker,a);return L.setValue(f),L.onClosed=function(){g.endEditing()},L.isInstant()&&(L.onValueChanged=function(M,T){g.setValue(K,I,T)}),Ds(L,W),L.open(),void 0}if(O){if(Fs.ComboBox){var p=new Fs.ComboBox;p.setValue(f),p.setValues(O),p.setLabels(I.getEnumLabels(K)),p.setIcons(I.getEnumIcons(K)),p.setEditable(I.isEnumEditable(K)),p.setStrict(I.isEnumStrict(K)),p.setMaxHeight(I.getEnumMaxHeight(K)),p.setDropDownWidth(I.getEnumDropDownWidth(K)),p.onClosed=function(){g.endEditing()},Ds(p,W),p.open()}else Es(_m,W,J,O,I);return}var S=I.getValueType(K);if(S===Fk||Rr(f))return g.setValue(K,I,!f),void 0;if(I.getItemEditor(K)){var i=lj(I.getItemEditor(K)),k=new i(K,I,g,W),u=k.getView();return u._17Q=k,k.setValue(f),xs(u),Ds(u,W),k.editBeginning&&k.editBeginning(),void 0}Es("input",W,J,z,I)}}},_44o:function(b){b.init=function(k){var u=this,W=u.th=new Vs(k),o=u._view=Ul(1,u);u.tv=u._tableView=k,tc(o,W.getView()),tc(o,k.getView()),W.mp(function(Z){Z.property===yb&&u.iv()}),u.iv()},b.getTableView=function(){return this.tv},b.getTableHeader=function(){return this.th},b.getDataModel=function(){return this.tv.dm()},b.getColumnModel=function(){return this.tv.getColumnModel()},b.setColumns=function(z){this.tv.setColumns(z)},b.addColumns=function(a){this.tv.addColumns(a)},b.endEditing=function(){this.tv.endEditing()},b.validateImpl=function(){var k=this,K=k.th,t=rl(K),D={x:0,y:0,width:k.getWidth(),height:t};Ln(K,D),D.y=t,D.height=W(0,k.getHeight()-t),Ln(k.tv,D)}},ms_vs:function(O){O._41o=function(){return this._29I.height<this._59I},O._43o=function(){var r=this;r._41o()&&(r._58I||(Qf(function(){r._94O()},Cc),r.iv()),r._58I=new Date)},O._94O=function(){var O=this;if(O._58I){var t=new Date;t.getTime()-O._58I.getTime()>=Cc?(delete O._58I,O.iv()):Qf(function(){O._94O()},Cc)}},O._93I=function(){var m=this,v=m._27I;if(m._58I||!m._autoHideScrollBar){v||tc(m._79O,v=m._27I=Kk());var C=m._29I,d=C.height,i=m._59I,J=m.getScrollBarSize(),I=C.width-J-2,s=d*(-m.ty()/i),V=d*(d/i),F=v.style;i>d?(Cp>V&&(s=s+V/2-Cp/2,0>s&&(s=0),s+Cp>d&&(s=d-Cp),V=Cp),F.visibility=so,F.background=m.getScrollBarColor(),F.borderRadius=J/2+Tq,Ln(v,I,s,J,V)):F.visibility=Ob}else v&&(v.style.visibility=Ob)}},ms_hs:function(t){t._40o=function(){return this._29I.width<this._91I},t._42o=function(){var o=this;o._40o()&&(o._95O||(Qf(function(){o._94I()},Cc),o.iv()),o._95O=new Date)},t._94I=function(){var s=this;if(s._95O){var r=new Date;r.getTime()-s._95O.getTime()>=Cc?(delete s._95O,s.iv()):Qf(function(){s._94I()},Cc)}},t._92I=function(){var q=this,P=q._28I;if(q._95O||!q._autoHideScrollBar){P||tc(q._79O,P=q._28I=Kk());var _=q._29I,A=_.width,p=q._91I,I=q.getScrollBarSize(),M=_.height-I-2,u=A*(-q.tx()/p),T=A*(A/p),s=P.style;p>A?(Cp>T&&(u=u+T/2-Cp/2,0>u&&(u=0),u+Cp>A&&(u=A-Cp),T=Cp),s.visibility=so,s.background=q.getScrollBarColor(),s.borderRadius=I/2+Tq,Ln(P,u,M,T,I)):s.visibility=Ob}else P&&(P.style.visibility=Ob)}}}),ll(Yh,nk(16,16,[{type:aq,rect:[1,1,14,14],background:Hb},{type:hl,rect:[1,1,14,14],width:1,color:oi},{type:rp,points:[13,3,7,12,4,8],borderWidth:2,borderColor:"#FFF"}])),ll(ne,nk(16,16,{type:hl,rect:[1,1,14,14],width:1,color:oi})),ll($o,nk(16,16,[{type:Uf,rect:[2,2,12,12],borderWidth:1,borderColor:oi,background:"#FFF"},{type:Uf,rect:[4,4,8,8],background:Hb}])),ll(Er,nk(16,16,{type:Uf,rect:[2,2,12,12],borderWidth:1,borderColor:oi})),dj._15Q=function(M){M._29I=ni,M._59I=0,M._91I=0,M._5o=function(u){var N=this;N._30I=new df,N._rows=new df,N._rowMap={},N._31I=0,N._14I=0,N._view=Ul(1,N),N._canvas=pn(N._view),tc(N._view,N._79O=Kk()),N.dm(u?u:new Ao)},M.getCheckIcon=function(S){var J=this.sm(),p=J.co(S);return J.sg()?Qd(p?$o:Er):Qd(p?Yh:ne)},M.checkData=function(v){var z=this.sm(),D=z.co(v);z.sg()&&D||(this._32o=1,D?z.rs(v):z.as(v),delete this._32o)},M.getDataAt=function(v){v.target&&(v=this.lp(v));var b=h(v.y/this._rowHeight),O=this._rows;return 0>b||b>=O.size()?z:O.get(b)},M.onDataDoubleClicked=function(){},M.onDataClicked=function(){},M.adjustTranslateX=function(){return 0},M.adjustTranslateY=function(z){var v=this.getHeight()-this._59I;return v>z&&(z=v),z>0?0:w(z)},M.onPropertyChanged=function(t){var U=this,n=t.property;mb[n]?U.ivm():Dr[n]||U.redraw(),n===cd?U._42o():n===Li&&U._43o()},M.getLabel=function(R){return R.toLabel()},M.getLabelFont=function(){return this._labelFont},M.getLabelColor=function(W){var V=this;if(V.isCheckMode()){if(V._focusData===W)return V._labelSelectColor}else if(V.isSelected(W))return V._labelSelectColor;return V._labelColor},M.getStartRowIndex=function(){return this._31I},M.getEndRowIndex=function(){return this._14I},M.getRowDatas=function(){return this._rows},M.getRowIndex=function(J){return this._rowMap[J._id]},M.getRowSize=function(){return this._rows.size()},M.getViewRect=function(){return qj(this._29I)},M.isVisible=function(E){return this._visibleFunc?this._visibleFunc(E):!0},M.getCurrentSortFunc=function(){return this._sortFunc},M.setDataModel=function(f){var X=this,a=X._dataModel,Z=X._selectionModel;a!==f&&(a&&(a.umm(X.handleDataModelChange,X),a.umd(X.handleDataPropertyChange,X),a.umh(X.handleHierarchyChange,X),Z||a.sm().ums(X.handleSelectionChange,X)),X._dataModel=f,f.mm(X.handleDataModelChange,X),f.md(X.handleDataPropertyChange,X),f.mh(X.handleHierarchyChange,X),Z?Z._21I(f):f.sm().ms(X.handleSelectionChange,X),X.fp("dataModel",a,f))},M.validateModel=function(){var G=this;G._rows.clear(),G._rowMap={},G.buildChildren(G._dataModel._roots);var K=G._rows=G._rows.toList(G.isVisible,G),D=0,s=G.getCurrentSortFunc(),j=K.size();for(s&&K.sort(s);j>D;D++)G._rowMap[K.get(D)._id]=D},M.buildChildren=function(N){var b=this;N.each(function(Z){b._rows.add(Z),b.buildChildren(Z._children)})},M.handleDataModelChange=function(){this.ivm()},M.handleDataPropertyChange=function(l){"parent"===l.property?this.ivm():this.invalidateData(l.data)},M.handleHierarchyChange=function(){this.ivm()},M.handleSelectionChange=function(P){P.datas.each(this.invalidateData,this),this.onSelectionChanged(P)},M.onSelectionChanged=function(I){var Z=this,T=Z.sm();!Z.isAutoMakeVisible()||1!==T.size()||"set"!==I.kind&&"append"!==I.kind||Z._32o||Z.makeVisible(T.ld())},M.handleBackgroundClick=function(v){wn(v)&&!this.isCheckMode()&&this.sm().cs()},M.makeVisible=function(F){F&&(this._23I=F,this.iv())},M.scrollToIndex=function(C){var G=this,t=G._29I,a=t.height,k=G._rowHeight,b=k*C;C>=0&&C<G._rows.size()&&a>0&&(b+k>t.y+a?G.ty(-b+a-k):b<t.y&&G.ty(-b))},M.autoScroll=function(_,c){var M=this,o=M._rowHeight,i=o,T=o/4,C=M._29I,B=M.lp(_),P={x:M.tx(),y:M.ty()};return o>0&&C&&(B.x-C.x<i?M.translate(T,0):C.x+C.width-B.x<i&&M.translate(-T,0),B.y-C.y<i?M.translate(0,T):C.y+C.height-B.y<i&&M.translate(0,-T)),P.x=M.tx()-P.x,P.y=M.ty()-P.y,c&&(c.x+=P.x,c.y+=P.y),P},M.getTopRowOrderSelection=function(){var T=this.sm().getTopSelection(),r={},i=new df;return T.each(function(Y){r[Y._id]=Y}),this._rows.each(function(Z){r[Z._id]&&i.add(Z)}),i},M.getRowOrderSelection=function(){var Q=new df;return this._rows.each(function(B){this.isSelected(B)&&Q.add(B)},this),Q},M.ivm=function(){this.invalidateModel()},M.invalidateModel=function(){var U=this;U._96I||(U._96I=1,U._32I=1,delete U._24I),U.iv()},M.redraw=function(){var A=this;A._32I||(A._32I=1,delete A._24I,A.iv())},M.invalidateData=function(y){var Y=this;lb?Y.redraw():Y._32I||(Y._24I||(Y._24I={}),Y._24I[y._id]=y,Y.iv())},M.getFocusData=function(){return this._focusData},M.setFocusDataById=function(S){this.setFocusData(this.dm().getDataById(S))},M.setFocusData=function(D){var B=this,Z=B._focusData;Z!==D&&(B._focusData=D,B.fp("focusData",Z,D),Z&&B.invalidateData(Z),D&&(B.invalidateData(D),B.isAutoMakeVisible()&&B.makeVisible(D)))},M.drawRowBackground=function(J,C,m,k,B,e,h){var l=this,q=l.isCheckMode();(C===l._focusData&&q||m&&!q)&&em(J,k,B,e,h,l.getSelectBackground(C))},M.drawData=function(R,I,b){var L=this,s=L._rowHeight,w=s*b,E=L._29I,n=E.x,O=E.width;R.save(),R.beginPath(),R.rect(n,w,O,s),R.clip(),L._87o(L.drawRow(R,I,L.isSelected(I),n,w,O,s),b,n,w,O,s),R.restore(),L._rowLineVisible&&em(R,n,w+s-1,O,1,L._rowLineColor)},M._12I=function(r){var M=this,U=M._31I,x=M._29I,l=x.x,g=x.y,d=x.width,n=x.height;for(r.beginPath(),r.rect(l,g,d,n),r.clip(),r.clearRect(l,g,d,n),M._76o(),M._93db(r);U<M._14I;U++)M.drawData(r,M._rows.get(U),U);M._92db(r)},M._13I=function(Z){for(var d,e=this,X=e._rowHeight,n=e._29I,G=n.x,Q=n.width,o=e._31I,P=e._30I;o<e._14I;o++)d=e._rows.get(o),e._24I[d._id]&&P.add({data:d,index:o});P.isEmpty()||(Z.beginPath(),P.each(function(S){Z.rect(G,S.index*X,Q,X)}),Z.clip(),P.each(function(f){Z.clearRect(G,f.index*X,Q,X)}),P.each(function(a){e._77o(a.index)}),e._93db(Z),P.each(function(B){e.drawData(Z,B.data,B.index)}),e._92db(Z),P.clear())},M.preValidateModel=function(){this.endEditing&&this.endEditing()},M.validateImpl=function(){var g=this,c=g._canvas,T=g.getWidth(),G=g.getHeight(),P=g._rowHeight,L=g._32I;(T!==c.clientWidth||G!==c.clientHeight)&&(vl(c,T,G),L=1);var t=bo&&!ah;g._96I&&!t&&(g.preValidateModel(),g.validateModel());var X=g._29I,C={x:-g.tx(),y:-g.ty(),width:T,height:G},y=g._rows.size(),N=vs(c),s=g._23I;L||Gp(C,X)||(L=1),g._29I=C,g._59I=y*P+g.getScrollBarSize(),g._31I=h(C.y/P),g._14I=v((C.y+C.height)/P),g._31I<0&&(g._31I=0),g._14I>y&&(g._14I=y),g._99I&&L&&g._99I(),kn(N,g.tx(),g.ty(),1),L?g._12I(N):g._24I&&g._13I(N),g._93I(),g._92I(),N.restore(),g._32I=g._24I=g._96I=z,s&&(g.scrollToIndex(g.getRowIndex(s)),delete g._23I),g.tx(g.tx()),g.ty(g.ty())}},dj._48o=function(v){v._rootVisible=!0,v._rootData=z,v._35o=function(){this._expandMap={},this._levelMap={}},v.validateModel=function(){var D=this,w=D._rootData;D._rows.clear(),D._levelMap={},D._rowMap={},D._currentLevel=0,w?D._rootVisible?D.isVisible(w)&&D.buildData(w):D.buildChildren(w):D.buildChildren(),delete D._currentLevel},v.buildData=function(G){var v=this,P=G._id,R=v._rows;v._rowMap[P]=R.size(),R.add(G),v._levelMap[P]=v._currentLevel,v.isExpanded(G)&&(v._currentLevel++,v.buildChildren(G),v._currentLevel--)},v.buildChildren=function(W){var N=this,R=W?W._children:N._dataModel._roots,D=N.getCurrentSortFunc();D&&N.isChildrenSortable(W)?R.toList(N.isVisible,N).sort(D).each(N.buildData,N):R.each(function($){N.isVisible($)&&N.buildData($)})},v.getLevel=function(X){return this._levelMap[X._id]},v.getToggleIcon=function(y){var C=this,O=C._loader,V=C._collapseIcon;return O&&!O.isLoaded(y)?V:y.hasChildren()?C.isExpanded(y)?C._expandIcon:V:z},v.isCheckMode=function(){return this._checkMode!=z},v.isChildrenSortable=function(){return!0},v.handleDataModelChange=function(N){var Y=this;N.kind===gm?delete Y._expandMap[N.data._id]:N.kind===Zj&&(Y._expandMap={}),Y.ivm()},v.toggle=function(j){var M=this;M.isExpanded(j)?M.collapse(j):M.expand(j)},v.isExpanded=function(c){return 1===this._expandMap[c._id]},v.expand=function(d){var C=this,M=C._loader;C.isExpanded(d)||(M&&!M.isLoaded(d)&&M.load(d),C._expandMap[d._id]=1,C.ivm(),C.onExpanded(d))},v.onExpanded=function(){},v.collapse=function(f){var F=this;F.isExpanded(f)&&(delete F._expandMap[f._id],F.ivm(),F.onCollapsed(f))},v.onCollapsed=function(){},v.expandAll=function(g){if(g)this.expand(g),g.eachChild(function(n){this.expandAll(n)},this);else{var Y=this;Y._dataModel.each(function(i){i.hasChildren()&&(Y._expandMap[i._id]=1)}),Y.ivm()}},v.collapseAll=function(){this._expandMap={},this.ivm()},v.makeVisible=function(a){if(a){var y=this;if(!y._rootData||a.isDescendantOf(y._rootData)){for(var U=a._parent;U;)y.expand(U),U=U._parent;
y._23I=a,y.iv()}}},v.checkData=function(M){var r,m=this,V=m._checkMode,o=m.sm(),g=o.co(M);if(!o.sg()||!g){if(m._32o=1,V===vj)g?o.rs(M):o.as(M);else if(V===Qe)r=new df(M),r.addAll(M._children);else if("descendant"===V)r=new df,sq(M,r);else if("all"===V&&(r=new df,sq(M,r),!g))for(var O=M._parent;O;)r.add(O),O=O._parent;r&&(g?o.rs(r):o.as(r)),delete m._32o}},v.drawTree=function(M,b,i,l,z,j,$){var E=this,X=E._indent,n=E._levelMap[b._id],F=E.getIconWidth(b),s=Qd(E.getToggleIcon(b));s?(l+=X*n,Op(M,s,l+X/2,z+$/2,b,E),l+=X):l+=X*(n+1),E._checkMode&&(Op(M,E.getCheckIcon(b),l+X/2,z+$/2,b,E),l+=X),E.drawIcon(M,b,l,z,F,$),E.drawLabel(M,b,l+F,z,$)}},dj._14Q=function(H){H.getIcon=function(d){return d.getIcon()},H.getIconWidth=function(X){return this.getIcon(X)?this._indent:0},H.drawIcon=function(l,R,M,t,f,b){if(f){var O=this,L=O.getBodyColor(R),H=Qd(O.getIcon(R),L);H&&(b-=O.isRowLineVisible()?1:0,Xm(l,H,bd,M,t,f,b,R,O,L),_q(l,O.getBorderColor(R),M,t,f,b))}},H.drawLabel=function(v,W,G,A,y){var d=this;Kq(v,d.getLabel(W),d.getLabelFont(W),d.getLabelColor(W),G,A,0,y)}},dj._50o=function(r){r._98I=function(){var F=this,h=F._39o=new Ao;F._60I=new df,h.mm(F._17o,F),h.md(F._18o,F),h.mh(F._19o,F)},r.setColumns=function(I){this._39o.clear(),this.addColumns(I)},r.addColumns=function(x){var $=this._39o;x.forEach(function(l){if(!(l instanceof Is)){var j=lj(l.className);l=$l(j?j:Is,l)}$.add(l)})},r.onColumnClicked=function(){},r.onCheckColumnClicked=function(){},r._3Q=function(n){for(var U,I=0,u=this._60I,a=u.size();a>I;I++)if(U=u.get(I),U.column===n)return U;return z},r.getColumnAt=function(v){var a=this._4Q(v);return a?a.column:z},r._4Q=function(N){for(var B=this,F=N.target?B.lp(N).x:N.x,K=B._60I,p=0;p<K.size();p++){var A=K.get(p),q=A.startX;if(F>=q&&F<q+A.column.getWidth())return A}return z},r.getToolTip=function(V){var R=this,m=R.getDataAt(V),P=R.getColumnAt(V);return m&&P?P.getToolTip(m,R):z},r.adjustTranslateX=function(i){var f=this.getWidth()-this._91I;return f>i&&(i=f),i>0?0:w(i)},r._99I=function(){var x=this,F=x._29I,y=x._60I;y.clear(),x._91I=0,x._39o._roots.each(function(R){if(R.isVisible()){var l=x._91I+R.getWidth();x._91I<=F.x+F.width&&l>=F.x&&y.add({column:R,startX:x._91I}),x._91I=l}}),x._91I+=x.getScrollBarSize()},r.drawData=function(P,r,u){var B=this,J=B._rowHeight,c=J*u,q=B.isSelected(r),Z=B._29I,i=Z.x,f=Z.width;B.drawRowBackground(P,r,q,i,c,f,J),B._60I.each(function(T){var X=T.column,Z=T.startX,I=X.getWidth();I>0&&!B.isEditing(r,X)&&(P.save(),P.beginPath(),P.rect(Z,c,I,J),P.clip(),B._87o(B.drawCell(P,r,q,X,Z,c,I,J),u,Z,c,I,J),B._columnLineVisible&&em(P,Z+I-1,c,1,J,B._columnLineColor),P.restore())}),B._rowLineVisible&&em(P,i,c+J-1,f,1,B._rowLineColor)},r.drawCell=function(l,W,U,$,x,v,N,m){var s=this;if($.drawCell)return $.drawCell(l,W,U,$,x,v,N,m,s);var J=s.getValue(W,$);hb(l,J,$,s.getLabelFont(W,$,J),s.getLabelColor(W,$,J),x,v,N,m,W,s)},r.getColumnModel=function(){return this._39o},r._17o=function(){this.redraw()},r._18o=function(K){var r=this;K.data===r._sortColumn&&zj[K.property]?r.ivm():(r._42o(),r.redraw())},r._19o=function(){this.redraw()},r.getCurrentSortFunc=function(){var w=this,Y=w._sortColumn;if(Y&&Y.isSortable()){var X=Y.getSortFunc(),E=zb===Y.getSortOrder()?1:-1;return X||(X=qp),function(r,p){return X.call(w,w.getValue(r,Y),w.getValue(p,Y),r,p)*E}}return w._sortFunc},r.isCellEditable=function(j,L,X){return L.isEditable()&&this.isEditable()?L.isCellEditable?L.isCellEditable(j,L,X,this):!0:!1},r._37O=function(T,u){if(wn(u))for(var C=this,K=C.lp(u),t=C._60I,I=C._rowHeight,A=C._29I,w=A.x,Q=A.y,d=A.width,k=A.height,n=0;n<t.size();n++){var N=t.get(n),_=N.startX,H=N.column,f=H.getWidth();if(H!==C._31o&&H!==C._4o&&K.x>=_&&K.x<_+f&&C.isCellEditable(T,H,u)){var X={x:_,y:C.getRowIndex(T)*I,width:f,height:I},Z={x:X.x+C.tx(),y:X.y+C.ty(),width:X.width,height:X.height},o=0,b=0;return X.x<w?o=X.x-w:X.x+X.width>w+d&&(o=X.x+X.width-w-d),o&&(C.tx(C.tx()-o),Z.x-=o),X.y<Q?b=X.y-Q:X.y+I>Q+k&&(b=X.y+I-Q-k),b&&(C.ty(C.ty()-b),Z.y-=b),C.beginEditing({data:T,column:H,value:C.getValue(T,H),event:u,rect:X,editorRect:Z,view:C}),void 0}}}},Fs.BaseItemEditor=function(V,h,D,W){this._data=V,this._column=h,this._master=D,this._editInfo=W},Gs("BaseItemEditor",U,{ms_ac:["data","column","master","editInfo"],editBeginning:function(){},getView:function(){},getValue:function(){},setValue:function(){}});var Hs=R.Tab=function(){ac(Hs,this)};Wp("Tab",bq,{ms_ac:["view","closable","disabled","visible"],_icon:z,_closable:!1,_disabled:!1,_visible:!0,setParent:fe});var Is=R.Column=function(){ac(Is,this)};Wp("Column",bq,{_46o:1,ms_ac:["accessType","valueType",so,be,sc,en,"align",ij,"sortOrder",Pf,"sortable","clickable","nullable","emptiable","slider","colorPicker","itemEditor"],_visible:!0,_width:80,_sortOrder:zb,_sortFunc:z,_sortable:!0,_clickable:!0,setWidth:function(W){16>W&&(W=16);var I=this._width;this._width=W,this.fp(en,I,W)},getToolTip:function(t,I){return this.formatValue(I.getValue(t,this))}});var Js=R.Property=function(){ac(Js,this)};Wp("Property",bq,{_46o:1,ms_ac:["accessType","valueType",be,sc,"categoryName",ij,"align","nullable","emptiable","slider","itemEditor","colorPicker"],_categoryName:z,getToolTip:function(X,f,$){var s=this;return f?s.formatValue($.getValue(X,s)):$.getPropertyName(s)}}),Fs.AccordionView=function(){var A=this;A._20o={},A._21o=new df,A._10o=z,A._9o=z,A._11o=z,A._view=Ul(0,A),A.iv()},Gs("AccordionView",U,{ms_v:1,ms_fire:1,ms_ac:[Rc,bh,"titleHeight",Hi,ek,"titleBackground","selectWidth",Yj,"orientation","separatorColor"],_expandIcon:m.accordionViewExpandIcon,_collapseIcon:m.accordionViewCollapseIcon,_titleHeight:al,_labelColor:m.accordionViewLabelColor,_labelFont:m.accordionViewLabelFont,_titleBackground:m.accordionViewTitleBackground,_selectBackground:m.accordionViewSelectBackground,_selectWidth:m.accordionViewSelectWidth,_orientation:"v",_separatorColor:m.accordionViewSeparatorColor,onPropertyChanged:function(){this.iv()},getView:function(){return this._view},getTitles:function(){return this._21o},getCurrentTitle:function(){return this._10o},add:function(j,T,h,c){var V=this,W=Kk(),Q={content:T,div:W,canvas:pn(W),icon:c};if(V._20o[j])throw j+" already exists";var k=Q.downEventFunc=function(x){$r(x)},i=Q.upEventFunc=function(u){$r(u),wn(u)&&(V._10o===j?V.collapse():V.expand(j))};[le,Ir].forEach(function(o){n(W,o,k)}),[Qq,ig].forEach(function(J){n(W,J,i)}),W.style.cursor=Rh,tc(V._view,W),V._20o[j]=Q,V._21o.add(j),h&&V.expand(j),V.iv()},remove:function(H){var K=this,q=K._20o[H];if(q){var P=q.div;Rd(P),[le,Ir].forEach(function(H){I(P,H,q.downEventFunc)}),[Qq,ig].forEach(function(H){I(P,H,q.upEventFunc)}),delete K._20o[H],K._21o.remove(H),K.iv()}},clear:function(){var U=this;U._21o.toArray().forEach(U.remove,U),U._20o={},U._21o.clear(),U.iv()},isExpanded:function(G){return this._10o===G},expand:function(e){var l=this;l._20o[e]&&l._10o!==e&&(l._10o=e,l.onExpanded(e),l.iv())},onExpanded:function(){},collapse:function(){var t=this;t._10o&&(t.onCollapsed(t._10o),delete t._10o,t.iv())},onCollapsed:function(){},initCanvas:function(J,G,c){vl(J,G,c);var e=vs(J);return kn(e,0,0,1),e.clearRect(0,0,G,c),e},drawTitle:function(T,P,n,d,E){var U=this,W=Qd(E.icon),C=U.isExpanded(P),c=U._titleHeight,D=U._titleBackground,z=U._selectWidth,O=U._separatorColor,i=Qd(C?U._expandIcon:U._collapseIcon),N=z+4;em(T,0,0,n,d,D),C&&z&&em(T,0,0,z,d,U._selectBackground),(C||U._21o.get(U._21o.size()-1)!==P)&&em(T,0,d-1,n,1,O?O:kd(D)),W&&(Op(T,W,N+Uk(W)/2,c/2),N+=Uk(W)+2),Kq(T,P,U.getLabelFont(P),U.getLabelColor(P),N,0,0,c),i&&Op(T,i,n-Uk(i)/2-4,c/2)},validateImpl:function(){var n=this,a=n._view,Q=0,E=0,f=n.getWidth(),A=n.getHeight(),w=n._titleHeight,r=n._21o.size()*w,s=n._11o,D=n._9o;delete n._11o,delete n._9o,n._21o.each(function(N){var s,B,Y=n._20o[N],t=Y.content,V=n._10o===N;Fr(n)?(Ln(Y.div,Q,0,w,A),s=n.initCanvas(Y.canvas,w,A),jm(s,0,A),Eg(s,-P),n.drawTitle(s,N,A,w,Y),s.restore(),V?(B=W(0,f-r),t&&(n._11o=t,n._9o=zs(t),Ln(t,Q+w,0,B,A)),Q+=w+B):Q+=w):(Ln(Y.div,0,E,f,w),s=n.initCanvas(Y.canvas,f,w),n.drawTitle(s,N,f,w,Y),s.restore(),V?(B=W(0,A-r),t&&(n._11o=t,n._9o=zs(t),Ln(t,0,E+w,f,B)),E+=w+B):E+=w)});var X=n._9o;s&&s!==n._11o&&s.endEditing&&s.endEditing(),X&&X!==D&&tc(a,X),D&&D!==X&&Rd(D)}}),Fs.SplitView=function(N,W,x,B){var t=this,n=t._dividerDiv=Kk(),v=t._60O=pn(),p=t._61O=pn(),g=v.style,F=p.style;t._view=Ul(1,t),tc(t._view,n),g.msTouchAction=vf,g.pointerEvents=vf,g.cursor=Rh,F.msTouchAction=vf,F.pointerEvents=vf,F.cursor=Rh,N&&t.setLeftView(N),W&&t.setRightView(W),x&&t.setOrientation(x),B!=z&&t.setPosition(B),t.setStatus(Oc),new Ks(t)},Gs("SplitView",U,{ms_v:1,ms_fire:1,ms_ac:["continuousLayout","dividerSize","dividerBackground","toggleIcon","togglable","dragOpacity","orientation","draggable","status"],_continuousLayout:!1,_position:.5,_togglable:!0,_orientation:"h",_draggable:!0,_dividerSize:m.splitViewDividerSize,_dividerBackground:m.splitViewDividerBackground,_dragOpacity:m.splitViewDragOpacity,_toggleIcon:m.splitViewToggleIcon,onPropertyChanged:function(){this.iv()},getDividerDiv:function(){return this._dividerDiv},getPosition:function(){return this._position},setPosition:function(e,r){var t=this,Q=t._position;isNaN(e)||(r||(t._82O=0>e?-1:e>1?1:0),t._position=e,t.fp(db,Q,e))},getLeftView:function(){return this._leftView},setLeftView:function(R){var W=this,Q=W._leftView,K=W._view;if(W._leftView!==R){if(Q&&Q!==W._rightView){var F=zs(Q);F.parentNode===K&&Rd(F)}if(W._leftView=R,R){var e=zs(R);e.parentNode!==K&&K.insertBefore(e,W._dividerDiv)}W.fp("leftView",Q,R)}},getRightView:function(){return this._rightView},setRightView:function(h){var s=this,n=s._rightView,K=s._view;if(s._rightView!==h){if(n&&n!==s._leftView){var r=zs(n);r.parentNode===K&&Rd(r)}if(s._rightView=h,h){var x=zs(h);x.parentNode!==K&&K.insertBefore(x,s._dividerDiv)}s.fp("rightView",n,h)}},validateImpl:function(){var p=this,M=p._draggable,d=p._position,o=p.getWidth(),r=p.getHeight(),O=p._dividerSize,m=p._dividerBackground,$=vd?18:8,K=p._dividerDiv,e=p._82O,t=p._60O,b=p._61O,v=p._toggleIcon,A=p._status,l=K.style,I=null,J=vd?20:4,x=v.comps[0];O>=$||0===O?p._coverDiv&&(Rd(p._coverDiv),delete p._coverDiv):p._coverDiv||(p._coverDiv=Kk(),Nb&&(p._coverDiv.style.background=Ol),tc(K,p._coverDiv)),p._togglable?t.parentNode||(tc(K,t),tc(K,b)):(Rd(t),Rd(b));var V=p._coverDiv,C=p._leftView,X=p._rightView;if(Fr(p)){if(O>o&&(O=o),A===Oc)if(1===e)var i=g(d,o),h=W(0,o-O-i);else-1===e?(h=g(-d,o),i=W(0,o-O-h)):(i=w((o-O)*d),h=W(0,o-O-i));else"cl"===A?(i=0,h=W(0,o-O)):"cr"===A&&(h=0,i=W(0,o-O));C&&Ln(C,0,0,i,r),X&&Ln(X,i+O,0,h,r),Ln(K,i,0,O,r),p._22o=i,V&&(Ln(V,O/2-$/2,0,$,r),V.style.cursor=M?ag:""),K.style.cursor=M?ag:"";var q=K.clientHeight/2,H=K.clientWidth;vl(t,H,H),Ln(t,0,q-H-J,H,H),I=vs(t),kn(I,0,0,1),x.rotation=-P,rb(I,v,0,0,H,H),I.restore(),vl(b,H,H),Ln(b,0,q+J,H,H),I=vs(b),kn(I,0,0,1),x.rotation=P,rb(I,v,0,0,H,H),I.restore()}else{if(O>r&&(O=r),A===Oc)if(1===e)var f=g(d,r),s=W(0,r-O-f);else-1===e?(s=g(-d,r),f=W(0,r-O-s)):(f=w((r-O)*d),s=W(0,r-O-f));else"cl"===A?(f=0,s=W(0,r-O)):"cr"===A&&(s=0,f=W(0,r-O));C&&Ln(C,0,0,o,f),X&&Ln(X,0,f+O,o,s),Ln(K,0,f,o,O),p._22o=f,V&&(Ln(V,0,O/2-$/2,o,$),V.style.cursor=M?nd:""),l.cursor=M?nd:"";var U=K.clientWidth/2,H=K.clientHeight;vl(t,H,H),Ln(t,U-H-J,0,H,H),I=vs(t),kn(I,0,0,1),x.rotation=0,rb(I,v,0,0,H,H),I.restore(),vl(b,H,H),Ln(b,U+J,0,H,H),I=vs(b),kn(I,0,0,1),x.rotation=j,rb(I,v,0,0,H,H),I.restore()}l.background=m}});var Ks=function(Q){this.sv=Q,this.addListeners()};Ad(Ks,U,{ms_listener:1,getView:function(){return this.sv.getView()},handle_touchstart:function(m){var z=this,i=z.sv,q=i._dividerDiv,f=i._60O,o=i._61O,v=i._status,G=m.target;if(G===f)v===Oc?i.setStatus("cl"):"cr"===v&&i.setStatus(Oc);else if(G===o)v===Oc?i.setStatus("cr"):"cl"===v&&i.setStatus(Oc);else if(jg(m)&&(G===q||G===i._coverDiv)&&($r(m),i.isDraggable())){i.getLeftView(),i.getRightView();var S=z.maskDiv=Kk();if(S.style.left=0,S.style.top=0,S.style.width=i.getWidth()+"px",S.style.height=i.getHeight()+"px",i.getView().appendChild(S),!i.isContinuousLayout()){var t=z.resizeDiv=Kk();t.style.left=q.style.left,t.style.top=q.style.top,t.style.width=q.style.width,t.style.height=q.style.height,t.style.opacity=i.getDragOpacity(),t.style.background=i.getDividerBackground(),tc(z.getView(),t)}z._lastAbsPosition=i._22o,z._86o=Fr(i)?sb(m).x:sb(m).y,np(z,m)}},handleWindowTouchMove:function(J){jg(J)&&this.update(J,this.sv.isContinuousLayout())},handleWindowTouchEnd:function(T){var i=this;i.update(T,!0),i.sv.setStatus(Oc),i.maskDiv&&Rd(i.maskDiv),i.resizeDiv&&Rd(i.resizeDiv),i.maskDiv=i.resizeDiv=z},handle_mousedown:function(g){wn(g)&&this.handle_touchstart(g)},handleWindowMouseMove:function(v){this.handleWindowTouchMove(v)},handleWindowMouseUp:function(K){this.handleWindowTouchEnd(K)},update:function(Y,H){var E=this,A=E.sv,r=Fr(A)?A.getWidth():A.getHeight(),R=A._dividerSize,a=E._lastAbsPosition-E._86o;Fr(A)?(a+=sb(Y).x,a>r-R&&(a=r-R),0>a&&(a=0),E.resizeDiv&&(E.resizeDiv.style.left=a+Tq)):(a+=sb(Y).y,a>r-R&&(a=r-R),0>a&&(a=0),E.resizeDiv&&(E.resizeDiv.style.top=a+Tq)),H&&r!==R&&(1===A._82O?A.setPosition(a,1):-1===A._82O?A.setPosition(a-r+R,1):A.setPosition(a/(r-R),1))}}),Fs.TabView=function(){var V=this,s=V._view=Ul(1,V),c=V._91O=Kk(1),w=V._tabModel=new Ao,N=w.sm(),Q=V.invalidate;V._7o=new df,V._canvas=pn(c),tc(s,c),tc(s,V._92O=Kk(1)),N.setSelectionMode(Aq),N.ms(V.handleSelectionChange,V),w.mm(Q,V),w.mh(Q,V),w.md(Q,V),V._interactor=new Ls(V),V.iv()},Gs("TabView",U,{ms_v:1,ms_fire:1,ms_tx:1,ms_ty:1,ms_lp:1,ms_ac:["movable","tabGap","tabHeight","tabPosition",Hi,ek,"tabHPadding","tabBackground","selectWidth",Yj,"moveBackground","insertColor"],_tabHPadding:0,_tabPosition:$i,_tabHeight:al,_tabGap:m.tabViewTabGap,_labelColor:m.tabViewLabelColor,_labelFont:m.tabViewLabelFont,_tabBackground:m.tabViewTabBackground,_selectWidth:m.tabViewSelectWidth,_selectBackground:m.tabViewSelectBackground,_moveBackground:m.tabViewMoveBackground,_insertColor:m.tabViewInsertColor,_movable:!0,handleSelectionChange:function(){this._selectionChanged=!0,this.invalidate()},getContentDiv:function(){return this._92O},getTitleDiv:function(){return this._91O},getTabModel:function(){return this._tabModel},add:function(W,U,f){var v,G=this._tabModel;return W instanceof Hs?(v=W,U&&v.setView(U)):(v=new Hs,v.setName(W),v.setView(U)),G.add(v),f&&G.sm().ss(v),v},getLabel:function(A){return A.toLabel()},onPropertyChanged:function(){this.iv()},_7Q:function(R){this._23o=R,this.iv()},get:function(s){var y=this,f=y._tabModel;if(pk(s))return f._roots.get(s);if(yk(s)){var b;return f.each(function(R){s===y.getLabel(R)&&(b=R)}),b}return s instanceof Hs?s:z},select:function(m){this._tabModel.sm().ss(this.get(m))},remove:function(e){var m=this;if(e=m.get(e)){var N=m._tabModel,t=N._roots.indexOf(e);m._tabModel.remove(e),m.selectByIndex(--t)}},getCurrentTab:function(){return this._8o},hideTabView:function(r,W){W.parentNode===this._92O&&(Or(W)?(W.style.display=sn,W._tab_=r):Rd(W),Eh())},showTabView:function(T,E){Or(E)&&(E.style.display="block",E._tab_=T),E.parentNode!==this._92O&&(tc(this._92O,E),Eh())},_24o:function(){var T,v=this,P=v._8o,O=v._9o,V=v._tabModel.sm().ld();V&&(T=zs(V.getView())),T!==O&&(O&&(P.getView()&&P.getView().endEditing&&P.getView().endEditing(),v.hideTabView(P,O)),T&&v.showTabView(V,T)),v._8o=V,v._9o=T,P!==V&&v.onTabChanged(P,V)},onTabClosing:function(){return!0},onTabChanged:function(){},onTabClosed:function(A,n){this.selectByIndex(--n)},selectByIndex:function(h){var m=this,G=m._tabModel,j=G.size();if(j&&!G.sm().ld()){h==z&&(h=0),h>=j&&(h=j-1),0>h&&(h=0);for(var g=h;g>=0;g--){var $=m.get(g);if(!$.isDisabled())return m.select($),$}for(g=h+1;j>g;g++)if($=m.get(g),!$.isDisabled())return m.select($),$}},getTabWidth:function(O){var K=this.getTabHPadding(),Q=4+2*K,y=Qd(O.getIcon());y&&(Q+=Uk(y,O)+4);var o=this.getLabel(O);return o&&(Q+=Yf(this.getLabelFont(O),o).width+4),O.isClosable()&&(Q+=10),Q},drawTab:function(M,s,x,d,H,q,_){var r,i=this,A=i._tabPosition,F=this.getTabHPadding(),p=x+4+F,Z=i._selectWidth,o=Qd(s.getIcon()),J=s.isDisabled(),h=i.getLabelColor(s),X=i.getLabelFont(s),S=i.getLabel(s),c=i._selectBackground,n=A===ec+"-vertical",t=A===Gj+"-vertical";(n||t)&&(p=d+4+F),J&&(M.globalAlpha=Kd),em(M,x,d,H,q,_),s===i._8o&&Z&&(A===$i?em(M,x,d+q-Z,H,Z,c):A===ec?em(M,x+H-Z,d,Z,q,c):A===Gj?em(M,x,d,Z,q,c):n?em(M,x+H-Z,d,Z,q,c):t?em(M,x,d,Z,q,c):em(M,x,d,H,Z,c));var R=H/2;if(n&&(jm(M,R,d+q/2),Eg(M,j),jm(M,-R,-d-q/2)),o){var B=Cf(o,s),l=Uk(o,s);if(n||t){var m=x+H/2,Q=p+B/2;jm(M,m,Q),Eg(M,P),jm(M,-m,-Q),Op(M,o,x+H/2,p+B/2,s,i),jm(M,m,Q),Eg(M,-P),jm(M,-m,-Q),p+=B+4}else Op(M,o,p+l/2,d+q/2,s,i),p+=l+4}return n||t?(jm(M,H/2,p+H/2),Eg(M,P),jm(M,-H/2,-p-H/2),Kq(M,S,X,h,x,p,q,H),jm(M,H/2,p+H/2),Eg(M,-P),jm(M,-H/2,-p-H/2)):Kq(M,S,X,h,p,d,H,q),n&&(jm(M,R,d+q/2),Eg(M,-j),jm(M,-R,-d-q/2)),s.isClosable()&&(r=t?{x:x+H-12,y:d+q-12,width:12,height:12}:{x:x+H-12,y:d+2,width:12,height:12},this.drawCloseIcon(s,M,h,r)),J&&(M.globalAlpha=1),r},drawCloseIcon:function(i,J,I,X){var S=X.x,e=X.y;J.strokeStyle=I,J.lineWidth=1,J.beginPath(),J.moveTo(S+2,e+8),J.lineTo(S+8,e+2),J.moveTo(S+8,e+8),J.lineTo(S+2,e+2),J.stroke()},getTabAt:function(H){var d=this._interactor._8Q(H);return d?d.tab:null},validateImpl:function(){var J=this;J._24o();var x,e=J._canvas,$=J._tabPosition,Q=J._91O,E=J._92O,R=J._tabModel,D=J.getWidth(),o=J.getHeight(),Y=J._tabHeight,Z=J._7o,v=J._tabGap,u=$===$i,N=$===ec,i=$===Gj,V=$===ec+"-vertical",y=$===Gj+"-vertical",A=J._23o,n=0;if((N||i)&&R._roots.each(function(b){n=W(J.getTabWidth(b),n)}),u?(Ln(Q,0,0,D,Y),x={x:0,y:Y,width:D,height:W(0,o-Y)}):N?(Ln(Q,0,0,n,o),x={x:n,y:0,width:W(0,D-n),height:o}):i?(Ln(Q,D-n,0,n,o),x={x:0,y:0,width:W(0,D-n),height:o}):V?(Ln(Q,0,0,Y,o),x={x:Y,y:0,width:W(0,D-Y),height:o}):y?(Ln(Q,D-Y,0,Y,o),x={x:0,y:0,width:W(0,D-Y),height:o}):(Ln(Q,0,o-Y,D,Y),x={x:0,y:0,width:D,height:W(0,o-Y)}),Ln(E,x),V||y){J._9o&&(x.x=0,Ln(J._8o.getView(),x)),vl(e,Y,o);var X=vs(e),j=0;if(kn(X,0,J.ty(),1),X.clearRect(0,0,Y,o),Z.clear(),R._roots.each(function(f){if(f.isVisible()){var r,s=J.getTabWidth(f);A&&A.tab===f||(r=J.drawTab(X,f,0,j,Y,s,J._tabBackground)),Z.add({_75o:r,tab:f,startY:j,endY:j+s,height:s}),j+=s+v}}),J._23Q=W(0,j-v),A){var M=A.position;J.drawTab(X,A.tab,0,A.startY,Y,A.height,J._moveBackground),em(X,0,M,Y,1,J._insertColor)}if(X.restore(),J._selectionChanged){J._selectionChanged=!1;for(var L=J.ty(),c=0;c<Z.size();c++){var P=Z.get(c);if(P.tab===J._8o){if(P.endY+L<0){J.ty(-P.startY);break}if(P.startY+L>o){J.ty(o-P.endY);break}}}}J.ty(J.ty())}else if(N||i){J._9o&&(x.x=0,Ln(J._8o.getView(),x)),vl(e,n,o);var X=vs(e),j=0;if(kn(X,0,J.ty(),1),X.clearRect(0,0,n,o),Z.clear(),R._roots.each(function(R){if(R.isVisible()){var L;A&&A.tab===R||(L=J.drawTab(X,R,0,j,n,Y,J._tabBackground)),Z.add({_75o:L,tab:R,startY:j,endY:j+Y,height:Y}),j+=Y+v}}),J._23Q=W(0,j-v),A){var M=A.position;J.drawTab(X,A.tab,0,A.startY,n,A.height,J._moveBackground),em(X,0,M,n,1,J._insertColor)}if(X.restore(),J._selectionChanged){J._selectionChanged=!1;for(var L=J.ty(),c=0;c<Z.size();c++){var P=Z.get(c);if(P.tab===J._8o){if(P.endY+L<0){J.ty(-P.startY);break}if(P.startY+L>o){J.ty(o-P.endY);break}}}}J.ty(J.ty())}else{J._9o&&(x.y=0,Ln(J._8o.getView(),x)),vl(e,D,Y);var X=vs(e),m=0;if(kn(X,J.tx(),0,1),X.clearRect(0,0,D,Y),Z.clear(),R._roots.each(function(R){if(R.isVisible()){var Q,P=J.getTabWidth(R);A&&A.tab===R||(Q=J.drawTab(X,R,m,0,P,Y,J._tabBackground)),Z.add({_75o:Q,tab:R,startX:m,endX:m+P,width:P}),m+=P+v}}),J._64I=W(0,m-v),A){var M=A.position;J.drawTab(X,A.tab,A.startX,0,A.width,Y,J._moveBackground),fg(X,J._insertColor,M,0,Y)}if(X.restore(),J._selectionChanged){J._selectionChanged=!1;for(var l=J.tx(),c=0;c<Z.size();c++){var P=Z.get(c);if(P.tab===J._8o){if(P.endX+l<0){J.tx(-P.startX);break}if(P.startX+l>D){J.tx(D-P.endX);break}}}}J.tx(J.tx())}for(var O=[],b=E.children,c=0;c<b.length;c++){var t=b[c],U=t._tab_;U&&!R.contains(U)&&O.push(t)}O.forEach(function(L){E.removeChild(L)})}});var Ls=function(c){this.tv=c,this.addListeners()};Ad(Ls,U,{ms_listener:1,getView:function(){return this.tv._91O},handle_mousewheel:function(s){this.handleScroll(s,10*(s.wheelDelta/40))},handle_DOMMouseScroll:function(W){this.handleScroll(W,10*-W.detail)},handleScroll:function(Z,g){$r(Z);var G=this.tv,M=G._tabPosition;!G._40o()||M!==$i&&M!==dh||G.tx(this.tv.tx()+g),!G._41o()||M!==ec&&M!==Gj&&M!==ec+"-vertical"&&M!==Gj+"-vertical"||G.ty(this.tv.ty()+g)},_8Q:function(c){var j,O,Z=this.tv,v=Z._tabPosition,$=Z._7o;if(v===$i||v===dh){var B=Z.lp(c).x;for(j=0;j<$.size();j++)if(O=$.get(j),O.startX<=B&&B<=O.endX)return O}else if(v===ec||v===Gj||v===ec+"-vertical"||v===Gj+"-vertical"){var h=Z.lp(c).y;for(j=0;j<$.size();j++)if(O=$.get(j),O.startY<=h&&h<=O.endY)return O}return z},isClickable:function(c){var _=this.tv,A=_._tabPosition,G=this._73o=this._8Q(c);return!_._40o()||A!==$i&&A!==dh?!_._41o()||A!==ec&&A!==Gj&&A!==ec+"-vertical"&&A!==Gj+"-vertical"?G&&(!G.tab.isDisabled()||_.isMovable()):!0:!0},handle_mousemove:function(U){var s=this;Si?s._74o=s._8Q(U):s.getView().style.cursor=s.isClickable(U)?Rh:""},handle_mousedown:function(d){this.handle_mousemove(d),this.handle_touchstart(d)},handle_touchstart:function(r){var D=this,L=D.tv,X=L._tabPosition;$r(r),wn(r)&&D.isClickable(r)&&(X===$i||X===dh?(D.x=sb(r).x,D.lp=L.lp(r),D.tx=L.tx()):(D.y=sb(r).y,D.lp=L.lp(r),D.ty=L.ty()),np(D,r))},handleWindowMouseMove:function(I){this.handleWindowTouchMove(I)},handleWindowTouchMove:function(s){var p,C=this,F=C.tv,d=F._tabPosition,e=C._73o;if(d===$i||d===dh){if(p=sb(s).x-C.x,!C._25o&&!C.moving&&H(p)>2&&(F._40o()&&!Kb(s)?C._25o=1:e&&F.isMovable()&&(C.moving=1)),C._25o)F.tx(C.tx+p);else if(C.moving){var B=C.lp.x+p,l=F._tabGap/2;F._7o.each(function(s){var y=s.endX,G=B-s.startX<y-B;B>=s.startX&&y>=B&&F._7Q({tab:e.tab,startX:e.startX+p,width:e.width,front:G,insertTab:s.tab,position:G?W(0,s.startX-l):g(F._64I,y+l)})})}}else if(p=sb(s).y-C.y,!C._25o&&!C.moving&&H(p)>2&&(F._41o()&&!Kb(s)?C._25o=1:e&&F.isMovable()&&(C.moving=1)),C._25o)F.ty(C.ty+p);else if(C.moving){var $=C.lp.y+p,l=F._tabGap/2;F._7o.each(function(O){var i=O.endY,k=$-O.startY<i-$;$>=O.startY&&i>=$&&F._7Q({tab:e.tab,startY:e.startY+p,height:e.height,front:k,insertTab:O.tab,position:k?W(0,O.startY-l):g(F._23Q,i+l)})})}},handleWindowMouseUp:function(F){this.handleWindowTouchEnd(F)},handleWindowTouchEnd:function(){var e=this,n=e.tv,Q=n._tabPosition,r=n.getTabModel(),t=r._roots,L=e._73o;if(e.moving){var N=n._23o;if(N&&N.insertTab!==N.tab){var i=N.tab,W=t.remove(i),h=t.indexOf(N.insertTab);h>=0&&(N.front||h++,h<=t.size()&&(t.add(i,h),r._38I(i,W,h)))}n._7Q(z),delete e.moving}else if(!e._25o&&L){i=L.tab;var y=e._74o;if(!y||y.tab===i)if(!i.isDisabled()&&Eq(L._75o,e.lp)){var $=function(){var J=t.indexOf(i);r.remove(i),n.onTabClosed(i,J)};n.onTabClosing(i,$)&&$()}else i.isDisabled()||n._8o===i||r.sm().ss(i)}e._25o=e._73o=e._74o=Q===$i||Q===dh?e.x=e.lp=e.tx=z:e.y=e.lp=e.ty=z}}),Fs.PropertyView=function(g){var k=this;k._view=Ul(1,k),k._canvas=pn(k._view),tc(k._view,k._79O=Kk()),k._rows=new df,k._28o=new df,k._26o={},k._26Q={};var o=k._propertyModel=new Ao,B=k.ivm;o.mm(B,k),o.md(B,k),o.mh(B,k),k.dm(g?g:new Ao),new Ms(k)},Gs("PropertyView",U,{ms_ac:[Hi,me,ek,be,sc,"categorizable",Bj,Pf,qf,Rc,bh,Jo,Hg,gs,"selectRowIndex",Yj,"background",Pe,th,Bc,nj,_n],ms_v:1,ms_dm:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,_45o:1,_47o:1,ms_tip:1,_29I:ni,_59I:0,_9I:0,_selectRowIndex:-1,_editable:!0,_batchEditable:!0,_categorizable:!0,_indent:Ef,_background:m.propertyViewBackground,_expandIcon:m.propertyViewExpandIcon,_collapseIcon:m.propertyViewCollapseIcon,_scrollBarColor:Bi,_scrollBarSize:Pl,_autoHideScrollBar:ce,_selectBackground:m.propertyViewSelectBackground,_rowHeight:vb,_rowLineVisible:m.propertyViewRowLineVisible,_rowLineColor:m.propertyViewRowLineColor,_10I:.5,_columnLineVisible:m.propertyViewColumnLineVisible,_columnLineColor:m.propertyViewColumnLineColor,_labelColor:m.propertyViewLabelColor,_labelSelectColor:m.propertyViewLabelSelectColor,_labelFont:m.propertyViewLabelFont,getRows:function(){return this._rows},getColumnPosition:function(){return this._10I},setColumnPosition:function(m){0>m&&(m=0),m>1&&(m=1);var L=this,I=L._10I;L._10I=m,L.fp("columnPosition",I,m)},getPropertyName:function(R){return R.toLabel()},getLabelFont:function(){return this._labelFont},getLabelColor:function(D,L,i){return i===this._selectRowIndex?this._labelSelectColor:this._labelColor},getPropertyFont:function(){return this._labelFont},getPropertyColor:function(E,b){return b===this._selectRowIndex?this._labelSelectColor:E.getColor()||this._labelColor},getCategoryFont:function(){return this._labelFont},getCategoryColor:function(){return this._labelColor},adjustTranslateX:function(){return 0},adjustTranslateY:function(b){var R=this.getHeight()-this._59I;return R>b&&(b=R),b>0?0:w(b)},isExpanded:function(h){if(!h)return!0;var d=this._26o[h];return d?d.isExpanded:!(this._26Q[h]===!1)},toggle:function(z){var V=this;V.isExpanded(z)?V.collapse(z):V.expand(z)},expandAll:function(){this.validate();for(var F in this._26o)this.expand(F)},expand:function(g){if(g&&g!==sn){var H=this,a=H._26o[g];a&&!a.isExpanded&&(a.isExpanded=!0,H.onExpanded(g),H.ivm())}},onExpanded:function(){},collapseAll:function(){this.validate();for(var P in this._26o)this.collapse(P)},collapse:function(p){if(p&&p!==sn){var Q=this,d=Q._26o[p];d&&d.isExpanded&&(d.isExpanded=!1,Q.onCollapsed(p),Q.ivm())}},onCollapsed:function(){},getCategoryName:function(x){if(!this.isCategorizable())return sn;var t=x.getCategoryName();return t?t:sn},getPropertyModel:function(){return this._propertyModel},handleSelectionChange:function(){this.ivm()},setDataModel:function(y){var L=this,R=L._dataModel;R!==y&&(R&&(R.umd(L.handlePropertyChange,L),L._selectionModel||R.sm().ums(L.handleSelectionChange,L)),L._dataModel=y,y.md(L.handlePropertyChange,L),L._selectionModel?L._selectionModel._21I(y):y.sm().ms(L.handleSelectionChange,L),L.fp(Ap,R,y))},isVisible:function(Q){return this._visibleFunc?this._visibleFunc(Q):!0},onPropertyChanged:function(U){var m=this,E=U.property;ej[E]?m.ivm():m.iv(),E===Li&&m._43o()},getCurrentData:function(){return this._27o},updateCurrentData:function(){this._27o=this.sm().ld()},getRawProperties:function(){return this._27o?this._propertyModel._roots:Bm},handlePropertyChange:function(B){this._27o===B.data&&this.iv()},ivm:function(){this.invalidateModel()},invalidateModel:function(){var O=this;O._96I||(O.setSelectRowIndex(-1),O._96I=1,O.iv())},redraw:function(){this.iv()},validateModel:function(){var g=this,B=g._rows,s=g._28o,z={},I=new df,Q=g._27o;g.updateCurrentData(),Q!==g._27o&&g.endEditing(),B.clear(),s.clear(),g.getRawProperties().each(function(t){if(g.isVisible(t)){I.add(t);var k=g.getCategoryName(t);z[k]||(s.add(k,k===sn?0:x),z[k]={isExpanded:g.isExpanded(k),properties:new df})}}),g._sortFunc&&I.sort(g._sortFunc);for(var d in g._26o)g._26Q[d]=g.isExpanded(d);g._26o=z,s.each(function(h){h!==sn&&B.add(h);var c=z[h];c.isExpanded&&I.each(function(J){g.getCategoryName(J)===h&&(c.properties.add(J),B.add({property:J,data:g._27o}))},g)})},validateImpl:function(){var N=this;N._76o(),N._96I&&(N.validateModel(),delete N._96I);var X=N._canvas,a=N.getWidth(),V=N.getHeight(),y=-N.ty(),K=N._rowHeight,F=N._indent,s=a-F,M=N._rows,A=M.size(),Q=N._9I=F+s*N._10I,D=N._59I=A*K;vl(X,a,V),N._29I={x:0,y:y,width:a,height:V},N._31I=h(y/K),N._14I=v((y+V)/K),N._31I<0&&(N._31I=0),N._14I>A&&(N._14I=A);var j,k=vs(X),_=N._background;kn(k,0,-y,1),k.beginPath(),k.rect(0,y,a,V),k.clip(),k.clearRect(0,y,a,V),N._93db(k),_&&em(k,0,0,F,D,_);for(var B=N._31I;B<N._14I;B++){var n=M.get(B),y=K*B;if(yk(n))_&&em(k,F,y,s,K,_),j=Qd(N.isExpanded(n)?N._expandIcon:N._collapseIcon),j&&Xm(k,j,bd,0,y,F,K),k.save(),k.beginPath(),k.rect(F,y,s,K),k.clip(),N.drawCategoryName(k,n,B,F,y,s,K),k.restore();else{var S=n.property,f=n.data,j=Qd(S.getIcon()),q=N._selectRowIndex===B?N.getSelectBackground():z;if(j&&Xm(k,j,bd,0,y,F,K),q&&em(k,F,y,s,K,q),k.save(),k.beginPath(),k.rect(F,y,Q-F,K),k.clip(),N.drawPropertyName(k,S,B,F,y,Q-F,K),k.restore(),!N.isEditing(f,S)){var c=Q+1,L=a-Q-1;k.save(),k.beginPath(),k.rect(c,y,L,K),k.clip(),N._87o(N.drawPropertyValue(k,S,N.getValue(f,S),B,c,y,L,K,f),B,c,y,L,K),k.restore()}}N._rowLineVisible&&em(k,F,y+K-1,s,1,N._rowLineColor)}N._columnLineVisible&&(em(k,Q,0,1,D,N._columnLineColor),em(k,a-1,0,1,D)),N._92db(k),N._93I(),k.restore(),N.ty(N.ty())},drawCategoryName:function(d,n,I,F,y,f,s){Kq(d,n,this.getCategoryFont(n),this.getCategoryColor(n),F,y,f,s)},drawPropertyName:function(N,Y,e,c,F,Q,X){return Y.drawPropertyName?(Y.drawPropertyName(N,Y,e,c,F,Q,X,this),void 0):(Kq(N,this.getPropertyName(Y),this.getPropertyFont(Y,e),this.getPropertyColor(Y,e),c,F,Q,X),void 0)},drawPropertyValue:function(U,R,m,N,G,n,o,k,J){return R.drawPropertyValue?R.drawPropertyValue(U,R,m,N,G,n,o,k,J,this):(hb(U,m,R,this.getLabelFont(R,m,N),this.getLabelColor(R,m,N),G,n,o,k,J,this),void 0)},isPropertyEditable:function(R){return R.isEditable()&&this.isEditable()},setProperties:function(V){this._propertyModel.clear(),this.addProperties(V)},addProperties:function(n){if(n){var $=this._propertyModel;n.forEach(function(J){if(!(J instanceof Js)){var W=lj(J.className);J=$l(W?W:Js,J)}$.add(J)})}},getRowIndexAt:function(d){var M=this,W=h(M.lp(d).y/M._rowHeight);return W>=0&&W<M._rows.size()?W:-1},getPropertyAt:function(r){var u=this,V=u.getRowIndexAt(r);return V>=0?u._rows.get(V).property:z},getToolTip:function(u){var K=this,A=K.getPropertyAt(u),Y=K._27o;return A&&Y?A.getToolTip(Y,K._9I<K.lp(u).x,K):z}});var Ms=function(F){this.pv=F,this.addListeners()};Ad(Ms,U,{ms_listener:1,getView:function(){return this.pv._view},setCursor:function(c){this.getView().style.cursor=c},clear:function(){var F=this;F._62O=F.cp=F.ty=F.p=z,F.setCursor(vj)},handle_mousedown:function(i){this.handle_touchstart(i)},handle_touchstart:function(U){var W=this,j=W.pv;$r(U),j.setFocus(U)&&(wn(U)?(W.cp=sb(U),W.ty=j.ty(),W.p=j.getColumnPosition(),W.handle_touchmove(U)):j.setSelectRowIndex(j.getRowIndexAt(U)))},handleWindowMouseUp:function(){this.clear()},handleWindowTouchEnd:function(){this.clear()},handle_mouseup:function(P){this.handle_touchend(P)},handle_touchend:function($){var J=this;if(J.cp&&!J._62O){var S=J.pv,i=S.lp($),b=i.x,o=i.y,O=S._indent,j=S.getRowIndexAt($),z=S._9I;if(j>=0){var I=S._rowHeight,P=I*j,Z=S._rows.get(j),E=Z.property;if(yk(Z))Qd(S.isExpanded(Z)?S._expandIcon:S._collapseIcon)&&b>=0&&O>=b&&o>=P&&P+I>=o?S.toggle(Z):cm($)&&S.toggle(Z);else if(b>z&&S.isPropertyEditable(E,$)){var A={x:z+1,y:P,width:S.getWidth()-z-1,height:I},p={x:A.x+S.tx(),y:A.y+S.ty(),width:A.width,height:A.height},v=0,V=S._29I;A.y<V.y?v=A.y-V.y:A.y+I>V.y+V.height&&(v=A.y+I-V.y-V.height),v&&(S.ty(S.ty()-v),p.y-=v),S.beginEditing({data:Z.data,property:E,value:S.getValue(Z.data,E),event:$,rect:A,editorRect:p,view:S})}}S.setSelectRowIndex(j)}J.clear()},handleWindowMouseMove:function(s){this.handleWindowTouchMove(s)},handleWindowTouchMove:function(q){var v=this,Q=v.pv,k=v.ty,L=v.cp,H=sb(q),E=v._62O;if("p"===E)Q.setTranslateY(k+H.y-L.y);else if("c"===E){var r=Q.getWidth()-Q._indent;if(r>16){var j=v.p-(L.x-H.x)/r,T=16/r;T>j&&(j=T),j>1-T&&(j=1-T),Q.setColumnPosition(j)}}else"s"===E&&Q.setTranslateY(k+(L.y-H.y)*Q._59I/Q._29I.height)},handle_mousemove:function(B){this.handle_touchmove(B)},handle_touchmove:function(R){if(!Si&&wn(R)){var y=this,p=y.pv,S=H(p.lp(R).x-p._9I)<=(vd?8:3);y.cp?y._62O||(S?(y._62O="c",np(y,R)):H(sb(R).y-y.cp.y)>=2&&(y._62O=y.isV(R)?"s":"p",np(y,R))):(S?y.setCursor(ag):y.setCursor(vj),y.isV(R)&&p._43o())}},isV:function(C){var H=this.pv,A=H._29I;return H._41o()&&A.x+A.width-H.lp(C).x<rk},handle_mousewheel:function(o){this.handleScroll(o,o.wheelDelta/40)},handle_DOMMouseScroll:function(B){2===B.axis&&this.handleScroll(B,-B.detail)},handleScroll:function(J,E){var D=this.pv;$r(J),D.endEditing(),D.translate(0,E*D.getRowHeight())},handle_keydown:function(i){var C=this.pv,I=C._rows.size(),v=C._selectRowIndex+(Hr(i)?-1:1);(Hr(i)||Fe(i))&&(0>v&&(v=0),v>=I&&(v=I-1),C.setSelectRowIndex(v))}}),Fs.ListView=function(z){this._5o(z),new Ns(this)},Gs("ListView",U,{ms_ac:[Hi,me,ek,Pe,Bj,th,Bc,Pf,qf,Jo,Hg,gs,Fd,Yj],ms_v:1,ms_bnb:1,ms_tip:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,_14Q:1,ms_dm:1,_45o:1,_checkMode:!1,_indent:Ef,_rowHeight:vb,_rowLineVisible:m.listViewRowLineVisible,_rowLineColor:m.listViewRowLineColor,_scrollBarColor:Bi,_scrollBarSize:Pl,_autoMakeVisible:yg,_autoHideScrollBar:ce,_selectBackground:m.listViewSelectBackground,_labelColor:m.listViewLabelColor,_labelSelectColor:m.listViewLabelSelectColor,_labelFont:m.listViewLabelFont,isCheckMode:function(){return this._checkMode
},setCheckMode:function(q){var H=this,W=H._checkMode;H._checkMode=q,H.fp(Fg,W,q)},drawRow:function(W,$,u,D,v,f,k){var P=this,V=0,K=P._indent,q=P.getIconWidth($);P.drawRowBackground(W,$,u,D,v,f,k),P._checkMode&&(Op(W,Qd(P.getCheckIcon($)),V+K/2,v+k/2,$,P),V+=K),P.drawIcon(W,$,V,v,q,k),P.drawLabel(W,$,V+q,v,k)}});var Ns=function(a){this.list=a,this._lastSelectDataTime=Pc(),this.addListeners()};Ad(Ns,U,{ms_listener:1,getView:function(){return this.list._view},clear:function(V){var d=this,Q=d.list;V&&"d"===d._62O&&!d.dragCancel&&Q.handleDragAndDrop(V,"end"),Q.draggingData&&(Q.draggingData=null,Q.redraw()),d.dragCancel=d._62O=d._isV=d._isH=d.cp=d.tx=d.ty=z},handle_mousedown:function(C){this.handle_touchstart(C)},handle_touchstart:function(T){var H=this,Q=H.list;if($r(T),Q.setFocus(T)){var e=Q.getDataAt(T);H.cp=sb(T),H.tx=Q.tx(),H.ty=Q.ty(),wn(T)?e&&Q.handleDragAndDrop&&!H.isV(T)&&!H.isH(T)&&(Q.draggingData=e,Q.redraw(),Q.handleDragAndDrop(T,"prepare")):(e&&H._33o(T,e),H.clear(T))}},handleWindowMouseUp:function(s){this.clear(s)},handleWindowTouchEnd:function(u){this.clear(u)},handle_mouseup:function(p){this.handle_touchend(p)},handle_touchend:function(r){var E=this,L=E.list;if(!E._isV&&!E._isH&&E.cp&&!E._62O){var v=L.getDataAt(r);v?(L.isCheckMode()?E._34o(r,v):E._33o(r,v),cm(r)?L.onDataDoubleClicked(v,r):L.onDataClicked(v,r)):L.handleBackgroundClick(r)}E.clear(r)},handleWindowMouseMove:function(U){this.handleWindowTouchMove(U)},handleWindowTouchMove:function(Z){var D=this,I=D.list,p=D._62O,d=D.tx,z=D.ty,n=D.cp,y=sb(Z),Y=I._29I;"p"===p?I.setTranslate(d+y.x-n.x,z+y.y-n.y):"v"===p?I.ty(z+(n.y-y.y)*I._59I/Y.height):"h"===p?I.tx(d+(n.x-y.x)*I._91I/Y.width):"d"===p&&(D.dragCancel||I.handleDragAndDrop(Z,"between"))},handle_mousemove:function(P){this.handle_touchmove(P)},handle_touchmove:function(n){if(!Si&&wn(n)){var s=this,y=s.list;if(s._isV=s.isV(n),s._isH=s.isH(n),s.cp){if(!s._62O){if(id(sb(n),s.cp)<2)return;s._isV?s._62O="v":s._isH?s._62O="h":y.draggingData&&!this.dragCancel?(s._62O="d",y.handleDragAndDrop(n,"begin")):s._62O="p",s._62O&&"d"!==s._62O&&y.draggingData&&(y.draggingData=null,y.redraw()),np(s,n)}}else s._isV&&y._43o(),s._isH&&y._42o()}},isV:function(N){var e=this.list,T=e._29I;return e._41o()&&T.x+T.width-e.lp(N).x<rk},isH:function(h){var w=this.list,x=w._29I;return w._40o()&&x.y+x.height-w.lp(h).y<rk},handle_mousewheel:function(V){this.handleScroll(V,V.wheelDelta/40,V.wheelDelta!==V.wheelDeltaX)},handle_DOMMouseScroll:function(d){this.handleScroll(d,-d.detail,1)},handleScroll:function(O,W,D){var E=this.list;$r(O),E.endEditing&&E.endEditing(),D&&E._41o()?E.translate(0,W*E.getRowHeight()):E._40o()&&E.translate(10*W,0)},handle_keydown:function(U){if(!m.isInput(U.target)){var O,Q=this.list,l=Q.sm(),n=Q._rows,h=n.size();if(Rj(U))Q.selectAll();else if(Mg(U))Q.handleDelete&&Q.handleDelete(U);else if(qd(U))"d"!==this._62O||this.dragCancel||(Q.handleDragAndDrop(U,"cancel"),this.dragCancel=!0);else if(Wh(U))Q.isCheckMode()&&(O=Q.getFocusData(),O&&Q.checkData(O));else if(Hr(U)||Fe(U)){var K=Q.isCheckMode();if(O=K?Q.getFocusData():l.ld()){var M=Q.getRowIndex(O);M>=0&&(Hr(U)?0!==M&&(O=n.get(M-1),K?Q.setFocusData(O):l.ss(O)):M!==h-1&&(O=n.get(M+1),K?Q.setFocusData(O):l.ss(O)))}else h>0&&(O=n.get(0),K?Q.setFocusData(O):l.ss(O))}}},_34o:function(P,z){var j=this.list,C=j.lp(P).x;return C>=0&&C<=j._indent?(j.checkData(z),void 0):(j.setFocusData(z),void 0)},_33o:function(Y,K){var p=this.list,F=p.sm(),Z=F.ld();if(Kb(Y))p.isSelected(K)?F.rs(K):F.as(K);else if(Zh(Y))if(Z)for(var c=p.getRowIndex(Z),y=p.getRowIndex(K);c!==y;)c+=y>c?1:-1,F.as(p._rows.get(c));else F.ss(K);else if(wn(Y)){var R=Pc();if(F.contains(K)){var s=R-this._lastSelectDataTime;p.handleDataDoubleSelect&&s>500&&1500>s&&p.handleDataDoubleSelect(Y,K)}F.ss(K),this._lastSelectDataTime=R}else F.contains(K)||F.ss(K)}}),Fs.TreeView=function(F){var e=this;e._35o(),e._5o(F),new Os(e)},Gs("TreeView",U,{ms_ac:[Hi,me,ek,"rootVisible",Fg,"rootData",Pf,qf,Jo,Hg,gs,Bj,Pe,th,Bc,Rc,bh,Fd,Yj,"loader","doubleClickToToggle"],ms_v:1,ms_bnb:1,ms_tip:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,_48o:1,_14Q:1,_45o:1,_checkMode:z,_indent:Ef,_rowHeight:vb,_rowLineVisible:m.treeViewRowLineVisible,_rowLineColor:m.treeViewRowLineColor,_scrollBarColor:Bi,_scrollBarSize:Pl,_autoHideScrollBar:ce,_expandIcon:m.treeViewExpandIcon,_collapseIcon:m.treeViewCollapseIcon,_autoMakeVisible:yg,_selectBackground:m.treeViewSelectBackground,_labelColor:m.treeViewLabelColor,_labelSelectColor:m.treeViewLabelSelectColor,_labelFont:m.treeViewLabelFont,_doubleClickToToggle:m.treeViewDoubleClickToToggle,drawRow:function(v,a,S,Y,Z,q,r){var n=this;n.drawRowBackground(v,a,S,Y,Z,q,r),n.drawTree(v,a,S,0,Z,q,r)},isOnToggleIcon:function($){var V=this.getDataAt($);if(V){var v=this.getIndent(),C=this.lp($).x;if(Qd(this.getToggleIcon(V))){var G=v*this.getLevel(V);if(C>=G&&G+v>=C)return!0}}return!1}});var Os=function(p){ac(Os,this,[p])};Ad(Os,Ns,{toggle:function(S,d,A,p){var K=this.list,q=K.lp(S).x;if(Qd(K.getToggleIcon(d))){var V=A*p;if(q>=V&&V+A>=q)return K.toggle(d),!0}return K.isDoubleClickToToggle()&&cm(S)?(K.toggle(d),!0):!1},_34o:function(s,f){var w=this.list,c=w.lp(s).x,e=w._levelMap[f._id],X=w._indent,J=X*(e+1);return c>=J&&J+X>=c?(w.checkData(f),void 0):(this.toggle(s,f,X,e)||w.setFocusData(f),void 0)},_33o:function(a,G){var S=this,d=S.list;if(!S.toggle(a,G,d._indent,d.getLevel(G)))if(Zh(a)){var W=d.sm();if(W.size()>0){for(var l=d._rows,R=null,Q=0,U=l.size();U>Q;Q++)if(d.isSelected(l.get(Q))){R=Q;break}for(var j=null,Q=l.size()-1;Q>=0;Q--)if(d.isSelected(l.get(Q))){j=Q;break}var J,I,A=d.getRowIndex(G);for(R>A?(J=A-1,I=R):A>j?(J=j,I=A):(J=R,I=j);J!==I;)J++,W.as(d._rows.get(J))}else W.ss(G)}else Os.superClass._33o.call(S,a,G)},handle_keydown:function(y){if(sr(y)||Kf(y)){var A=this.list,X=A._rows,l=A.isCheckMode(),I=A.sm(),b=l?A.getFocusData():I.ld();b?b.hasChildren()&&(sr(y)?A.collapse(b):A.expand(b)):X.size()>0&&(b=X.get(0),l?A.setFocusData(b):I.ss(b))}else Os.superClass.handle_keydown.call(this,y)}});var Ps=Fs.TableView=function(s){this._98I(),this._5o(s),new Qs(this)};Gs("TableView",U,{ms_ac:[Hi,me,ek,"sortMode",be,sc,Pe,th,Bc,nj,_n,"sortColumn",Pf,qf,Jo,Hg,gs,Fd,Yj],ms_v:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,ms_tip:1,_50o:1,_45o:1,_47o:1,_sortMode:gp,_editable:!0,_batchEditable:!1,_rowHeight:vb,_rowLineVisible:m.tableViewRowLineVisible,_rowLineColor:m.tableViewRowLineColor,_columnLineVisible:m.tableViewColumnLineVisible,_columnLineColor:m.tableViewColumnLineColor,_scrollBarColor:Bi,_scrollBarSize:Pl,_autoHideScrollBar:ce,_autoMakeVisible:yg,_selectBackground:m.tableViewSelectBackground,_labelColor:m.tableViewLabelColor,_labelSelectColor:m.tableViewLabelSelectColor,_labelFont:m.tableViewLabelFont,getCheckColumn:function(){var g=this;if(!g._31o){var t=g._31o=new Is;t.setEditable(!0),t.setWidth(40),t.getValue=g.getCheckColumValue,t.drawCell=g.drawCheckColumnCell}return g._31o},isCheckMode:function(){return this._39o.contains(this._31o)},setCheckMode:function(s){var S=this,C=S._39o,e=S.getCheckColumn();s!==S.isCheckMode()&&(s?C.add(e,0):C.remove(e),S.fp(Fg,!s,s))},getCheckColumValue:function(n,L,z){return z.isSelected(n)},drawCheckColumnCell:function(Y,z,Z,P,s,f,l,w,n){Op(Y,n.getCheckIcon(z),s+l/2,f+w/2,z,n)}});var Qs=function(i){ac(Qs,this,[i])};Ad(Qs,Ns,{_34o:function(u,K){var g=this.list,T=g._31o;if(g.isCellEditable(K,T,u)){var L=g._3Q(T),b=g.lp(u).x;if(L&&b>=L.startX&&b<L.startX+T.getWidth())return g.checkData(K),void 0}g._37O(K,u),g.setFocusData(K)},_33o:function(B,c){this.list._37O(c,B),Qs.superClass._33o.apply(this,arguments)}});var Rs=Fs.TreeTableView=function(D){var M=this,H=M._4o=new Is;M._35o(),M._98I(),M._5o(D),H.setDisplayName("Name"),H.setEditable(!0),H.setWidth(180),H.drawCell=Ss,H.getValue=Ts,M._39o.add(H),new Us(M)},Ss=function(C,m,e,i,G,D,t,X,O){O.drawTree(C,m,e,G,D,t,X)},Ts=function(E,e,d){return d.getLabel(E)};Gs("TreeTableView",U,{ms_ac:[Hi,me,ek,"sortMode",be,sc,Bj,Fg,"rootData","rootVisible",Pf,qf,"sortColumn",Rc,bh,Jo,Hg,gs,Fd,Bc,Pe,th,nj,_n,Yj,"loader"],ms_v:1,ms_bnb:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,ms_tip:1,_50o:1,_48o:1,_14Q:1,_45o:1,_47o:1,_sortMode:gp,_checkMode:z,_editable:!0,_batchEditable:!1,_indent:Ef,_rowHeight:vb,_rowLineVisible:m.treeTableViewRowLineVisible,_rowLineColor:m.treeTableViewRowLineColor,_columnLineVisible:m.treeTableViewColumnLineVisible,_columnLineColor:m.treeTableViewColumnLineColor,_expandIcon:m.treeTableViewExpandIcon,_collapseIcon:m.treeTableViewCollapseIcon,_scrollBarColor:Bi,_scrollBarSize:Pl,_autoHideScrollBar:ce,_autoMakeVisible:yg,_selectBackground:m.treeTableViewSelectBackground,_labelColor:m.treeTableViewLabelColor,_labelSelectColor:m.treeTableViewLabelSelectColor,_labelFont:m.treeTableViewLabelFont,getTreeColumn:function(){return this._4o}});var Us=function(I){ac(Us,this,[I])};Ad(Us,Ns,{_34o:function(l,q){var P=this.list,h=P._4o,j=P._3Q(h),d=P.lp(l).x;if(j){var v=P._indent,g=j.startX+v*P.getLevel(q);if(Qd(P.getToggleIcon(q))&&d>=g&&g+v>=d)return P.toggle(q),void 0;if(P.isCellEditable(q,h)&&(g+=v,d>=g&&g+v>=d))return P.checkData(q),void 0}P._37O(q,l),P.setFocusData(q)},_33o:function(a,e){var w=this.list,r=w.lp(a).x;if(Qd(w.getToggleIcon(e))){var F=w._3Q(w._4o);if(F){var c=w._indent,K=F.startX+c*w.getLevel(e);if(r>=K&&K+c>=r)return w.toggle(e),void 0}}w._37O(e,a),Us.superClass._33o.apply(this,arguments)}});var Vs=Fs.TableHeader=function(p){var u=this,n=u._view=Ul(1,u),C=u._39o=p.getColumnModel(),$=u.iv;u.tv=u._tableView=p,u._60I=new df,u._canvas=pn(n),n.style.background=m.tableHeaderBackground||"",n.style.height=Mo+Tq,C.mm($,u),C.md($,u),C.mh($,u),p.mp(function(f){Zp[f.property]&&u.iv()},u),new Ws(u),u.iv()};Gs("TableHeader",U,{ms_v:1,ms_lp:1,ms_fire:1,ms_ac:["checkIcon","sortDescIcon","sortAscIcon",Hi,ek,Bj,"moveBackground","insertColor",nj,_n,"resizable","movable"],_checkIcon:ne,_movable:!0,_resizable:!0,_labelColor:m.tableHeaderLabelColor,_labelFont:m.tableHeaderLabelFont,_columnLineColor:m.tableHeaderColumnLineColor,_columnLineVisible:m.tableHeaderColumnLineVisible,_sortDescIcon:m.tableHeaderSortDescIcon,_sortAscIcon:m.tableHeaderSortAscIcon,_moveBackground:m.tableHeaderMoveBackground,_insertColor:m.tableHeaderInsertColor,_indent:Ef,getCheckIcon:function(){return this._checkIcon},getTableView:function(){return this.tv},getLabel:function(l){return l.toLabel()},getLabelFont:function(){return this._labelFont},getLabelColor:function(M){return M.getColor()||this._labelColor},getLabelAlign:function(p){return p._align},onPropertyChanged:function(){this.iv()},_5Q:function(i){this._61I=i,this.iv()},getLogicalPoint:function(A){return bp(A,this._canvas,this.tv.tx())},validateImpl:function(){var Z=this,C=Z._canvas,f=Z.getWidth(),D=Z.getHeight(),K=Z.tv,H=Z._60I,_=Z._61I,q=-K.tx(),B=0;(f!==C.clientWidth||D!==C.clientHeight)&&vl(C,f,D),H.clear(),Z._39o._roots.each(function(k){if(k.isVisible()){var r=B+k.getWidth();q+f>=B&&r>=q&&H.add({column:k,startX:B}),B=r}});var t=vs(C);if(kn(t,-q,0,1),t.beginPath(),t.rect(q,0,f,D),t.clip(),t.clearRect(q,0,f,D),H.each(function(V){var P=V.column,g=V.startX,f=P.getWidth();f>0&&(t.save(),t.beginPath(),t.rect(g,0,f,D),t.clip(),_&&_.column===P||Z.drawColumn(t,P,g,0,f,D),Z._columnLineVisible&&em(t,g+f-1,0,1,D,Z._columnLineColor),t.restore())}),_){var x=_.column,B=_.startX,y=_.position,Y=x.getWidth();t.save(),t.beginPath(),t.rect(B,0,Y,D),t.clip(),t.fillStyle=Z._moveBackground,t.fill(),Z.drawColumn(t,x,B,0,Y,D),t.restore(),fg(t,Z._insertColor,y,0,D)}t.restore()},_6Q:function(c){var b=this.tv;return b._31o===c&&b.sm().getSelectionMode()===Wo},drawColumn:function(B,f,Q,b,M,G){var Z=this,h=Z.tv,T=Qd(f.getIcon()),E=Z.getLabelAlign(f);if(Z._6Q(f)){var P=Qd(Z._checkIcon);Op(B,P,Q+M/2,b+G/2,f,Z)}else{var p=Z.getLabel(f),W=Z.getLabelFont(f),l=Z.getLabelColor(f),R=Yf(W,p).width,a=T?Z._indent:0;E===ec?(T&&Xm(B,T,bd,Q,b,a,G),Kq(B,p,W,l,Q+a,b,M,G,ec)):E===Gj?(T&&Xm(B,T,bd,Q+M-R-a,b,a,G),Kq(B,p,W,l,Q,b,M,G,Gj)):(T&&Xm(B,T,bd,Q+(M-R-a)/2,b,a,G),Kq(B,p,W,l,Q+(M-R+a)/2,b,0,G,ec))}if(f.isSortable()&&h.getSortColumn()===f&&(T=Qd(f.getSortOrder()===zb?Z._sortAscIcon:Z._sortDescIcon))){var n=Uk(T,f)/2+2;Op(B,T,E===Gj?Q+n:Q+M-n,b+G/2,f,h)}}});var Ws=function(V){var W=this;W.th=V,W.tv=V._tableView,W.addListeners()};Ad(Ws,U,{ms_listener:1,getView:function(){return this.th.getView()},setCursor:function(e){this.getView().style.cursor=e},handle_mousemove:function(b){if(!Si){var T=this;delete T._29o,T.setCursor(vj);for(var i=T.th,U=i._60I,n=i.lp(b).x,F=U.size()-1;F>=0;F--){var w=U.get(F),t=w.column,N=w.startX+t.getWidth();if(i.isResizable()&&H(N-n)<=(vd?10:3))return T._29o=w,T.setCursor(ag),void 0;n>w.startX&&N>n&&(T._29o=w),(t.isClickable()||t.isSortable()||i.isMovable()||T.tv.getCheckColumn&&t===T.tv.getCheckColumn())&&n>w.startX&&N>n&&T.setCursor(Rh)}}},handle_mousedown:function(c){this.handle_touchstart(c)},handle_touchstart:function(t){var S=this;$r(t),S.tv.endEditing(),S.handle_mousemove(t),S._29o&&(S.x=sb(t).x,S.lx=S.th.lp(t).x,S.w=S._29o.column.getWidth(),np(S,t))},handleWindowMouseMove:function(p){this.handleWindowTouchMove(p)},handleWindowTouchMove:function(S){var v=this,$=v.th,j=v.getView().style.cursor,n=v._29o,N=sb(S).x-v.x;if(v.resizing||v.moving||(j===ag?v.resizing=1:$.isMovable()&&j===Rh&&H(N)>2&&(v.moving=1)),v.resizing)n.column.setWidth(v.w+N);else if(v.moving){var B=v.lx+N;$._60I.each(function(P){var h=P.startX,D=h+P.column.getWidth();if(B>=h&&D>=B){var m={column:n.column,startX:n.startX+N,front:D-B>B-h,insertColumn:P.column};m.position=m.front?h:D,$._5Q(m)}})}},_16Q:function(G,Q){var b=this,J=b.tv,O=b.th,N=O._checkIcon;if(O._6Q(G)){var e=Qd(N),Y=b.lx,V=G.getWidth(),A=Uk(e,G);if(Y>=Q+V/2-A&&Q+V/2+A>=Y){O.setCheckIcon(N===Yh?ne:Yh);var T=J.sm(),t=J._rows;return N===Yh?T.rs(t):T.ss(t),J.onCheckColumnClicked(G),!0}}return!1},handleWindowMouseUp:function(T){this.handleWindowTouchEnd(T)},handleWindowTouchEnd:function(p){var Y=this,k=Y.tv,R=Y.th,c=Y._29o;if(Y.moving){var L=R._61I;if(L&&L.insertColumn!==L.column){var S=L.column,V=k.getColumnModel()._roots,m=V.remove(S),O=V.indexOf(L.insertColumn);O>=0&&(L.front||O++,O<=V.size()&&(V.add(S,O),k.getColumnModel()._38I(S,m,O)))}R._5Q(z),delete Y.moving}else if(!Y.resizing&&c){S=c.column;var x=R.lp(p).x,d=c.startX,K=!0;if(R.onColumnClicked){var h=R.onColumnClicked(S,p,d);h===!1&&(K=!1)}if(K&&x>=d&&x<=d+S.getWidth()&&!Y._16Q(S,d)){if(S.isSortable()){var W=k.getSortMode(),e=S.getSortOrder();W===gp?k.getSortColumn()===S?(e===Gk&&k.setSortColumn(z),S.setSortOrder(e===zb?Gk:zb)):k.setSortColumn(S):"bistate"===W&&(k.getSortColumn()===S?S.setSortOrder(e===zb?Gk:zb):k.setSortColumn(S))}k.onColumnClicked(S,p,d)}}Y._29o=Y.resizing=Y.x=Y.lx=Y.w=z}}),Fs.TablePane=function(R){this.init(new Ps(R))},Gs("TablePane",U,{ms_v:1,_44o:1}),Fs.TreeTablePane=function(s){this.init(new Rs(s))},Gs("TreeTablePane",U,{ms_v:1,_44o:1}),Fs.Toolbar=function($){var a=this,S=a._view=Ul(1,a),f=S.style;f.background=m.toolbarBackground||"",f.height=al+Tq,a._canvas=pn(S),a._30o=new df,a._90I=new df,a.setItems($||[]),S.handleGroupSelectedChanged=function(w){if(w.isSelected()){var S=w.getGroupId();null!=S&&a._items.forEach(function(Q){var M=Q.element;M&&M!==w&&M.setSelected&&M.getGroupId&&M.getGroupId()===S&&M.setSelected(!1)})}},new Xs(a)},Gs("Toolbar",U,{ms_v:1,ms_fire:1,ms_tx:1,ms_lp:1,ms_tip:1,ms_value:1,ms_ac:[zf,Hi,ek,me,Yj,"itemGap","separatorColor","currentItem","stickToRight"],_labelColor:m.toolbarLabelColor,_labelSelectColor:m.toolbarLabelSelectColor,_labelFont:m.toolbarLabelFont,_selectBackground:m.toolbarSelectBackground,_itemGap:m.toolbarItemGap,_separatorColor:m.toolbarSeparatorColor,_stickToRight:!1,getSumWidth:function(){return this._64I},getToolTip:function(X){var x=this.getItemInfoAt(X);return x?x.item.toolTip:z},getLabelColor:function(x){return x&&x.selected&&x.type!==Yh&&x.type!==nb?this._labelSelectColor:this._labelColor},onPropertyChanged:function(o){this.iv(),o.property===zf&&this._items.forEach(function(O){no(O)})},redraw:function(){this.iv()},addItem:function(g,x){var j=this._items;x==z?j.push(g):j.splice(x,0,g),this.fp(zf,z,j)},removeItem:function(w){if(w)for(var _=this._items,O=0;O<_.length;O++)w===_[O]&&(_.splice(O,1),this.fp(zf,z,_))},removeItemById:function(f){if(f!=z)for(var M=this._items,A=0;A<M.length;A++)if(f===M[A].id){var R=M.splice(A,1)[0];return this.fp(zf,z,M),R}},getItemById:function(h){if(h!=z)for(var J=this._items,I=0;I<J.length;I++){var S=J[I];if(h===S.id)return S}},setItemVisible:function(t,X){var p=this.getItemById(t);p&&(p.visible=X)},getItemInfos:function(){return this._30o},getItemInfoAt:function(r){var f=this,I=0,L=f._30o,x=f.lp(r),g=x.x,A=x.y;if(A>=0&&A<=f.getHeight())for(;I<L.size();I++){var G=L.get(I);if(G.startX<=g&&g<=G.endX)return G}return z},drawItem:function(H,J,N,Q,k){if(J.visible===!1)return 0;if(Jc(J.visible)&&!J.visible())return 0;var j=this,e=J.disabled;e&&(H.globalAlpha=Kd);var i=j.drawItemImpl(H,J,N,Q,k),c=j._itemGap;return e&&(H.globalAlpha=1),this._currentItem!==J||"separator"===J||J.separator===!0||J.unfocusable||_q(H,j._separatorColor,N-c/2,0,i+c,Q),i},drawItemImpl:function(W,m,d,v,o){var x=this,M=x._view,Y=x._itemGap,Z=v/2,V=m.type,L=m.element,P=m.label;yk(L)&&(P=L,L=z);var n,X=x.getLabelFont(m),l=x.getLabelColor(m),I=m.selected,q=Qd(m.icon),b=Uk(q,m),a=0,p=b+(P?Yf(X,P).width:0);if("separator"===m||m.separator===!0)return fg(W,x._separatorColor,d,v/4,Z),1;if(L){q&&Op(W,q,d+b/2,Z,m,x),Kq(W,P,X,l,d+b,0,0,v);var E=zs(L);o||x._90I.add(E),E.parentNode!==M&&tc(M,E),L.iv&&L.iv(),L.validate&&L.validate();var N=E.getBoundingClientRect(),s=N.width,t=E.style;return xs(E),t.left=x.tx()+d+p+Tq,t.top=(v-N.height)/2+Tq,p+s}return V===nb?n=Qd(I?$o:Er):V===Yh&&(n=Qd(I?Yh:ne)),n?(a=Uk(n,m),Op(W,n,d+a/2,Z,m,x),d+=a,p+=a):I&&em(W,d-Y/2,0,p+Y,v,x.getSelectBackground(m)),q&&Op(W,q,d+b/2,Z,m,x),Kq(W,P,X,l,d+b,0,0,v),p},validateImpl:function(){var v=this,Q=v._canvas,G=v.getWidth(),M=v.getHeight(),l=v._30o,f=v._items;vl(Q,G,M);var h=vs(Q),V=v._itemGap,b=V/2;kn(h,v.tx(),0,1),h.clearRect(0,0,G,M);var k=v._90I;v._90I=new df,l.clear(),f.forEach(function(p){var U=v.drawItem(h,p,b,M);l.add({item:p,startX:b,endX:b+U,width:U}),U&&(b+=U+V)}),k.each(function(c){v._90I.contains(c)||Rd(c)});var w=v._64I;v._64I=W(0,b),h.restore(),v._stickToRight?(v._65O=0,h=vs(Q),b=G-v._64I+V,kn(h,0,0,1),h.clearRect(0,0,G,M),l.clear(),f.forEach(function(e){var U=v.drawItem(h,e,b,M,!0);l.add({item:e,startX:b,endX:b+U,width:U}),U&&(b+=U+V)}),h.restore()):v.tx(v.tx()),w!==v._64I&&v.onSumWidthChanged(w,v._64I)},onSumWidthChanged:function(){},handleClick:function(E,b){var L=this,j=E.type,$=E.action,Y=E.groupId,d=E.selected;E.disabled||(Y!=z?d||(E.selected=!0,this._items.forEach(function(U){U.groupId===Y&&E!==U&&(U.selected=!1)}),$&&E.action(E,L,b)):j===Yh||"toggle"===j?(E.selected=!d,$&&E.action(E,L,b)):$&&E.action(E,L,b)),Eh(),L.iv()}});var Xs=function(j){this.tb=j,this.addListeners()};Ad(Xs,U,{ms_listener:1,getView:function(){return this.tb._view},handle_mousewheel:function(p){this.handleScroll(p,10*(p.wheelDelta/40))},handle_DOMMouseScroll:function(B){this.handleScroll(B,10*-B.detail)},handleScroll:function(P,z){$r(P);var Y=this.tb;Y.isScrollable()&&!Y._stickToRight&&(Y.tx(Y.tx()+z),wl())},handle_mousemove:function(v){var F=this;Si||F.setItem(v)},handle_mouseout:function(a){var s=this;a.target===s.getView()?s.tb.setCurrentItem(z):s.handle_mousemove(a)},handle_mousedown:function(l){this.handle_mousemove(l),this.handle_touchstart(l)},handle_touchstart:function(L){var E=this,m=E.tb,Q=L.target;wn(L)&&(Q===E.getView()||Q===m._canvas)&&($r(L),m.setFocus(L)&&(this.setItem(L,!0),(m.isScrollable()||E.info&&!E.info.item.disabled)&&(E.x=sb(L).x,E.tx=m.tx(),np(E,L))))},handleWindowMouseMove:function(D){this.handleWindowTouchMove(D)},handleWindowTouchMove:function(g){var F=this,S=F.tb;if(!S._stickToRight){var i=sb(g).x-F.x;!F._25o&&H(i)>2&&S.isScrollable()&&(F._25o=1),F._25o&&S.tx(F.tx+i)}},handleWindowMouseUp:function(N){this.handleWindowTouchEnd(N)},handleWindowTouchEnd:function(h){var i=this,U=i.tb,f=i.info,v=i.tb.getItemInfoAt(h);if(!i._25o&&f){var C=f.item;v&&v.item===C&&U.handleClick(C,h)}i._25o=i.x=i.tx=z,i.setItem()},setItem:function(c,X){var x=this,F=x.tb,R=x.info=c?F.getItemInfoAt(c):z,Q=R?R.item:z;F.setCurrentItem(Q),X&&Q&&Jc(Q.onDown)&&Q.onDown(c)}}),Fs.BorderPane=function(){this._view=Ul(1,this),this.iv()},Gs("BorderPane",U,{ms_v:1,ms_ac:["topHeight","bottomHeight","leftWidth","rightWidth"],ms_fire:1,getLeftView:function(){return this._leftView},setLeftView:function(B,x){this._12o("leftView",B),x!=z&&this.setLeftWidth(x)},getRightView:function(){return this._rightView},setRightView:function(F,P){this._12o("rightView",F),P!=z&&this.setRightWidth(P)},getTopView:function(){return this._topView},setTopView:function(q,p){this._12o("topView",q),p!=z&&this.setTopHeight(p)},getBottomView:function(){return this._bottomView},setBottomView:function(M,C){this._12o("bottomView",M),C!=z&&this.setBottomHeight(C)},getCenterView:function(){return this._centerView},setCenterView:function(X){this._12o("centerView",X)},_12o:function(c,L){var V=this,f="_"+c,t=V._view,s=V[f];s!==L&&(s&&(s.getView?Rd(s.getView()):Rd(s)),V[f]=L,L&&(L.getView?tc(t,L.getView(),1):tc(t,L,1)),V.fp(c,s,L))},onPropertyChanged:function(){this.iv()},validateImpl:function(){var j=this,Z=j._topView,l=j._bottomView,C=j._leftView,R=j._rightView,q=j._centerView,T=j.getWidth(),n=j.getHeight(),I=0,w=0,x=T,Y=n,d=0,u=0,o=0,J=0;Z&&(d=j._topHeight==z?rl(Z):j._topHeight,w=d),l&&(u=j._bottomHeight==z?rl(l):j._bottomHeight,Y=n-u),C&&(o=j._leftWidth==z?Ym(C):j._leftWidth,I=o),R&&(J=j._rightWidth==z?Ym(R):j._rightWidth,x=T-J);var P=W(0,x-I),S=W(0,Y-w);Z&&Ln(Z,0,0,T,d),l&&Ln(l,0,Y,T,u),C&&Ln(C,0,w,o,S),R&&Ln(R,x,w,J,S),q&&Ln(q,I,w,P,S)}})}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);